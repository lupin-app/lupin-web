import {
  __export
} from "./chunk-G3PMV62Z.js";

// node_modules/@amplitude/analytics-core/node_modules/tslib/tslib.es6.mjs
var extendStatics = function(d2, b2) {
  extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
    d3.__proto__ = b3;
  } || function(d3, b3) {
    for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
  };
  return extendStatics(d2, b2);
};
function __extends(d2, b2) {
  if (typeof b2 !== "function" && b2 !== null)
    throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
  extendStatics(d2, b2);
  function __() {
    this.constructor = d2;
  }
  d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
}
var __assign = function() {
  __assign = Object.assign || function __assign7(t2) {
    for (var s2, i2 = 1, n2 = arguments.length; i2 < n2; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2)) t2[p2] = s2[p2];
    }
    return t2;
  };
  return __assign.apply(this, arguments);
};
function __rest(s2, e2) {
  var t2 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e2.indexOf(p2) < 0)
    t2[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e2.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t2[p2[i2]] = s2[p2[i2]];
    }
  return t2;
}
function __awaiter(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e2) {
        reject(e2);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e2) {
        reject(e2);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t2[0] & 1) throw t2[1];
    return t2[1];
  }, trys: [], ops: [] }, f2, y2, t2, g2 = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
  return g2.next = verb(0), g2["throw"] = verb(1), g2["return"] = verb(2), typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n2) {
    return function(v2) {
      return step([n2, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t2 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t2 = y2["return"]) && t2.call(y2), 0) : y2.next) && !(t2 = t2.call(y2, op[1])).done) return t2;
      if (y2 = 0, t2) op = [op[0] & 2, t2.value];
      switch (op[0]) {
        case 0:
        case 1:
          t2 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t2 = _2.trys, t2 = t2.length > 0 && t2[t2.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t2 || op[1] > t2[0] && op[1] < t2[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t2[1]) {
            _2.label = t2[1];
            t2 = op;
            break;
          }
          if (t2 && _2.label < t2[2]) {
            _2.label = t2[2];
            _2.ops.push(op);
            break;
          }
          if (t2[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e2) {
      op = [6, e2];
      y2 = 0;
    } finally {
      f2 = t2 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}
function __values(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
function __read(o2, n2) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r2, ar = [], e2;
  try {
    while ((n2 === void 0 || n2-- > 0) && !(r2 = i2.next()).done) ar.push(r2.value);
  } catch (error) {
    e2 = { error };
  } finally {
    try {
      if (r2 && !r2.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e2) throw e2.error;
    }
  }
  return ar;
}
function __spreadArray(to, from, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from.length, ar; i2 < l2; i2++) {
    if (ar || !(i2 in from)) {
      if (!ar) ar = Array.prototype.slice.call(from, 0, i2);
      ar[i2] = from[i2];
    }
  }
  return to.concat(ar || Array.prototype.slice.call(from));
}

// node_modules/@amplitude/analytics-core/lib/esm/types/event/event.js
var IdentifyOperation;
(function(IdentifyOperation3) {
  IdentifyOperation3["SET"] = "$set";
  IdentifyOperation3["SET_ONCE"] = "$setOnce";
  IdentifyOperation3["ADD"] = "$add";
  IdentifyOperation3["APPEND"] = "$append";
  IdentifyOperation3["PREPEND"] = "$prepend";
  IdentifyOperation3["REMOVE"] = "$remove";
  IdentifyOperation3["PREINSERT"] = "$preInsert";
  IdentifyOperation3["POSTINSERT"] = "$postInsert";
  IdentifyOperation3["UNSET"] = "$unset";
  IdentifyOperation3["CLEAR_ALL"] = "$clearAll";
})(IdentifyOperation || (IdentifyOperation = {}));
var SpecialEventType;
(function(SpecialEventType2) {
  SpecialEventType2["IDENTIFY"] = "$identify";
  SpecialEventType2["GROUP_IDENTIFY"] = "$groupidentify";
  SpecialEventType2["REVENUE"] = "revenue_amount";
})(SpecialEventType || (SpecialEventType = {}));

// node_modules/@amplitude/analytics-core/lib/esm/types/constants.js
var UNSET_VALUE = "-";
var AMPLITUDE_PREFIX = "AMP";
var STORAGE_PREFIX = "".concat(AMPLITUDE_PREFIX, "_unsent");
var DEFAULT_INSTANCE_NAME = "$default_instance";
var AMPLITUDE_SERVER_URL = "https://api2.amplitude.com/2/httpapi";
var EU_AMPLITUDE_SERVER_URL = "https://api.eu.amplitude.com/2/httpapi";
var AMPLITUDE_BATCH_SERVER_URL = "https://api2.amplitude.com/batch";
var EU_AMPLITUDE_BATCH_SERVER_URL = "https://api.eu.amplitude.com/batch";
var UTM_CAMPAIGN = "utm_campaign";
var UTM_CONTENT = "utm_content";
var UTM_ID = "utm_id";
var UTM_MEDIUM = "utm_medium";
var UTM_SOURCE = "utm_source";
var UTM_TERM = "utm_term";
var DCLID = "dclid";
var FBCLID = "fbclid";
var GBRAID = "gbraid";
var GCLID = "gclid";
var KO_CLICK_ID = "ko_click_id";
var LI_FAT_ID = "li_fat_id";
var MSCLKID = "msclkid";
var RDT_CID = "rdt_cid";
var TTCLID = "ttclid";
var TWCLID = "twclid";
var WBRAID = "wbraid";
var BASE_CAMPAIGN = {
  utm_campaign: void 0,
  utm_content: void 0,
  utm_id: void 0,
  utm_medium: void 0,
  utm_source: void 0,
  utm_term: void 0,
  referrer: void 0,
  referring_domain: void 0,
  dclid: void 0,
  gbraid: void 0,
  gclid: void 0,
  fbclid: void 0,
  ko_click_id: void 0,
  li_fat_id: void 0,
  msclkid: void 0,
  rdt_cid: void 0,
  ttclid: void 0,
  twclid: void 0,
  wbraid: void 0
};
var SAFE_HEADERS = [
  "access-control-allow-origin",
  "access-control-allow-credentials",
  "access-control-expose-headers",
  "access-control-max-age",
  "access-control-allow-methods",
  "access-control-allow-headers",
  "accept-patch",
  "accept-ranges",
  "age",
  "allow",
  "alt-svc",
  "cache-control",
  "connection",
  "content-disposition",
  "content-encoding",
  "content-language",
  "content-length",
  "content-location",
  "content-md5",
  "content-range",
  "content-type",
  "date",
  "delta-base",
  "etag",
  "expires",
  "im",
  "last-modified",
  "link",
  "location",
  "permanent",
  "p3p",
  "pragma",
  "proxy-authenticate",
  "public-key-pins",
  "retry-after",
  "server",
  "status",
  "strict-transport-security",
  "trailer",
  "transfer-encoding",
  "tk",
  "upgrade",
  "vary",
  "via",
  "warning",
  "www-authenticate",
  "x-b3-traceid",
  "x-frame-options"
];
var FORBIDDEN_HEADERS = ["authorization", "cookie", "set-cookie"];

// node_modules/@amplitude/analytics-core/lib/esm/utils/valid-properties.js
var MAX_PROPERTY_KEYS = 1e3;
var isValidObject = function(properties) {
  if (Object.keys(properties).length > MAX_PROPERTY_KEYS) {
    return false;
  }
  for (var key in properties) {
    var value = properties[key];
    if (!isValidProperties(key, value))
      return false;
  }
  return true;
};
var isValidProperties = function(property, value) {
  var e_1, _a;
  if (typeof property !== "string")
    return false;
  if (Array.isArray(value)) {
    var isValid = true;
    try {
      for (var value_1 = __values(value), value_1_1 = value_1.next(); !value_1_1.done; value_1_1 = value_1.next()) {
        var valueElement = value_1_1.value;
        if (Array.isArray(valueElement)) {
          return false;
        } else if (typeof valueElement === "object") {
          isValid = isValid && isValidObject(valueElement);
        } else if (!["number", "string"].includes(typeof valueElement)) {
          return false;
        }
        if (!isValid) {
          return false;
        }
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (value_1_1 && !value_1_1.done && (_a = value_1.return)) _a.call(value_1);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
  } else if (value === null || value === void 0) {
    return false;
  } else if (typeof value === "object") {
    return isValidObject(value);
  } else if (!["number", "string", "boolean"].includes(typeof value)) {
    return false;
  }
  return true;
};

// node_modules/@amplitude/analytics-core/lib/esm/identify.js
var Identify = (
  /** @class */
  (function() {
    function Identify2() {
      this._propertySet = /* @__PURE__ */ new Set();
      this._properties = {};
    }
    Identify2.prototype.getUserProperties = function() {
      return __assign({}, this._properties);
    };
    Identify2.prototype.set = function(property, value) {
      this._safeSet(IdentifyOperation2.SET, property, value);
      return this;
    };
    Identify2.prototype.setOnce = function(property, value) {
      this._safeSet(IdentifyOperation2.SET_ONCE, property, value);
      return this;
    };
    Identify2.prototype.append = function(property, value) {
      this._safeSet(IdentifyOperation2.APPEND, property, value);
      return this;
    };
    Identify2.prototype.prepend = function(property, value) {
      this._safeSet(IdentifyOperation2.PREPEND, property, value);
      return this;
    };
    Identify2.prototype.postInsert = function(property, value) {
      this._safeSet(IdentifyOperation2.POSTINSERT, property, value);
      return this;
    };
    Identify2.prototype.preInsert = function(property, value) {
      this._safeSet(IdentifyOperation2.PREINSERT, property, value);
      return this;
    };
    Identify2.prototype.remove = function(property, value) {
      this._safeSet(IdentifyOperation2.REMOVE, property, value);
      return this;
    };
    Identify2.prototype.add = function(property, value) {
      this._safeSet(IdentifyOperation2.ADD, property, value);
      return this;
    };
    Identify2.prototype.unset = function(property) {
      this._safeSet(IdentifyOperation2.UNSET, property, UNSET_VALUE);
      return this;
    };
    Identify2.prototype.clearAll = function() {
      this._properties = {};
      this._properties[IdentifyOperation2.CLEAR_ALL] = UNSET_VALUE;
      return this;
    };
    Identify2.prototype._safeSet = function(operation, property, value) {
      if (this._validate(operation, property, value)) {
        var userPropertyMap = this._properties[operation];
        if (userPropertyMap === void 0) {
          userPropertyMap = {};
          this._properties[operation] = userPropertyMap;
        }
        userPropertyMap[property] = value;
        this._propertySet.add(property);
        return true;
      }
      return false;
    };
    Identify2.prototype._validate = function(operation, property, value) {
      if (this._properties[IdentifyOperation2.CLEAR_ALL] !== void 0) {
        return false;
      }
      if (this._propertySet.has(property)) {
        return false;
      }
      if (operation === IdentifyOperation2.ADD) {
        return typeof value === "number";
      }
      if (operation !== IdentifyOperation2.UNSET && operation !== IdentifyOperation2.REMOVE) {
        return isValidProperties(property, value);
      }
      return true;
    };
    return Identify2;
  })()
);
var IdentifyOperation2;
(function(IdentifyOperation3) {
  IdentifyOperation3["SET"] = "$set";
  IdentifyOperation3["SET_ONCE"] = "$setOnce";
  IdentifyOperation3["ADD"] = "$add";
  IdentifyOperation3["APPEND"] = "$append";
  IdentifyOperation3["PREPEND"] = "$prepend";
  IdentifyOperation3["REMOVE"] = "$remove";
  IdentifyOperation3["PREINSERT"] = "$preInsert";
  IdentifyOperation3["POSTINSERT"] = "$postInsert";
  IdentifyOperation3["UNSET"] = "$unset";
  IdentifyOperation3["CLEAR_ALL"] = "$clearAll";
})(IdentifyOperation2 || (IdentifyOperation2 = {}));
var OrderedIdentifyOperations = [
  IdentifyOperation2.CLEAR_ALL,
  IdentifyOperation2.UNSET,
  IdentifyOperation2.SET,
  IdentifyOperation2.SET_ONCE,
  IdentifyOperation2.ADD,
  IdentifyOperation2.APPEND,
  IdentifyOperation2.PREPEND,
  IdentifyOperation2.PREINSERT,
  IdentifyOperation2.POSTINSERT,
  IdentifyOperation2.REMOVE
];

// node_modules/@amplitude/analytics-core/lib/esm/types/messages.js
var SUCCESS_MESSAGE = "Event tracked successfully";
var UNEXPECTED_ERROR_MESSAGE = "Unexpected error occurred";
var MAX_RETRIES_EXCEEDED_MESSAGE = "Event rejected due to exceeded retry count";
var OPT_OUT_MESSAGE = "Event skipped due to optOut config";
var MISSING_API_KEY_MESSAGE = "Event rejected due to missing API key";
var INVALID_API_KEY = "Invalid API key";
var CLIENT_NOT_INITIALIZED = "Client not initialized";

// node_modules/@amplitude/analytics-core/lib/esm/types/status.js
var Status;
(function(Status2) {
  Status2["Unknown"] = "unknown";
  Status2["Skipped"] = "skipped";
  Status2["Success"] = "success";
  Status2["RateLimit"] = "rate_limit";
  Status2["PayloadTooLarge"] = "payload_too_large";
  Status2["Invalid"] = "invalid";
  Status2["Failed"] = "failed";
  Status2["Timeout"] = "Timeout";
  Status2["SystemError"] = "SystemError";
})(Status || (Status = {}));

// node_modules/@amplitude/analytics-core/lib/esm/utils/result-builder.js
var buildResult = function(event, code, message) {
  if (code === void 0) {
    code = 0;
  }
  if (message === void 0) {
    message = Status.Unknown;
  }
  return { event, code, message };
};

// node_modules/@amplitude/analytics-core/lib/esm/global-scope.js
var getGlobalScope = function() {
  var ampIntegrationContextName = "ampIntegrationContext";
  if (typeof globalThis !== "undefined" && typeof globalThis[ampIntegrationContextName] !== "undefined") {
    return globalThis[ampIntegrationContextName];
  }
  if (typeof globalThis !== "undefined") {
    return globalThis;
  }
  if (typeof window !== "undefined") {
    return window;
  }
  if (typeof self !== "undefined") {
    return self;
  }
  if (typeof global !== "undefined") {
    return global;
  }
  return void 0;
};

// node_modules/@amplitude/analytics-core/lib/esm/utils/uuid.js
var legacyUUID = function(a2) {
  return a2 ? (
    // a random number from 0 to 15
    (a2 ^ // unless b is 8,
    Math.random() * // in which case
    16 >> // a random number from
    a2 / 4).toString(16)
  ) : (
    // or otherwise a concatenated string:
    (String(1e7) + // 10000000 +
    String(-1e3) + // -1000 +
    String(-4e3) + // -4000 +
    String(-8e3) + // -80000000 +
    String(-1e11)).replace(
      // replacing
      /[018]/g,
      // zeroes, ones, and eights with
      UUID
    )
  );
};
var hex = __spreadArray([], __read(Array(256).keys()), false).map(function(index) {
  return index.toString(16).padStart(2, "0");
});
var UUID = function(a2) {
  var _a;
  var globalScope3 = getGlobalScope();
  if (!((_a = globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.crypto) === null || _a === void 0 ? void 0 : _a.getRandomValues)) {
    return legacyUUID(a2);
  }
  var r2 = globalScope3.crypto.getRandomValues(new Uint8Array(16));
  r2[6] = r2[6] & 15 | 64;
  r2[8] = r2[8] & 63 | 128;
  return __spreadArray([], __read(r2.entries()), false).map(function(_a2) {
    var _b = __read(_a2, 2), index = _b[0], int = _b[1];
    return [4, 6, 8, 10].includes(index) ? "-".concat(hex[int]) : hex[int];
  }).join("");
};

// node_modules/@amplitude/analytics-core/lib/esm/timeline.js
var Timeline = (
  /** @class */
  (function() {
    function Timeline2(client) {
      this.client = client;
      this.queue = [];
      this.applying = false;
      this.plugins = [];
    }
    Timeline2.prototype.register = function(plugin, config) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_c) {
          switch (_c.label) {
            case 0:
              if (this.plugins.some(function(existingPlugin) {
                return existingPlugin.name === plugin.name;
              })) {
                this.loggerProvider.warn("Plugin with name ".concat(plugin.name, " already exists, skipping registration"));
                return [
                  2
                  /*return*/
                ];
              }
              if (plugin.name === void 0) {
                plugin.name = UUID();
                this.loggerProvider.warn("Plugin name is undefined. \n      Generating a random UUID for plugin name: ".concat(plugin.name, ". \n      Set a name for the plugin to prevent it from being added multiple times."));
              }
              plugin.type = (_a = plugin.type) !== null && _a !== void 0 ? _a : "enrichment";
              return [4, (_b = plugin.setup) === null || _b === void 0 ? void 0 : _b.call(plugin, config, this.client)];
            case 1:
              _c.sent();
              this.plugins.push(plugin);
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    Timeline2.prototype.deregister = function(pluginName, config) {
      var _a;
      return __awaiter(this, void 0, void 0, function() {
        var index, plugin;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              index = this.plugins.findIndex(function(plugin2) {
                return plugin2.name === pluginName;
              });
              if (index === -1) {
                config.loggerProvider.warn("Plugin with name ".concat(pluginName, " does not exist, skipping deregistration"));
                return [
                  2
                  /*return*/
                ];
              }
              plugin = this.plugins[index];
              this.plugins.splice(index, 1);
              return [4, (_a = plugin.teardown) === null || _a === void 0 ? void 0 : _a.call(plugin)];
            case 1:
              _b.sent();
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    Timeline2.prototype.reset = function(client) {
      this.applying = false;
      var plugins = this.plugins;
      plugins.map(function(plugin) {
        var _a;
        return (_a = plugin.teardown) === null || _a === void 0 ? void 0 : _a.call(plugin);
      });
      this.plugins = [];
      this.client = client;
    };
    Timeline2.prototype.push = function(event) {
      var _this = this;
      return new Promise(function(resolve) {
        _this.queue.push([event, resolve]);
        _this.scheduleApply(0);
      });
    };
    Timeline2.prototype.scheduleApply = function(timeout) {
      var _this = this;
      if (this.applying)
        return;
      this.applying = true;
      setTimeout(function() {
        void _this.apply(_this.queue.shift()).then(function() {
          _this.applying = false;
          if (_this.queue.length > 0) {
            _this.scheduleApply(0);
          }
        });
      }, timeout);
    };
    Timeline2.prototype.apply = function(item) {
      return __awaiter(this, void 0, void 0, function() {
        var _a, event, _b, resolve, before, before_1, before_1_1, plugin, e2, e_1_1, enrichment, enrichment_1, enrichment_1_1, plugin, e2, e_2_1, destination, executeDestinations;
        var e_1, _c, e_2, _d;
        return __generator(this, function(_e) {
          switch (_e.label) {
            case 0:
              if (!item) {
                return [
                  2
                  /*return*/
                ];
              }
              _a = __read(item, 1), event = _a[0];
              _b = __read(item, 2), resolve = _b[1];
              this.loggerProvider.log("Timeline.apply: Initial event", event);
              before = this.plugins.filter(function(plugin2) {
                return plugin2.type === "before";
              });
              _e.label = 1;
            case 1:
              _e.trys.push([1, 6, 7, 8]);
              before_1 = __values(before), before_1_1 = before_1.next();
              _e.label = 2;
            case 2:
              if (!!before_1_1.done) return [3, 5];
              plugin = before_1_1.value;
              if (!plugin.execute) {
                return [3, 4];
              }
              return [4, plugin.execute(__assign({}, event))];
            case 3:
              e2 = _e.sent();
              if (e2 === null) {
                this.loggerProvider.log("Timeline.apply: Event filtered out by before plugin '".concat(String(plugin.name), "', event: ").concat(JSON.stringify(event)));
                resolve({ event, code: 0, message: "" });
                return [
                  2
                  /*return*/
                ];
              } else {
                event = e2;
                this.loggerProvider.log("Timeline.apply: Event after before plugin '".concat(String(plugin.name), "', event: ").concat(JSON.stringify(event)));
              }
              _e.label = 4;
            case 4:
              before_1_1 = before_1.next();
              return [3, 2];
            case 5:
              return [3, 8];
            case 6:
              e_1_1 = _e.sent();
              e_1 = { error: e_1_1 };
              return [3, 8];
            case 7:
              try {
                if (before_1_1 && !before_1_1.done && (_c = before_1.return)) _c.call(before_1);
              } finally {
                if (e_1) throw e_1.error;
              }
              return [
                7
                /*endfinally*/
              ];
            case 8:
              enrichment = this.plugins.filter(function(plugin2) {
                return plugin2.type === "enrichment" || plugin2.type === void 0;
              });
              _e.label = 9;
            case 9:
              _e.trys.push([9, 14, 15, 16]);
              enrichment_1 = __values(enrichment), enrichment_1_1 = enrichment_1.next();
              _e.label = 10;
            case 10:
              if (!!enrichment_1_1.done) return [3, 13];
              plugin = enrichment_1_1.value;
              if (!plugin.execute) {
                return [3, 12];
              }
              return [4, plugin.execute(__assign({}, event))];
            case 11:
              e2 = _e.sent();
              if (e2 === null) {
                this.loggerProvider.log("Timeline.apply: Event filtered out by enrichment plugin '".concat(String(plugin.name), "', event: ").concat(JSON.stringify(event)));
                resolve({ event, code: 0, message: "" });
                return [
                  2
                  /*return*/
                ];
              } else {
                event = e2;
                this.loggerProvider.log("Timeline.apply: Event after enrichment plugin '".concat(String(plugin.name), "', event: ").concat(JSON.stringify(event)));
              }
              _e.label = 12;
            case 12:
              enrichment_1_1 = enrichment_1.next();
              return [3, 10];
            case 13:
              return [3, 16];
            case 14:
              e_2_1 = _e.sent();
              e_2 = { error: e_2_1 };
              return [3, 16];
            case 15:
              try {
                if (enrichment_1_1 && !enrichment_1_1.done && (_d = enrichment_1.return)) _d.call(enrichment_1);
              } finally {
                if (e_2) throw e_2.error;
              }
              return [
                7
                /*endfinally*/
              ];
            case 16:
              destination = this.plugins.filter(function(plugin2) {
                return plugin2.type === "destination";
              });
              this.loggerProvider.log("Timeline.apply: Final event before destinations, event: ".concat(JSON.stringify(event)));
              executeDestinations = destination.map(function(plugin2) {
                var eventClone = __assign({}, event);
                return plugin2.execute(eventClone).catch(function(e3) {
                  return buildResult(eventClone, 0, String(e3));
                });
              });
              void Promise.all(executeDestinations).then(function(_a2) {
                var _b2 = __read(_a2, 1), result = _b2[0];
                var resolveResult = result || buildResult(event, 100, "Event not tracked, no destination plugins on the instance");
                resolve(resolveResult);
              });
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    Timeline2.prototype.flush = function() {
      return __awaiter(this, void 0, void 0, function() {
        var queue, destination, executeDestinations;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              queue = this.queue;
              this.queue = [];
              return [4, Promise.all(queue.map(function(item) {
                return _this.apply(item);
              }))];
            case 1:
              _a.sent();
              destination = this.plugins.filter(function(plugin) {
                return plugin.type === "destination";
              });
              executeDestinations = destination.map(function(plugin) {
                return plugin.flush && plugin.flush();
              });
              return [4, Promise.all(executeDestinations)];
            case 2:
              _a.sent();
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    Timeline2.prototype.onIdentityChanged = function(identity) {
      this.plugins.forEach(function(plugin) {
        var _a;
        void ((_a = plugin.onIdentityChanged) === null || _a === void 0 ? void 0 : _a.call(plugin, identity));
      });
    };
    Timeline2.prototype.onSessionIdChanged = function(sessionId) {
      this.plugins.forEach(function(plugin) {
        var _a;
        void ((_a = plugin.onSessionIdChanged) === null || _a === void 0 ? void 0 : _a.call(plugin, sessionId));
      });
    };
    Timeline2.prototype.onOptOutChanged = function(optOut) {
      this.plugins.forEach(function(plugin) {
        var _a;
        void ((_a = plugin.onOptOutChanged) === null || _a === void 0 ? void 0 : _a.call(plugin, optOut));
      });
    };
    Timeline2.prototype.onReset = function() {
      this.plugins.forEach(function(plugin) {
        var _a;
        void ((_a = plugin.onReset) === null || _a === void 0 ? void 0 : _a.call(plugin));
      });
    };
    return Timeline2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/utils/event-builder.js
var createTrackEvent = function(eventInput, eventProperties, eventOptions) {
  var baseEvent = typeof eventInput === "string" ? { event_type: eventInput } : eventInput;
  return __assign(__assign(__assign({}, baseEvent), eventOptions), eventProperties && { event_properties: eventProperties });
};
var createIdentifyEvent = function(identify2, eventOptions) {
  var identifyEvent = __assign(__assign({}, eventOptions), { event_type: SpecialEventType.IDENTIFY, user_properties: identify2.getUserProperties() });
  return identifyEvent;
};
var createGroupIdentifyEvent = function(groupType, groupName, identify2, eventOptions) {
  var _a;
  var groupIdentify2 = __assign(__assign({}, eventOptions), { event_type: SpecialEventType.GROUP_IDENTIFY, group_properties: identify2.getUserProperties(), groups: (_a = {}, _a[groupType] = groupName, _a) });
  return groupIdentify2;
};
var createGroupEvent = function(groupType, groupName, eventOptions) {
  var _a;
  var identify2 = new Identify();
  identify2.set(groupType, groupName);
  var groupEvent = __assign(__assign({}, eventOptions), { event_type: SpecialEventType.IDENTIFY, user_properties: identify2.getUserProperties(), groups: (_a = {}, _a[groupType] = groupName, _a) });
  return groupEvent;
};
var createRevenueEvent = function(revenue2, eventOptions) {
  return __assign(__assign({}, eventOptions), { event_type: SpecialEventType.REVENUE, event_properties: revenue2.getEventProperties() });
};

// node_modules/@amplitude/analytics-core/lib/esm/utils/return-wrapper.js
var returnWrapper = function(awaitable) {
  return {
    promise: awaitable || Promise.resolve()
  };
};

// node_modules/@amplitude/analytics-core/lib/esm/core-client.js
var AmplitudeCore = (
  /** @class */
  (function() {
    function AmplitudeCore2(name) {
      if (name === void 0) {
        name = "$default";
      }
      this.initializing = false;
      this.isReady = false;
      this.q = [];
      this.dispatchQ = [];
      this.logEvent = this.track.bind(this);
      this.timeline = new Timeline(this);
      this.name = name;
    }
    AmplitudeCore2.prototype._init = function(config) {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              this.config = config;
              this.timeline.reset(this);
              this.timeline.loggerProvider = this.config.loggerProvider;
              return [4, this.runQueuedFunctions("q")];
            case 1:
              _a.sent();
              this.isReady = true;
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    AmplitudeCore2.prototype.runQueuedFunctions = function(queueName) {
      return __awaiter(this, void 0, void 0, function() {
        var queuedFunctions, queuedFunctions_1, queuedFunctions_1_1, queuedFunction, val, e_1_1;
        var e_1, _a;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              queuedFunctions = this[queueName];
              this[queueName] = [];
              _b.label = 1;
            case 1:
              _b.trys.push([1, 8, 9, 10]);
              queuedFunctions_1 = __values(queuedFunctions), queuedFunctions_1_1 = queuedFunctions_1.next();
              _b.label = 2;
            case 2:
              if (!!queuedFunctions_1_1.done) return [3, 7];
              queuedFunction = queuedFunctions_1_1.value;
              val = queuedFunction();
              if (!(val && "promise" in val)) return [3, 4];
              return [4, val.promise];
            case 3:
              _b.sent();
              return [3, 6];
            case 4:
              return [4, val];
            case 5:
              _b.sent();
              _b.label = 6;
            case 6:
              queuedFunctions_1_1 = queuedFunctions_1.next();
              return [3, 2];
            case 7:
              return [3, 10];
            case 8:
              e_1_1 = _b.sent();
              e_1 = { error: e_1_1 };
              return [3, 10];
            case 9:
              try {
                if (queuedFunctions_1_1 && !queuedFunctions_1_1.done && (_a = queuedFunctions_1.return)) _a.call(queuedFunctions_1);
              } finally {
                if (e_1) throw e_1.error;
              }
              return [
                7
                /*endfinally*/
              ];
            case 10:
              if (!this[queueName].length) return [3, 12];
              return [4, this.runQueuedFunctions(queueName)];
            case 11:
              _b.sent();
              _b.label = 12;
            case 12:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    AmplitudeCore2.prototype.track = function(eventInput, eventProperties, eventOptions) {
      var event = createTrackEvent(eventInput, eventProperties, eventOptions);
      return returnWrapper(this.dispatch(event));
    };
    AmplitudeCore2.prototype.identify = function(identify2, eventOptions) {
      var event = createIdentifyEvent(identify2, eventOptions);
      return returnWrapper(this.dispatch(event));
    };
    AmplitudeCore2.prototype.groupIdentify = function(groupType, groupName, identify2, eventOptions) {
      var event = createGroupIdentifyEvent(groupType, groupName, identify2, eventOptions);
      return returnWrapper(this.dispatch(event));
    };
    AmplitudeCore2.prototype.setGroup = function(groupType, groupName, eventOptions) {
      var event = createGroupEvent(groupType, groupName, eventOptions);
      return returnWrapper(this.dispatch(event));
    };
    AmplitudeCore2.prototype.revenue = function(revenue2, eventOptions) {
      var event = createRevenueEvent(revenue2, eventOptions);
      return returnWrapper(this.dispatch(event));
    };
    AmplitudeCore2.prototype.add = function(plugin) {
      if (!this.isReady) {
        this.q.push(this._addPlugin.bind(this, plugin));
        return returnWrapper();
      }
      return this._addPlugin(plugin);
    };
    AmplitudeCore2.prototype._addPlugin = function(plugin) {
      return returnWrapper(this.timeline.register(plugin, this.config));
    };
    AmplitudeCore2.prototype.remove = function(pluginName) {
      if (!this.isReady) {
        this.q.push(this._removePlugin.bind(this, pluginName));
        return returnWrapper();
      }
      return this._removePlugin(pluginName);
    };
    AmplitudeCore2.prototype._removePlugin = function(pluginName) {
      return returnWrapper(this.timeline.deregister(pluginName, this.config));
    };
    AmplitudeCore2.prototype.dispatchWithCallback = function(event, callback) {
      if (!this.isReady) {
        return callback(buildResult(event, 0, CLIENT_NOT_INITIALIZED));
      }
      void this.process(event).then(callback);
    };
    AmplitudeCore2.prototype.dispatch = function(event) {
      return __awaiter(this, void 0, void 0, function() {
        var _this = this;
        return __generator(this, function(_a) {
          if (!this.isReady) {
            return [2, new Promise(function(resolve) {
              _this.dispatchQ.push(_this.dispatchWithCallback.bind(_this, event, resolve));
            })];
          }
          return [2, this.process(event)];
        });
      });
    };
    AmplitudeCore2.prototype.getOperationAppliedUserProperties = function(userProperties) {
      var updatedProperties = {};
      if (userProperties === void 0) {
        return updatedProperties;
      }
      var nonOpProperties = {};
      Object.keys(userProperties).forEach(function(key) {
        if (!Object.values(IdentifyOperation).includes(key)) {
          nonOpProperties[key] = userProperties[key];
        }
      });
      OrderedIdentifyOperations.forEach(function(operation) {
        if (!Object.keys(userProperties).includes(operation))
          return;
        var opProperties = userProperties[operation];
        switch (operation) {
          case IdentifyOperation.CLEAR_ALL:
            Object.keys(updatedProperties).forEach(function(prop) {
              delete updatedProperties[prop];
            });
            break;
          case IdentifyOperation.UNSET:
            Object.keys(opProperties).forEach(function(prop) {
              delete updatedProperties[prop];
            });
            break;
          case IdentifyOperation.SET:
            Object.assign(updatedProperties, opProperties);
            break;
        }
      });
      Object.assign(updatedProperties, nonOpProperties);
      return updatedProperties;
    };
    AmplitudeCore2.prototype.process = function(event) {
      return __awaiter(this, void 0, void 0, function() {
        var userProperties, result, e_2, message, result;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              if (this.config.optOut) {
                return [2, buildResult(event, 0, OPT_OUT_MESSAGE)];
              }
              if (event.event_type === SpecialEventType.IDENTIFY) {
                userProperties = this.getOperationAppliedUserProperties(event.user_properties);
                this.timeline.onIdentityChanged({ userProperties });
              }
              return [4, this.timeline.push(event)];
            case 1:
              result = _a.sent();
              result.code === 200 ? this.config.loggerProvider.log(result.message) : result.code === 100 ? this.config.loggerProvider.warn(result.message) : this.config.loggerProvider.error(result.message);
              return [2, result];
            case 2:
              e_2 = _a.sent();
              message = String(e_2);
              this.config.loggerProvider.error(message);
              result = buildResult(event, 0, message);
              return [2, result];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    AmplitudeCore2.prototype.setOptOut = function(optOut) {
      if (!this.isReady) {
        this.q.push(this._setOptOut.bind(this, Boolean(optOut)));
        return;
      }
      this._setOptOut(optOut);
    };
    AmplitudeCore2.prototype._setOptOut = function(optOut) {
      if (this.config.optOut !== optOut) {
        this.timeline.onOptOutChanged(optOut);
        this.config.optOut = Boolean(optOut);
      }
    };
    AmplitudeCore2.prototype.flush = function() {
      return returnWrapper(this.timeline.flush());
    };
    AmplitudeCore2.prototype.plugin = function(name) {
      var plugin = this.timeline.plugins.find(function(plugin2) {
        return plugin2.name === name;
      });
      if (plugin === void 0) {
        this.config.loggerProvider.debug("Cannot find plugin with name ".concat(name));
        return void 0;
      }
      return plugin;
    };
    AmplitudeCore2.prototype.plugins = function(pluginClass) {
      return this.timeline.plugins.filter(function(plugin) {
        return plugin instanceof pluginClass;
      });
    };
    return AmplitudeCore2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/revenue.js
var Revenue = (
  /** @class */
  (function() {
    function Revenue2() {
      this.productId = "";
      this.quantity = 1;
      this.price = 0;
    }
    Revenue2.prototype.setProductId = function(productId) {
      this.productId = productId;
      return this;
    };
    Revenue2.prototype.setQuantity = function(quantity) {
      if (quantity > 0) {
        this.quantity = quantity;
      }
      return this;
    };
    Revenue2.prototype.setPrice = function(price) {
      this.price = price;
      return this;
    };
    Revenue2.prototype.setRevenueType = function(revenueType) {
      this.revenueType = revenueType;
      return this;
    };
    Revenue2.prototype.setCurrency = function(currency) {
      this.currency = currency;
      return this;
    };
    Revenue2.prototype.setRevenue = function(revenue2) {
      this.revenue = revenue2;
      return this;
    };
    Revenue2.prototype.setReceipt = function(receipt) {
      this.receipt = receipt;
      return this;
    };
    Revenue2.prototype.setReceiptSig = function(receiptSig) {
      this.receiptSig = receiptSig;
      return this;
    };
    Revenue2.prototype.setEventProperties = function(properties) {
      if (isValidObject(properties)) {
        this.properties = properties;
      }
      return this;
    };
    Revenue2.prototype.getEventProperties = function() {
      var eventProperties = this.properties ? __assign({}, this.properties) : {};
      eventProperties[RevenueProperty.REVENUE_PRODUCT_ID] = this.productId;
      eventProperties[RevenueProperty.REVENUE_QUANTITY] = this.quantity;
      eventProperties[RevenueProperty.REVENUE_PRICE] = this.price;
      eventProperties[RevenueProperty.REVENUE_TYPE] = this.revenueType;
      eventProperties[RevenueProperty.REVENUE_CURRENCY] = this.currency;
      eventProperties[RevenueProperty.REVENUE] = this.revenue;
      eventProperties[RevenueProperty.RECEIPT] = this.receipt;
      eventProperties[RevenueProperty.RECEIPT_SIG] = this.receiptSig;
      return eventProperties;
    };
    return Revenue2;
  })()
);
var RevenueProperty;
(function(RevenueProperty2) {
  RevenueProperty2["REVENUE_PRODUCT_ID"] = "$productId";
  RevenueProperty2["REVENUE_QUANTITY"] = "$quantity";
  RevenueProperty2["REVENUE_PRICE"] = "$price";
  RevenueProperty2["REVENUE_TYPE"] = "$revenueType";
  RevenueProperty2["REVENUE_CURRENCY"] = "$currency";
  RevenueProperty2["REVENUE"] = "$revenue";
  RevenueProperty2["RECEIPT"] = "$receipt";
  RevenueProperty2["RECEIPT_SIG"] = "$receiptSig";
})(RevenueProperty || (RevenueProperty = {}));

// node_modules/@amplitude/analytics-core/lib/esm/utils/chunk.js
var chunk = function(arr, size) {
  var chunkSize = Math.max(size, 1);
  return arr.reduce(function(chunks, element, index) {
    var chunkIndex = Math.floor(index / chunkSize);
    if (!chunks[chunkIndex]) {
      chunks[chunkIndex] = [];
    }
    chunks[chunkIndex].push(element);
    return chunks;
  }, []);
};

// node_modules/@amplitude/analytics-core/lib/esm/types/loglevel.js
var LogLevel;
(function(LogLevel2) {
  LogLevel2[LogLevel2["None"] = 0] = "None";
  LogLevel2[LogLevel2["Error"] = 1] = "Error";
  LogLevel2[LogLevel2["Warn"] = 2] = "Warn";
  LogLevel2[LogLevel2["Verbose"] = 3] = "Verbose";
  LogLevel2[LogLevel2["Debug"] = 4] = "Debug";
})(LogLevel || (LogLevel = {}));

// node_modules/@amplitude/analytics-core/lib/esm/logger.js
var PREFIX = "Amplitude Logger ";
var Logger = (
  /** @class */
  (function() {
    function Logger2() {
      this.logLevel = LogLevel.None;
    }
    Logger2.prototype.disable = function() {
      this.logLevel = LogLevel.None;
    };
    Logger2.prototype.enable = function(logLevel) {
      if (logLevel === void 0) {
        logLevel = LogLevel.Warn;
      }
      this.logLevel = logLevel;
    };
    Logger2.prototype.log = function() {
      var args = [];
      for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
      }
      if (this.logLevel < LogLevel.Verbose) {
        return;
      }
      console.log("".concat(PREFIX, "[Log]: ").concat(args.join(" ")));
    };
    Logger2.prototype.warn = function() {
      var args = [];
      for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
      }
      if (this.logLevel < LogLevel.Warn) {
        return;
      }
      console.warn("".concat(PREFIX, "[Warn]: ").concat(args.join(" ")));
    };
    Logger2.prototype.error = function() {
      var args = [];
      for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
      }
      if (this.logLevel < LogLevel.Error) {
        return;
      }
      console.error("".concat(PREFIX, "[Error]: ").concat(args.join(" ")));
    };
    Logger2.prototype.debug = function() {
      var args = [];
      for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
      }
      if (this.logLevel < LogLevel.Debug) {
        return;
      }
      console.log("".concat(PREFIX, "[Debug]: ").concat(args.join(" ")));
    };
    return Logger2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/config.js
var getDefaultConfig = function() {
  return {
    flushMaxRetries: 12,
    flushQueueSize: 200,
    flushIntervalMillis: 1e4,
    instanceName: DEFAULT_INSTANCE_NAME,
    logLevel: LogLevel.Warn,
    loggerProvider: new Logger(),
    offline: false,
    optOut: false,
    serverUrl: AMPLITUDE_SERVER_URL,
    serverZone: "US",
    useBatch: false
  };
};
var Config = (
  /** @class */
  (function() {
    function Config2(options) {
      var _a, _b, _c, _d;
      this._optOut = false;
      var defaultConfig = getDefaultConfig();
      this.apiKey = options.apiKey;
      this.flushIntervalMillis = (_a = options.flushIntervalMillis) !== null && _a !== void 0 ? _a : defaultConfig.flushIntervalMillis;
      this.flushMaxRetries = options.flushMaxRetries || defaultConfig.flushMaxRetries;
      this.flushQueueSize = options.flushQueueSize || defaultConfig.flushQueueSize;
      this.instanceName = options.instanceName || defaultConfig.instanceName;
      this.loggerProvider = options.loggerProvider || defaultConfig.loggerProvider;
      this.logLevel = (_b = options.logLevel) !== null && _b !== void 0 ? _b : defaultConfig.logLevel;
      this.minIdLength = options.minIdLength;
      this.plan = options.plan;
      this.ingestionMetadata = options.ingestionMetadata;
      this.offline = options.offline !== void 0 ? options.offline : defaultConfig.offline;
      this.optOut = (_c = options.optOut) !== null && _c !== void 0 ? _c : defaultConfig.optOut;
      this.serverUrl = options.serverUrl;
      this.serverZone = options.serverZone || defaultConfig.serverZone;
      this.storageProvider = options.storageProvider;
      this.transportProvider = options.transportProvider;
      this.useBatch = (_d = options.useBatch) !== null && _d !== void 0 ? _d : defaultConfig.useBatch;
      this.loggerProvider.enable(this.logLevel);
      var serverConfig = createServerConfig(options.serverUrl, options.serverZone, options.useBatch);
      this.serverZone = serverConfig.serverZone;
      this.serverUrl = serverConfig.serverUrl;
    }
    Object.defineProperty(Config2.prototype, "optOut", {
      get: function() {
        return this._optOut;
      },
      set: function(optOut) {
        this._optOut = optOut;
      },
      enumerable: false,
      configurable: true
    });
    return Config2;
  })()
);
var getServerUrl = function(serverZone, useBatch) {
  if (serverZone === "EU") {
    return useBatch ? EU_AMPLITUDE_BATCH_SERVER_URL : EU_AMPLITUDE_SERVER_URL;
  }
  return useBatch ? AMPLITUDE_BATCH_SERVER_URL : AMPLITUDE_SERVER_URL;
};
var createServerConfig = function(serverUrl, serverZone, useBatch) {
  if (serverUrl === void 0) {
    serverUrl = "";
  }
  if (serverZone === void 0) {
    serverZone = getDefaultConfig().serverZone;
  }
  if (useBatch === void 0) {
    useBatch = getDefaultConfig().useBatch;
  }
  if (serverUrl) {
    return { serverUrl, serverZone: void 0 };
  }
  var _serverZone = ["US", "EU"].includes(serverZone) ? serverZone : getDefaultConfig().serverZone;
  return {
    serverZone: _serverZone,
    serverUrl: getServerUrl(_serverZone, useBatch)
  };
};
var RequestMetadata = (
  /** @class */
  (function() {
    function RequestMetadata2() {
      this.sdk = {
        metrics: {
          histogram: {}
        }
      };
    }
    RequestMetadata2.prototype.recordHistogram = function(key, value) {
      this.sdk.metrics.histogram[key] = value;
    };
    return RequestMetadata2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/utils/status-code.js
function isSuccessStatusCode(code) {
  return code >= 200 && code < 300;
}

// node_modules/@amplitude/analytics-core/lib/esm/utils/debug.js
var getStacktrace = function(ignoreDepth) {
  if (ignoreDepth === void 0) {
    ignoreDepth = 0;
  }
  var trace = new Error().stack || "";
  return trace.split("\n").slice(2 + ignoreDepth).map(function(text) {
    return text.trim();
  });
};
var getClientLogConfig = function(client) {
  return function() {
    var _a = __assign({}, client.config), logger = _a.loggerProvider, logLevel = _a.logLevel;
    return {
      logger,
      logLevel
    };
  };
};
var getValueByStringPath = function(obj, path) {
  var e_1, _a;
  path = path.replace(/\[(\w+)\]/g, ".$1");
  path = path.replace(/^\./, "");
  try {
    for (var _b = __values(path.split(".")), _c = _b.next(); !_c.done; _c = _b.next()) {
      var attr = _c.value;
      if (attr in obj) {
        obj = obj[attr];
      } else {
        return;
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
  return obj;
};
var getClientStates = function(client, paths) {
  return function() {
    var e_2, _a;
    var res = {};
    try {
      for (var paths_1 = __values(paths), paths_1_1 = paths_1.next(); !paths_1_1.done; paths_1_1 = paths_1.next()) {
        var path = paths_1_1.value;
        res[path] = getValueByStringPath(client, path);
      }
    } catch (e_2_1) {
      e_2 = { error: e_2_1 };
    } finally {
      try {
        if (paths_1_1 && !paths_1_1.done && (_a = paths_1.return)) _a.call(paths_1);
      } finally {
        if (e_2) throw e_2.error;
      }
    }
    return res;
  };
};
var debugWrapper = function(fn, fnName, getLogConfig, getStates, fnContext) {
  if (fnContext === void 0) {
    fnContext = null;
  }
  return function() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      args[_i] = arguments[_i];
    }
    var _a = getLogConfig(), logger = _a.logger, logLevel = _a.logLevel;
    if (logLevel && logLevel < LogLevel.Debug || !logLevel || !logger) {
      return fn.apply(fnContext, args);
    }
    var debugContext = {
      type: "invoke public method",
      name: fnName,
      args,
      stacktrace: getStacktrace(1),
      time: {
        start: (/* @__PURE__ */ new Date()).toISOString()
      },
      states: {}
    };
    if (getStates && debugContext.states) {
      debugContext.states.before = getStates();
    }
    var result = fn.apply(fnContext, args);
    if (result && result.promise) {
      result.promise.then(function() {
        if (getStates && debugContext.states) {
          debugContext.states.after = getStates();
        }
        if (debugContext.time) {
          debugContext.time.end = (/* @__PURE__ */ new Date()).toISOString();
        }
        logger.debug(JSON.stringify(debugContext, null, 2));
      });
    } else {
      if (getStates && debugContext.states) {
        debugContext.states.after = getStates();
      }
      if (debugContext.time) {
        debugContext.time.end = (/* @__PURE__ */ new Date()).toISOString();
      }
      logger.debug(JSON.stringify(debugContext, null, 2));
    }
    return result;
  };
};

// node_modules/@amplitude/analytics-core/lib/esm/plugins/destination.js
function getErrorMessage(error) {
  if (error instanceof Error)
    return error.message;
  return String(error);
}
function getResponseBodyString(res) {
  var responseBodyString = "";
  try {
    if ("body" in res) {
      responseBodyString = JSON.stringify(res.body, null, 2);
    }
  } catch (_a) {
  }
  return responseBodyString;
}
var Destination = (
  /** @class */
  (function() {
    function Destination2(context) {
      this.name = "amplitude";
      this.type = "destination";
      this.retryTimeout = 1e3;
      this.throttleTimeout = 3e4;
      this.storageKey = "";
      this.scheduleId = null;
      this.scheduledTimeout = 0;
      this.flushId = null;
      this.queue = [];
      this.diagnosticsClient = context === null || context === void 0 ? void 0 : context.diagnosticsClient;
    }
    Destination2.prototype.setup = function(config) {
      var _a;
      return __awaiter(this, void 0, void 0, function() {
        var unsent;
        var _this = this;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              this.config = config;
              this.storageKey = "".concat(STORAGE_PREFIX, "_").concat(this.config.apiKey.substring(0, 10));
              return [4, (_a = this.config.storageProvider) === null || _a === void 0 ? void 0 : _a.get(this.storageKey)];
            case 1:
              unsent = _b.sent();
              if (unsent && unsent.length > 0) {
                void Promise.all(unsent.map(function(event) {
                  return _this.execute(event);
                })).catch();
              }
              return [2, Promise.resolve(void 0)];
          }
        });
      });
    };
    Destination2.prototype.execute = function(event) {
      var _this = this;
      if (!event.insert_id) {
        event.insert_id = UUID();
      }
      return new Promise(function(resolve) {
        var context = {
          event,
          attempts: 0,
          callback: function(result) {
            return resolve(result);
          },
          timeout: 0
        };
        _this.queue.push(context);
        _this.schedule(_this.config.flushIntervalMillis);
        _this.saveEvents();
      });
    };
    Destination2.prototype.removeEventsExceedFlushMaxRetries = function(list) {
      var _this = this;
      return list.filter(function(context) {
        context.attempts += 1;
        if (context.attempts < _this.config.flushMaxRetries) {
          return true;
        }
        void _this.fulfillRequest([context], 500, MAX_RETRIES_EXCEEDED_MESSAGE);
        return false;
      });
    };
    Destination2.prototype.scheduleEvents = function(list) {
      var _this = this;
      list.forEach(function(context) {
        _this.schedule(context.timeout === 0 ? _this.config.flushIntervalMillis : context.timeout);
      });
    };
    Destination2.prototype.schedule = function(timeout) {
      var _this = this;
      if (this.config.offline) {
        return;
      }
      if (this.scheduleId === null || this.scheduleId && timeout > this.scheduledTimeout) {
        if (this.scheduleId) {
          clearTimeout(this.scheduleId);
        }
        this.scheduledTimeout = timeout;
        this.scheduleId = setTimeout(function() {
          _this.queue = _this.queue.map(function(context) {
            context.timeout = 0;
            return context;
          });
          void _this.flush(true);
        }, timeout);
        return;
      }
    };
    Destination2.prototype.resetSchedule = function() {
      this.scheduleId = null;
      this.scheduledTimeout = 0;
    };
    Destination2.prototype.flush = function(useRetry) {
      if (useRetry === void 0) {
        useRetry = false;
      }
      return __awaiter(this, void 0, void 0, function() {
        var list, later, batches;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              if (this.config.offline) {
                this.resetSchedule();
                this.config.loggerProvider.debug("Skipping flush while offline.");
                return [
                  2
                  /*return*/
                ];
              }
              if (this.flushId) {
                this.resetSchedule();
                this.config.loggerProvider.debug("Skipping flush because previous flush has not resolved.");
                return [
                  2
                  /*return*/
                ];
              }
              this.flushId = this.scheduleId;
              this.resetSchedule();
              list = [];
              later = [];
              this.queue.forEach(function(context) {
                return context.timeout === 0 ? list.push(context) : later.push(context);
              });
              batches = chunk(list, this.config.flushQueueSize);
              return [4, batches.reduce(function(promise, batch) {
                return __awaiter(_this, void 0, void 0, function() {
                  return __generator(this, function(_a2) {
                    switch (_a2.label) {
                      case 0:
                        return [4, promise];
                      case 1:
                        _a2.sent();
                        return [4, this.send(batch, useRetry)];
                      case 2:
                        return [2, _a2.sent()];
                    }
                  });
                });
              }, Promise.resolve())];
            case 1:
              _a.sent();
              this.flushId = null;
              this.scheduleEvents(this.queue);
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    Destination2.prototype.send = function(list, useRetry) {
      var _a;
      if (useRetry === void 0) {
        useRetry = true;
      }
      return __awaiter(this, void 0, void 0, function() {
        var payload, serverUrl, res, e_1, errorMessage;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              if (!this.config.apiKey) {
                return [2, this.fulfillRequest(list, 400, MISSING_API_KEY_MESSAGE)];
              }
              payload = {
                api_key: this.config.apiKey,
                events: list.map(function(context) {
                  var _a2 = context.event, extra = _a2.extra, eventWithoutExtra = __rest(_a2, ["extra"]);
                  return eventWithoutExtra;
                }),
                options: {
                  min_id_length: this.config.minIdLength
                },
                client_upload_time: (/* @__PURE__ */ new Date()).toISOString(),
                request_metadata: this.config.requestMetadata
              };
              this.config.requestMetadata = new RequestMetadata();
              _b.label = 1;
            case 1:
              _b.trys.push([1, 3, , 4]);
              serverUrl = createServerConfig(this.config.serverUrl, this.config.serverZone, this.config.useBatch).serverUrl;
              return [4, this.config.transportProvider.send(serverUrl, payload)];
            case 2:
              res = _b.sent();
              if (res === null) {
                this.fulfillRequest(list, 0, UNEXPECTED_ERROR_MESSAGE);
                return [
                  2
                  /*return*/
                ];
              }
              if (!useRetry) {
                if ("body" in res) {
                  this.fulfillRequest(list, res.statusCode, "".concat(res.status, ": ").concat(getResponseBodyString(res)));
                } else {
                  this.fulfillRequest(list, res.statusCode, res.status);
                }
                return [
                  2
                  /*return*/
                ];
              }
              this.handleResponse(res, list);
              return [3, 4];
            case 3:
              e_1 = _b.sent();
              errorMessage = getErrorMessage(e_1);
              this.config.loggerProvider.error(errorMessage);
              (_a = this.diagnosticsClient) === null || _a === void 0 ? void 0 : _a.recordEvent("analytics.events.unsuccessful.from.catch.error", {
                events: list.map(function(context) {
                  return context.event.event_type;
                }),
                message: errorMessage,
                stack_trace: getStacktrace()
              });
              this.handleResponse({ status: Status.Failed, statusCode: 0 }, list);
              return [3, 4];
            case 4:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    Destination2.prototype.handleResponse = function(res, list) {
      var _a;
      if (!isSuccessStatusCode(res.statusCode)) {
        (_a = this.diagnosticsClient) === null || _a === void 0 ? void 0 : _a.recordEvent("analytics.events.unsuccessful", {
          events: list.map(function(context) {
            return context.event.event_type;
          }),
          code: res.statusCode,
          status: res.status,
          body: getResponseBodyString(res),
          stack_trace: getStacktrace()
        });
      }
      var status = res.status;
      switch (status) {
        case Status.Success: {
          this.handleSuccessResponse(res, list);
          break;
        }
        case Status.Invalid: {
          this.handleInvalidResponse(res, list);
          break;
        }
        case Status.PayloadTooLarge: {
          this.handlePayloadTooLargeResponse(res, list);
          break;
        }
        case Status.RateLimit: {
          this.handleRateLimitResponse(res, list);
          break;
        }
        default: {
          this.config.loggerProvider.warn(`{code: 0, error: "Status '`.concat(status, "' provided for ").concat(list.length, ' events"}'));
          this.handleOtherResponse(list);
          break;
        }
      }
    };
    Destination2.prototype.handleSuccessResponse = function(res, list) {
      this.fulfillRequest(list, res.statusCode, SUCCESS_MESSAGE);
    };
    Destination2.prototype.handleInvalidResponse = function(res, list) {
      var _this = this;
      if (res.body.missingField || res.body.error.startsWith(INVALID_API_KEY)) {
        this.fulfillRequest(list, res.statusCode, res.body.error);
        return;
      }
      var dropIndex = __spreadArray(__spreadArray(__spreadArray(__spreadArray([], __read(Object.values(res.body.eventsWithInvalidFields)), false), __read(Object.values(res.body.eventsWithMissingFields)), false), __read(Object.values(res.body.eventsWithInvalidIdLengths)), false), __read(res.body.silencedEvents), false).flat();
      var dropIndexSet = new Set(dropIndex);
      var retry = list.filter(function(context, index) {
        if (dropIndexSet.has(index)) {
          _this.fulfillRequest([context], res.statusCode, res.body.error);
          return;
        }
        return true;
      });
      if (retry.length > 0) {
        this.config.loggerProvider.warn(getResponseBodyString(res));
      }
      var tryable = this.removeEventsExceedFlushMaxRetries(retry);
      this.scheduleEvents(tryable);
    };
    Destination2.prototype.handlePayloadTooLargeResponse = function(res, list) {
      if (list.length === 1) {
        this.fulfillRequest(list, res.statusCode, res.body.error);
        return;
      }
      this.config.loggerProvider.warn(getResponseBodyString(res));
      this.config.flushQueueSize /= 2;
      var tryable = this.removeEventsExceedFlushMaxRetries(list);
      this.scheduleEvents(tryable);
    };
    Destination2.prototype.handleRateLimitResponse = function(res, list) {
      var _this = this;
      var dropUserIds = Object.keys(res.body.exceededDailyQuotaUsers);
      var dropDeviceIds = Object.keys(res.body.exceededDailyQuotaDevices);
      var throttledIndex = res.body.throttledEvents;
      var dropUserIdsSet = new Set(dropUserIds);
      var dropDeviceIdsSet = new Set(dropDeviceIds);
      var throttledIndexSet = new Set(throttledIndex);
      var retry = list.filter(function(context, index) {
        if (context.event.user_id && dropUserIdsSet.has(context.event.user_id) || context.event.device_id && dropDeviceIdsSet.has(context.event.device_id)) {
          _this.fulfillRequest([context], res.statusCode, res.body.error);
          return;
        }
        if (throttledIndexSet.has(index)) {
          context.timeout = _this.throttleTimeout;
        }
        return true;
      });
      if (retry.length > 0) {
        this.config.loggerProvider.warn(getResponseBodyString(res));
      }
      var tryable = this.removeEventsExceedFlushMaxRetries(retry);
      this.scheduleEvents(tryable);
    };
    Destination2.prototype.handleOtherResponse = function(list) {
      var _this = this;
      var later = list.map(function(context) {
        context.timeout = context.attempts * _this.retryTimeout;
        return context;
      });
      var tryable = this.removeEventsExceedFlushMaxRetries(later);
      this.scheduleEvents(tryable);
    };
    Destination2.prototype.fulfillRequest = function(list, code, message) {
      var _a, _b, _c;
      if (!isSuccessStatusCode(code)) {
        (_a = this.diagnosticsClient) === null || _a === void 0 ? void 0 : _a.increment("analytics.events.dropped", list.length);
        (_b = this.diagnosticsClient) === null || _b === void 0 ? void 0 : _b.recordEvent("analytics.events.dropped", {
          events: list.map(function(context) {
            return context.event.event_type;
          }),
          code,
          message,
          stack_trace: getStacktrace()
        });
      } else {
        (_c = this.diagnosticsClient) === null || _c === void 0 ? void 0 : _c.increment("analytics.events.sent", list.length);
      }
      this.removeEvents(list);
      list.forEach(function(context) {
        return context.callback(buildResult(context.event, code, message));
      });
    };
    Destination2.prototype.saveEvents = function() {
      if (!this.config.storageProvider) {
        return;
      }
      var updatedEvents = this.queue.map(function(context) {
        return context.event;
      });
      void this.config.storageProvider.set(this.storageKey, updatedEvents);
    };
    Destination2.prototype.removeEvents = function(eventsToRemove) {
      this.queue = this.queue.filter(function(queuedContext) {
        return !eventsToRemove.some(function(context) {
          return context.event.insert_id === queuedContext.event.insert_id;
        });
      });
      this.saveEvents();
    };
    return Destination2;
  })()
);

// node_modules/@amplitude/analytics-connector/dist/analytics-connector.esm.js
var ApplicationContextProviderImpl = (
  /** @class */
  (function() {
    function ApplicationContextProviderImpl2() {
    }
    ApplicationContextProviderImpl2.prototype.getApplicationContext = function() {
      return {
        versionName: this.versionName,
        language: getLanguage(),
        platform: "Web",
        os: void 0,
        deviceModel: void 0
      };
    };
    return ApplicationContextProviderImpl2;
  })()
);
var getLanguage = function() {
  return typeof navigator !== "undefined" && (navigator.languages && navigator.languages[0] || navigator.language) || "";
};
var EventBridgeImpl = (
  /** @class */
  (function() {
    function EventBridgeImpl2() {
      this.queue = [];
    }
    EventBridgeImpl2.prototype.logEvent = function(event) {
      if (!this.receiver) {
        if (this.queue.length < 512) {
          this.queue.push(event);
        }
      } else {
        this.receiver(event);
      }
    };
    EventBridgeImpl2.prototype.setEventReceiver = function(receiver) {
      this.receiver = receiver;
      if (this.queue.length > 0) {
        this.queue.forEach(function(event) {
          receiver(event);
        });
        this.queue = [];
      }
    };
    return EventBridgeImpl2;
  })()
);
var __assign2 = function() {
  __assign2 = Object.assign || function __assign7(t2) {
    for (var s2, i2 = 1, n2 = arguments.length; i2 < n2; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2)) t2[p2] = s2[p2];
    }
    return t2;
  };
  return __assign2.apply(this, arguments);
};
function __values2(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return {
        value: o2 && o2[i2++],
        done: !o2
      };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
function __read2(o2, n2) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r2, ar = [], e2;
  try {
    while ((n2 === void 0 || n2-- > 0) && !(r2 = i2.next()).done) ar.push(r2.value);
  } catch (error) {
    e2 = {
      error
    };
  } finally {
    try {
      if (r2 && !r2.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e2) throw e2.error;
    }
  }
  return ar;
}
var isEqual = function(obj1, obj2) {
  var e_1, _a;
  var primitive = ["string", "number", "boolean", "undefined"];
  var typeA = typeof obj1;
  var typeB = typeof obj2;
  if (typeA !== typeB) {
    return false;
  }
  try {
    for (var primitive_1 = __values2(primitive), primitive_1_1 = primitive_1.next(); !primitive_1_1.done; primitive_1_1 = primitive_1.next()) {
      var p2 = primitive_1_1.value;
      if (p2 === typeA) {
        return obj1 === obj2;
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (primitive_1_1 && !primitive_1_1.done && (_a = primitive_1.return)) _a.call(primitive_1);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
  if (obj1 == null && obj2 == null) {
    return true;
  } else if (obj1 == null || obj2 == null) {
    return false;
  }
  if (obj1.length !== obj2.length) {
    return false;
  }
  var isArrayA = Array.isArray(obj1);
  var isArrayB = Array.isArray(obj2);
  if (isArrayA !== isArrayB) {
    return false;
  }
  if (isArrayA && isArrayB) {
    for (var i2 = 0; i2 < obj1.length; i2++) {
      if (!isEqual(obj1[i2], obj2[i2])) {
        return false;
      }
    }
  } else {
    var sorted1 = Object.keys(obj1).sort();
    var sorted2 = Object.keys(obj2).sort();
    if (!isEqual(sorted1, sorted2)) {
      return false;
    }
    var result_1 = true;
    Object.keys(obj1).forEach(function(key) {
      if (!isEqual(obj1[key], obj2[key])) {
        result_1 = false;
      }
    });
    return result_1;
  }
  return true;
};
var ID_OP_SET = "$set";
var ID_OP_UNSET = "$unset";
var ID_OP_CLEAR_ALL = "$clearAll";
if (!Object.entries) {
  Object.entries = function(obj) {
    var ownProps = Object.keys(obj);
    var i2 = ownProps.length;
    var resArray = new Array(i2);
    while (i2--) {
      resArray[i2] = [ownProps[i2], obj[ownProps[i2]]];
    }
    return resArray;
  };
}
var IdentityStoreImpl = (
  /** @class */
  (function() {
    function IdentityStoreImpl2() {
      this.identity = { userProperties: {} };
      this.listeners = /* @__PURE__ */ new Set();
    }
    IdentityStoreImpl2.prototype.editIdentity = function() {
      var self2 = this;
      var actingUserProperties = __assign2({}, this.identity.userProperties);
      var actingIdentity = __assign2(__assign2({}, this.identity), { userProperties: actingUserProperties });
      return {
        setUserId: function(userId) {
          actingIdentity.userId = userId;
          return this;
        },
        setDeviceId: function(deviceId) {
          actingIdentity.deviceId = deviceId;
          return this;
        },
        setUserProperties: function(userProperties) {
          actingIdentity.userProperties = userProperties;
          return this;
        },
        setOptOut: function(optOut) {
          actingIdentity.optOut = optOut;
          return this;
        },
        updateUserProperties: function(actions) {
          var e_1, _a, e_2, _b, e_3, _c;
          var actingProperties = actingIdentity.userProperties || {};
          try {
            for (var _d = __values2(Object.entries(actions)), _e = _d.next(); !_e.done; _e = _d.next()) {
              var _f = __read2(_e.value, 2), action = _f[0], properties = _f[1];
              switch (action) {
                case ID_OP_SET:
                  try {
                    for (var _g = (e_2 = void 0, __values2(Object.entries(properties))), _h = _g.next(); !_h.done; _h = _g.next()) {
                      var _j = __read2(_h.value, 2), key = _j[0], value = _j[1];
                      actingProperties[key] = value;
                    }
                  } catch (e_2_1) {
                    e_2 = { error: e_2_1 };
                  } finally {
                    try {
                      if (_h && !_h.done && (_b = _g.return)) _b.call(_g);
                    } finally {
                      if (e_2) throw e_2.error;
                    }
                  }
                  break;
                case ID_OP_UNSET:
                  try {
                    for (var _k = (e_3 = void 0, __values2(Object.keys(properties))), _l = _k.next(); !_l.done; _l = _k.next()) {
                      var key = _l.value;
                      delete actingProperties[key];
                    }
                  } catch (e_3_1) {
                    e_3 = { error: e_3_1 };
                  } finally {
                    try {
                      if (_l && !_l.done && (_c = _k.return)) _c.call(_k);
                    } finally {
                      if (e_3) throw e_3.error;
                    }
                  }
                  break;
                case ID_OP_CLEAR_ALL:
                  actingProperties = {};
                  break;
              }
            }
          } catch (e_1_1) {
            e_1 = { error: e_1_1 };
          } finally {
            try {
              if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
            } finally {
              if (e_1) throw e_1.error;
            }
          }
          actingIdentity.userProperties = actingProperties;
          return this;
        },
        commit: function() {
          self2.setIdentity(actingIdentity);
          return this;
        }
      };
    };
    IdentityStoreImpl2.prototype.getIdentity = function() {
      return __assign2({}, this.identity);
    };
    IdentityStoreImpl2.prototype.setIdentity = function(identity) {
      var originalIdentity = __assign2({}, this.identity);
      this.identity = __assign2({}, identity);
      if (!isEqual(originalIdentity, this.identity)) {
        this.listeners.forEach(function(listener) {
          listener(identity);
        });
      }
    };
    IdentityStoreImpl2.prototype.addIdentityListener = function(listener) {
      this.listeners.add(listener);
    };
    IdentityStoreImpl2.prototype.removeIdentityListener = function(listener) {
      this.listeners.delete(listener);
    };
    return IdentityStoreImpl2;
  })()
);
var safeGlobal = typeof globalThis !== "undefined" ? globalThis : typeof global !== "undefined" ? global : self;
var AnalyticsConnector = (
  /** @class */
  (function() {
    function AnalyticsConnector2() {
      this.identityStore = new IdentityStoreImpl();
      this.eventBridge = new EventBridgeImpl();
      this.applicationContextProvider = new ApplicationContextProviderImpl();
    }
    AnalyticsConnector2.getInstance = function(instanceName) {
      if (!safeGlobal["analyticsConnectorInstances"]) {
        safeGlobal["analyticsConnectorInstances"] = {};
      }
      if (!safeGlobal["analyticsConnectorInstances"][instanceName]) {
        safeGlobal["analyticsConnectorInstances"][instanceName] = new AnalyticsConnector2();
      }
      return safeGlobal["analyticsConnectorInstances"][instanceName];
    };
    return AnalyticsConnector2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/analytics-connector.js
var getAnalyticsConnector = function(instanceName) {
  if (instanceName === void 0) {
    instanceName = DEFAULT_INSTANCE_NAME;
  }
  return AnalyticsConnector.getInstance(instanceName);
};
var setConnectorUserId = function(userId, instanceName) {
  getAnalyticsConnector(instanceName).identityStore.editIdentity().setUserId(userId).commit();
};
var setConnectorDeviceId = function(deviceId, instanceName) {
  getAnalyticsConnector(instanceName).identityStore.editIdentity().setDeviceId(deviceId).commit();
};

// node_modules/@amplitude/analytics-core/lib/esm/plugins/identity.js
var IdentityEventSender = (
  /** @class */
  (function() {
    function IdentityEventSender2() {
      this.name = "identity";
      this.type = "before";
      this.identityStore = getAnalyticsConnector().identityStore;
    }
    IdentityEventSender2.prototype.execute = function(context) {
      return __awaiter(this, void 0, void 0, function() {
        var userProperties;
        return __generator(this, function(_a) {
          userProperties = context.user_properties;
          if (userProperties) {
            this.identityStore.editIdentity().updateUserProperties(userProperties).commit();
          }
          return [2, context];
        });
      });
    };
    IdentityEventSender2.prototype.setup = function(config) {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          if (config.instanceName) {
            this.identityStore = getAnalyticsConnector(config.instanceName).identityStore;
          }
          return [
            2
            /*return*/
          ];
        });
      });
    };
    return IdentityEventSender2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/session.js
var isNewSession = function(sessionTimeout, lastEventTime) {
  if (lastEventTime === void 0) {
    lastEventTime = Date.now();
  }
  var currentTime = Date.now();
  var timeSinceLastEvent = currentTime - lastEventTime;
  return timeSinceLastEvent > sessionTimeout;
};

// node_modules/@amplitude/analytics-core/lib/esm/cookie-name.js
var getCookieName = function(apiKey, postKey, limit) {
  if (postKey === void 0) {
    postKey = "";
  }
  if (limit === void 0) {
    limit = 10;
  }
  return [AMPLITUDE_PREFIX, postKey, apiKey.substring(0, limit)].filter(Boolean).join("_");
};
var getOldCookieName = function(apiKey) {
  return "".concat(AMPLITUDE_PREFIX.toLowerCase(), "_").concat(apiKey.substring(0, 6));
};

// node_modules/@amplitude/analytics-core/lib/esm/language.js
var getLanguage2 = function() {
  var _a, _b, _c, _d;
  if (typeof navigator === "undefined")
    return "";
  var userLanguage = navigator.userLanguage;
  return (_d = (_c = (_b = (_a = navigator.languages) === null || _a === void 0 ? void 0 : _a[0]) !== null && _b !== void 0 ? _b : navigator.language) !== null && _c !== void 0 ? _c : userLanguage) !== null && _d !== void 0 ? _d : "";
};

// node_modules/@amplitude/analytics-core/lib/esm/query-params.js
var getQueryParams = function() {
  var _a;
  var globalScope3 = getGlobalScope();
  if (!((_a = globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.location) === null || _a === void 0 ? void 0 : _a.search)) {
    return {};
  }
  var pairs = globalScope3.location.search.substring(1).split("&").filter(Boolean);
  var params = pairs.reduce(function(acc, curr) {
    var query = curr.split("=", 2);
    var key = tryDecodeURIComponent(query[0]);
    var value = tryDecodeURIComponent(query[1]);
    if (!value) {
      return acc;
    }
    acc[key] = value;
    return acc;
  }, {});
  return params;
};
var tryDecodeURIComponent = function(value) {
  if (value === void 0) {
    value = "";
  }
  try {
    return decodeURIComponent(value);
  } catch (_a) {
    return "";
  }
};

// node_modules/@amplitude/analytics-core/lib/esm/utils/url-utils.js
var isUrlMatchAllowlist = function(url, allowlist) {
  if (!allowlist || !allowlist.length) {
    return true;
  }
  return allowlist.some(function(allowedUrl) {
    if (typeof allowedUrl === "string") {
      return url === allowedUrl;
    }
    return url.match(allowedUrl);
  });
};
var getDecodeURI = function(locationStr, loggerProvider) {
  var decodedLocationStr = locationStr;
  try {
    decodedLocationStr = decodeURI(locationStr);
  } catch (e2) {
    loggerProvider === null || loggerProvider === void 0 ? void 0 : loggerProvider.error("Malformed URI sequence: ", e2);
  }
  return decodedLocationStr;
};

// node_modules/@amplitude/analytics-core/lib/esm/utils/sampling.js
var generateHashCode = function(str) {
  var hash = 0;
  if (str.length === 0)
    return hash;
  for (var i2 = 0; i2 < str.length; i2++) {
    var chr = str.charCodeAt(i2);
    hash = (hash << 5) - hash + chr;
    hash |= 0;
  }
  return hash;
};
var isTimestampInSampleTemp = function(timestamp, sampleRate) {
  var hashNumber = generateHashCode(timestamp.toString());
  var absHash = Math.abs(hashNumber);
  var absHashMultiply = absHash * 31;
  var mod = absHashMultiply % 1e5;
  return mod / 1e5 < sampleRate;
};

// node_modules/@amplitude/analytics-core/lib/esm/storage/memory.js
var MemoryStorage = (
  /** @class */
  (function() {
    function MemoryStorage2() {
      this.memoryStorage = /* @__PURE__ */ new Map();
    }
    MemoryStorage2.prototype.isEnabled = function() {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          return [2, true];
        });
      });
    };
    MemoryStorage2.prototype.get = function(key) {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          return [2, this.memoryStorage.get(key)];
        });
      });
    };
    MemoryStorage2.prototype.getRaw = function(key) {
      return __awaiter(this, void 0, void 0, function() {
        var value;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              return [4, this.get(key)];
            case 1:
              value = _a.sent();
              return [2, value ? JSON.stringify(value) : void 0];
          }
        });
      });
    };
    MemoryStorage2.prototype.set = function(key, value) {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          this.memoryStorage.set(key, value);
          return [
            2
            /*return*/
          ];
        });
      });
    };
    MemoryStorage2.prototype.remove = function(key) {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          this.memoryStorage.delete(key);
          return [
            2
            /*return*/
          ];
        });
      });
    };
    MemoryStorage2.prototype.reset = function() {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          this.memoryStorage.clear();
          return [
            2
            /*return*/
          ];
        });
      });
    };
    return MemoryStorage2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/storage/cookie.js
var CookieStorage = (
  /** @class */
  (function() {
    function CookieStorage2(options, config) {
      if (config === void 0) {
        config = {};
      }
      this.options = __assign({}, options);
      this.config = config;
    }
    CookieStorage2.prototype.isEnabled = function() {
      return __awaiter(this, void 0, void 0, function() {
        var testCookieOptions, testStorage, testKey, value, _a;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              if (!getGlobalScope()) {
                return [2, false];
              }
              CookieStorage2.testValue = String(Date.now());
              testCookieOptions = __assign(__assign({}, this.options), { expirationDays: 3e-3 });
              testStorage = new CookieStorage2(testCookieOptions);
              testKey = "AMP_TEST_".concat(UUID().substring(0, 8));
              _b.label = 1;
            case 1:
              _b.trys.push([1, 4, 5, 7]);
              return [4, testStorage.set(testKey, CookieStorage2.testValue)];
            case 2:
              _b.sent();
              return [4, testStorage.get(testKey)];
            case 3:
              value = _b.sent();
              return [2, value === CookieStorage2.testValue];
            case 4:
              _a = _b.sent();
              return [2, false];
            case 5:
              return [4, testStorage.remove(testKey)];
            case 6:
              _b.sent();
              return [
                7
                /*endfinally*/
              ];
            case 7:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    CookieStorage2.prototype.get = function(key) {
      return __awaiter(this, void 0, void 0, function() {
        var value, decodedValue;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              return [4, this.getRaw(key)];
            case 1:
              value = _a.sent();
              if (!value) {
                return [2, void 0];
              }
              try {
                decodedValue = decodeCookieValue(value);
                if (decodedValue === void 0) {
                  console.error("Amplitude Logger [Error]: Failed to decode cookie value for key: ".concat(key, ", value: ").concat(value));
                  return [2, void 0];
                }
                return [2, JSON.parse(decodedValue)];
              } catch (_b) {
                console.error("Amplitude Logger [Error]: Failed to parse cookie value for key: ".concat(key, ", value: ").concat(value));
                return [2, void 0];
              }
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    CookieStorage2.prototype.getRaw = function(key) {
      var _a, _b, _c, _d;
      return __awaiter(this, void 0, void 0, function() {
        var globalScope3, globalScopeWithCookiesStore, cookieStore, cookies_2, cookies_1, cookies_1_1, cookie, ignoreError_1, cookies, match, duplicateResolverFn;
        var e_1, _e;
        var _this = this;
        return __generator(this, function(_f) {
          switch (_f.label) {
            case 0:
              globalScope3 = getGlobalScope();
              globalScopeWithCookiesStore = globalScope3;
              _f.label = 1;
            case 1:
              _f.trys.push([1, 4, , 5]);
              cookieStore = globalScopeWithCookiesStore === null || globalScopeWithCookiesStore === void 0 ? void 0 : globalScopeWithCookiesStore.cookieStore;
              if (!cookieStore) return [3, 3];
              return [4, cookieStore.getAll(key)];
            case 2:
              cookies_2 = _f.sent();
              if (cookies_2) {
                if (cookies_2.length > 1) {
                  (_a = this.config.diagnosticsClient) === null || _a === void 0 ? void 0 : _a.recordEvent("cookies.duplicate", {
                    cookies: cookies_2.map(function(cookie2) {
                      return cookie2.domain;
                    })
                  });
                  (_b = this.config.diagnosticsClient) === null || _b === void 0 ? void 0 : _b.increment("cookies.duplicate.occurrence.cookieStore");
                }
                try {
                  for (cookies_1 = __values(cookies_2), cookies_1_1 = cookies_1.next(); !cookies_1_1.done; cookies_1_1 = cookies_1.next()) {
                    cookie = cookies_1_1.value;
                    if (isDomainEqual(cookie.domain, this.options.domain)) {
                      return [2, cookie.value];
                    }
                  }
                } catch (e_1_1) {
                  e_1 = { error: e_1_1 };
                } finally {
                  try {
                    if (cookies_1_1 && !cookies_1_1.done && (_e = cookies_1.return)) _e.call(cookies_1);
                  } finally {
                    if (e_1) throw e_1.error;
                  }
                }
              }
              _f.label = 3;
            case 3:
              return [3, 5];
            case 4:
              ignoreError_1 = _f.sent();
              return [3, 5];
            case 5:
              cookies = ((_d = (_c = globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.document) === null || _c === void 0 ? void 0 : _c.cookie.split("; ")) !== null && _d !== void 0 ? _d : []).filter(function(c2) {
                return c2.indexOf(key + "=") === 0;
              });
              match = void 0;
              duplicateResolverFn = this.config.duplicateResolverFn;
              if (typeof duplicateResolverFn === "function" && cookies.length > 1) {
                match = cookies.find(function(c2) {
                  var _a2;
                  try {
                    var res = duplicateResolverFn(c2.substring(key.length + 1));
                    if (!res) {
                      (_a2 = _this.config.diagnosticsClient) === null || _a2 === void 0 ? void 0 : _a2.increment("cookies.duplicate.occurrence.document.cookie");
                    }
                    return res;
                  } catch (ignoreError) {
                    return false;
                  }
                });
              }
              if (!match) {
                match = cookies[0];
              }
              if (!match) {
                return [2, void 0];
              }
              return [2, match.substring(key.length + 1)];
          }
        });
      });
    };
    CookieStorage2.prototype.set = function(key, value) {
      var _a;
      return __awaiter(this, void 0, void 0, function() {
        var expirationDays, expires, expireDate, date, str, globalScope3, errorMessage;
        return __generator(this, function(_b) {
          try {
            expirationDays = (_a = this.options.expirationDays) !== null && _a !== void 0 ? _a : 0;
            expires = value !== null ? expirationDays : -1;
            expireDate = void 0;
            if (expires) {
              date = /* @__PURE__ */ new Date();
              date.setTime(date.getTime() + expires * 24 * 60 * 60 * 1e3);
              expireDate = date;
            }
            str = "".concat(key, "=").concat(btoa(encodeURIComponent(JSON.stringify(value))));
            if (expireDate) {
              str += "; expires=".concat(expireDate.toUTCString());
            }
            str += "; path=/";
            if (this.options.domain) {
              str += "; domain=".concat(this.options.domain);
            }
            if (this.options.secure) {
              str += "; Secure";
            }
            if (this.options.sameSite) {
              str += "; SameSite=".concat(this.options.sameSite);
            }
            globalScope3 = getGlobalScope();
            if (globalScope3) {
              globalScope3.document.cookie = str;
            }
          } catch (error) {
            errorMessage = error instanceof Error ? error.message : String(error);
            console.error("Amplitude Logger [Error]: Failed to set cookie for key: ".concat(key, ". Error: ").concat(errorMessage));
          }
          return [
            2
            /*return*/
          ];
        });
      });
    };
    CookieStorage2.prototype.remove = function(key) {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              return [4, this.set(key, null)];
            case 1:
              _a.sent();
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    CookieStorage2.prototype.reset = function() {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          return [
            2
            /*return*/
          ];
        });
      });
    };
    return CookieStorage2;
  })()
);
var decodeCookiesAsDefault = function(value) {
  try {
    return decodeURIComponent(atob(value));
  } catch (_a) {
    return void 0;
  }
};
var decodeCookiesWithDoubleUrlEncoding = function(value) {
  try {
    return decodeURIComponent(atob(decodeURIComponent(value)));
  } catch (_a) {
    return void 0;
  }
};
var decodeCookieValue = function(value) {
  var _a;
  return (_a = decodeCookiesAsDefault(value)) !== null && _a !== void 0 ? _a : decodeCookiesWithDoubleUrlEncoding(value);
};
var isDomainEqual = function(domain1, domain2) {
  if (!domain1 || !domain2) {
    return false;
  }
  var normalized1 = domain1.startsWith(".") ? domain1.substring(1) : domain1;
  var normalized2 = domain2.startsWith(".") ? domain2.substring(1) : domain2;
  return normalized1.toLowerCase() === normalized2.toLowerCase();
};

// node_modules/@amplitude/analytics-core/lib/esm/storage/helpers.js
var getStorageKey = function(apiKey, postKey, limit) {
  if (postKey === void 0) {
    postKey = "";
  }
  if (limit === void 0) {
    limit = 10;
  }
  return [AMPLITUDE_PREFIX, postKey, apiKey.substring(0, limit)].filter(Boolean).join("_");
};

// node_modules/@amplitude/analytics-core/lib/esm/storage/browser-storage.js
var BrowserStorage = (
  /** @class */
  (function() {
    function BrowserStorage2(storage) {
      this.storage = storage;
    }
    BrowserStorage2.prototype.isEnabled = function() {
      return __awaiter(this, void 0, void 0, function() {
        var random, testStorage, testKey, value, _a;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              if (!this.storage) {
                return [2, false];
              }
              random = String(Date.now());
              testStorage = new BrowserStorage2(this.storage);
              testKey = "AMP_TEST";
              _b.label = 1;
            case 1:
              _b.trys.push([1, 4, 5, 7]);
              return [4, testStorage.set(testKey, random)];
            case 2:
              _b.sent();
              return [4, testStorage.get(testKey)];
            case 3:
              value = _b.sent();
              return [2, value === random];
            case 4:
              _a = _b.sent();
              return [2, false];
            case 5:
              return [4, testStorage.remove(testKey)];
            case 6:
              _b.sent();
              return [
                7
                /*endfinally*/
              ];
            case 7:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    BrowserStorage2.prototype.get = function(key) {
      return __awaiter(this, void 0, void 0, function() {
        var value, _a;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              _b.trys.push([0, 2, , 3]);
              return [4, this.getRaw(key)];
            case 1:
              value = _b.sent();
              if (!value) {
                return [2, void 0];
              }
              return [2, JSON.parse(value)];
            case 2:
              _a = _b.sent();
              console.error("[Amplitude] Error: Could not get value from storage");
              return [2, void 0];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    BrowserStorage2.prototype.getRaw = function(key) {
      var _a;
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_b) {
          return [2, ((_a = this.storage) === null || _a === void 0 ? void 0 : _a.getItem(key)) || void 0];
        });
      });
    };
    BrowserStorage2.prototype.set = function(key, value) {
      var _a;
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_b) {
          try {
            (_a = this.storage) === null || _a === void 0 ? void 0 : _a.setItem(key, JSON.stringify(value));
          } catch (_c) {
          }
          return [
            2
            /*return*/
          ];
        });
      });
    };
    BrowserStorage2.prototype.remove = function(key) {
      var _a;
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_b) {
          try {
            (_a = this.storage) === null || _a === void 0 ? void 0 : _a.removeItem(key);
          } catch (_c) {
          }
          return [
            2
            /*return*/
          ];
        });
      });
    };
    BrowserStorage2.prototype.reset = function() {
      var _a;
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_b) {
          try {
            (_a = this.storage) === null || _a === void 0 ? void 0 : _a.clear();
          } catch (_c) {
          }
          return [
            2
            /*return*/
          ];
        });
      });
    };
    return BrowserStorage2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/diagnostics/diagnostics-storage.js
var MAX_PERSISTENT_STORAGE_EVENTS_COUNT = 10;
var DB_VERSION = 1;
var TABLE_NAMES = {
  TAGS: "tags",
  COUNTERS: "counters",
  HISTOGRAMS: "histograms",
  EVENTS: "events",
  INTERNAL: "internal"
  // New table for internal storage like flush timestamps
};
var INTERNAL_KEYS = {
  LAST_FLUSH_TIMESTAMP: "last_flush_timestamp"
};
var DiagnosticsStorage = (
  /** @class */
  (function() {
    function DiagnosticsStorage2(apiKey, logger) {
      this.dbPromise = null;
      this.logger = logger;
      this.dbName = "AMP_diagnostics_".concat(apiKey.substring(0, 10));
    }
    DiagnosticsStorage2.isSupported = function() {
      var _a;
      return ((_a = getGlobalScope()) === null || _a === void 0 ? void 0 : _a.indexedDB) !== void 0;
    };
    DiagnosticsStorage2.prototype.getDB = function() {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          if (!this.dbPromise) {
            this.dbPromise = this.openDB();
          }
          return [2, this.dbPromise];
        });
      });
    };
    DiagnosticsStorage2.prototype.openDB = function() {
      var _this = this;
      return new Promise(function(resolve, reject) {
        var request = indexedDB.open(_this.dbName, DB_VERSION);
        request.onerror = function() {
          _this.dbPromise = null;
          reject(new Error("Failed to open IndexedDB"));
        };
        request.onsuccess = function() {
          var db = request.result;
          db.onclose = function() {
            _this.dbPromise = null;
            _this.logger.debug("DiagnosticsStorage: DB connection closed.");
          };
          db.onerror = function(event) {
            _this.logger.debug("DiagnosticsStorage: A global database error occurred.", event);
            db.close();
          };
          resolve(db);
        };
        request.onupgradeneeded = function(event) {
          var db = event.target.result;
          _this.createTables(db);
        };
      });
    };
    DiagnosticsStorage2.prototype.createTables = function(db) {
      if (!db.objectStoreNames.contains(TABLE_NAMES.TAGS)) {
        db.createObjectStore(TABLE_NAMES.TAGS, { keyPath: "key" });
      }
      if (!db.objectStoreNames.contains(TABLE_NAMES.COUNTERS)) {
        db.createObjectStore(TABLE_NAMES.COUNTERS, { keyPath: "key" });
      }
      if (!db.objectStoreNames.contains(TABLE_NAMES.HISTOGRAMS)) {
        db.createObjectStore(TABLE_NAMES.HISTOGRAMS, {
          keyPath: "key"
        });
      }
      if (!db.objectStoreNames.contains(TABLE_NAMES.EVENTS)) {
        var eventsStore = db.createObjectStore(TABLE_NAMES.EVENTS, {
          keyPath: "id",
          autoIncrement: true
        });
        eventsStore.createIndex("time_idx", "time", { unique: false });
      }
      if (!db.objectStoreNames.contains(TABLE_NAMES.INTERNAL)) {
        db.createObjectStore(TABLE_NAMES.INTERNAL, { keyPath: "key" });
      }
    };
    DiagnosticsStorage2.prototype.setTags = function(tags) {
      return __awaiter(this, void 0, void 0, function() {
        var db, transaction_1, store_1, error_1;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              if (Object.entries(tags).length === 0) {
                return [
                  2
                  /*return*/
                ];
              }
              return [4, this.getDB()];
            case 1:
              db = _a.sent();
              transaction_1 = db.transaction([TABLE_NAMES.TAGS], "readwrite");
              store_1 = transaction_1.objectStore(TABLE_NAMES.TAGS);
              return [2, new Promise(function(resolve) {
                var entries = Object.entries(tags);
                transaction_1.oncomplete = function() {
                  resolve();
                };
                transaction_1.onabort = function(event) {
                  _this.logger.debug("DiagnosticsStorage: Failed to set tags", event);
                  resolve();
                };
                entries.forEach(function(_a2) {
                  var _b = __read(_a2, 2), key = _b[0], value = _b[1];
                  var putRequest = store_1.put({ key, value });
                  putRequest.onerror = function(event) {
                    _this.logger.debug("DiagnosticsStorage: Failed to set tag", key, value, event);
                  };
                });
              })];
            case 2:
              error_1 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to set tags", error_1);
              return [3, 3];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.incrementCounters = function(counters) {
      return __awaiter(this, void 0, void 0, function() {
        var db, transaction_2, store_2, error_2;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              if (Object.entries(counters).length === 0) {
                return [
                  2
                  /*return*/
                ];
              }
              return [4, this.getDB()];
            case 1:
              db = _a.sent();
              transaction_2 = db.transaction([TABLE_NAMES.COUNTERS], "readwrite");
              store_2 = transaction_2.objectStore(TABLE_NAMES.COUNTERS);
              return [2, new Promise(function(resolve) {
                var entries = Object.entries(counters);
                transaction_2.oncomplete = function() {
                  resolve();
                };
                transaction_2.onabort = function(event) {
                  _this.logger.debug("DiagnosticsStorage: Failed to increment counters", event);
                  resolve();
                };
                entries.forEach(function(_a2) {
                  var _b = __read(_a2, 2), key = _b[0], incrementValue = _b[1];
                  var getRequest = store_2.get(key);
                  getRequest.onsuccess = function() {
                    var existingRecord = getRequest.result;
                    var existingValue = existingRecord ? existingRecord.value : 0;
                    var putRequest = store_2.put({ key, value: existingValue + incrementValue });
                    putRequest.onerror = function(event) {
                      _this.logger.debug("DiagnosticsStorage: Failed to update counter", key, event);
                    };
                  };
                  getRequest.onerror = function(event) {
                    _this.logger.debug("DiagnosticsStorage: Failed to read existing counter", key, event);
                  };
                });
              })];
            case 2:
              error_2 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to increment counters", error_2);
              return [3, 3];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.setHistogramStats = function(histogramStats) {
      return __awaiter(this, void 0, void 0, function() {
        var db, transaction_3, store_3, error_3;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              if (Object.entries(histogramStats).length === 0) {
                return [
                  2
                  /*return*/
                ];
              }
              return [4, this.getDB()];
            case 1:
              db = _a.sent();
              transaction_3 = db.transaction([TABLE_NAMES.HISTOGRAMS], "readwrite");
              store_3 = transaction_3.objectStore(TABLE_NAMES.HISTOGRAMS);
              return [2, new Promise(function(resolve) {
                var entries = Object.entries(histogramStats);
                transaction_3.oncomplete = function() {
                  resolve();
                };
                transaction_3.onabort = function(event) {
                  _this.logger.debug("DiagnosticsStorage: Failed to set histogram stats", event);
                  resolve();
                };
                entries.forEach(function(_a2) {
                  var _b = __read(_a2, 2), key = _b[0], newStats = _b[1];
                  var getRequest = store_3.get(key);
                  getRequest.onsuccess = function() {
                    var existingRecord = getRequest.result;
                    var updatedStats;
                    if (existingRecord) {
                      updatedStats = {
                        key,
                        count: existingRecord.count + newStats.count,
                        min: Math.min(existingRecord.min, newStats.min),
                        max: Math.max(existingRecord.max, newStats.max),
                        sum: existingRecord.sum + newStats.sum
                      };
                    } else {
                      updatedStats = {
                        key,
                        count: newStats.count,
                        min: newStats.min,
                        max: newStats.max,
                        sum: newStats.sum
                      };
                    }
                    var putRequest = store_3.put(updatedStats);
                    putRequest.onerror = function(event) {
                      _this.logger.debug("DiagnosticsStorage: Failed to set histogram stats", key, event);
                    };
                  };
                  getRequest.onerror = function(event) {
                    _this.logger.debug("DiagnosticsStorage: Failed to read existing histogram stats", key, event);
                  };
                });
              })];
            case 2:
              error_3 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to set histogram stats", error_3);
              return [3, 3];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.addEventRecords = function(events) {
      return __awaiter(this, void 0, void 0, function() {
        var db, transaction_4, store_4, error_4;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              if (events.length === 0) {
                return [
                  2
                  /*return*/
                ];
              }
              return [4, this.getDB()];
            case 1:
              db = _a.sent();
              transaction_4 = db.transaction([TABLE_NAMES.EVENTS], "readwrite");
              store_4 = transaction_4.objectStore(TABLE_NAMES.EVENTS);
              return [2, new Promise(function(resolve) {
                transaction_4.oncomplete = function() {
                  resolve();
                };
                transaction_4.onabort = function(event) {
                  _this.logger.debug("DiagnosticsStorage: Failed to add event records", event);
                  resolve();
                };
                var countRequest = store_4.count();
                countRequest.onsuccess = function() {
                  var currentCount = countRequest.result;
                  var availableSlots = Math.max(0, MAX_PERSISTENT_STORAGE_EVENTS_COUNT - currentCount);
                  if (availableSlots < events.length) {
                    _this.logger.debug("DiagnosticsStorage: Only added ".concat(availableSlots, " of ").concat(events.length, " events due to storage limit"));
                  }
                  events.slice(0, availableSlots).forEach(function(event) {
                    var request = store_4.add(event);
                    request.onerror = function(event2) {
                      _this.logger.debug("DiagnosticsStorage: Failed to add event record", event2);
                    };
                  });
                };
                countRequest.onerror = function(event) {
                  _this.logger.debug("DiagnosticsStorage: Failed to count existing events", event);
                };
              })];
            case 2:
              error_4 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to add event records", error_4);
              return [3, 3];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.setInternal = function(key, value) {
      return __awaiter(this, void 0, void 0, function() {
        var db, transaction_5, store_5, error_5;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              return [4, this.getDB()];
            case 1:
              db = _a.sent();
              transaction_5 = db.transaction([TABLE_NAMES.INTERNAL], "readwrite");
              store_5 = transaction_5.objectStore(TABLE_NAMES.INTERNAL);
              return [2, new Promise(function(resolve, reject) {
                transaction_5.onabort = function() {
                  return reject(new Error("Failed to set internal value"));
                };
                var request = store_5.put({ key, value });
                request.onsuccess = function() {
                  return resolve();
                };
                request.onerror = function() {
                  return reject(new Error("Failed to set internal value"));
                };
              })];
            case 2:
              error_5 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to set internal value", error_5);
              return [3, 3];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.getInternal = function(key) {
      return __awaiter(this, void 0, void 0, function() {
        var db, transaction_6, store_6, error_6;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              return [4, this.getDB()];
            case 1:
              db = _a.sent();
              transaction_6 = db.transaction([TABLE_NAMES.INTERNAL], "readonly");
              store_6 = transaction_6.objectStore(TABLE_NAMES.INTERNAL);
              return [2, new Promise(function(resolve, reject) {
                transaction_6.onabort = function() {
                  return reject(new Error("Failed to get internal value"));
                };
                var request = store_6.get(key);
                request.onsuccess = function() {
                  return resolve(request.result);
                };
                request.onerror = function() {
                  return reject(new Error("Failed to get internal value"));
                };
              })];
            case 2:
              error_6 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to get internal value", error_6);
              return [2, void 0];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.getLastFlushTimestamp = function() {
      return __awaiter(this, void 0, void 0, function() {
        var record, error_7;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              return [4, this.getInternal(INTERNAL_KEYS.LAST_FLUSH_TIMESTAMP)];
            case 1:
              record = _a.sent();
              return [2, record ? parseInt(record.value, 10) : void 0];
            case 2:
              error_7 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to get last flush timestamp", error_7);
              return [2, void 0];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.setLastFlushTimestamp = function(timestamp) {
      return __awaiter(this, void 0, void 0, function() {
        var error_8;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              return [4, this.setInternal(INTERNAL_KEYS.LAST_FLUSH_TIMESTAMP, timestamp.toString())];
            case 1:
              _a.sent();
              return [3, 3];
            case 2:
              error_8 = _a.sent();
              this.logger.debug("DiagnosticsStorage: Failed to set last flush timestamp", error_8);
              return [3, 3];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.clearTable = function(transaction, tableName) {
      return new Promise(function(resolve, reject) {
        var store = transaction.objectStore(tableName);
        var request = store.clear();
        request.onsuccess = function() {
          return resolve();
        };
        request.onerror = function() {
          return reject(new Error("Failed to clear table ".concat(tableName)));
        };
      });
    };
    DiagnosticsStorage2.prototype.getAllAndClear = function() {
      return __awaiter(this, void 0, void 0, function() {
        var db, transaction, _a, tags, counters, histogramStats, events, error_9;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              _b.trys.push([0, 4, , 5]);
              return [4, this.getDB()];
            case 1:
              db = _b.sent();
              transaction = db.transaction([TABLE_NAMES.TAGS, TABLE_NAMES.COUNTERS, TABLE_NAMES.HISTOGRAMS, TABLE_NAMES.EVENTS], "readwrite");
              return [4, Promise.all([
                this.getAllFromStore(transaction, TABLE_NAMES.TAGS),
                this.getAllFromStore(transaction, TABLE_NAMES.COUNTERS),
                this.getAllFromStore(transaction, TABLE_NAMES.HISTOGRAMS),
                this.getAllFromStore(transaction, TABLE_NAMES.EVENTS)
              ])];
            case 2:
              _a = __read.apply(void 0, [_b.sent(), 4]), tags = _a[0], counters = _a[1], histogramStats = _a[2], events = _a[3];
              return [4, Promise.all([
                this.clearTable(transaction, TABLE_NAMES.COUNTERS),
                this.clearTable(transaction, TABLE_NAMES.HISTOGRAMS),
                this.clearTable(transaction, TABLE_NAMES.EVENTS)
              ])];
            case 3:
              _b.sent();
              return [2, { tags, counters, histogramStats, events }];
            case 4:
              error_9 = _b.sent();
              this.logger.debug("DiagnosticsStorage: Failed to get all and clear data", error_9);
              return [2, { tags: [], counters: [], histogramStats: [], events: [] }];
            case 5:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsStorage2.prototype.getAllFromStore = function(transaction, tableName) {
      return new Promise(function(resolve, reject) {
        var store = transaction.objectStore(tableName);
        var request = store.getAll();
        request.onsuccess = function() {
          return resolve(request.result);
        };
        request.onerror = function() {
          return reject(new Error("Failed to get all from ".concat(tableName)));
        };
      });
    };
    return DiagnosticsStorage2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/diagnostics/uncaught-sdk-errors.js
var GLOBAL_KEY = "__AMPLITUDE_SCRIPT_URL__";
var EVENT_NAME_ERROR_UNCAUGHT = "sdk.error.uncaught";
var getNormalizedScriptUrl = function() {
  var scope = getGlobalScope();
  return scope === null || scope === void 0 ? void 0 : scope[GLOBAL_KEY];
};
var enableSdkErrorListeners = function(client) {
  var scope = getGlobalScope();
  if (!scope || typeof scope.addEventListener !== "function") {
    return;
  }
  var handleError = function(event) {
    var error = event.error instanceof Error ? event.error : void 0;
    var stack = error === null || error === void 0 ? void 0 : error.stack;
    var match = detectSdkOrigin({ filename: event.filename, stack });
    if (!match) {
      return;
    }
    capture({
      type: "error",
      message: event.message,
      stack,
      filename: event.filename,
      errorName: error === null || error === void 0 ? void 0 : error.name,
      metadata: {
        colno: event.colno,
        lineno: event.lineno,
        isTrusted: event.isTrusted,
        matchReason: match
      }
    });
  };
  var handleRejection = function(event) {
    var _a;
    var error = event.reason instanceof Error ? event.reason : void 0;
    var stack = error === null || error === void 0 ? void 0 : error.stack;
    var filename = extractFilenameFromStack(stack);
    var match = detectSdkOrigin({ filename, stack });
    if (!match) {
      return;
    }
    capture({
      type: "unhandledrejection",
      message: (_a = error === null || error === void 0 ? void 0 : error.message) !== null && _a !== void 0 ? _a : stringifyReason(event.reason),
      stack,
      filename,
      errorName: error === null || error === void 0 ? void 0 : error.name,
      metadata: {
        isTrusted: event.isTrusted,
        matchReason: match
      }
    });
  };
  var capture = function(context) {
    client.recordEvent(EVENT_NAME_ERROR_UNCAUGHT, __assign({ type: context.type, message: context.message, filename: context.filename, error_name: context.errorName, stack: context.stack }, context.metadata));
  };
  scope.addEventListener("error", handleError, true);
  scope.addEventListener("unhandledrejection", handleRejection, true);
};
var detectSdkOrigin = function(payload) {
  var normalizedScriptUrl = getNormalizedScriptUrl();
  if (!normalizedScriptUrl) {
    return void 0;
  }
  if (payload.filename && payload.filename.includes(normalizedScriptUrl)) {
    return "filename";
  }
  if (payload.stack && payload.stack.includes(normalizedScriptUrl)) {
    return "stack";
  }
  return void 0;
};
var extractFilenameFromStack = function(stack) {
  if (!stack) {
    return void 0;
  }
  var match = stack.match(/(https?:\/\/\S+?)(?=[)\s]|$)/);
  return match ? match[1] : void 0;
};
var stringifyReason = function(reason) {
  if (typeof reason === "string") {
    return reason;
  }
  try {
    return JSON.stringify(reason);
  } catch (_a) {
    return "[object Object]";
  }
};

// node_modules/@amplitude/analytics-core/lib/esm/diagnostics/diagnostics-client.js
var SAVE_INTERVAL_MS = 1e3;
var FLUSH_INTERVAL_MS = 5 * 60 * 1e3;
var DIAGNOSTICS_US_SERVER_URL = "https://diagnostics.prod.us-west-2.amplitude.com/v1/capture";
var DIAGNOSTICS_EU_SERVER_URL = "https://diagnostics.prod.eu-central-1.amplitude.com/v1/capture";
var MAX_MEMORY_STORAGE_COUNT = 1e4;
var MAX_MEMORY_STORAGE_EVENTS_COUNT = 10;
var DiagnosticsClient = (
  /** @class */
  (function() {
    function DiagnosticsClient2(apiKey, logger, serverZone, options) {
      if (serverZone === void 0) {
        serverZone = "US";
      }
      this.inMemoryTags = {};
      this.inMemoryCounters = {};
      this.inMemoryHistograms = {};
      this.inMemoryEvents = [];
      this.saveTimer = null;
      this.flushTimer = null;
      this.apiKey = apiKey;
      this.logger = logger;
      this.serverUrl = serverZone === "US" ? DIAGNOSTICS_US_SERVER_URL : DIAGNOSTICS_EU_SERVER_URL;
      this.logger.debug("DiagnosticsClient: Initializing with options", JSON.stringify(options, null, 2));
      this.config = __assign({ enabled: true, sampleRate: 0 }, options);
      this.startTimestamp = Date.now();
      this.shouldTrack = isTimestampInSampleTemp(this.startTimestamp, this.config.sampleRate) && this.config.enabled;
      if (DiagnosticsStorage.isSupported()) {
        this.storage = new DiagnosticsStorage(apiKey, logger);
      } else {
        this.logger.debug("DiagnosticsClient: IndexedDB is not supported");
      }
      void this.initializeFlushInterval();
      if (this.shouldTrack) {
        this.increment("sdk.diagnostics.sampled.in.and.enabled");
        enableSdkErrorListeners(this);
      }
    }
    DiagnosticsClient2.prototype.isStorageAndTrackEnabled = function() {
      return Boolean(this.storage) && Boolean(this.shouldTrack);
    };
    DiagnosticsClient2.prototype.setTag = function(name, value) {
      if (!this.isStorageAndTrackEnabled()) {
        return;
      }
      if (Object.keys(this.inMemoryTags).length >= MAX_MEMORY_STORAGE_COUNT) {
        this.logger.debug("DiagnosticsClient: Early return setTags as reaching memory limit");
        return;
      }
      this.inMemoryTags[name] = value;
      this.startTimersIfNeeded();
    };
    DiagnosticsClient2.prototype.increment = function(name, size) {
      if (size === void 0) {
        size = 1;
      }
      if (!this.isStorageAndTrackEnabled()) {
        return;
      }
      if (Object.keys(this.inMemoryCounters).length >= MAX_MEMORY_STORAGE_COUNT) {
        this.logger.debug("DiagnosticsClient: Early return increment as reaching memory limit");
        return;
      }
      this.inMemoryCounters[name] = (this.inMemoryCounters[name] || 0) + size;
      this.startTimersIfNeeded();
    };
    DiagnosticsClient2.prototype.recordHistogram = function(name, value) {
      if (!this.isStorageAndTrackEnabled()) {
        return;
      }
      if (Object.keys(this.inMemoryHistograms).length >= MAX_MEMORY_STORAGE_COUNT) {
        this.logger.debug("DiagnosticsClient: Early return recordHistogram as reaching memory limit");
        return;
      }
      var existing = this.inMemoryHistograms[name];
      if (existing) {
        existing.count += 1;
        existing.min = Math.min(existing.min, value);
        existing.max = Math.max(existing.max, value);
        existing.sum += value;
      } else {
        this.inMemoryHistograms[name] = {
          count: 1,
          min: value,
          max: value,
          sum: value
        };
      }
      this.startTimersIfNeeded();
    };
    DiagnosticsClient2.prototype.recordEvent = function(name, properties) {
      if (!this.isStorageAndTrackEnabled()) {
        return;
      }
      if (this.inMemoryEvents.length >= MAX_MEMORY_STORAGE_EVENTS_COUNT) {
        this.logger.debug("DiagnosticsClient: Early return recordEvent as reaching memory limit");
        return;
      }
      this.inMemoryEvents.push({
        event_name: name,
        time: Date.now(),
        event_properties: properties
      });
      this.startTimersIfNeeded();
    };
    DiagnosticsClient2.prototype.startTimersIfNeeded = function() {
      var _this = this;
      if (!this.saveTimer) {
        this.saveTimer = setTimeout(function() {
          _this.saveAllDataToStorage().catch(function(error) {
            _this.logger.debug("DiagnosticsClient: Failed to save all data to storage", error);
          }).finally(function() {
            _this.saveTimer = null;
          });
        }, SAVE_INTERVAL_MS);
      }
      if (!this.flushTimer) {
        this.flushTimer = setTimeout(function() {
          _this._flush().catch(function(error) {
            _this.logger.debug("DiagnosticsClient: Failed to flush", error);
          }).finally(function() {
            _this.flushTimer = null;
          });
        }, FLUSH_INTERVAL_MS);
      }
    };
    DiagnosticsClient2.prototype.saveAllDataToStorage = function() {
      return __awaiter(this, void 0, void 0, function() {
        var tagsToSave, countersToSave, histogramsToSave, eventsToSave;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              if (!this.storage) {
                return [
                  2
                  /*return*/
                ];
              }
              tagsToSave = __assign({}, this.inMemoryTags);
              countersToSave = __assign({}, this.inMemoryCounters);
              histogramsToSave = __assign({}, this.inMemoryHistograms);
              eventsToSave = __spreadArray([], __read(this.inMemoryEvents), false);
              this.inMemoryEvents = [];
              this.inMemoryTags = {};
              this.inMemoryCounters = {};
              this.inMemoryHistograms = {};
              return [4, Promise.all([
                this.storage.setTags(tagsToSave),
                this.storage.incrementCounters(countersToSave),
                this.storage.setHistogramStats(histogramsToSave),
                this.storage.addEventRecords(eventsToSave)
              ])];
            case 1:
              _a.sent();
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsClient2.prototype._flush = function() {
      return __awaiter(this, void 0, void 0, function() {
        var _a, tagRecords, counterRecords, histogramStatsRecords, eventRecords, tags, counters, histogram, events, payload;
        return __generator(this, function(_b) {
          switch (_b.label) {
            case 0:
              if (!this.storage) {
                return [
                  2
                  /*return*/
                ];
              }
              return [4, this.saveAllDataToStorage()];
            case 1:
              _b.sent();
              this.saveTimer = null;
              this.flushTimer = null;
              return [4, this.storage.getAllAndClear()];
            case 2:
              _a = _b.sent(), tagRecords = _a.tags, counterRecords = _a.counters, histogramStatsRecords = _a.histogramStats, eventRecords = _a.events;
              void this.storage.setLastFlushTimestamp(Date.now());
              tags = {};
              tagRecords.forEach(function(record) {
                tags[record.key] = record.value;
              });
              counters = {};
              counterRecords.forEach(function(record) {
                counters[record.key] = record.value;
              });
              histogram = {};
              histogramStatsRecords.forEach(function(stats) {
                histogram[stats.key] = {
                  count: stats.count,
                  min: stats.min,
                  max: stats.max,
                  avg: Math.round(stats.sum / stats.count * 100) / 100
                  // round the average to 2 decimal places.
                };
              });
              events = eventRecords.map(function(record) {
                return {
                  event_name: record.event_name,
                  time: record.time,
                  event_properties: record.event_properties
                };
              });
              if (Object.keys(counters).length === 0 && Object.keys(histogram).length === 0 && events.length === 0) {
                return [
                  2
                  /*return*/
                ];
              }
              payload = {
                tags,
                histogram,
                counters,
                events
              };
              void this.fetch(payload);
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsClient2.prototype.fetch = function(payload) {
      return __awaiter(this, void 0, void 0, function() {
        var response, error_1;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              _a.trys.push([0, 2, , 3]);
              if (!getGlobalScope()) {
                throw new Error("DiagnosticsClient: Fetch is not supported");
              }
              return [4, fetch(this.serverUrl, {
                method: "POST",
                headers: {
                  "X-ApiKey": this.apiKey,
                  "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
              })];
            case 1:
              response = _a.sent();
              if (!response.ok) {
                this.logger.debug("DiagnosticsClient: Failed to send diagnostics data.");
                return [
                  2
                  /*return*/
                ];
              }
              this.logger.debug("DiagnosticsClient: Successfully sent diagnostics data");
              return [3, 3];
            case 2:
              error_1 = _a.sent();
              this.logger.debug("DiagnosticsClient: Failed to send diagnostics data. ", error_1);
              return [3, 3];
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsClient2.prototype.initializeFlushInterval = function() {
      return __awaiter(this, void 0, void 0, function() {
        var now, lastFlushTimestamp, timeSinceLastFlush;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              if (!this.storage) {
                return [
                  2
                  /*return*/
                ];
              }
              now = Date.now();
              return [4, this.storage.getLastFlushTimestamp()];
            case 1:
              lastFlushTimestamp = _a.sent() || -1;
              if (lastFlushTimestamp === -1) {
                void this.storage.setLastFlushTimestamp(now);
                this._setFlushTimer(FLUSH_INTERVAL_MS);
                return [
                  2
                  /*return*/
                ];
              }
              timeSinceLastFlush = now - lastFlushTimestamp;
              if (timeSinceLastFlush >= FLUSH_INTERVAL_MS) {
                void this._flush();
                return [
                  2
                  /*return*/
                ];
              } else {
                this._setFlushTimer(FLUSH_INTERVAL_MS - timeSinceLastFlush);
              }
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    DiagnosticsClient2.prototype._setFlushTimer = function(delay) {
      var _this = this;
      this.flushTimer = setTimeout(function() {
        _this._flush().catch(function(error) {
          _this.logger.debug("DiagnosticsClient: Failed to flush", error);
        }).finally(function() {
          _this.flushTimer = null;
        });
      }, delay);
    };
    DiagnosticsClient2.prototype._setSampleRate = function(sampleRate) {
      this.logger.debug("DiagnosticsClient: Setting sample rate to", sampleRate);
      this.config.sampleRate = sampleRate;
      this.shouldTrack = isTimestampInSampleTemp(this.startTimestamp, this.config.sampleRate) && this.config.enabled;
      this.logger.debug("DiagnosticsClient: Should track is", this.shouldTrack);
    };
    return DiagnosticsClient2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/transports/base.js
var BaseTransport = (
  /** @class */
  (function() {
    function BaseTransport2() {
    }
    BaseTransport2.prototype.send = function(_serverUrl, _payload) {
      return Promise.resolve(null);
    };
    BaseTransport2.prototype.buildResponse = function(responseJSON) {
      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x;
      if (typeof responseJSON !== "object") {
        return null;
      }
      var statusCode = responseJSON.code || 0;
      var status = this.buildStatus(statusCode);
      switch (status) {
        case Status.Success:
          return {
            status,
            statusCode,
            body: {
              eventsIngested: (_a = responseJSON.events_ingested) !== null && _a !== void 0 ? _a : 0,
              payloadSizeBytes: (_b = responseJSON.payload_size_bytes) !== null && _b !== void 0 ? _b : 0,
              serverUploadTime: (_c = responseJSON.server_upload_time) !== null && _c !== void 0 ? _c : 0
            }
          };
        case Status.Invalid:
          return {
            status,
            statusCode,
            body: {
              error: (_d = responseJSON.error) !== null && _d !== void 0 ? _d : "",
              missingField: (_e = responseJSON.missing_field) !== null && _e !== void 0 ? _e : "",
              eventsWithInvalidFields: (_f = responseJSON.events_with_invalid_fields) !== null && _f !== void 0 ? _f : {},
              eventsWithMissingFields: (_g = responseJSON.events_with_missing_fields) !== null && _g !== void 0 ? _g : {},
              eventsWithInvalidIdLengths: (_h = responseJSON.events_with_invalid_id_lengths) !== null && _h !== void 0 ? _h : {},
              epsThreshold: (_j = responseJSON.eps_threshold) !== null && _j !== void 0 ? _j : 0,
              exceededDailyQuotaDevices: (_k = responseJSON.exceeded_daily_quota_devices) !== null && _k !== void 0 ? _k : {},
              silencedDevices: (_l = responseJSON.silenced_devices) !== null && _l !== void 0 ? _l : [],
              silencedEvents: (_m = responseJSON.silenced_events) !== null && _m !== void 0 ? _m : [],
              throttledDevices: (_o = responseJSON.throttled_devices) !== null && _o !== void 0 ? _o : {},
              throttledEvents: (_p = responseJSON.throttled_events) !== null && _p !== void 0 ? _p : []
            }
          };
        case Status.PayloadTooLarge:
          return {
            status,
            statusCode,
            body: {
              error: (_q = responseJSON.error) !== null && _q !== void 0 ? _q : ""
            }
          };
        case Status.RateLimit:
          return {
            status,
            statusCode,
            body: {
              error: (_r = responseJSON.error) !== null && _r !== void 0 ? _r : "",
              epsThreshold: (_s = responseJSON.eps_threshold) !== null && _s !== void 0 ? _s : 0,
              throttledDevices: (_t = responseJSON.throttled_devices) !== null && _t !== void 0 ? _t : {},
              throttledUsers: (_u = responseJSON.throttled_users) !== null && _u !== void 0 ? _u : {},
              exceededDailyQuotaDevices: (_v = responseJSON.exceeded_daily_quota_devices) !== null && _v !== void 0 ? _v : {},
              exceededDailyQuotaUsers: (_w = responseJSON.exceeded_daily_quota_users) !== null && _w !== void 0 ? _w : {},
              throttledEvents: (_x = responseJSON.throttled_events) !== null && _x !== void 0 ? _x : []
            }
          };
        case Status.Timeout:
        default:
          return {
            status,
            statusCode
          };
      }
    };
    BaseTransport2.prototype.buildStatus = function(code) {
      if (isSuccessStatusCode(code)) {
        return Status.Success;
      }
      if (code === 429) {
        return Status.RateLimit;
      }
      if (code === 413) {
        return Status.PayloadTooLarge;
      }
      if (code === 408) {
        return Status.Timeout;
      }
      if (code >= 400 && code < 500) {
        return Status.Invalid;
      }
      if (code >= 500) {
        return Status.Failed;
      }
      return Status.Unknown;
    };
    return BaseTransport2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/transports/fetch.js
var FetchTransport = (
  /** @class */
  (function(_super) {
    __extends(FetchTransport2, _super);
    function FetchTransport2(customHeaders) {
      if (customHeaders === void 0) {
        customHeaders = {};
      }
      var _this = _super.call(this) || this;
      _this.customHeaders = customHeaders;
      return _this;
    }
    FetchTransport2.prototype.send = function(serverUrl, payload) {
      return __awaiter(this, void 0, void 0, function() {
        var options, response, responseText;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              if (typeof fetch === "undefined") {
                throw new Error("FetchTransport is not supported");
              }
              options = {
                headers: __assign({ "Content-Type": "application/json", Accept: "*/*" }, this.customHeaders),
                body: JSON.stringify(payload),
                method: "POST"
              };
              return [4, fetch(serverUrl, options)];
            case 1:
              response = _a.sent();
              return [4, response.text()];
            case 2:
              responseText = _a.sent();
              try {
                return [2, this.buildResponse(JSON.parse(responseText))];
              } catch (_b) {
                return [2, this.buildResponse({ code: response.status })];
              }
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    return FetchTransport2;
  })(BaseTransport)
);

// node_modules/@amplitude/analytics-core/lib/esm/remote-config/remote-config-localstorage.js
var RemoteConfigLocalStorage = (
  /** @class */
  (function() {
    function RemoteConfigLocalStorage2(apiKey, logger) {
      this.key = "AMP_remote_config_".concat(apiKey.substring(0, 10));
      this.logger = logger;
    }
    RemoteConfigLocalStorage2.prototype.fetchConfig = function() {
      var result = null;
      var failedRemoteConfigInfo = {
        remoteConfig: null,
        lastFetch: /* @__PURE__ */ new Date()
      };
      try {
        result = localStorage.getItem(this.key);
      } catch (error) {
        this.logger.debug("Remote config localstorage failed to access: ", error);
        return Promise.resolve(failedRemoteConfigInfo);
      }
      if (result === null) {
        this.logger.debug("Remote config localstorage gets null because the key does not exist");
        return Promise.resolve(failedRemoteConfigInfo);
      }
      try {
        var remoteConfigInfo = JSON.parse(result);
        this.logger.debug("Remote config localstorage parsed successfully: ".concat(JSON.stringify(remoteConfigInfo)));
        return Promise.resolve({
          remoteConfig: remoteConfigInfo.remoteConfig,
          lastFetch: new Date(remoteConfigInfo.lastFetch)
        });
      } catch (error) {
        this.logger.debug("Remote config localstorage failed to parse: ", error);
        localStorage.removeItem(this.key);
        return Promise.resolve(failedRemoteConfigInfo);
      }
    };
    RemoteConfigLocalStorage2.prototype.setConfig = function(config) {
      try {
        localStorage.setItem(this.key, JSON.stringify(config));
        this.logger.debug("Remote config localstorage set successfully.");
        return Promise.resolve(true);
      } catch (error) {
        this.logger.debug("Remote config localstorage failed to set: ", error);
      }
      return Promise.resolve(false);
    };
    return RemoteConfigLocalStorage2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/remote-config/remote-config.js
var US_SERVER_URL = "https://sr-client-cfg.amplitude.com/config";
var EU_SERVER_URL = "https://sr-client-cfg.eu.amplitude.com/config";
var DEFAULT_MAX_RETRIES = 3;
var DEFAULT_TIMEOUT = 1e3;
var DEFAULT_MIN_TIME_BETWEEN_FETCHES = 5 * 60 * 1e3;
var RemoteConfigClient = (
  /** @class */
  (function() {
    function RemoteConfigClient2(apiKey, logger, serverZone, serverUrl) {
      if (serverZone === void 0) {
        serverZone = "US";
      }
      this.callbackInfos = [];
      this.lastSuccessfulFetch = null;
      this.fetchPromise = null;
      this.apiKey = apiKey;
      this.serverUrl = serverUrl || (serverZone === "US" ? US_SERVER_URL : EU_SERVER_URL);
      this.logger = logger;
      this.storage = new RemoteConfigLocalStorage(apiKey, logger);
    }
    RemoteConfigClient2.prototype.subscribe = function(key, deliveryMode, callback) {
      var id = UUID();
      var callbackInfo = {
        id,
        key,
        deliveryMode,
        callback
      };
      this.callbackInfos.push(callbackInfo);
      if (deliveryMode === "all") {
        void this.subscribeAll(callbackInfo);
      } else {
        void this.subscribeWaitForRemote(callbackInfo, deliveryMode.timeout);
      }
      return id;
    };
    RemoteConfigClient2.prototype.unsubscribe = function(id) {
      var index = this.callbackInfos.findIndex(function(callbackInfo) {
        return callbackInfo.id === id;
      });
      if (index === -1) {
        this.logger.debug("Remote config client unsubscribe failed because callback with id ".concat(id, " doesn't exist."));
        return false;
      }
      this.callbackInfos.splice(index, 1);
      this.logger.debug("Remote config client unsubscribe succeeded removing callback with id ".concat(id, "."));
      return true;
    };
    RemoteConfigClient2.prototype.updateConfigs = function() {
      return __awaiter(this, void 0, void 0, function() {
        var timeSinceLastFetch, result;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              if (this.lastSuccessfulFetch) {
                timeSinceLastFetch = Date.now() - this.lastSuccessfulFetch;
                if (timeSinceLastFetch < DEFAULT_MIN_TIME_BETWEEN_FETCHES) {
                  this.logger.debug("Remote config client skipping updateConfigs: Too recent");
                  return [
                    2
                    /*return*/
                  ];
                }
              }
              return [4, this.getOrCreateFetchPromise()];
            case 1:
              result = _a.sent();
              void this.storage.setConfig(result);
              this.callbackInfos.forEach(function(callbackInfo) {
                _this.sendCallback(callbackInfo, result, "remote");
              });
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    RemoteConfigClient2.prototype.getOrCreateFetchPromise = function() {
      var _this = this;
      if (this.fetchPromise) {
        return this.fetchPromise;
      }
      this.fetchPromise = this.fetch().then(function(result) {
        if (result.remoteConfig !== null) {
          _this.lastSuccessfulFetch = Date.now();
        }
        return result;
      }).finally(function() {
        _this.fetchPromise = null;
      });
      return this.fetchPromise;
    };
    RemoteConfigClient2.prototype.subscribeAll = function(callbackInfo) {
      return __awaiter(this, void 0, void 0, function() {
        var remotePromise, cachePromise, result;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              remotePromise = this.getOrCreateFetchPromise().then(function(result2) {
                _this.logger.debug("Remote config client subscription all mode fetched from remote: ".concat(JSON.stringify(result2)));
                _this.sendCallback(callbackInfo, result2, "remote");
                void _this.storage.setConfig(result2);
              });
              cachePromise = this.storage.fetchConfig().then(function(result2) {
                return result2;
              });
              return [4, Promise.race([remotePromise, cachePromise])];
            case 1:
              result = _a.sent();
              if (result !== void 0) {
                this.logger.debug("Remote config client subscription all mode fetched from cache: ".concat(JSON.stringify(result)));
                if (result.remoteConfig !== null) {
                  this.sendCallback(callbackInfo, result, "cache");
                } else {
                  this.logger.debug("Remote config client skips sending callback because cache is empty (first time user).");
                }
              }
              return [4, remotePromise];
            case 2:
              _a.sent();
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    RemoteConfigClient2.prototype.subscribeWaitForRemote = function(callbackInfo, timeout) {
      return __awaiter(this, void 0, void 0, function() {
        var timeoutPromise, result, error_1, result;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              timeoutPromise = new Promise(function(_2, reject) {
                setTimeout(function() {
                  reject("Timeout exceeded");
                }, timeout);
              });
              _a.label = 1;
            case 1:
              _a.trys.push([1, 3, , 5]);
              return [4, Promise.race([
                this.getOrCreateFetchPromise(),
                timeoutPromise
              ])];
            case 2:
              result = _a.sent();
              this.logger.debug("Remote config client subscription wait for remote mode returns from remote.");
              this.sendCallback(callbackInfo, result, "remote");
              void this.storage.setConfig(result);
              return [3, 5];
            case 3:
              error_1 = _a.sent();
              this.logger.debug("Remote config client subscription wait for remote mode exceeded timeout. Try to fetch from cache.");
              return [4, this.storage.fetchConfig()];
            case 4:
              result = _a.sent();
              if (result.remoteConfig !== null) {
                this.logger.debug("Remote config client subscription wait for remote mode returns a cached copy.");
                this.sendCallback(callbackInfo, result, "cache");
              } else {
                this.logger.debug("Remote config client subscription wait for remote mode failed to fetch cache.");
                this.sendCallback(callbackInfo, result, "remote");
              }
              return [3, 5];
            case 5:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    RemoteConfigClient2.prototype.sendCallback = function(callbackInfo, remoteConfigInfo, source) {
      callbackInfo.lastCallback = /* @__PURE__ */ new Date();
      var filteredConfig;
      if (callbackInfo.key) {
        filteredConfig = callbackInfo.key.split(".").reduce(function(config, key) {
          if (config === null) {
            return config;
          }
          return key in config ? config[key] : null;
        }, remoteConfigInfo.remoteConfig);
      } else {
        filteredConfig = remoteConfigInfo.remoteConfig;
      }
      callbackInfo.callback(filteredConfig, source, remoteConfigInfo.lastFetch);
    };
    RemoteConfigClient2.prototype.fetch = function(retries, timeout) {
      if (retries === void 0) {
        retries = DEFAULT_MAX_RETRIES;
      }
      if (timeout === void 0) {
        timeout = DEFAULT_TIMEOUT;
      }
      return __awaiter(this, void 0, void 0, function() {
        var interval, failedRemoteConfigInfo, _loop_1, this_1, attempt, state_1;
        var _this = this;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              interval = timeout / retries;
              failedRemoteConfigInfo = {
                remoteConfig: null,
                lastFetch: /* @__PURE__ */ new Date()
              };
              _loop_1 = function(attempt2) {
                var abortController, timeoutId, res, body, remoteConfig, error_2;
                return __generator(this, function(_b) {
                  switch (_b.label) {
                    case 0:
                      abortController = new AbortController();
                      timeoutId = setTimeout(function() {
                        return abortController.abort();
                      }, timeout);
                      _b.label = 1;
                    case 1:
                      _b.trys.push([1, 7, 8, 9]);
                      return [4, fetch(this_1.getUrlParams(), {
                        method: "GET",
                        headers: {
                          Accept: "*/*"
                        },
                        signal: abortController.signal
                      })];
                    case 2:
                      res = _b.sent();
                      if (!!res.ok) return [3, 4];
                      return [4, res.text()];
                    case 3:
                      body = _b.sent();
                      this_1.logger.debug("Remote config client fetch with retry time ".concat(retries, " failed with ").concat(res.status, ": ").concat(body));
                      return [3, 6];
                    case 4:
                      return [4, res.json()];
                    case 5:
                      remoteConfig = _b.sent();
                      return [2, { value: {
                        remoteConfig,
                        lastFetch: /* @__PURE__ */ new Date()
                      } }];
                    case 6:
                      return [3, 9];
                    case 7:
                      error_2 = _b.sent();
                      if (error_2 instanceof Error && error_2.name === "AbortError") {
                        this_1.logger.debug("Remote config client fetch with retry time ".concat(retries, " timed out after ").concat(timeout, "ms"));
                      } else {
                        this_1.logger.debug("Remote config client fetch with retry time ".concat(retries, " is rejected because: "), error_2);
                      }
                      return [3, 9];
                    case 8:
                      clearTimeout(timeoutId);
                      return [
                        7
                        /*endfinally*/
                      ];
                    case 9:
                      if (!(attempt2 < retries - 1)) return [3, 11];
                      return [4, new Promise(function(resolve) {
                        return setTimeout(resolve, _this.getJitterDelay(interval));
                      })];
                    case 10:
                      _b.sent();
                      _b.label = 11;
                    case 11:
                      return [
                        2
                        /*return*/
                      ];
                  }
                });
              };
              this_1 = this;
              attempt = 0;
              _a.label = 1;
            case 1:
              if (!(attempt < retries)) return [3, 4];
              return [5, _loop_1(attempt)];
            case 2:
              state_1 = _a.sent();
              if (typeof state_1 === "object")
                return [2, state_1.value];
              _a.label = 3;
            case 3:
              attempt++;
              return [3, 1];
            case 4:
              return [2, failedRemoteConfigInfo];
          }
        });
      });
    };
    RemoteConfigClient2.prototype.getJitterDelay = function(baseDelay) {
      return Math.floor(Math.random() * baseDelay);
    };
    RemoteConfigClient2.prototype.getUrlParams = function() {
      var encodedApiKey = encodeURIComponent(this.apiKey);
      var urlParams = new URLSearchParams();
      urlParams.append("config_group", RemoteConfigClient2.CONFIG_GROUP);
      return "".concat(this.serverUrl, "/").concat(encodedApiKey, "?").concat(urlParams.toString());
    };
    RemoteConfigClient2.CONFIG_GROUP = "browser";
    return RemoteConfigClient2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/observers/console.js
var globalScope = getGlobalScope();
var originalConsole = globalScope === null || globalScope === void 0 ? void 0 : globalScope.console;
var handlers = {};
var originalFn = {};
var inConsoleOverride = false;
function overrideConsole(logLevel) {
  if (!originalConsole) {
    return false;
  }
  if (typeof originalConsole[logLevel] !== "function") {
    return false;
  }
  if (originalFn[logLevel]) {
    return true;
  }
  var handler = function() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      args[_i] = arguments[_i];
    }
    try {
      if (handlers[logLevel] && !inConsoleOverride) {
        inConsoleOverride = true;
        var callbacks = handlers[logLevel];
        if (callbacks) {
          callbacks.forEach(function(callback) {
            try {
              callback(logLevel, args);
            } catch (_a) {
            }
          });
        }
      }
    } catch (_a) {
    }
    inConsoleOverride = false;
    return originalFn[logLevel].apply(originalConsole, args);
  };
  originalFn[logLevel] = originalConsole[logLevel];
  originalConsole[logLevel] = handler;
  return true;
}
function addListener(level, callback) {
  var res = overrideConsole(level);
  if (!res) {
    return new Error("Console override failed");
  }
  if (handlers[level]) {
    handlers[level].push(callback);
  } else {
    handlers[level] = [callback];
  }
}
function removeListener(callback) {
  var e_1, _a;
  try {
    for (var _b = __values(Object.values(handlers)), _c = _b.next(); !_c.done; _c = _b.next()) {
      var callbacks = _c.value;
      for (var i2 = callbacks.length - 1; i2 >= 0; i2--) {
        if (callbacks[i2] === callback) {
          callbacks.splice(i2, 1);
          break;
        }
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
}
function _restoreConsole() {
  var e_2, _a;
  try {
    for (var _b = __values(Object.entries(originalFn)), _c = _b.next(); !_c.done; _c = _b.next()) {
      var _d = __read(_c.value, 2), key = _d[0], originalHandler = _d[1];
      if (originalHandler) {
        originalConsole[key] = originalHandler;
      }
    }
  } catch (e_2_1) {
    e_2 = { error: e_2_1 };
  } finally {
    try {
      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
    } finally {
      if (e_2) throw e_2.error;
    }
  }
  originalFn = {};
  handlers = {};
}
var consoleObserver = {
  addListener,
  removeListener,
  _restoreConsole
};

// node_modules/@amplitude/analytics-core/lib/esm/types/server-zone.js
var ServerZone;
(function(ServerZone2) {
  ServerZone2["US"] = "US";
  ServerZone2["EU"] = "EU";
  ServerZone2["STAGING"] = "STAGING";
})(ServerZone || (ServerZone = {}));

// node_modules/@amplitude/analytics-core/lib/esm/types/offline.js
var OfflineDisabled = null;

// node_modules/@amplitude/analytics-core/lib/esm/types/element-interactions.js
var DEFAULT_CSS_SELECTOR_ALLOWLIST = [
  "a",
  "button",
  "input",
  "select",
  "textarea",
  "label",
  "video",
  "audio",
  '[contenteditable="true" i]',
  "[data-amp-default-track]",
  ".amp-default-track"
];
var DEFAULT_DATA_ATTRIBUTE_PREFIX = "data-amp-track-";
var DEFAULT_ACTION_CLICK_ALLOWLIST = ["div", "span", "h1", "h2", "h3", "h4", "h5", "h6"];

// node_modules/@amplitude/analytics-core/lib/esm/types/frustration-interactions.js
var CLICKABLE_ELEMENT_SELECTORS = [
  "a",
  "button",
  '[role="button"]',
  '[role="link"]',
  '[role="menuitem"]',
  '[role="menuitemcheckbox"]',
  '[role="menuitemradio"]',
  '[role="option"]',
  '[role="tab"]',
  '[role="treeitem"]',
  '[contenteditable="true" i]'
];
var DEFAULT_ERROR_AND_DEAD_CLICK_ALLOWLIST = __spreadArray([
  'input[type="button"]',
  'input[type="submit"]',
  'input[type="reset"]',
  'input[type="image"]',
  'input[type="file"]'
], __read(CLICKABLE_ELEMENT_SELECTORS), false);
var DEFAULT_DEAD_CLICK_ALLOWLIST = DEFAULT_ERROR_AND_DEAD_CLICK_ALLOWLIST;
var DEFAULT_ERROR_CLICK_ALLOWLIST = DEFAULT_ERROR_AND_DEAD_CLICK_ALLOWLIST;
var DEFAULT_RAGE_CLICK_ALLOWLIST = ["*"];
var DEFAULT_RAGE_CLICK_WINDOW_MS = 1e3;
var DEFAULT_RAGE_CLICK_THRESHOLD = 4;
var DEFAULT_RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD = 50;

// node_modules/@amplitude/analytics-core/lib/esm/utils/json-query.js
function isJsonPrimitive(json) {
  return typeof json === "string" || typeof json === "number" || typeof json === "boolean" || json === null || json === void 0;
}
function pruneJson(json, allowlist, excludelist) {
  if (!json)
    return;
  var allowlistTokens = allowlist.map(tokenizeJsonPath);
  var excludelistTokens = excludelist.map(tokenizeJsonPath);
  _pruneJson({
    json,
    allowlist: allowlistTokens,
    excludelist: excludelistTokens,
    ancestors: []
  });
}
function _pruneJson(_a) {
  var e_1, _b;
  var json = _a.json, targetObject = _a.targetObject, allowlist = _a.allowlist, excludelist = _a.excludelist, ancestors = _a.ancestors, parentObject = _a.parentObject, targetKey = _a.targetKey;
  if (!targetObject) {
    targetObject = json;
  }
  var keys = Object.keys(targetObject);
  try {
    for (var keys_1 = __values(keys), keys_1_1 = keys_1.next(); !keys_1_1.done; keys_1_1 = keys_1.next()) {
      var key = keys_1_1.value;
      var path = __spreadArray(__spreadArray([], __read(ancestors), false), [key], false);
      if (isJsonPrimitive(targetObject[key])) {
        if (!hasPathMatchInList(path, allowlist) || hasPathMatchInList(path, excludelist)) {
          delete targetObject[key];
        }
      } else {
        _pruneJson({
          json,
          targetObject: targetObject[key],
          allowlist,
          excludelist,
          ancestors: path,
          parentObject: targetObject,
          targetKey: key
        });
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (keys_1_1 && !keys_1_1.done && (_b = keys_1.return)) _b.call(keys_1);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
  if (Object.keys(targetObject).length === 0 && parentObject && targetKey) {
    delete parentObject[targetKey];
  }
}
function tokenizeJsonPath(path) {
  if (path.startsWith("/")) {
    path = path.slice(1);
  }
  return path.split("/").map(function(token) {
    return token.replace(/~0/g, "~").replace(/~1/g, "/");
  });
}
function isPathMatch(path, pathMatcher, i2, j) {
  if (i2 === void 0) {
    i2 = 0;
  }
  if (j === void 0) {
    j = 0;
  }
  if (j === pathMatcher.length) {
    return i2 === path.length;
  }
  if (i2 === path.length) {
    while (j < pathMatcher.length && pathMatcher[j] === "**") {
      j++;
    }
    return j === pathMatcher.length;
  }
  var currentMatcher = pathMatcher[j];
  if (currentMatcher === "**") {
    if (j + 1 === pathMatcher.length) {
      return true;
    }
    for (var k2 = i2; k2 <= path.length; k2++) {
      if (isPathMatch(path, pathMatcher, k2, j + 1)) {
        return true;
      }
    }
    return false;
  } else if (currentMatcher === "*" || currentMatcher === path[i2]) {
    return isPathMatch(path, pathMatcher, i2 + 1, j + 1);
  } else {
    return false;
  }
}
function hasPathMatchInList(path, allowOrExcludeList) {
  return allowOrExcludeList.some(function(l2) {
    return isPathMatch(path, l2);
  });
}

// node_modules/@amplitude/analytics-core/lib/esm/network-request-event.js
var TEXT_READ_TIMEOUT = 500;
var MAXIMUM_ENTRIES = 100;
var RequestWrapperFetch = (
  /** @class */
  (function() {
    function RequestWrapperFetch2(request) {
      this.request = request;
    }
    RequestWrapperFetch2.prototype.headers = function(allow) {
      var e_1, _a;
      if (allow === void 0) {
        allow = [];
      }
      var headersUnsafe = this.request.headers;
      var headersSafeCopy = {};
      if (Array.isArray(headersUnsafe)) {
        headersUnsafe.forEach(function(_a2) {
          var _b2 = __read(_a2, 2), headerName = _b2[0], headerValue = _b2[1];
          headersSafeCopy[headerName] = headerValue;
        });
      } else if (headersUnsafe instanceof Headers) {
        headersUnsafe.forEach(function(value2, key2) {
          headersSafeCopy[key2] = value2;
        });
      } else if (typeof headersUnsafe === "object" && headersUnsafe !== null) {
        try {
          for (var _b = __values(Object.entries(headersUnsafe)), _c = _b.next(); !_c.done; _c = _b.next()) {
            var _d = __read(_c.value, 2), key = _d[0], value = _d[1];
            headersSafeCopy[key] = value;
          }
        } catch (e_1_1) {
          e_1 = { error: e_1_1 };
        } finally {
          try {
            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
          } finally {
            if (e_1) throw e_1.error;
          }
        }
      }
      return pruneHeaders(headersSafeCopy, { allow });
    };
    Object.defineProperty(RequestWrapperFetch2.prototype, "bodySize", {
      get: function() {
        if (typeof this._bodySize === "number")
          return this._bodySize;
        var global2 = getGlobalScope();
        if (!(global2 === null || global2 === void 0 ? void 0 : global2.TextEncoder)) {
          return;
        }
        var body = this.request.body;
        this._bodySize = getBodySize(body, MAXIMUM_ENTRIES);
        return this._bodySize;
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(RequestWrapperFetch2.prototype, "method", {
      get: function() {
        return this.request.method;
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(RequestWrapperFetch2.prototype, "body", {
      get: function() {
        if (typeof this.request.body === "string") {
          return this.request.body;
        }
        return null;
      },
      enumerable: false,
      configurable: true
    });
    RequestWrapperFetch2.prototype.json = function(allow, exclude) {
      if (allow === void 0) {
        allow = [];
      }
      if (exclude === void 0) {
        exclude = [];
      }
      return __awaiter(this, void 0, void 0, function() {
        var text;
        return __generator(this, function(_a) {
          if (allow.length === 0) {
            return [2, null];
          }
          text = this.body;
          return [2, safeParseAndPruneBody(text, allow, exclude)];
        });
      });
    };
    return RequestWrapperFetch2;
  })()
);
var RequestWrapperXhr = (
  /** @class */
  (function() {
    function RequestWrapperXhr2(bodyRaw, requestHeaders) {
      this.bodyRaw = bodyRaw;
      this.requestHeaders = requestHeaders;
    }
    RequestWrapperXhr2.prototype.headers = function(allow) {
      if (allow === void 0) {
        allow = [];
      }
      return pruneHeaders(this.requestHeaders, { allow });
    };
    Object.defineProperty(RequestWrapperXhr2.prototype, "bodySize", {
      get: function() {
        return getBodySize(this.bodyRaw, MAXIMUM_ENTRIES);
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(RequestWrapperXhr2.prototype, "body", {
      get: function() {
        if (typeof this.bodyRaw === "string") {
          return this.bodyRaw;
        }
        return null;
      },
      enumerable: false,
      configurable: true
    });
    RequestWrapperXhr2.prototype.json = function(allow, exclude) {
      if (allow === void 0) {
        allow = [];
      }
      if (exclude === void 0) {
        exclude = [];
      }
      return __awaiter(this, void 0, void 0, function() {
        var text;
        return __generator(this, function(_a) {
          if (allow.length === 0) {
            return [2, null];
          }
          text = this.body;
          return [2, safeParseAndPruneBody(text, allow, exclude)];
        });
      });
    };
    return RequestWrapperXhr2;
  })()
);
function getBodySize(bodyUnsafe, maxEntries) {
  var e_2, _a;
  var bodySize;
  var global2 = getGlobalScope();
  var TextEncoder = global2 === null || global2 === void 0 ? void 0 : global2.TextEncoder;
  if (!TextEncoder) {
    return;
  }
  var bodySafe;
  if (typeof bodyUnsafe === "string") {
    bodySafe = bodyUnsafe;
    bodySize = new TextEncoder().encode(bodySafe).length;
  } else if (bodyUnsafe instanceof Blob) {
    bodySafe = bodyUnsafe;
    bodySize = bodySafe.size;
  } else if (bodyUnsafe instanceof URLSearchParams) {
    bodySafe = bodyUnsafe;
    bodySize = new TextEncoder().encode(bodySafe.toString()).length;
  } else if (ArrayBuffer.isView(bodyUnsafe)) {
    bodySafe = bodyUnsafe;
    bodySize = bodySafe.byteLength;
  } else if (bodyUnsafe instanceof ArrayBuffer) {
    bodySafe = bodyUnsafe;
    bodySize = bodySafe.byteLength;
  } else if (bodyUnsafe instanceof FormData) {
    var formData = bodyUnsafe;
    var total = 0;
    var count = 0;
    try {
      for (var _b = __values(formData.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {
        var _d = __read(_c.value, 2), key = _d[0], value = _d[1];
        total += key.length;
        if (typeof value === "string") {
          total += new TextEncoder().encode(value).length;
        } else if (value instanceof Blob) {
          total += value.size;
        } else {
          return;
        }
        if (++count >= maxEntries) {
          return;
        }
      }
    } catch (e_2_1) {
      e_2 = { error: e_2_1 };
    } finally {
      try {
        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
      } finally {
        if (e_2) throw e_2.error;
      }
    }
    bodySize = total;
  } else if (bodyUnsafe instanceof ReadableStream) {
    bodySafe = bodyUnsafe;
    return;
  }
  return bodySize;
}
var ResponseWrapperFetch = (
  /** @class */
  (function() {
    function ResponseWrapperFetch2(response) {
      this.response = response;
    }
    ResponseWrapperFetch2.prototype.headers = function(allow) {
      var _a;
      if (allow === void 0) {
        allow = [];
      }
      if (this.response.headers instanceof Headers) {
        var headersSafe = this.response.headers;
        var headersOut_1 = {};
        (_a = headersSafe === null || headersSafe === void 0 ? void 0 : headersSafe.forEach) === null || _a === void 0 ? void 0 : _a.call(headersSafe, function(value, key) {
          headersOut_1[key] = value;
        });
        return pruneHeaders(headersOut_1, { allow });
      }
      return;
    };
    Object.defineProperty(ResponseWrapperFetch2.prototype, "bodySize", {
      get: function() {
        var _a, _b;
        if (this._bodySize !== void 0)
          return this._bodySize;
        var contentLength = (_b = (_a = this.response.headers) === null || _a === void 0 ? void 0 : _a.get) === null || _b === void 0 ? void 0 : _b.call(_a, "content-length");
        var bodySize = contentLength ? parseInt(contentLength, 10) : void 0;
        this._bodySize = bodySize;
        return bodySize;
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(ResponseWrapperFetch2.prototype, "status", {
      get: function() {
        return this.response.status;
      },
      enumerable: false,
      configurable: true
    });
    ResponseWrapperFetch2.prototype.text = function() {
      return __awaiter(this, void 0, void 0, function() {
        var textPromise, timer, text, error_1;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              if (!this.clonedResponse) {
                this.clonedResponse = this.response.clone();
              }
              _a.label = 1;
            case 1:
              _a.trys.push([1, 3, , 4]);
              textPromise = this.clonedResponse.text();
              timer = new Promise(function(resolve) {
                return setTimeout(
                  /* istanbul ignore next */
                  function() {
                    return resolve(null);
                  },
                  TEXT_READ_TIMEOUT
                );
              });
              return [4, Promise.race([textPromise, timer])];
            case 2:
              text = _a.sent();
              return [2, text];
            case 3:
              error_1 = _a.sent();
              return [2, null];
            case 4:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    ResponseWrapperFetch2.prototype.json = function(allow, exclude) {
      if (allow === void 0) {
        allow = [];
      }
      if (exclude === void 0) {
        exclude = [];
      }
      return __awaiter(this, void 0, void 0, function() {
        var text;
        return __generator(this, function(_a) {
          switch (_a.label) {
            case 0:
              if (allow.length === 0) {
                return [2, null];
              }
              return [4, this.text()];
            case 1:
              text = _a.sent();
              return [2, safeParseAndPruneBody(text, allow, exclude)];
          }
        });
      });
    };
    return ResponseWrapperFetch2;
  })()
);
var ResponseWrapperXhr = (
  /** @class */
  (function() {
    function ResponseWrapperXhr2(statusCode, headersString, size, getJson) {
      this.statusCode = statusCode;
      this.headersString = headersString;
      this.size = size;
      this.getJson = getJson;
    }
    Object.defineProperty(ResponseWrapperXhr2.prototype, "bodySize", {
      get: function() {
        return this.size;
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(ResponseWrapperXhr2.prototype, "status", {
      get: function() {
        return this.statusCode;
      },
      enumerable: false,
      configurable: true
    });
    ResponseWrapperXhr2.prototype.headers = function(allow) {
      var e_3, _a;
      if (allow === void 0) {
        allow = [];
      }
      if (!this.headersString) {
        return {};
      }
      var headers = {};
      var headerLines = this.headersString.split("\r\n");
      try {
        for (var headerLines_1 = __values(headerLines), headerLines_1_1 = headerLines_1.next(); !headerLines_1_1.done; headerLines_1_1 = headerLines_1.next()) {
          var line = headerLines_1_1.value;
          var _b = __read(line.split(": "), 2), key = _b[0], value = _b[1];
          if (key && value) {
            headers[key] = value;
          }
        }
      } catch (e_3_1) {
        e_3 = { error: e_3_1 };
      } finally {
        try {
          if (headerLines_1_1 && !headerLines_1_1.done && (_a = headerLines_1.return)) _a.call(headerLines_1);
        } finally {
          if (e_3) throw e_3.error;
        }
      }
      return pruneHeaders(headers, { allow });
    };
    ResponseWrapperXhr2.prototype.json = function(allow, exclude) {
      if (allow === void 0) {
        allow = [];
      }
      if (exclude === void 0) {
        exclude = [];
      }
      return __awaiter(this, void 0, void 0, function() {
        var jsonBody;
        return __generator(this, function(_a) {
          if (allow.length === 0) {
            return [2, null];
          }
          jsonBody = this.getJson();
          if (jsonBody) {
            pruneJson(jsonBody, allow, exclude);
            return [2, jsonBody];
          }
          return [2, null];
        });
      });
    };
    return ResponseWrapperXhr2;
  })()
);
function safeParseAndPruneBody(text, allow, exclude) {
  if (!text)
    return null;
  try {
    var json = JSON.parse(text);
    pruneJson(json, allow, exclude);
    return json;
  } catch (error) {
    return null;
  }
}
var PRUNE_STRATEGY;
(function(PRUNE_STRATEGY2) {
  PRUNE_STRATEGY2["REDACT"] = "redact";
  PRUNE_STRATEGY2["REMOVE"] = "remove";
})(PRUNE_STRATEGY || (PRUNE_STRATEGY = {}));
var REDACTED_VALUE = "[REDACTED]";
var pruneHeaders = function(headers, options) {
  var e_4, _a;
  var _b = options.allow, allow = _b === void 0 ? [] : _b, _c = options.strategy, strategy = _c === void 0 ? PRUNE_STRATEGY.REMOVE : _c;
  var exclude = __spreadArray([], __read(FORBIDDEN_HEADERS), false);
  var headersPruned = {};
  var _loop_1 = function(key2) {
    var lowerKey = key2.toLowerCase();
    if (exclude.find(function(e2) {
      return e2.toLowerCase() === lowerKey;
    })) {
      if (strategy === PRUNE_STRATEGY.REDACT) {
        headersPruned[key2] = REDACTED_VALUE;
      }
    } else if (!allow.find(function(i2) {
      return i2.toLowerCase() === lowerKey;
    })) {
      if (strategy === PRUNE_STRATEGY.REDACT) {
        headersPruned[key2] = REDACTED_VALUE;
      }
    } else {
      headersPruned[key2] = headers[key2];
    }
  };
  try {
    for (var _d = __values(Object.keys(headers)), _e = _d.next(); !_e.done; _e = _d.next()) {
      var key = _e.value;
      _loop_1(key);
    }
  } catch (e_4_1) {
    e_4 = { error: e_4_1 };
  } finally {
    try {
      if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
    } finally {
      if (e_4) throw e_4.error;
    }
  }
  return headersPruned;
};
var NetworkRequestEvent = (
  /** @class */
  (function() {
    function NetworkRequestEvent2(type, method, timestamp, startTime, url, requestWrapper, status, duration, responseWrapper, error, endTime) {
      if (status === void 0) {
        status = 0;
      }
      this.type = type;
      this.method = method;
      this.timestamp = timestamp;
      this.startTime = startTime;
      this.url = url;
      this.requestWrapper = requestWrapper;
      this.status = status;
      this.duration = duration;
      this.responseWrapper = responseWrapper;
      this.error = error;
      this.endTime = endTime;
    }
    NetworkRequestEvent2.prototype.toSerializable = function() {
      var _a, _b, _c, _d;
      var serialized = {
        type: this.type,
        method: this.method,
        url: this.url,
        timestamp: this.timestamp,
        status: this.status,
        duration: this.duration,
        error: this.error,
        startTime: this.startTime,
        endTime: this.endTime,
        requestHeaders: (_a = this.requestWrapper) === null || _a === void 0 ? void 0 : _a.headers(__spreadArray([], __read(SAFE_HEADERS), false)),
        requestBodySize: (_b = this.requestWrapper) === null || _b === void 0 ? void 0 : _b.bodySize,
        responseHeaders: (_c = this.responseWrapper) === null || _c === void 0 ? void 0 : _c.headers(__spreadArray([], __read(SAFE_HEADERS), false)),
        responseBodySize: (_d = this.responseWrapper) === null || _d === void 0 ? void 0 : _d.bodySize
      };
      return Object.fromEntries(Object.entries(serialized).filter(function(_a2) {
        var _b2 = __read(_a2, 2), _2 = _b2[0], v2 = _b2[1];
        return v2 !== void 0;
      }));
    };
    return NetworkRequestEvent2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/observers/network.js
function isRequest(requestInfo) {
  return typeof requestInfo === "object" && requestInfo !== null && "url" in requestInfo && "method" in requestInfo;
}
var NetworkEventCallback = (
  /** @class */
  /* @__PURE__ */ (function() {
    function NetworkEventCallback2(callback, id) {
      if (id === void 0) {
        id = UUID();
      }
      this.callback = callback;
      this.id = id;
    }
    return NetworkEventCallback2;
  })()
);
var NetworkObserver = (
  /** @class */
  (function() {
    function NetworkObserver2(logger) {
      this.eventCallbacks = /* @__PURE__ */ new Map();
      this.isObserving = false;
      this.logger = logger;
      var globalScope3 = getGlobalScope();
      if (!NetworkObserver2.isSupported()) {
        return;
      }
      this.globalScope = globalScope3;
    }
    NetworkObserver2.isSupported = function() {
      var globalScope3 = getGlobalScope();
      return !!globalScope3 && !!globalScope3.fetch;
    };
    NetworkObserver2.prototype.subscribe = function(eventCallback, logger) {
      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
      if (!this.logger) {
        this.logger = logger;
      }
      this.eventCallbacks.set(eventCallback.id, eventCallback);
      if (!this.isObserving) {
        var originalXhrOpen = (_c = (_b = (_a = this.globalScope) === null || _a === void 0 ? void 0 : _a.XMLHttpRequest) === null || _b === void 0 ? void 0 : _b.prototype) === null || _c === void 0 ? void 0 : _c.open;
        var originalXhrSend = (_f = (_e = (_d = this.globalScope) === null || _d === void 0 ? void 0 : _d.XMLHttpRequest) === null || _e === void 0 ? void 0 : _e.prototype) === null || _f === void 0 ? void 0 : _f.send;
        var originalXhrSetRequestHeader = (_j = (_h = (_g = this.globalScope) === null || _g === void 0 ? void 0 : _g.XMLHttpRequest) === null || _h === void 0 ? void 0 : _h.prototype) === null || _j === void 0 ? void 0 : _j.setRequestHeader;
        if (originalXhrOpen && originalXhrSend && originalXhrSetRequestHeader) {
          this.observeXhr(originalXhrOpen, originalXhrSend, originalXhrSetRequestHeader);
        }
        var originalFetch = (_k = this.globalScope) === null || _k === void 0 ? void 0 : _k.fetch;
        if (originalFetch) {
          this.observeFetch(originalFetch);
        }
        this.isObserving = true;
      }
    };
    NetworkObserver2.prototype.unsubscribe = function(eventCallback) {
      this.eventCallbacks.delete(eventCallback.id);
    };
    NetworkObserver2.prototype.triggerEventCallbacks = function(event) {
      var _this = this;
      this.eventCallbacks.forEach(function(callback) {
        var _a;
        try {
          callback.callback(event);
        } catch (err) {
          (_a = _this.logger) === null || _a === void 0 ? void 0 : _a.debug("an unexpected error occurred while triggering event callbacks", err);
        }
      });
    };
    NetworkObserver2.prototype.handleNetworkRequestEvent = function(requestType, requestInfo, requestWrapper, responseWrapper, typedError, startTime, durationStart) {
      var _a;
      if (startTime === void 0 || durationStart === void 0) {
        return;
      }
      var url;
      var method = "GET";
      if (isRequest(requestInfo)) {
        url = requestInfo["url"];
        method = requestInfo["method"];
      } else {
        url = (_a = requestInfo === null || requestInfo === void 0 ? void 0 : requestInfo.toString) === null || _a === void 0 ? void 0 : _a.call(requestInfo);
      }
      if (url) {
        try {
          var parsedUrl = new URL(url);
          url = "".concat(parsedUrl.protocol, "//").concat(parsedUrl.host).concat(parsedUrl.pathname).concat(parsedUrl.search).concat(parsedUrl.hash);
        } catch (err) {
        }
      }
      method = (requestWrapper === null || requestWrapper === void 0 ? void 0 : requestWrapper.method) || method;
      var status, error;
      if (responseWrapper) {
        status = responseWrapper.status;
      }
      if (typedError) {
        error = {
          name: typedError.name || "UnknownError",
          message: typedError.message || "An unknown error occurred"
        };
        status = 0;
      }
      var duration = Math.floor(performance.now() - durationStart);
      var endTime = Math.floor(startTime + duration);
      var requestEvent = new NetworkRequestEvent(
        requestType,
        method,
        startTime,
        // timestamp and startTime are aliases
        startTime,
        url,
        requestWrapper,
        status,
        duration,
        responseWrapper,
        error,
        endTime
      );
      this.triggerEventCallbacks(requestEvent);
    };
    NetworkObserver2.prototype.getTimestamps = function() {
      var _a, _b;
      return {
        startTime: (_a = Date.now) === null || _a === void 0 ? void 0 : _a.call(Date),
        durationStart: (_b = performance === null || performance === void 0 ? void 0 : performance.now) === null || _b === void 0 ? void 0 : _b.call(performance)
      };
    };
    NetworkObserver2.prototype.observeFetch = function(originalFetch) {
      var _this = this;
      if (!this.globalScope || !originalFetch) {
        return;
      }
      this.globalScope.fetch = function(requestInfo, requestInit) {
        return __awaiter(_this, void 0, void 0, function() {
          var timestamps, originalResponse, originalError, err_1;
          var _a, _b;
          return __generator(this, function(_c) {
            switch (_c.label) {
              case 0:
                try {
                  timestamps = this.getTimestamps();
                } catch (error) {
                  (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug("an unexpected error occurred while retrieving timestamps", error);
                }
                _c.label = 1;
              case 1:
                _c.trys.push([1, 3, , 4]);
                return [4, originalFetch(requestInfo, requestInit)];
              case 2:
                originalResponse = _c.sent();
                return [3, 4];
              case 3:
                err_1 = _c.sent();
                originalError = err_1;
                return [3, 4];
              case 4:
                try {
                  this.handleNetworkRequestEvent(
                    "fetch",
                    requestInfo,
                    requestInit ? new RequestWrapperFetch(requestInit) : void 0,
                    originalResponse ? new ResponseWrapperFetch(originalResponse) : void 0,
                    originalError,
                    /* istanbul ignore next */
                    timestamps === null || timestamps === void 0 ? void 0 : timestamps.startTime,
                    /* istanbul ignore next */
                    timestamps === null || timestamps === void 0 ? void 0 : timestamps.durationStart
                  );
                } catch (err) {
                  (_b = this.logger) === null || _b === void 0 ? void 0 : _b.debug("an unexpected error occurred while handling fetch", err);
                }
                if (originalResponse) {
                  return [2, originalResponse];
                } else {
                  throw originalError;
                }
                return [
                  2
                  /*return*/
                ];
            }
          });
        });
      };
    };
    NetworkObserver2.createXhrJsonParser = function(xhrUnsafe, context) {
      return function() {
        var _a, _b;
        try {
          if (xhrUnsafe.responseType === "json") {
            if ((_a = context.globalScope) === null || _a === void 0 ? void 0 : _a.structuredClone) {
              return context.globalScope.structuredClone(xhrUnsafe.response);
            }
          } else if (["text", ""].includes(xhrUnsafe.responseType)) {
            return JSON.parse(xhrUnsafe.responseText);
          }
        } catch (err) {
          if (err instanceof Error && err.name === "InvalidStateError") {
            (_b = context.logger) === null || _b === void 0 ? void 0 : _b.error("unexpected error when retrieving responseText. responseType='".concat(xhrUnsafe.responseType, "'"));
          }
          return null;
        }
        return null;
      };
    };
    NetworkObserver2.prototype.observeXhr = function(originalXhrOpen, originalXhrSend, originalXhrSetRequestHeader) {
      if (!this.globalScope || !originalXhrOpen || !originalXhrSend) {
        return;
      }
      var xhrProto = this.globalScope.XMLHttpRequest.prototype;
      var networkObserverContext = this;
      xhrProto.open = function() {
        var _a, _b;
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        var xhrSafe = this;
        var _c = __read(args, 2), method = _c[0], url = _c[1];
        try {
          xhrSafe.$$AmplitudeAnalyticsEvent = __assign({ method, url: (_a = url === null || url === void 0 ? void 0 : url.toString) === null || _a === void 0 ? void 0 : _a.call(url), headers: {} }, networkObserverContext.getTimestamps());
        } catch (err) {
          (_b = networkObserverContext.logger) === null || _b === void 0 ? void 0 : _b.error("an unexpected error occurred while calling xhr open", err);
        }
        return originalXhrOpen.apply(xhrSafe, args);
      };
      xhrProto.send = function() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        var xhrUnsafe = this;
        var xhrSafe = xhrUnsafe;
        var getJson = NetworkObserver2.createXhrJsonParser(xhrUnsafe, networkObserverContext);
        var body = args[0];
        var requestEvent = xhrSafe.$$AmplitudeAnalyticsEvent;
        xhrSafe.addEventListener("loadend", function() {
          var _a;
          try {
            var responseHeaders = xhrSafe.getAllResponseHeaders();
            var responseBodySize = xhrSafe.getResponseHeader("content-length");
            var responseWrapper = new ResponseWrapperXhr(
              xhrSafe.status,
              responseHeaders,
              /* istanbul ignore next */
              responseBodySize ? parseInt(responseBodySize, 10) : void 0,
              getJson
            );
            var requestHeaders = xhrSafe.$$AmplitudeAnalyticsEvent.headers;
            var requestWrapper = new RequestWrapperXhr(body, requestHeaders);
            requestEvent.status = xhrSafe.status;
            networkObserverContext.handleNetworkRequestEvent("xhr", { url: requestEvent.url, method: requestEvent.method }, requestWrapper, responseWrapper, void 0, requestEvent.startTime, requestEvent.durationStart);
          } catch (err) {
            (_a = networkObserverContext.logger) === null || _a === void 0 ? void 0 : _a.error("an unexpected error occurred while handling xhr send", err);
          }
        });
        return originalXhrSend.apply(xhrSafe, args);
      };
      xhrProto.setRequestHeader = function(headerName, headerValue) {
        var _a;
        var xhrSafe = this;
        try {
          xhrSafe.$$AmplitudeAnalyticsEvent.headers[headerName] = headerValue;
        } catch (err) {
          (_a = networkObserverContext.logger) === null || _a === void 0 ? void 0 : _a.error("an unexpected error occurred while calling xhr setRequestHeader", err);
        }
        originalXhrSetRequestHeader.apply(xhrSafe, [headerName, headerValue]);
      };
    };
    return NetworkObserver2;
  })()
);
var networkObserver = new NetworkObserver();

// node_modules/@amplitude/analytics-core/lib/esm/campaign/campaign-parser.js
var CampaignParser = (
  /** @class */
  (function() {
    function CampaignParser2() {
    }
    CampaignParser2.prototype.parse = function() {
      return __awaiter(this, void 0, void 0, function() {
        return __generator(this, function(_a) {
          return [2, __assign(__assign(__assign(__assign({}, BASE_CAMPAIGN), this.getUtmParam()), this.getReferrer()), this.getClickIds())];
        });
      });
    };
    CampaignParser2.prototype.getUtmParam = function() {
      var params = getQueryParams();
      var utmCampaign = params[UTM_CAMPAIGN];
      var utmContent = params[UTM_CONTENT];
      var utmId = params[UTM_ID];
      var utmMedium = params[UTM_MEDIUM];
      var utmSource = params[UTM_SOURCE];
      var utmTerm = params[UTM_TERM];
      return {
        utm_campaign: utmCampaign,
        utm_content: utmContent,
        utm_id: utmId,
        utm_medium: utmMedium,
        utm_source: utmSource,
        utm_term: utmTerm
      };
    };
    CampaignParser2.prototype.getReferrer = function() {
      var _a, _b;
      var data = {
        referrer: void 0,
        referring_domain: void 0
      };
      try {
        data.referrer = document.referrer || void 0;
        data.referring_domain = (_b = (_a = data.referrer) === null || _a === void 0 ? void 0 : _a.split("/")[2]) !== null && _b !== void 0 ? _b : void 0;
      } catch (_c) {
      }
      return data;
    };
    CampaignParser2.prototype.getClickIds = function() {
      var _a;
      var params = getQueryParams();
      return _a = {}, _a[DCLID] = params[DCLID], _a[FBCLID] = params[FBCLID], _a[GBRAID] = params[GBRAID], _a[GCLID] = params[GCLID], _a[KO_CLICK_ID] = params[KO_CLICK_ID], _a[LI_FAT_ID] = params[LI_FAT_ID], _a[MSCLKID] = params[MSCLKID], _a[RDT_CID] = params[RDT_CID], _a[TTCLID] = params[TTCLID], _a[TWCLID] = params[TWCLID], _a[WBRAID] = params[WBRAID], _a;
    };
    return CampaignParser2;
  })()
);

// node_modules/@amplitude/analytics-core/lib/esm/plugins/helpers.js
var TEXT_MASK_ATTRIBUTE = "data-amp-mask";
var MASKED_TEXT_VALUE = "*****";
var CC_REGEX = /\b(?:\d[ -]*?){13,16}\b/;
var SSN_REGEX = /(\d{3}-?\d{2}-?\d{4})/g;
var EMAIL_REGEX = /[^\s@]+@[^\s@.]+\.[^\s@]+/g;
var replaceSensitiveString = function(text, additionalMaskTextPatterns) {
  var e_1, _a;
  if (additionalMaskTextPatterns === void 0) {
    additionalMaskTextPatterns = [];
  }
  if (typeof text !== "string") {
    return "";
  }
  var result = text;
  result = result.replace(CC_REGEX, MASKED_TEXT_VALUE);
  result = result.replace(SSN_REGEX, MASKED_TEXT_VALUE);
  result = result.replace(EMAIL_REGEX, MASKED_TEXT_VALUE);
  try {
    for (var additionalMaskTextPatterns_1 = __values(additionalMaskTextPatterns), additionalMaskTextPatterns_1_1 = additionalMaskTextPatterns_1.next(); !additionalMaskTextPatterns_1_1.done; additionalMaskTextPatterns_1_1 = additionalMaskTextPatterns_1.next()) {
      var pattern = additionalMaskTextPatterns_1_1.value;
      try {
        result = result.replace(pattern, MASKED_TEXT_VALUE);
      } catch (_b) {
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (additionalMaskTextPatterns_1_1 && !additionalMaskTextPatterns_1_1.done && (_a = additionalMaskTextPatterns_1.return)) _a.call(additionalMaskTextPatterns_1);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
  return result;
};
var getPageTitle = function(parseTitleFunction) {
  if (typeof document === "undefined" || !document.title) {
    return "";
  }
  var titleElement = document.querySelector("title");
  if (titleElement && titleElement.hasAttribute(TEXT_MASK_ATTRIBUTE)) {
    return MASKED_TEXT_VALUE;
  }
  return parseTitleFunction ? parseTitleFunction(document.title) : document.title;
};

// node_modules/zen-observable-ts/module.js
function _createForOfIteratorHelperLoose(o2, allowArrayLike) {
  var it = typeof Symbol !== "undefined" && o2[Symbol.iterator] || o2["@@iterator"];
  if (it) return (it = it.call(o2)).next.bind(it);
  if (Array.isArray(o2) || (it = _unsupportedIterableToArray(o2)) || allowArrayLike && o2 && typeof o2.length === "number") {
    if (it) o2 = it;
    var i2 = 0;
    return function() {
      if (i2 >= o2.length) return { done: true };
      return { done: false, value: o2[i2++] };
    };
  }
  throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _unsupportedIterableToArray(o2, minLen) {
  if (!o2) return;
  if (typeof o2 === "string") return _arrayLikeToArray(o2, minLen);
  var n2 = Object.prototype.toString.call(o2).slice(8, -1);
  if (n2 === "Object" && o2.constructor) n2 = o2.constructor.name;
  if (n2 === "Map" || n2 === "Set") return Array.from(o2);
  if (n2 === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n2)) return _arrayLikeToArray(o2, minLen);
}
function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;
  for (var i2 = 0, arr2 = new Array(len); i2 < len; i2++) {
    arr2[i2] = arr[i2];
  }
  return arr2;
}
function _defineProperties(target, props) {
  for (var i2 = 0; i2 < props.length; i2++) {
    var descriptor = props[i2];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}
function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  return Constructor;
}
var hasSymbols = function() {
  return typeof Symbol === "function";
};
var hasSymbol = function(name) {
  return hasSymbols() && Boolean(Symbol[name]);
};
var getSymbol = function(name) {
  return hasSymbol(name) ? Symbol[name] : "@@" + name;
};
if (hasSymbols() && !hasSymbol("observable")) {
  Symbol.observable = /* @__PURE__ */ Symbol("observable");
}
var SymbolIterator = getSymbol("iterator");
var SymbolObservable = getSymbol("observable");
var SymbolSpecies = getSymbol("species");
function getMethod(obj, key) {
  var value = obj[key];
  if (value == null) return void 0;
  if (typeof value !== "function") throw new TypeError(value + " is not a function");
  return value;
}
function getSpecies(obj) {
  var ctor = obj.constructor;
  if (ctor !== void 0) {
    ctor = ctor[SymbolSpecies];
    if (ctor === null) {
      ctor = void 0;
    }
  }
  return ctor !== void 0 ? ctor : Observable;
}
function isObservable(x2) {
  return x2 instanceof Observable;
}
function hostReportError(e2) {
  if (hostReportError.log) {
    hostReportError.log(e2);
  } else {
    setTimeout(function() {
      throw e2;
    });
  }
}
function enqueue(fn) {
  Promise.resolve().then(function() {
    try {
      fn();
    } catch (e2) {
      hostReportError(e2);
    }
  });
}
function cleanupSubscription(subscription2) {
  var cleanup = subscription2._cleanup;
  if (cleanup === void 0) return;
  subscription2._cleanup = void 0;
  if (!cleanup) {
    return;
  }
  try {
    if (typeof cleanup === "function") {
      cleanup();
    } else {
      var unsubscribe = getMethod(cleanup, "unsubscribe");
      if (unsubscribe) {
        unsubscribe.call(cleanup);
      }
    }
  } catch (e2) {
    hostReportError(e2);
  }
}
function closeSubscription(subscription2) {
  subscription2._observer = void 0;
  subscription2._queue = void 0;
  subscription2._state = "closed";
}
function flushSubscription(subscription2) {
  var queue = subscription2._queue;
  if (!queue) {
    return;
  }
  subscription2._queue = void 0;
  subscription2._state = "ready";
  for (var i2 = 0; i2 < queue.length; ++i2) {
    notifySubscription(subscription2, queue[i2].type, queue[i2].value);
    if (subscription2._state === "closed") break;
  }
}
function notifySubscription(subscription2, type, value) {
  subscription2._state = "running";
  var observer = subscription2._observer;
  try {
    var m2 = getMethod(observer, type);
    switch (type) {
      case "next":
        if (m2) m2.call(observer, value);
        break;
      case "error":
        closeSubscription(subscription2);
        if (m2) m2.call(observer, value);
        else throw value;
        break;
      case "complete":
        closeSubscription(subscription2);
        if (m2) m2.call(observer);
        break;
    }
  } catch (e2) {
    hostReportError(e2);
  }
  if (subscription2._state === "closed") cleanupSubscription(subscription2);
  else if (subscription2._state === "running") subscription2._state = "ready";
}
function onNotify(subscription2, type, value) {
  if (subscription2._state === "closed") return;
  if (subscription2._state === "buffering") {
    subscription2._queue.push({
      type,
      value
    });
    return;
  }
  if (subscription2._state !== "ready") {
    subscription2._state = "buffering";
    subscription2._queue = [{
      type,
      value
    }];
    enqueue(function() {
      return flushSubscription(subscription2);
    });
    return;
  }
  notifySubscription(subscription2, type, value);
}
var Subscription = (function() {
  function Subscription2(observer, subscriber) {
    this._cleanup = void 0;
    this._observer = observer;
    this._queue = void 0;
    this._state = "initializing";
    var subscriptionObserver = new SubscriptionObserver(this);
    try {
      this._cleanup = subscriber.call(void 0, subscriptionObserver);
    } catch (e2) {
      subscriptionObserver.error(e2);
    }
    if (this._state === "initializing") this._state = "ready";
  }
  var _proto = Subscription2.prototype;
  _proto.unsubscribe = function unsubscribe() {
    if (this._state !== "closed") {
      closeSubscription(this);
      cleanupSubscription(this);
    }
  };
  _createClass(Subscription2, [{
    key: "closed",
    get: function() {
      return this._state === "closed";
    }
  }]);
  return Subscription2;
})();
var SubscriptionObserver = (function() {
  function SubscriptionObserver2(subscription2) {
    this._subscription = subscription2;
  }
  var _proto2 = SubscriptionObserver2.prototype;
  _proto2.next = function next(value) {
    onNotify(this._subscription, "next", value);
  };
  _proto2.error = function error(value) {
    onNotify(this._subscription, "error", value);
  };
  _proto2.complete = function complete() {
    onNotify(this._subscription, "complete");
  };
  _createClass(SubscriptionObserver2, [{
    key: "closed",
    get: function() {
      return this._subscription._state === "closed";
    }
  }]);
  return SubscriptionObserver2;
})();
var Observable = (function() {
  function Observable2(subscriber) {
    if (!(this instanceof Observable2)) throw new TypeError("Observable cannot be called as a function");
    if (typeof subscriber !== "function") throw new TypeError("Observable initializer must be a function");
    this._subscriber = subscriber;
  }
  var _proto3 = Observable2.prototype;
  _proto3.subscribe = function subscribe(observer) {
    if (typeof observer !== "object" || observer === null) {
      observer = {
        next: observer,
        error: arguments[1],
        complete: arguments[2]
      };
    }
    return new Subscription(observer, this._subscriber);
  };
  _proto3.forEach = function forEach(fn) {
    var _this = this;
    return new Promise(function(resolve, reject) {
      if (typeof fn !== "function") {
        reject(new TypeError(fn + " is not a function"));
        return;
      }
      function done() {
        subscription2.unsubscribe();
        resolve();
      }
      var subscription2 = _this.subscribe({
        next: function(value) {
          try {
            fn(value, done);
          } catch (e2) {
            reject(e2);
            subscription2.unsubscribe();
          }
        },
        error: reject,
        complete: resolve
      });
    });
  };
  _proto3.map = function map(fn) {
    var _this2 = this;
    if (typeof fn !== "function") throw new TypeError(fn + " is not a function");
    var C2 = getSpecies(this);
    return new C2(function(observer) {
      return _this2.subscribe({
        next: function(value) {
          try {
            value = fn(value);
          } catch (e2) {
            return observer.error(e2);
          }
          observer.next(value);
        },
        error: function(e2) {
          observer.error(e2);
        },
        complete: function() {
          observer.complete();
        }
      });
    });
  };
  _proto3.filter = function filter(fn) {
    var _this3 = this;
    if (typeof fn !== "function") throw new TypeError(fn + " is not a function");
    var C2 = getSpecies(this);
    return new C2(function(observer) {
      return _this3.subscribe({
        next: function(value) {
          try {
            if (!fn(value)) return;
          } catch (e2) {
            return observer.error(e2);
          }
          observer.next(value);
        },
        error: function(e2) {
          observer.error(e2);
        },
        complete: function() {
          observer.complete();
        }
      });
    });
  };
  _proto3.reduce = function reduce(fn) {
    var _this4 = this;
    if (typeof fn !== "function") throw new TypeError(fn + " is not a function");
    var C2 = getSpecies(this);
    var hasSeed = arguments.length > 1;
    var hasValue = false;
    var seed = arguments[1];
    var acc = seed;
    return new C2(function(observer) {
      return _this4.subscribe({
        next: function(value) {
          var first = !hasValue;
          hasValue = true;
          if (!first || hasSeed) {
            try {
              acc = fn(acc, value);
            } catch (e2) {
              return observer.error(e2);
            }
          } else {
            acc = value;
          }
        },
        error: function(e2) {
          observer.error(e2);
        },
        complete: function() {
          if (!hasValue && !hasSeed) return observer.error(new TypeError("Cannot reduce an empty sequence"));
          observer.next(acc);
          observer.complete();
        }
      });
    });
  };
  _proto3.concat = function concat() {
    var _this5 = this;
    for (var _len = arguments.length, sources = new Array(_len), _key = 0; _key < _len; _key++) {
      sources[_key] = arguments[_key];
    }
    var C2 = getSpecies(this);
    return new C2(function(observer) {
      var subscription2;
      var index = 0;
      function startNext(next) {
        subscription2 = next.subscribe({
          next: function(v2) {
            observer.next(v2);
          },
          error: function(e2) {
            observer.error(e2);
          },
          complete: function() {
            if (index === sources.length) {
              subscription2 = void 0;
              observer.complete();
            } else {
              startNext(C2.from(sources[index++]));
            }
          }
        });
      }
      startNext(_this5);
      return function() {
        if (subscription2) {
          subscription2.unsubscribe();
          subscription2 = void 0;
        }
      };
    });
  };
  _proto3.flatMap = function flatMap(fn) {
    var _this6 = this;
    if (typeof fn !== "function") throw new TypeError(fn + " is not a function");
    var C2 = getSpecies(this);
    return new C2(function(observer) {
      var subscriptions = [];
      var outer = _this6.subscribe({
        next: function(value) {
          if (fn) {
            try {
              value = fn(value);
            } catch (e2) {
              return observer.error(e2);
            }
          }
          var inner = C2.from(value).subscribe({
            next: function(value2) {
              observer.next(value2);
            },
            error: function(e2) {
              observer.error(e2);
            },
            complete: function() {
              var i2 = subscriptions.indexOf(inner);
              if (i2 >= 0) subscriptions.splice(i2, 1);
              completeIfDone();
            }
          });
          subscriptions.push(inner);
        },
        error: function(e2) {
          observer.error(e2);
        },
        complete: function() {
          completeIfDone();
        }
      });
      function completeIfDone() {
        if (outer.closed && subscriptions.length === 0) observer.complete();
      }
      return function() {
        subscriptions.forEach(function(s2) {
          return s2.unsubscribe();
        });
        outer.unsubscribe();
      };
    });
  };
  _proto3[SymbolObservable] = function() {
    return this;
  };
  Observable2.from = function from(x2) {
    var C2 = typeof this === "function" ? this : Observable2;
    if (x2 == null) throw new TypeError(x2 + " is not an object");
    var method = getMethod(x2, SymbolObservable);
    if (method) {
      var observable = method.call(x2);
      if (Object(observable) !== observable) throw new TypeError(observable + " is not an object");
      if (isObservable(observable) && observable.constructor === C2) return observable;
      return new C2(function(observer) {
        return observable.subscribe(observer);
      });
    }
    if (hasSymbol("iterator")) {
      method = getMethod(x2, SymbolIterator);
      if (method) {
        return new C2(function(observer) {
          enqueue(function() {
            if (observer.closed) return;
            for (var _iterator = _createForOfIteratorHelperLoose(method.call(x2)), _step; !(_step = _iterator()).done; ) {
              var item = _step.value;
              observer.next(item);
              if (observer.closed) return;
            }
            observer.complete();
          });
        });
      }
    }
    if (Array.isArray(x2)) {
      return new C2(function(observer) {
        enqueue(function() {
          if (observer.closed) return;
          for (var i2 = 0; i2 < x2.length; ++i2) {
            observer.next(x2[i2]);
            if (observer.closed) return;
          }
          observer.complete();
        });
      });
    }
    throw new TypeError(x2 + " is not observable");
  };
  Observable2.of = function of() {
    for (var _len2 = arguments.length, items = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      items[_key2] = arguments[_key2];
    }
    var C2 = typeof this === "function" ? this : Observable2;
    return new C2(function(observer) {
      enqueue(function() {
        if (observer.closed) return;
        for (var i2 = 0; i2 < items.length; ++i2) {
          observer.next(items[i2]);
          if (observer.closed) return;
        }
        observer.complete();
      });
    });
  };
  _createClass(Observable2, null, [{
    key: SymbolSpecies,
    get: function() {
      return this;
    }
  }]);
  return Observable2;
})();
if (hasSymbols()) {
  Object.defineProperty(Observable, /* @__PURE__ */ Symbol("extensions"), {
    value: {
      symbol: SymbolObservable,
      hostReportError
    },
    configurable: true
  });
}

// node_modules/@amplitude/analytics-core/lib/esm/utils/observable.js
function asyncMap(observable, fn) {
  return new Observable(function(observer) {
    observable.subscribe({
      next: function(value) {
        fn(value).then(function(result) {
          return observer.next(result);
        }).catch(function(error) {
          return observer.error(error);
        });
      },
      error: function(error) {
        observer.error(error);
      },
      complete: function() {
        observer.complete();
      }
    });
  });
}
function merge(sourceA, sourceB) {
  return new Observable(function(observer) {
    var closed = false;
    var subscriptions = /* @__PURE__ */ new Set();
    var cleanup = function() {
      var e_1, _a;
      closed = true;
      try {
        for (var subscriptions_1 = __values(subscriptions), subscriptions_1_1 = subscriptions_1.next(); !subscriptions_1_1.done; subscriptions_1_1 = subscriptions_1.next()) {
          var sub = subscriptions_1_1.value;
          try {
            sub.unsubscribe();
          } catch (_b) {
          }
        }
      } catch (e_1_1) {
        e_1 = { error: e_1_1 };
      } finally {
        try {
          if (subscriptions_1_1 && !subscriptions_1_1.done && (_a = subscriptions_1.return)) _a.call(subscriptions_1);
        } finally {
          if (e_1) throw e_1.error;
        }
      }
      subscriptions.clear();
    };
    var subscribeTo = function(source) {
      var sub = source.subscribe({
        next: function(value) {
          if (!closed)
            observer.next(value);
        },
        error: function(err) {
          if (!closed) {
            closed = true;
            observer.error(err);
            cleanup();
          }
        },
        complete: function() {
          subscriptions.delete(sub);
          if (!closed && subscriptions.size === 0) {
            observer.complete();
            cleanup();
            closed = true;
          }
        }
      });
      subscriptions.add(sub);
    };
    subscribeTo(sourceA);
    subscribeTo(sourceB);
    return cleanup;
  });
}
function multicast(source) {
  var observers = /* @__PURE__ */ new Set();
  var subscription2 = null;
  function cleanup() {
    subscription2 === null || subscription2 === void 0 ? void 0 : subscription2.unsubscribe();
    subscription2 = null;
    observers.clear();
  }
  return new Observable(function(observer) {
    observers.add(observer);
    if (subscription2 === null) {
      subscription2 = source.subscribe({
        next: function(value) {
          var e_2, _a;
          var _b;
          try {
            for (var observers_1 = __values(observers), observers_1_1 = observers_1.next(); !observers_1_1.done; observers_1_1 = observers_1.next()) {
              var obs = observers_1_1.value;
              (_b = obs.next) === null || _b === void 0 ? void 0 : _b.call(obs, value);
            }
          } catch (e_2_1) {
            e_2 = { error: e_2_1 };
          } finally {
            try {
              if (observers_1_1 && !observers_1_1.done && (_a = observers_1.return)) _a.call(observers_1);
            } finally {
              if (e_2) throw e_2.error;
            }
          }
        },
        error: function(err) {
          var e_3, _a;
          var _b;
          try {
            for (var observers_2 = __values(observers), observers_2_1 = observers_2.next(); !observers_2_1.done; observers_2_1 = observers_2.next()) {
              var obs = observers_2_1.value;
              (_b = obs.error) === null || _b === void 0 ? void 0 : _b.call(obs, err);
            }
          } catch (e_3_1) {
            e_3 = { error: e_3_1 };
          } finally {
            try {
              if (observers_2_1 && !observers_2_1.done && (_a = observers_2.return)) _a.call(observers_2);
            } finally {
              if (e_3) throw e_3.error;
            }
          }
          cleanup();
        },
        complete: function() {
          var e_4, _a;
          var _b;
          try {
            for (var observers_3 = __values(observers), observers_3_1 = observers_3.next(); !observers_3_1.done; observers_3_1 = observers_3.next()) {
              var obs = observers_3_1.value;
              (_b = obs.complete) === null || _b === void 0 ? void 0 : _b.call(obs);
            }
          } catch (e_4_1) {
            e_4 = { error: e_4_1 };
          } finally {
            try {
              if (observers_3_1 && !observers_3_1.done && (_a = observers_3.return)) _a.call(observers_3);
            } finally {
              if (e_4) throw e_4.error;
            }
          }
          cleanup();
        }
      });
    }
    return function() {
      observers.delete(observer);
      if (observers.size === 0 && subscription2) {
        subscription2.unsubscribe();
        subscription2 = null;
      }
    };
  });
}

// node_modules/@amplitude/analytics-browser/node_modules/tslib/tslib.es6.mjs
var extendStatics2 = function(d2, b2) {
  extendStatics2 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
    d3.__proto__ = b3;
  } || function(d3, b3) {
    for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
  };
  return extendStatics2(d2, b2);
};
function __extends2(d2, b2) {
  if (typeof b2 !== "function" && b2 !== null)
    throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
  extendStatics2(d2, b2);
  function __() {
    this.constructor = d2;
  }
  d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
}
var __assign3 = function() {
  __assign3 = Object.assign || function __assign7(t2) {
    for (var s2, i2 = 1, n2 = arguments.length; i2 < n2; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2)) t2[p2] = s2[p2];
    }
    return t2;
  };
  return __assign3.apply(this, arguments);
};
function __rest2(s2, e2) {
  var t2 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e2.indexOf(p2) < 0)
    t2[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e2.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t2[p2[i2]] = s2[p2[i2]];
    }
  return t2;
}
function __awaiter2(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e2) {
        reject(e2);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e2) {
        reject(e2);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator2(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t2[0] & 1) throw t2[1];
    return t2[1];
  }, trys: [], ops: [] }, f2, y2, t2, g2 = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
  return g2.next = verb(0), g2["throw"] = verb(1), g2["return"] = verb(2), typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n2) {
    return function(v2) {
      return step([n2, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t2 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t2 = y2["return"]) && t2.call(y2), 0) : y2.next) && !(t2 = t2.call(y2, op[1])).done) return t2;
      if (y2 = 0, t2) op = [op[0] & 2, t2.value];
      switch (op[0]) {
        case 0:
        case 1:
          t2 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t2 = _2.trys, t2 = t2.length > 0 && t2[t2.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t2 || op[1] > t2[0] && op[1] < t2[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t2[1]) {
            _2.label = t2[1];
            t2 = op;
            break;
          }
          if (t2 && _2.label < t2[2]) {
            _2.label = t2[2];
            _2.ops.push(op);
            break;
          }
          if (t2[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e2) {
      op = [6, e2];
      y2 = 0;
    } finally {
      f2 = t2 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}
function __values3(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
function __read3(o2, n2) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r2, ar = [], e2;
  try {
    while ((n2 === void 0 || n2-- > 0) && !(r2 = i2.next()).done) ar.push(r2.value);
  } catch (error) {
    e2 = { error };
  } finally {
    try {
      if (r2 && !r2.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e2) throw e2.error;
    }
  }
  return ar;
}
function __spreadArray2(to, from, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from.length, ar; i2 < l2; i2++) {
    if (ar || !(i2 in from)) {
      if (!ar) ar = Array.prototype.slice.call(from, 0, i2);
      ar[i2] = from[i2];
    }
  }
  return to.concat(ar || Array.prototype.slice.call(from));
}

// node_modules/@amplitude/analytics-browser/lib/esm/default-tracking.js
var isTrackingEnabled = function(autocapture, event) {
  if (typeof autocapture === "boolean") {
    return autocapture;
  }
  if ((autocapture === null || autocapture === void 0 ? void 0 : autocapture[event]) === false) {
    return false;
  }
  return true;
};
var isAttributionTrackingEnabled = function(autocapture) {
  return isTrackingEnabled(autocapture, "attribution");
};
var isFileDownloadTrackingEnabled = function(autocapture) {
  return isTrackingEnabled(autocapture, "fileDownloads");
};
var isFormInteractionTrackingEnabled = function(autocapture) {
  return isTrackingEnabled(autocapture, "formInteractions");
};
var isPageViewTrackingEnabled = function(autocapture) {
  return isTrackingEnabled(autocapture, "pageViews");
};
var isSessionTrackingEnabled = function(autocapture) {
  return isTrackingEnabled(autocapture, "sessions");
};
var isPageUrlEnrichmentEnabled = function(autocapture) {
  return isTrackingEnabled(autocapture, "pageUrlEnrichment");
};
var isNetworkTrackingEnabled = function(autocapture) {
  if (typeof autocapture === "boolean") {
    return autocapture;
  }
  if (typeof autocapture === "object" && (autocapture.networkTracking === true || typeof autocapture.networkTracking === "object")) {
    return true;
  }
  return false;
};
var isElementInteractionsEnabled = function(autocapture) {
  if (typeof autocapture === "boolean") {
    return autocapture;
  }
  if (typeof autocapture === "object" && (autocapture.elementInteractions === true || typeof autocapture.elementInteractions === "object")) {
    return true;
  }
  return false;
};
var isWebVitalsEnabled = function(autocapture) {
  if (typeof autocapture === "boolean") {
    return autocapture;
  }
  if (typeof autocapture === "object" && autocapture.webVitals === true) {
    return true;
  }
  return false;
};
var isFrustrationInteractionsEnabled = function(autocapture) {
  if (typeof autocapture === "boolean") {
    return autocapture;
  }
  if (typeof autocapture === "object" && (autocapture.frustrationInteractions === true || typeof autocapture.frustrationInteractions === "object")) {
    return true;
  }
  return false;
};
var getElementInteractionsConfig = function(config) {
  if (isElementInteractionsEnabled(config.autocapture) && typeof config.autocapture === "object" && typeof config.autocapture.elementInteractions === "object") {
    return config.autocapture.elementInteractions;
  }
  return void 0;
};
var getFrustrationInteractionsConfig = function(config) {
  if (isFrustrationInteractionsEnabled(config.autocapture) && typeof config.autocapture === "object" && typeof config.autocapture.frustrationInteractions === "object") {
    return config.autocapture.frustrationInteractions;
  }
  return void 0;
};
var getNetworkTrackingConfig = function(config) {
  var _a;
  if (isNetworkTrackingEnabled(config.autocapture)) {
    var networkTrackingConfig = void 0;
    if (typeof config.autocapture === "object" && typeof config.autocapture.networkTracking === "object") {
      networkTrackingConfig = config.autocapture.networkTracking;
    } else if (config.networkTrackingOptions) {
      networkTrackingConfig = config.networkTrackingOptions;
    }
    return __assign3(__assign3({}, networkTrackingConfig), { captureRules: (_a = networkTrackingConfig === null || networkTrackingConfig === void 0 ? void 0 : networkTrackingConfig.captureRules) === null || _a === void 0 ? void 0 : _a.map(function(rule) {
      var _a2, _b, _c;
      if (((_a2 = rule.urls) === null || _a2 === void 0 ? void 0 : _a2.length) && ((_b = rule.hosts) === null || _b === void 0 ? void 0 : _b.length)) {
        var hostsString = JSON.stringify(rule.hosts);
        var urlsString = JSON.stringify(rule.urls);
        (_c = config.loggerProvider) === null || _c === void 0 ? void 0 : _c.warn("Found network capture rule with both urls='".concat(urlsString, "' and hosts='").concat(hostsString, "' set. ") + "Definition of urls takes precedence over hosts, so ignoring hosts.");
        return __assign3(__assign3({}, rule), { hosts: void 0 });
      }
      return rule;
    }) });
  }
  return;
};
var getPageViewTrackingConfig = function(config) {
  var trackOn = function() {
    return false;
  };
  var trackHistoryChanges = void 0;
  var eventType;
  var pageCounter = config.pageCounter;
  var isDefaultPageViewTrackingEnabled = isPageViewTrackingEnabled(config.defaultTracking);
  if (isDefaultPageViewTrackingEnabled) {
    trackOn = void 0;
    eventType = void 0;
    if (config.defaultTracking && typeof config.defaultTracking === "object" && config.defaultTracking.pageViews && typeof config.defaultTracking.pageViews === "object") {
      if ("trackOn" in config.defaultTracking.pageViews) {
        trackOn = config.defaultTracking.pageViews.trackOn;
      }
      if ("trackHistoryChanges" in config.defaultTracking.pageViews) {
        trackHistoryChanges = config.defaultTracking.pageViews.trackHistoryChanges;
      }
      if ("eventType" in config.defaultTracking.pageViews && config.defaultTracking.pageViews.eventType) {
        eventType = config.defaultTracking.pageViews.eventType;
      }
    }
  }
  return {
    trackOn,
    trackHistoryChanges,
    eventType,
    pageCounter
  };
};
var getAttributionTrackingConfig = function(config) {
  if (isAttributionTrackingEnabled(config.defaultTracking) && config.defaultTracking && typeof config.defaultTracking === "object" && config.defaultTracking.attribution && typeof config.defaultTracking.attribution === "object") {
    return __assign3({}, config.defaultTracking.attribution);
  }
  return {};
};
var getFormInteractionsConfig = function(config) {
  if (isFormInteractionTrackingEnabled(config.defaultTracking) && config.defaultTracking && typeof config.defaultTracking === "object" && typeof config.defaultTracking.formInteractions === "object") {
    return config.defaultTracking.formInteractions;
  }
  return void 0;
};

// node_modules/@amplitude/analytics-browser/lib/esm/utils/snippet-helper.js
var runQueuedFunctions = function(instance, queue) {
  convertProxyObjectToRealObject(instance, queue);
};
var convertProxyObjectToRealObject = function(instance, queue) {
  for (var i2 = 0; i2 < queue.length; i2++) {
    var _a = queue[i2], name_1 = _a.name, args = _a.args, resolve = _a.resolve;
    var fn = instance && instance[name_1];
    if (typeof fn === "function") {
      var result = fn.apply(instance, args);
      if (typeof resolve === "function") {
        resolve(result === null || result === void 0 ? void 0 : result.promise);
      }
    }
  }
  return instance;
};
var isInstanceProxy = function(instance) {
  var instanceProxy = instance;
  return instanceProxy && instanceProxy._q !== void 0;
};

// node_modules/@amplitude/analytics-browser/lib/esm/version.js
var VERSION = "2.34.0";

// node_modules/@amplitude/analytics-browser/lib/esm/lib-prefix.js
var LIBPREFIX = "amplitude-ts";

// node_modules/@amplitude/analytics-browser/lib/esm/plugins/context.js
var BROWSER_PLATFORM = "Web";
var IP_ADDRESS = "$remote";
var Context = (
  /** @class */
  (function() {
    function Context2() {
      this.name = "@amplitude/plugin-context-browser";
      this.type = "before";
      this.library = "".concat(LIBPREFIX, "/").concat(VERSION);
      if (typeof navigator !== "undefined") {
        this.userAgent = navigator.userAgent;
      }
    }
    Context2.prototype.setup = function(config) {
      this.config = config;
      return Promise.resolve(void 0);
    };
    Context2.prototype.execute = function(context) {
      var _a, _b;
      return __awaiter2(this, void 0, void 0, function() {
        var time, lastEventId, nextEventId, event;
        return __generator2(this, function(_c) {
          time = (/* @__PURE__ */ new Date()).getTime();
          lastEventId = (_a = this.config.lastEventId) !== null && _a !== void 0 ? _a : -1;
          nextEventId = (_b = context.event_id) !== null && _b !== void 0 ? _b : lastEventId + 1;
          this.config.lastEventId = nextEventId;
          if (!context.time) {
            this.config.lastEventTime = time;
          }
          event = __assign3(__assign3(__assign3(__assign3(__assign3(__assign3(__assign3(__assign3({ user_id: this.config.userId, device_id: this.config.deviceId, session_id: this.config.sessionId, time }, this.config.appVersion && { app_version: this.config.appVersion }), this.config.trackingOptions.platform && { platform: BROWSER_PLATFORM }), this.config.trackingOptions.language && { language: getLanguage2() }), this.config.trackingOptions.ipAddress && { ip: IP_ADDRESS }), { insert_id: UUID(), partner_id: this.config.partnerId, plan: this.config.plan }), this.config.ingestionMetadata && {
            ingestion_metadata: {
              source_name: this.config.ingestionMetadata.sourceName,
              source_version: this.config.ingestionMetadata.sourceVersion
            }
          }), context), { event_id: nextEventId, library: this.library, user_agent: this.userAgent });
          return [2, event];
        });
      });
    };
    return Context2;
  })()
);

// node_modules/@amplitude/analytics-browser/lib/esm/storage/local-storage.js
var MAX_ARRAY_LENGTH = 1e3;
var LocalStorage = (
  /** @class */
  (function(_super) {
    __extends2(LocalStorage2, _super);
    function LocalStorage2(config) {
      var _this = this;
      var _a, _b;
      var localStorage2;
      try {
        localStorage2 = (_a = getGlobalScope()) === null || _a === void 0 ? void 0 : _a.localStorage;
      } catch (e2) {
        (_b = config === null || config === void 0 ? void 0 : config.loggerProvider) === null || _b === void 0 ? void 0 : _b.debug("Failed to access localStorage. error=".concat(JSON.stringify(e2)));
        localStorage2 = void 0;
      }
      _this = _super.call(this, localStorage2) || this;
      _this.loggerProvider = config === null || config === void 0 ? void 0 : config.loggerProvider;
      return _this;
    }
    LocalStorage2.prototype.set = function(key, value) {
      var _a;
      return __awaiter2(this, void 0, void 0, function() {
        var droppedEventsCount;
        return __generator2(this, function(_b) {
          switch (_b.label) {
            case 0:
              if (!(Array.isArray(value) && value.length > MAX_ARRAY_LENGTH)) return [3, 2];
              droppedEventsCount = value.length - MAX_ARRAY_LENGTH;
              return [4, _super.prototype.set.call(this, key, value.slice(0, MAX_ARRAY_LENGTH))];
            case 1:
              _b.sent();
              (_a = this.loggerProvider) === null || _a === void 0 ? void 0 : _a.error("Failed to save ".concat(droppedEventsCount, " events because the queue length exceeded ").concat(MAX_ARRAY_LENGTH, "."));
              return [3, 4];
            case 2:
              return [4, _super.prototype.set.call(this, key, value)];
            case 3:
              _b.sent();
              _b.label = 4;
            case 4:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    return LocalStorage2;
  })(BrowserStorage)
);

// node_modules/@amplitude/analytics-browser/lib/esm/storage/session-storage.js
var SessionStorage = (
  /** @class */
  (function(_super) {
    __extends2(SessionStorage2, _super);
    function SessionStorage2() {
      var _a;
      return _super.call(this, (_a = getGlobalScope()) === null || _a === void 0 ? void 0 : _a.sessionStorage) || this;
    }
    return SessionStorage2;
  })(BrowserStorage)
);

// node_modules/@amplitude/analytics-browser/lib/esm/transports/xhr.js
var XHRTransport = (
  /** @class */
  (function(_super) {
    __extends2(XHRTransport2, _super);
    function XHRTransport2(customHeaders) {
      if (customHeaders === void 0) {
        customHeaders = {};
      }
      var _this = _super.call(this) || this;
      _this.state = {
        done: 4
      };
      _this.customHeaders = customHeaders;
      return _this;
    }
    XHRTransport2.prototype.send = function(serverUrl, payload) {
      return __awaiter2(this, void 0, void 0, function() {
        var _this = this;
        return __generator2(this, function(_a) {
          return [2, new Promise(function(resolve, reject) {
            var e_1, _a2;
            if (typeof XMLHttpRequest === "undefined") {
              reject(new Error("XHRTransport is not supported."));
            }
            var xhr = new XMLHttpRequest();
            xhr.open("POST", serverUrl, true);
            xhr.onreadystatechange = function() {
              if (xhr.readyState === _this.state.done) {
                var responseText = xhr.responseText;
                try {
                  resolve(_this.buildResponse(JSON.parse(responseText)));
                } catch (_a3) {
                  resolve(_this.buildResponse({ code: xhr.status }));
                }
              }
            };
            var headers = __assign3({ "Content-Type": "application/json", Accept: "*/*" }, _this.customHeaders);
            try {
              for (var _b = __values3(Object.entries(headers)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var _d = __read3(_c.value, 2), key = _d[0], value = _d[1];
                xhr.setRequestHeader(key, value);
              }
            } catch (e_1_1) {
              e_1 = { error: e_1_1 };
            } finally {
              try {
                if (_c && !_c.done && (_a2 = _b.return)) _a2.call(_b);
              } finally {
                if (e_1) throw e_1.error;
              }
            }
            xhr.send(JSON.stringify(payload));
          })];
        });
      });
    };
    return XHRTransport2;
  })(BaseTransport)
);

// node_modules/@amplitude/analytics-browser/lib/esm/transports/send-beacon.js
var SendBeaconTransport = (
  /** @class */
  (function(_super) {
    __extends2(SendBeaconTransport2, _super);
    function SendBeaconTransport2() {
      return _super !== null && _super.apply(this, arguments) || this;
    }
    SendBeaconTransport2.prototype.send = function(serverUrl, payload) {
      return __awaiter2(this, void 0, void 0, function() {
        var _this = this;
        return __generator2(this, function(_a) {
          return [2, new Promise(function(resolve, reject) {
            var globalScope3 = getGlobalScope();
            if (!(globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.navigator.sendBeacon)) {
              throw new Error("SendBeaconTransport is not supported");
            }
            try {
              var data = JSON.stringify(payload);
              var success = globalScope3.navigator.sendBeacon(serverUrl, JSON.stringify(payload));
              if (success) {
                return resolve(_this.buildResponse({
                  code: 200,
                  events_ingested: payload.events.length,
                  payload_size_bytes: data.length,
                  server_upload_time: Date.now()
                }));
              }
              return resolve(_this.buildResponse({ code: 500 }));
            } catch (e2) {
              reject(e2);
            }
          })];
        });
      });
    };
    return SendBeaconTransport2;
  })(BaseTransport)
);

// node_modules/@amplitude/analytics-browser/lib/esm/cookie-migration/index.js
var parseLegacyCookies = function(apiKey, cookieStorage, deleteLegacyCookies) {
  if (deleteLegacyCookies === void 0) {
    deleteLegacyCookies = true;
  }
  return __awaiter2(void 0, void 0, void 0, function() {
    var cookieName, cookies, _a, deviceId, userId, optOut, sessionId, lastEventTime, lastEventId;
    return __generator2(this, function(_b) {
      switch (_b.label) {
        case 0:
          cookieName = getOldCookieName(apiKey);
          return [4, cookieStorage.getRaw(cookieName)];
        case 1:
          cookies = _b.sent();
          if (!cookies) {
            return [2, {
              optOut: false
            }];
          }
          if (!deleteLegacyCookies) return [3, 3];
          return [4, cookieStorage.remove(cookieName)];
        case 2:
          _b.sent();
          _b.label = 3;
        case 3:
          _a = __read3(cookies.split("."), 6), deviceId = _a[0], userId = _a[1], optOut = _a[2], sessionId = _a[3], lastEventTime = _a[4], lastEventId = _a[5];
          return [2, {
            deviceId,
            userId: decode(userId),
            sessionId: parseTime(sessionId),
            lastEventId: parseTime(lastEventId),
            lastEventTime: parseTime(lastEventTime),
            optOut: Boolean(optOut)
          }];
      }
    });
  });
};
var parseTime = function(num) {
  var integer = parseInt(num, 32);
  if (isNaN(integer)) {
    return void 0;
  }
  return integer;
};
var decode = function(value) {
  if (!atob || !escape || !value) {
    return void 0;
  }
  try {
    return decodeURIComponent(escape(atob(value)));
  } catch (_a) {
    return void 0;
  }
};

// node_modules/@amplitude/analytics-browser/lib/esm/constants.js
var DEFAULT_EVENT_PREFIX = "[Amplitude]";
var DEFAULT_PAGE_VIEW_EVENT = "".concat(DEFAULT_EVENT_PREFIX, " Page Viewed");
var DEFAULT_FORM_START_EVENT = "".concat(DEFAULT_EVENT_PREFIX, " Form Started");
var DEFAULT_FORM_SUBMIT_EVENT = "".concat(DEFAULT_EVENT_PREFIX, " Form Submitted");
var DEFAULT_FILE_DOWNLOAD_EVENT = "".concat(DEFAULT_EVENT_PREFIX, " File Downloaded");
var DEFAULT_SESSION_START_EVENT = "session_start";
var DEFAULT_SESSION_END_EVENT = "session_end";
var FILE_EXTENSION = "".concat(DEFAULT_EVENT_PREFIX, " File Extension");
var FILE_NAME = "".concat(DEFAULT_EVENT_PREFIX, " File Name");
var LINK_ID = "".concat(DEFAULT_EVENT_PREFIX, " Link ID");
var LINK_TEXT = "".concat(DEFAULT_EVENT_PREFIX, " Link Text");
var LINK_URL = "".concat(DEFAULT_EVENT_PREFIX, " Link URL");
var FORM_ID = "".concat(DEFAULT_EVENT_PREFIX, " Form ID");
var FORM_NAME = "".concat(DEFAULT_EVENT_PREFIX, " Form Name");
var FORM_DESTINATION = "".concat(DEFAULT_EVENT_PREFIX, " Form Destination");
var DEFAULT_IDENTITY_STORAGE = "cookie";
var DEFAULT_SERVER_ZONE = "US";

// node_modules/@amplitude/analytics-browser/lib/esm/config.js
var BrowserConfig = (
  /** @class */
  (function(_super) {
    __extends2(BrowserConfig2, _super);
    function BrowserConfig2(apiKey, appVersion, cookieStorage, cookieOptions, defaultTracking, autocapture, deviceId, flushIntervalMillis, flushMaxRetries, flushQueueSize, identityStorage, ingestionMetadata, instanceName, lastEventId, lastEventTime, loggerProvider, logLevel, minIdLength, offline, optOut, partnerId, plan, serverUrl, serverZone, sessionId, sessionTimeout, storageProvider, trackingOptions, transport, useBatch, fetchRemoteConfig, userId, pageCounter, debugLogsEnabled, networkTrackingOptions, identify2, enableDiagnostics, diagnosticsSampleRate, diagnosticsClient, remoteConfig) {
      if (cookieStorage === void 0) {
        cookieStorage = new MemoryStorage();
      }
      if (cookieOptions === void 0) {
        cookieOptions = {
          domain: "",
          expiration: 365,
          sameSite: "Lax",
          secure: false,
          upgrade: true
        };
      }
      if (flushIntervalMillis === void 0) {
        flushIntervalMillis = 1e3;
      }
      if (flushMaxRetries === void 0) {
        flushMaxRetries = 5;
      }
      if (flushQueueSize === void 0) {
        flushQueueSize = 30;
      }
      if (identityStorage === void 0) {
        identityStorage = DEFAULT_IDENTITY_STORAGE;
      }
      if (loggerProvider === void 0) {
        loggerProvider = new Logger();
      }
      if (logLevel === void 0) {
        logLevel = LogLevel.Warn;
      }
      if (offline === void 0) {
        offline = false;
      }
      if (optOut === void 0) {
        optOut = false;
      }
      if (serverUrl === void 0) {
        serverUrl = "";
      }
      if (serverZone === void 0) {
        serverZone = DEFAULT_SERVER_ZONE;
      }
      if (sessionTimeout === void 0) {
        sessionTimeout = 30 * 60 * 1e3;
      }
      if (storageProvider === void 0) {
        storageProvider = new LocalStorage({ loggerProvider });
      }
      if (trackingOptions === void 0) {
        trackingOptions = {
          ipAddress: true,
          language: true,
          platform: true
        };
      }
      if (transport === void 0) {
        transport = "fetch";
      }
      if (useBatch === void 0) {
        useBatch = false;
      }
      if (fetchRemoteConfig === void 0) {
        fetchRemoteConfig = true;
      }
      if (enableDiagnostics === void 0) {
        enableDiagnostics = true;
      }
      if (diagnosticsSampleRate === void 0) {
        diagnosticsSampleRate = 0;
      }
      var _this = this;
      var _a;
      _this = _super.call(this, { apiKey, storageProvider, transportProvider: createTransport(transport) }) || this;
      _this.apiKey = apiKey;
      _this.appVersion = appVersion;
      _this.cookieOptions = cookieOptions;
      _this.defaultTracking = defaultTracking;
      _this.autocapture = autocapture;
      _this.flushIntervalMillis = flushIntervalMillis;
      _this.flushMaxRetries = flushMaxRetries;
      _this.flushQueueSize = flushQueueSize;
      _this.identityStorage = identityStorage;
      _this.ingestionMetadata = ingestionMetadata;
      _this.instanceName = instanceName;
      _this.loggerProvider = loggerProvider;
      _this.logLevel = logLevel;
      _this.minIdLength = minIdLength;
      _this.offline = offline;
      _this.partnerId = partnerId;
      _this.plan = plan;
      _this.serverUrl = serverUrl;
      _this.serverZone = serverZone;
      _this.sessionTimeout = sessionTimeout;
      _this.storageProvider = storageProvider;
      _this.trackingOptions = trackingOptions;
      _this.transport = transport;
      _this.useBatch = useBatch;
      _this.fetchRemoteConfig = fetchRemoteConfig;
      _this.networkTrackingOptions = networkTrackingOptions;
      _this.identify = identify2;
      _this.enableDiagnostics = enableDiagnostics;
      _this.diagnosticsSampleRate = diagnosticsSampleRate;
      _this.diagnosticsClient = diagnosticsClient;
      _this.remoteConfig = remoteConfig;
      _this.version = VERSION;
      _this._optOut = false;
      _this._cookieStorage = cookieStorage;
      _this.deviceId = deviceId;
      _this.lastEventId = lastEventId;
      _this.lastEventTime = lastEventTime;
      _this.optOut = optOut;
      _this.sessionId = sessionId;
      _this.pageCounter = pageCounter;
      _this.userId = userId;
      _this.debugLogsEnabled = debugLogsEnabled;
      _this.loggerProvider.enable(debugLogsEnabled ? LogLevel.Debug : _this.logLevel);
      _this.networkTrackingOptions = networkTrackingOptions;
      _this.identify = identify2;
      _this.enableDiagnostics = enableDiagnostics;
      _this.diagnosticsSampleRate = diagnosticsSampleRate;
      _this.diagnosticsClient = diagnosticsClient;
      var _fetchRemoteConfig = (_a = remoteConfig === null || remoteConfig === void 0 ? void 0 : remoteConfig.fetchRemoteConfig) !== null && _a !== void 0 ? _a : fetchRemoteConfig;
      _this.remoteConfig = _this.remoteConfig || {};
      _this.remoteConfig.fetchRemoteConfig = _fetchRemoteConfig;
      _this.fetchRemoteConfig = _fetchRemoteConfig;
      return _this;
    }
    Object.defineProperty(BrowserConfig2.prototype, "cookieStorage", {
      get: function() {
        return this._cookieStorage;
      },
      set: function(cookieStorage) {
        if (this._cookieStorage !== cookieStorage) {
          this._cookieStorage = cookieStorage;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "deviceId", {
      get: function() {
        return this._deviceId;
      },
      set: function(deviceId) {
        if (this._deviceId !== deviceId) {
          this._deviceId = deviceId;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "userId", {
      get: function() {
        return this._userId;
      },
      set: function(userId) {
        if (this._userId !== userId) {
          this._userId = userId;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "sessionId", {
      get: function() {
        return this._sessionId;
      },
      set: function(sessionId) {
        if (this._sessionId !== sessionId) {
          this._sessionId = sessionId;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "optOut", {
      get: function() {
        return this._optOut;
      },
      set: function(optOut) {
        if (this._optOut !== optOut) {
          this._optOut = optOut;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "lastEventTime", {
      get: function() {
        return this._lastEventTime;
      },
      set: function(lastEventTime) {
        if (this._lastEventTime !== lastEventTime) {
          this._lastEventTime = lastEventTime;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "lastEventId", {
      get: function() {
        return this._lastEventId;
      },
      set: function(lastEventId) {
        if (this._lastEventId !== lastEventId) {
          this._lastEventId = lastEventId;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "pageCounter", {
      get: function() {
        return this._pageCounter;
      },
      set: function(pageCounter) {
        if (this._pageCounter !== pageCounter) {
          this._pageCounter = pageCounter;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(BrowserConfig2.prototype, "debugLogsEnabled", {
      set: function(debugLogsEnabled) {
        if (this._debugLogsEnabled !== debugLogsEnabled) {
          this._debugLogsEnabled = debugLogsEnabled;
          this.updateStorage();
        }
      },
      enumerable: false,
      configurable: true
    });
    BrowserConfig2.prototype.updateStorage = function() {
      var cache = {
        deviceId: this._deviceId,
        userId: this._userId,
        sessionId: this._sessionId,
        optOut: this._optOut,
        lastEventTime: this._lastEventTime,
        lastEventId: this._lastEventId,
        pageCounter: this._pageCounter,
        debugLogsEnabled: this._debugLogsEnabled,
        cookieDomain: void 0
      };
      if (this.cookieStorage instanceof CookieStorage) {
        cache.cookieDomain = this.cookieStorage.options.domain;
      }
      void this.cookieStorage.set(getCookieName(this.apiKey), cache);
    };
    return BrowserConfig2;
  })(Config)
);
var useBrowserConfig = function(apiKey, options, amplitudeInstance, diagnosticsClient, earlyConfig) {
  if (options === void 0) {
    options = {};
  }
  return __awaiter2(void 0, void 0, void 0, function() {
    var identityStorage, cookieOptions, _a, _b, cookieConfig, cookieStorage, legacyCookies, previousCookies, queryParams, ampTimestamp, isWithinTimeLimit, deviceId, lastEventId, lastEventTime, optOut, sessionId, userId, trackingOptions, pageCounter, debugLogsEnabled, browserConfig;
    var _c;
    var _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6;
    return __generator2(this, function(_7) {
      switch (_7.label) {
        case 0:
          identityStorage = options.identityStorage || DEFAULT_IDENTITY_STORAGE;
          _c = {};
          if (!(identityStorage !== DEFAULT_IDENTITY_STORAGE)) return [3, 1];
          _a = "";
          return [3, 5];
        case 1:
          if (!((_e = (_d = options.cookieOptions) === null || _d === void 0 ? void 0 : _d.domain) !== null && _e !== void 0)) return [3, 2];
          _b = _e;
          return [3, 4];
        case 2:
          return [4, getTopLevelDomain()];
        case 3:
          _b = _7.sent();
          _7.label = 4;
        case 4:
          _a = _b;
          _7.label = 5;
        case 5:
          cookieOptions = __assign3.apply(void 0, [(_c.domain = _a, _c.expiration = 365, _c.sameSite = "Lax", _c.secure = false, _c.upgrade = true, _c), options.cookieOptions]);
          cookieConfig = {
            // if more than one cookie with the same key exists,
            // look for the cookie that has the domain attribute set to cookieOptions.domain
            duplicateResolverFn: function(value) {
              var decodedValue = decodeCookieValue(value);
              if (!decodedValue) {
                return false;
              }
              var parsed = JSON.parse(decodedValue);
              return isDomainEqual(parsed.cookieDomain, cookieOptions.domain);
            },
            diagnosticsClient
          };
          cookieStorage = createCookieStorage(options.identityStorage, cookieOptions, cookieConfig);
          return [4, parseLegacyCookies(apiKey, cookieStorage, (_g = (_f = options.cookieOptions) === null || _f === void 0 ? void 0 : _f.upgrade) !== null && _g !== void 0 ? _g : true)];
        case 6:
          legacyCookies = _7.sent();
          return [4, cookieStorage.get(getCookieName(apiKey))];
        case 7:
          previousCookies = _7.sent();
          queryParams = getQueryParams();
          ampTimestamp = queryParams.ampTimestamp ? Number(queryParams.ampTimestamp) : void 0;
          isWithinTimeLimit = ampTimestamp ? Date.now() < ampTimestamp : true;
          deviceId = (_m = (_l = (_k = (_h = options.deviceId) !== null && _h !== void 0 ? _h : isWithinTimeLimit ? (_j = queryParams.ampDeviceId) !== null && _j !== void 0 ? _j : queryParams.deviceId : void 0) !== null && _k !== void 0 ? _k : previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.deviceId) !== null && _l !== void 0 ? _l : legacyCookies.deviceId) !== null && _m !== void 0 ? _m : UUID();
          lastEventId = (_o = previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.lastEventId) !== null && _o !== void 0 ? _o : legacyCookies.lastEventId;
          lastEventTime = (_p = previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.lastEventTime) !== null && _p !== void 0 ? _p : legacyCookies.lastEventTime;
          optOut = (_r = (_q = options.optOut) !== null && _q !== void 0 ? _q : previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.optOut) !== null && _r !== void 0 ? _r : legacyCookies.optOut;
          sessionId = (_s = previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.sessionId) !== null && _s !== void 0 ? _s : legacyCookies.sessionId;
          userId = (_u = (_t = options.userId) !== null && _t !== void 0 ? _t : previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.userId) !== null && _u !== void 0 ? _u : legacyCookies.userId;
          amplitudeInstance.previousSessionDeviceId = (_v = previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.deviceId) !== null && _v !== void 0 ? _v : legacyCookies.deviceId;
          amplitudeInstance.previousSessionUserId = (_w = previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.userId) !== null && _w !== void 0 ? _w : legacyCookies.userId;
          trackingOptions = {
            ipAddress: (_y = (_x = options.trackingOptions) === null || _x === void 0 ? void 0 : _x.ipAddress) !== null && _y !== void 0 ? _y : true,
            language: (_0 = (_z = options.trackingOptions) === null || _z === void 0 ? void 0 : _z.language) !== null && _0 !== void 0 ? _0 : true,
            platform: (_2 = (_1 = options.trackingOptions) === null || _1 === void 0 ? void 0 : _1.platform) !== null && _2 !== void 0 ? _2 : true
          };
          pageCounter = previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.pageCounter;
          debugLogsEnabled = previousCookies === null || previousCookies === void 0 ? void 0 : previousCookies.debugLogsEnabled;
          if (options.autocapture !== void 0) {
            options.defaultTracking = options.autocapture;
          }
          browserConfig = new BrowserConfig(
            apiKey,
            options.appVersion,
            cookieStorage,
            cookieOptions,
            options.defaultTracking,
            options.autocapture,
            deviceId,
            options.flushIntervalMillis,
            options.flushMaxRetries,
            options.flushQueueSize,
            identityStorage,
            options.ingestionMetadata,
            options.instanceName,
            lastEventId,
            lastEventTime,
            // Use earlyConfig.loggerProvider to ensure consistent logger across DiagnosticsClient/RemoteConfigClient/BrowserConfig
            (_3 = earlyConfig === null || earlyConfig === void 0 ? void 0 : earlyConfig.loggerProvider) !== null && _3 !== void 0 ? _3 : options.loggerProvider,
            options.logLevel,
            options.minIdLength,
            options.offline,
            optOut,
            options.partnerId,
            options.plan,
            options.serverUrl,
            // Use earlyConfig.serverZone to ensure consistent serverZone
            (_4 = earlyConfig === null || earlyConfig === void 0 ? void 0 : earlyConfig.serverZone) !== null && _4 !== void 0 ? _4 : options.serverZone,
            sessionId,
            options.sessionTimeout,
            options.storageProvider,
            trackingOptions,
            options.transport,
            options.useBatch,
            options.fetchRemoteConfig,
            userId,
            pageCounter,
            debugLogsEnabled,
            options.networkTrackingOptions,
            options.identify,
            // Use earlyConfig values (already has remote config applied), otherwise fall back to options
            (_5 = earlyConfig === null || earlyConfig === void 0 ? void 0 : earlyConfig.enableDiagnostics) !== null && _5 !== void 0 ? _5 : options.enableDiagnostics,
            (_6 = earlyConfig === null || earlyConfig === void 0 ? void 0 : earlyConfig.diagnosticsSampleRate) !== null && _6 !== void 0 ? _6 : amplitudeInstance._diagnosticsSampleRate,
            diagnosticsClient,
            options.remoteConfig
          );
          return [4, browserConfig.storageProvider.isEnabled()];
        case 8:
          if (!_7.sent()) {
            browserConfig.loggerProvider.warn("Storage provider ".concat(browserConfig.storageProvider.constructor.name, " is not enabled. Falling back to MemoryStorage."));
            browserConfig.storageProvider = new MemoryStorage();
          }
          return [2, browserConfig];
      }
    });
  });
};
var createCookieStorage = function(identityStorage, cookieOptions, cookieConfig) {
  if (identityStorage === void 0) {
    identityStorage = DEFAULT_IDENTITY_STORAGE;
  }
  if (cookieOptions === void 0) {
    cookieOptions = {};
  }
  switch (identityStorage) {
    case "localStorage":
      return new LocalStorage();
    case "sessionStorage":
      return new SessionStorage();
    case "none":
      return new MemoryStorage();
    case "cookie":
    default:
      return new CookieStorage(__assign3(__assign3({}, cookieOptions), { expirationDays: cookieOptions.expiration }), cookieConfig);
  }
};
var shouldFetchRemoteConfig = function(options) {
  var _a, _b;
  if (options === void 0) {
    options = {};
  }
  if (((_a = options.remoteConfig) === null || _a === void 0 ? void 0 : _a.fetchRemoteConfig) === true) {
    return true;
  } else if (((_b = options.remoteConfig) === null || _b === void 0 ? void 0 : _b.fetchRemoteConfig) === false || options.fetchRemoteConfig === false) {
    return false;
  } else {
    return true;
  }
};
var createTransport = function(transport) {
  var type = typeof transport === "object" ? transport.type : transport;
  var headers = typeof transport === "object" ? transport.headers : void 0;
  if (type === "xhr") {
    return new XHRTransport(headers);
  }
  if (type === "beacon") {
    return new SendBeaconTransport();
  }
  return new FetchTransport(headers);
};
var getTopLevelDomain = function(url) {
  return __awaiter2(void 0, void 0, void 0, function() {
    var host, parts, levels, cookieKeyUniqueId, storageKey, i2, i2, domain, options, storage, value;
    return __generator2(this, function(_a) {
      switch (_a.label) {
        case 0:
          return [4, new CookieStorage().isEnabled()];
        case 1:
          if (!_a.sent() || !url && (typeof location === "undefined" || !location.hostname)) {
            return [2, ""];
          }
          host = url !== null && url !== void 0 ? url : location.hostname;
          parts = host.split(".");
          levels = [];
          cookieKeyUniqueId = UUID();
          storageKey = "AMP_TLDTEST_".concat(cookieKeyUniqueId.substring(0, 8));
          for (i2 = parts.length - 2; i2 >= 0; --i2) {
            levels.push(parts.slice(i2).join("."));
          }
          i2 = 0;
          _a.label = 2;
        case 2:
          if (!(i2 < levels.length)) return [3, 7];
          domain = levels[i2];
          options = {
            domain: "." + domain,
            expirationDays: 3e-3
            // expire in ~5 minutes
          };
          storage = new CookieStorage(options);
          return [4, storage.set(storageKey, 1)];
        case 3:
          _a.sent();
          return [4, storage.get(storageKey)];
        case 4:
          value = _a.sent();
          if (!value) return [3, 6];
          return [4, storage.remove(storageKey)];
        case 5:
          _a.sent();
          return [2, "." + domain];
        case 6:
          i2++;
          return [3, 2];
        case 7:
          return [2, ""];
      }
    });
  });
};

// node_modules/@amplitude/plugin-page-view-tracking-browser/node_modules/tslib/tslib.es6.mjs
var __assign4 = function() {
  __assign4 = Object.assign || function __assign7(t2) {
    for (var s2, i2 = 1, n2 = arguments.length; i2 < n2; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2)) t2[p2] = s2[p2];
    }
    return t2;
  };
  return __assign4.apply(this, arguments);
};
function __awaiter3(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e2) {
        reject(e2);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e2) {
        reject(e2);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator3(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t2[0] & 1) throw t2[1];
    return t2[1];
  }, trys: [], ops: [] }, f2, y2, t2, g2 = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
  return g2.next = verb(0), g2["throw"] = verb(1), g2["return"] = verb(2), typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n2) {
    return function(v2) {
      return step([n2, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t2 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t2 = y2["return"]) && t2.call(y2), 0) : y2.next) && !(t2 = t2.call(y2, op[1])).done) return t2;
      if (y2 = 0, t2) op = [op[0] & 2, t2.value];
      switch (op[0]) {
        case 0:
        case 1:
          t2 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t2 = _2.trys, t2 = t2.length > 0 && t2[t2.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t2 || op[1] > t2[0] && op[1] < t2[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t2[1]) {
            _2.label = t2[1];
            t2 = op;
            break;
          }
          if (t2 && _2.label < t2[2]) {
            _2.label = t2[2];
            _2.ops.push(op);
            break;
          }
          if (t2[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e2) {
      op = [6, e2];
      y2 = 0;
    } finally {
      f2 = t2 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}
function __read4(o2, n2) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r2, ar = [], e2;
  try {
    while ((n2 === void 0 || n2-- > 0) && !(r2 = i2.next()).done) ar.push(r2.value);
  } catch (error) {
    e2 = { error };
  } finally {
    try {
      if (r2 && !r2.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e2) throw e2.error;
    }
  }
  return ar;
}
function __spreadArray3(to, from, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from.length, ar; i2 < l2; i2++) {
    if (ar || !(i2 in from)) {
      if (!ar) ar = Array.prototype.slice.call(from, 0, i2);
      ar[i2] = from[i2];
    }
  }
  return to.concat(ar || Array.prototype.slice.call(from));
}

// node_modules/@amplitude/plugin-page-view-tracking-browser/lib/esm/utils.js
var omitUndefined = function(input) {
  var obj = {};
  for (var key in input) {
    var val = input[key];
    if (val) {
      obj[key] = val;
    }
  }
  return obj;
};

// node_modules/@amplitude/plugin-page-view-tracking-browser/lib/esm/page-view-tracking.js
var defaultPageViewEvent = "[Amplitude] Page Viewed";
var pageViewTrackingPlugin = function(options) {
  if (options === void 0) {
    options = {};
  }
  var amplitude;
  var globalScope3 = getGlobalScope();
  var loggerProvider = void 0;
  var isTracking = false;
  var localConfig;
  var trackOn = options.trackOn, trackHistoryChanges = options.trackHistoryChanges, _a = options.eventType, eventType = _a === void 0 ? defaultPageViewEvent : _a;
  var getDecodeURI2 = function(locationStr) {
    var decodedLocationStr = locationStr;
    try {
      decodedLocationStr = decodeURI(locationStr);
    } catch (e2) {
      loggerProvider === null || loggerProvider === void 0 ? void 0 : loggerProvider.error("Malformed URI sequence: ", e2);
    }
    return decodedLocationStr;
  };
  var createPageViewEvent = function() {
    return __awaiter3(void 0, void 0, void 0, function() {
      var locationHREF, _a2;
      var _b;
      return __generator3(this, function(_c) {
        switch (_c.label) {
          case 0:
            locationHREF = getDecodeURI2(typeof location !== "undefined" && location.href || "");
            _b = {
              event_type: eventType
            };
            _a2 = [{}];
            return [4, getCampaignParams()];
          case 1:
            return [2, (_b.event_properties = __assign4.apply(void 0, [__assign4.apply(void 0, _a2.concat([_c.sent()])), { "[Amplitude] Page Domain": (
              /* istanbul ignore next */
              typeof location !== "undefined" && location.hostname || ""
            ), "[Amplitude] Page Location": locationHREF, "[Amplitude] Page Path": (
              /* istanbul ignore next */
              typeof location !== "undefined" && getDecodeURI2(location.pathname) || ""
            ), "[Amplitude] Page Title": (
              /* istanbul ignore next */
              getPageTitle(replaceSensitiveString)
            ), "[Amplitude] Page URL": locationHREF.split("?")[0] }]), _b)];
        }
      });
    });
  };
  var shouldTrackOnPageLoad = function() {
    return typeof trackOn === "undefined" || typeof trackOn === "function" && trackOn();
  };
  var previousURL = typeof location !== "undefined" ? location.href : null;
  var trackHistoryPageView = function() {
    return __awaiter3(void 0, void 0, void 0, function() {
      var newURL, shouldTrackPageView, _a2, _b, _c;
      return __generator3(this, function(_d) {
        switch (_d.label) {
          case 0:
            newURL = location.href;
            shouldTrackPageView = shouldTrackHistoryPageView(trackHistoryChanges, newURL, previousURL || "") && shouldTrackOnPageLoad();
            previousURL = newURL;
            if (!shouldTrackPageView) return [3, 4];
            loggerProvider === null || loggerProvider === void 0 ? void 0 : loggerProvider.log("Tracking page view event");
            if (!(amplitude === null || amplitude === void 0)) return [3, 1];
            _a2 = void 0;
            return [3, 3];
          case 1:
            _c = (_b = amplitude).track;
            return [4, createPageViewEvent()];
          case 2:
            _a2 = _c.apply(_b, [_d.sent()]);
            _d.label = 3;
          case 3:
            _a2;
            _d.label = 4;
          case 4:
            return [
              2
              /*return*/
            ];
        }
      });
    });
  };
  var trackHistoryPageViewWrapper = function() {
    void trackHistoryPageView();
  };
  var plugin = {
    name: "@amplitude/plugin-page-view-tracking-browser",
    type: "enrichment",
    setup: function(config, client) {
      return __awaiter3(void 0, void 0, void 0, function() {
        var _a2, _b;
        return __generator3(this, function(_c) {
          switch (_c.label) {
            case 0:
              amplitude = client;
              localConfig = config;
              loggerProvider = config.loggerProvider;
              loggerProvider.log("Installing @amplitude/plugin-page-view-tracking-browser");
              isTracking = true;
              if (globalScope3) {
                globalScope3.addEventListener("popstate", trackHistoryPageViewWrapper);
                globalScope3.history.pushState = new Proxy(globalScope3.history.pushState, {
                  apply: function(target, thisArg, _a3) {
                    var _b2 = __read4(_a3, 3), state = _b2[0], unused = _b2[1], url = _b2[2];
                    target.apply(thisArg, [state, unused, url]);
                    if (isTracking) {
                      void trackHistoryPageView();
                    }
                  }
                });
              }
              if (!shouldTrackOnPageLoad()) return [3, 2];
              loggerProvider.log("Tracking page view event");
              _b = (_a2 = amplitude).track;
              return [4, createPageViewEvent()];
            case 1:
              _b.apply(_a2, [_c.sent()]);
              _c.label = 2;
            case 2:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    },
    execute: function(event) {
      return __awaiter3(void 0, void 0, void 0, function() {
        var pageViewEvent;
        return __generator3(this, function(_a2) {
          switch (_a2.label) {
            case 0:
              if (!(trackOn === "attribution" && isCampaignEvent(event))) return [3, 2];
              loggerProvider === null || loggerProvider === void 0 ? void 0 : loggerProvider.log("Enriching campaign event to page view event with campaign parameters");
              return [4, createPageViewEvent()];
            case 1:
              pageViewEvent = _a2.sent();
              event.event_type = pageViewEvent.event_type;
              event.event_properties = __assign4(__assign4({}, event.event_properties), pageViewEvent.event_properties);
              _a2.label = 2;
            case 2:
              if (localConfig && event.event_type === eventType) {
                localConfig.pageCounter = !localConfig.pageCounter ? 1 : localConfig.pageCounter + 1;
                event.event_properties = __assign4(__assign4({}, event.event_properties), { "[Amplitude] Page Counter": localConfig.pageCounter });
              }
              return [2, event];
          }
        });
      });
    },
    teardown: function() {
      return __awaiter3(void 0, void 0, void 0, function() {
        return __generator3(this, function(_a2) {
          if (globalScope3) {
            globalScope3.removeEventListener("popstate", trackHistoryPageViewWrapper);
            isTracking = false;
          }
          return [
            2
            /*return*/
          ];
        });
      });
    }
  };
  return plugin;
};
var getCampaignParams = function() {
  return __awaiter3(void 0, void 0, void 0, function() {
    var _a;
    return __generator3(this, function(_b) {
      switch (_b.label) {
        case 0:
          _a = omitUndefined;
          return [4, new CampaignParser().parse()];
        case 1:
          return [2, _a.apply(void 0, [_b.sent()])];
      }
    });
  });
};
var isCampaignEvent = function(event) {
  if (event.event_type === "$identify" && event.user_properties) {
    var properties = event.user_properties;
    var $set = properties[IdentifyOperation.SET] || {};
    var $unset = properties[IdentifyOperation.UNSET] || {};
    var userProperties_1 = __spreadArray3(__spreadArray3([], __read4(Object.keys($set)), false), __read4(Object.keys($unset)), false);
    return Object.keys(BASE_CAMPAIGN).every(function(value) {
      return userProperties_1.includes(value);
    });
  }
  return false;
};
var shouldTrackHistoryPageView = function(trackingOption, newURLStr, oldURLStr) {
  switch (trackingOption) {
    case "pathOnly": {
      if (oldURLStr == "")
        return true;
      var newURL = new URL(newURLStr);
      var oldURL = new URL(oldURLStr);
      var newBaseStr = newURL.origin + newURL.pathname;
      var oldBaseStr = oldURL.origin + oldURL.pathname;
      return newBaseStr !== oldBaseStr;
    }
    default:
      return newURLStr !== oldURLStr;
  }
};

// node_modules/@amplitude/analytics-browser/lib/esm/plugins/form-interaction-tracking.js
var formInteractionTracking = function() {
  var observer;
  var eventListeners = [];
  var addEventListener2 = function(element, type2, handler) {
    element.addEventListener(type2, handler);
    eventListeners.push({
      element,
      type: type2,
      handler
    });
  };
  var removeClickListeners = function() {
    eventListeners.forEach(function(_a) {
      var element = _a.element, type2 = _a.type, handler = _a.handler;
      element === null || element === void 0 ? void 0 : element.removeEventListener(type2, handler);
    });
    eventListeners = [];
  };
  var formInteractionsConfig;
  var name = "@amplitude/plugin-form-interaction-tracking-browser";
  var type = "enrichment";
  var setup = function(config, amplitude) {
    return __awaiter2(void 0, void 0, void 0, function() {
      var initializeFormTracking, window_1;
      return __generator2(this, function(_a) {
        formInteractionsConfig = getFormInteractionsConfig(config);
        initializeFormTracking = function() {
          if (!amplitude) {
            config.loggerProvider.warn("Form interaction tracking requires a later version of @amplitude/analytics-browser. Form interaction events are not tracked.");
            return;
          }
          if (typeof document === "undefined") {
            return;
          }
          var addFormInteractionListener = function(form) {
            var hasFormChanged = false;
            addEventListener2(form, "change", function() {
              var _a2;
              var formDestination = extractFormAction(form);
              if (!hasFormChanged) {
                amplitude.track(DEFAULT_FORM_START_EVENT, (_a2 = {}, _a2[FORM_ID] = stringOrUndefined(form.id), _a2[FORM_NAME] = stringOrUndefined(form.name), _a2[FORM_DESTINATION] = formDestination, _a2));
              }
              hasFormChanged = true;
            });
            addEventListener2(form, "submit", function(event) {
              var _a2, _b;
              var formDestination = extractFormAction(form);
              if (!hasFormChanged) {
                amplitude.track(DEFAULT_FORM_START_EVENT, (_a2 = {}, _a2[FORM_ID] = stringOrUndefined(form.id), _a2[FORM_NAME] = stringOrUndefined(form.name), _a2[FORM_DESTINATION] = formDestination, _a2));
              }
              hasFormChanged = true;
              if ((formInteractionsConfig === null || formInteractionsConfig === void 0 ? void 0 : formInteractionsConfig.shouldTrackSubmit) !== void 0) {
                if (typeof formInteractionsConfig.shouldTrackSubmit === "function" && typeof SubmitEvent !== "undefined" && event instanceof SubmitEvent) {
                  try {
                    var shouldTrack = formInteractionsConfig.shouldTrackSubmit(event);
                    if (!shouldTrack) {
                      return;
                    }
                  } catch (e2) {
                    config.loggerProvider.warn("shouldTrackSubmit callback threw an error, proceeding with tracking.");
                  }
                } else {
                  config.loggerProvider.warn("shouldTrackSubmit is ignored because it is not a function or event is not a SubmitEvent.");
                }
              }
              amplitude.track(DEFAULT_FORM_SUBMIT_EVENT, (_b = {}, _b[FORM_ID] = stringOrUndefined(form.id), _b[FORM_NAME] = stringOrUndefined(form.name), _b[FORM_DESTINATION] = formDestination, _b));
              hasFormChanged = false;
            });
          };
          var forms = Array.from(document.getElementsByTagName("form"));
          forms.forEach(addFormInteractionListener);
          if (typeof MutationObserver !== "undefined") {
            observer = new MutationObserver(function(mutations) {
              mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                  if (node.nodeName === "FORM") {
                    addFormInteractionListener(node);
                  }
                  if ("querySelectorAll" in node && typeof node.querySelectorAll === "function") {
                    Array.from(node.querySelectorAll("form")).map(addFormInteractionListener);
                  }
                });
              });
            });
            observer.observe(document.body, {
              subtree: true,
              childList: true
            });
          }
        };
        if (document.readyState === "complete") {
          initializeFormTracking();
        } else {
          window_1 = getGlobalScope();
          if (window_1) {
            window_1.addEventListener("load", initializeFormTracking);
          } else {
            config.loggerProvider.debug("Form interaction tracking is not installed because global is undefined.");
          }
        }
        return [
          2
          /*return*/
        ];
      });
    });
  };
  var execute = function(event) {
    return __awaiter2(void 0, void 0, void 0, function() {
      return __generator2(this, function(_a) {
        return [2, event];
      });
    });
  };
  var teardown = function() {
    return __awaiter2(void 0, void 0, void 0, function() {
      return __generator2(this, function(_a) {
        observer === null || observer === void 0 ? void 0 : observer.disconnect();
        removeClickListeners();
        return [
          2
          /*return*/
        ];
      });
    });
  };
  return {
    name,
    type,
    setup,
    execute,
    teardown
  };
};
var stringOrUndefined = function(name) {
  if (typeof name !== "string") {
    return void 0;
  }
  return name;
};
var extractFormAction = function(form) {
  var formDestination = form.getAttribute("action");
  try {
    formDestination = new URL(encodeURI(formDestination !== null && formDestination !== void 0 ? formDestination : ""), window.location.href).href;
  } catch (_a) {
  }
  return formDestination;
};

// node_modules/@amplitude/analytics-browser/lib/esm/plugins/file-download-tracking.js
var fileDownloadTracking = function() {
  var observer;
  var eventListeners = [];
  var addEventListener2 = function(element, type2, handler) {
    element.addEventListener(type2, handler);
    eventListeners.push({
      element,
      type: type2,
      handler
    });
  };
  var removeClickListeners = function() {
    eventListeners.forEach(function(_a) {
      var element = _a.element, type2 = _a.type, handler = _a.handler;
      element === null || element === void 0 ? void 0 : element.removeEventListener(type2, handler);
    });
    eventListeners = [];
  };
  var name = "@amplitude/plugin-file-download-tracking-browser";
  var type = "enrichment";
  var setup = function(config, amplitude) {
    return __awaiter2(void 0, void 0, void 0, function() {
      var initializeFileDownloadTracking, window_1;
      return __generator2(this, function(_a) {
        initializeFileDownloadTracking = function() {
          if (!amplitude) {
            config.loggerProvider.warn("File download tracking requires a later version of @amplitude/analytics-browser. File download events are not tracked.");
            return;
          }
          if (typeof document === "undefined") {
            return;
          }
          var addFileDownloadListener = function(a2) {
            var url;
            try {
              url = new URL(a2.href, window.location.href);
            } catch (_a2) {
              return;
            }
            var result = ext.exec(url.href);
            var fileExtension = result === null || result === void 0 ? void 0 : result[1];
            if (fileExtension) {
              addEventListener2(a2, "click", function() {
                var _a2;
                if (fileExtension) {
                  amplitude.track(DEFAULT_FILE_DOWNLOAD_EVENT, (_a2 = {}, _a2[FILE_EXTENSION] = fileExtension, _a2[FILE_NAME] = url.pathname, _a2[LINK_ID] = a2.id, _a2[LINK_TEXT] = a2.text, _a2[LINK_URL] = a2.href, _a2));
                }
              });
            }
          };
          var ext = /\.(pdf|xlsx?|docx?|txt|rtf|csv|exe|key|pp(s|t|tx)|7z|pkg|rar|gz|zip|avi|mov|mp4|mpe?g|wmv|midi?|mp3|wav|wma)(\?.+)?$/;
          var links = Array.from(document.getElementsByTagName("a"));
          links.forEach(addFileDownloadListener);
          if (typeof MutationObserver !== "undefined") {
            observer = new MutationObserver(function(mutations) {
              mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                  if (node.nodeName === "A") {
                    addFileDownloadListener(node);
                  }
                  if ("querySelectorAll" in node && typeof node.querySelectorAll === "function") {
                    Array.from(node.querySelectorAll("a")).map(addFileDownloadListener);
                  }
                });
              });
            });
            observer.observe(document.body, {
              subtree: true,
              childList: true
            });
          }
        };
        if (document.readyState === "complete") {
          initializeFileDownloadTracking();
        } else {
          window_1 = getGlobalScope();
          if (window_1) {
            window_1.addEventListener("load", initializeFileDownloadTracking);
          } else {
            config.loggerProvider.debug("File download tracking is not installed because global is undefined.");
          }
        }
        return [
          2
          /*return*/
        ];
      });
    });
  };
  var execute = function(event) {
    return __awaiter2(void 0, void 0, void 0, function() {
      return __generator2(this, function(_a) {
        return [2, event];
      });
    });
  };
  var teardown = function() {
    return __awaiter2(void 0, void 0, void 0, function() {
      return __generator2(this, function(_a) {
        observer === null || observer === void 0 ? void 0 : observer.disconnect();
        removeClickListeners();
        return [
          2
          /*return*/
        ];
      });
    });
  };
  return {
    name,
    type,
    setup,
    execute,
    teardown
  };
};

// node_modules/@amplitude/analytics-browser/lib/esm/det-notification.js
var notified = false;
var detNotify = function(config) {
  if (notified || config.defaultTracking !== void 0) {
    return;
  }
  var message = "`options.defaultTracking` is set to undefined. This implicitly configures your Amplitude instance to track Page Views, Sessions, File Downloads, and Form Interactions. You can suppress this warning by explicitly setting a value to `options.defaultTracking`. The value must either be a boolean, to enable and disable all default events, or an object, for advanced configuration. For example:\n\namplitude.init(<YOUR_API_KEY>, {\n  defaultTracking: true,\n});\n\nVisit https://www.docs.developers.amplitude.com/data/sdks/browser-2/#tracking-default-events for more details.";
  config.loggerProvider.warn(message);
  notified = true;
};

// node_modules/@amplitude/analytics-browser/lib/esm/plugins/network-connectivity-checker.js
var networkConnectivityCheckerPlugin = function() {
  var name = "@amplitude/plugin-network-checker-browser";
  var type = "before";
  var globalScope3 = getGlobalScope();
  var eventListeners = [];
  var addNetworkListener = function(type2, handler) {
    if (globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.addEventListener) {
      globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.addEventListener(type2, handler);
      eventListeners.push({
        type: type2,
        handler
      });
    }
  };
  var removeNetworkListeners = function() {
    eventListeners.forEach(function(_a) {
      var type2 = _a.type, handler = _a.handler;
      globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.removeEventListener(type2, handler);
    });
    eventListeners = [];
  };
  var setup = function(config, amplitude) {
    return __awaiter2(void 0, void 0, void 0, function() {
      return __generator2(this, function(_a) {
        if (typeof navigator === "undefined") {
          config.loggerProvider.debug("Network connectivity checker plugin is disabled because navigator is not available.");
          config.offline = false;
          return [
            2
            /*return*/
          ];
        }
        config.offline = !navigator.onLine;
        addNetworkListener("online", function() {
          config.loggerProvider.debug("Network connectivity changed to online.");
          config.offline = false;
          setTimeout(function() {
            amplitude.flush();
          }, config.flushIntervalMillis);
        });
        addNetworkListener("offline", function() {
          config.loggerProvider.debug("Network connectivity changed to offline.");
          config.offline = true;
        });
        return [
          2
          /*return*/
        ];
      });
    });
  };
  var teardown = function() {
    return __awaiter2(void 0, void 0, void 0, function() {
      return __generator2(this, function(_a) {
        removeNetworkListeners();
        return [
          2
          /*return*/
        ];
      });
    });
  };
  return {
    name,
    type,
    setup,
    teardown
  };
};

// node_modules/@amplitude/analytics-browser/lib/esm/config/joined-config.js
function translateRemoteConfigToLocal(config) {
  var e_1, _a, e_2, _b, e_3, _c;
  var _d, _e, _f, _g, _h;
  if (typeof config !== "object" || config === null) {
    return;
  }
  if (Array.isArray(config)) {
    return;
  }
  var propertyNames = Object.keys(config);
  try {
    for (var propertyNames_1 = __values3(propertyNames), propertyNames_1_1 = propertyNames_1.next(); !propertyNames_1_1.done; propertyNames_1_1 = propertyNames_1.next()) {
      var propertyName = propertyNames_1_1.value;
      try {
        var value = config[propertyName];
        if (typeof (value === null || value === void 0 ? void 0 : value.enabled) === "boolean") {
          if (value.enabled) {
            delete value.enabled;
            if (Object.keys(value).length === 0) {
              config[propertyName] = true;
            }
          } else {
            config[propertyName] = false;
          }
        }
        translateRemoteConfigToLocal(value);
      } catch (e2) {
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (propertyNames_1_1 && !propertyNames_1_1.done && (_a = propertyNames_1.return)) _a.call(propertyNames_1);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
  try {
    if ((_f = (_e = (_d = config.autocapture) === null || _d === void 0 ? void 0 : _d.networkTracking) === null || _e === void 0 ? void 0 : _e.captureRules) === null || _f === void 0 ? void 0 : _f.length) {
      try {
        for (var _j = __values3(config.autocapture.networkTracking.captureRules), _k = _j.next(); !_k.done; _k = _j.next()) {
          var rule = _k.value;
          try {
            for (var _l = (e_3 = void 0, __values3(["responseHeaders", "requestHeaders"])), _m = _l.next(); !_m.done; _m = _l.next()) {
              var header = _m.value;
              var _o = (_g = rule[header]) !== null && _g !== void 0 ? _g : {}, captureSafeHeaders = _o.captureSafeHeaders, allowlist = _o.allowlist;
              if (!captureSafeHeaders && !allowlist) {
                continue;
              }
              if (allowlist !== void 0 && !Array.isArray(allowlist)) {
                delete rule[header];
                continue;
              }
              rule[header] = __spreadArray2(__spreadArray2([], __read3(captureSafeHeaders ? SAFE_HEADERS : []), false), __read3(allowlist !== null && allowlist !== void 0 ? allowlist : []), false);
            }
          } catch (e_3_1) {
            e_3 = { error: e_3_1 };
          } finally {
            try {
              if (_m && !_m.done && (_c = _l.return)) _c.call(_l);
            } finally {
              if (e_3) throw e_3.error;
            }
          }
        }
      } catch (e_2_1) {
        e_2 = { error: e_2_1 };
      } finally {
        try {
          if (_k && !_k.done && (_b = _j.return)) _b.call(_j);
        } finally {
          if (e_2) throw e_2.error;
        }
      }
    }
  } catch (e2) {
  }
  var frustrationInteractions = (_h = config.autocapture) === null || _h === void 0 ? void 0 : _h.frustrationInteractions;
  if (frustrationInteractions) {
    if (frustrationInteractions.rageClick) {
      frustrationInteractions.rageClicks = frustrationInteractions.rageClick;
      delete frustrationInteractions.rageClick;
    }
    if (frustrationInteractions.deadClick) {
      frustrationInteractions.deadClicks = frustrationInteractions.deadClick;
      delete frustrationInteractions.deadClick;
    }
  }
}
function mergeUrls(urlsExact, urlsRegex, browserConfig) {
  var e_4, _a;
  var regexList = [];
  try {
    for (var _b = __values3(urlsRegex !== null && urlsRegex !== void 0 ? urlsRegex : []), _c = _b.next(); !_c.done; _c = _b.next()) {
      var pattern = _c.value;
      try {
        regexList.push(new RegExp(pattern));
      } catch (regexError) {
        browserConfig.loggerProvider.warn("Invalid regex pattern: ".concat(pattern), regexError);
      }
    }
  } catch (e_4_1) {
    e_4 = { error: e_4_1 };
  } finally {
    try {
      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
    } finally {
      if (e_4) throw e_4.error;
    }
  }
  return urlsExact.concat(regexList);
}
function updateBrowserConfigWithRemoteConfig(remoteConfig, browserConfig) {
  var e_5, _a;
  var _b, _c, _d, _e, _f;
  if (!remoteConfig) {
    return;
  }
  translateRemoteConfigToLocal(remoteConfig);
  try {
    browserConfig.loggerProvider.debug("Update browser config with remote configuration:", JSON.stringify(remoteConfig));
    var typedRemoteConfig = remoteConfig;
    if (typedRemoteConfig && "autocapture" in typedRemoteConfig) {
      if (typeof typedRemoteConfig.autocapture === "boolean") {
        browserConfig.autocapture = typedRemoteConfig.autocapture;
      }
      if (typeof typedRemoteConfig.autocapture === "object" && typedRemoteConfig.autocapture !== null) {
        var transformedAutocaptureRemoteConfig = __assign3({}, typedRemoteConfig.autocapture);
        if (browserConfig.autocapture === void 0) {
          browserConfig.autocapture = typedRemoteConfig.autocapture;
        }
        if (typeof typedRemoteConfig.autocapture.elementInteractions === "object" && typedRemoteConfig.autocapture.elementInteractions !== null && ((_b = typedRemoteConfig.autocapture.elementInteractions.pageUrlAllowlistRegex) === null || _b === void 0 ? void 0 : _b.length)) {
          transformedAutocaptureRemoteConfig.elementInteractions = __assign3({}, typedRemoteConfig.autocapture.elementInteractions);
          var transformedRcElementInteractions = transformedAutocaptureRemoteConfig.elementInteractions;
          var exactAllowList = (_c = transformedRcElementInteractions.pageUrlAllowlist) !== null && _c !== void 0 ? _c : [];
          var urlsRegex = typedRemoteConfig.autocapture.elementInteractions.pageUrlAllowlistRegex;
          transformedRcElementInteractions.pageUrlAllowlist = mergeUrls(exactAllowList, urlsRegex, browserConfig);
          delete transformedRcElementInteractions.pageUrlAllowlistRegex;
        }
        if (typeof typedRemoteConfig.autocapture.networkTracking === "object" && typedRemoteConfig.autocapture.networkTracking !== null && ((_d = typedRemoteConfig.autocapture.networkTracking.captureRules) === null || _d === void 0 ? void 0 : _d.length)) {
          transformedAutocaptureRemoteConfig.networkTracking = __assign3({}, typedRemoteConfig.autocapture.networkTracking);
          var transformedRcNetworkTracking = transformedAutocaptureRemoteConfig.networkTracking;
          var captureRules = (_e = transformedRcNetworkTracking.captureRules) !== null && _e !== void 0 ? _e : [];
          try {
            for (var captureRules_1 = __values3(captureRules), captureRules_1_1 = captureRules_1.next(); !captureRules_1_1.done; captureRules_1_1 = captureRules_1.next()) {
              var rule = captureRules_1_1.value;
              rule.urls = mergeUrls((_f = rule.urls) !== null && _f !== void 0 ? _f : [], rule.urlsRegex, browserConfig);
              delete rule.urlsRegex;
            }
          } catch (e_5_1) {
            e_5 = { error: e_5_1 };
          } finally {
            try {
              if (captureRules_1_1 && !captureRules_1_1.done && (_a = captureRules_1.return)) _a.call(captureRules_1);
            } finally {
              if (e_5) throw e_5.error;
            }
          }
        }
        if (typeof browserConfig.autocapture === "boolean") {
          browserConfig.autocapture = __assign3({ attribution: browserConfig.autocapture, fileDownloads: browserConfig.autocapture, formInteractions: browserConfig.autocapture, pageViews: browserConfig.autocapture, sessions: browserConfig.autocapture, elementInteractions: browserConfig.autocapture, webVitals: browserConfig.autocapture, frustrationInteractions: browserConfig.autocapture }, transformedAutocaptureRemoteConfig);
        }
        if (typeof browserConfig.autocapture === "object") {
          browserConfig.autocapture = __assign3(__assign3({}, browserConfig.autocapture), transformedAutocaptureRemoteConfig);
        }
      }
      browserConfig.defaultTracking = browserConfig.autocapture;
    }
    browserConfig.loggerProvider.debug("Browser config after remote config update:", JSON.stringify(browserConfig));
  } catch (e2) {
    browserConfig.loggerProvider.error("Failed to apply remote configuration because of error: ", e2);
  }
}

// node_modules/@amplitude/plugin-autocapture-browser/node_modules/tslib/tslib.es6.mjs
var __assign5 = function() {
  __assign5 = Object.assign || function __assign7(t2) {
    for (var s2, i2 = 1, n2 = arguments.length; i2 < n2; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2)) t2[p2] = s2[p2];
    }
    return t2;
  };
  return __assign5.apply(this, arguments);
};
function __awaiter4(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e2) {
        reject(e2);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e2) {
        reject(e2);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator4(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t2[0] & 1) throw t2[1];
    return t2[1];
  }, trys: [], ops: [] }, f2, y2, t2, g2 = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
  return g2.next = verb(0), g2["throw"] = verb(1), g2["return"] = verb(2), typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n2) {
    return function(v2) {
      return step([n2, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t2 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t2 = y2["return"]) && t2.call(y2), 0) : y2.next) && !(t2 = t2.call(y2, op[1])).done) return t2;
      if (y2 = 0, t2) op = [op[0] & 2, t2.value];
      switch (op[0]) {
        case 0:
        case 1:
          t2 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t2 = _2.trys, t2 = t2.length > 0 && t2[t2.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t2 || op[1] > t2[0] && op[1] < t2[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t2[1]) {
            _2.label = t2[1];
            t2 = op;
            break;
          }
          if (t2 && _2.label < t2[2]) {
            _2.label = t2[2];
            _2.ops.push(op);
            break;
          }
          if (t2[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e2) {
      op = [6, e2];
      y2 = 0;
    } finally {
      f2 = t2 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}
function __values4(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
function __read5(o2, n2) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r2, ar = [], e2;
  try {
    while ((n2 === void 0 || n2-- > 0) && !(r2 = i2.next()).done) ar.push(r2.value);
  } catch (error) {
    e2 = { error };
  } finally {
    try {
      if (r2 && !r2.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e2) throw e2.error;
    }
  }
  return ar;
}
function __spreadArray4(to, from, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from.length, ar; i2 < l2; i2++) {
    if (ar || !(i2 in from)) {
      if (!ar) ar = Array.prototype.slice.call(from, 0, i2);
      ar[i2] = from[i2];
    }
  }
  return to.concat(ar || Array.prototype.slice.call(from));
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/version.js
var VERSION2 = "1.19.0";

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/constants.js
var PLUGIN_NAME = "@amplitude/plugin-autocapture-browser";
var FRUSTRATION_PLUGIN_NAME = "@amplitude/plugin-frustration-browser";
var AMPLITUDE_ELEMENT_CLICKED_EVENT = "[Amplitude] Element Clicked";
var AMPLITUDE_ELEMENT_DEAD_CLICKED_EVENT = "[Amplitude] Dead Click";
var AMPLITUDE_ELEMENT_RAGE_CLICKED_EVENT = "[Amplitude] Rage Click";
var AMPLITUDE_ELEMENT_ERROR_CLICKED_EVENT = "[Amplitude] Error Click";
var AMPLITUDE_ELEMENT_CHANGED_EVENT = "[Amplitude] Element Changed";
var AMPLITUDE_EVENT_PROP_ELEMENT_ID = "[Amplitude] Element ID";
var AMPLITUDE_EVENT_PROP_ELEMENT_CLASS = "[Amplitude] Element Class";
var AMPLITUDE_EVENT_PROP_ELEMENT_TAG = "[Amplitude] Element Tag";
var AMPLITUDE_EVENT_PROP_ELEMENT_TEXT = "[Amplitude] Element Text";
var AMPLITUDE_EVENT_PROP_ELEMENT_HIERARCHY = "[Amplitude] Element Hierarchy";
var AMPLITUDE_EVENT_PROP_ELEMENT_HREF = "[Amplitude] Element Href";
var AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_LEFT = "[Amplitude] Element Position Left";
var AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_TOP = "[Amplitude] Element Position Top";
var AMPLITUDE_EVENT_PROP_ELEMENT_ARIA_LABEL = "[Amplitude] Element Aria Label";
var AMPLITUDE_EVENT_PROP_ELEMENT_ATTRIBUTES = "[Amplitude] Element Attributes";
var AMPLITUDE_EVENT_PROP_ELEMENT_PARENT_LABEL = "[Amplitude] Element Parent Label";
var AMPLITUDE_EVENT_PROP_PAGE_URL = "[Amplitude] Page URL";
var AMPLITUDE_EVENT_PROP_PAGE_TITLE = "[Amplitude] Page Title";
var AMPLITUDE_EVENT_PROP_VIEWPORT_HEIGHT = "[Amplitude] Viewport Height";
var AMPLITUDE_EVENT_PROP_VIEWPORT_WIDTH = "[Amplitude] Viewport Width";
var AMPLITUDE_ORIGIN = "https://app.amplitude.com";
var AMPLITUDE_ORIGIN_EU = "https://app.eu.amplitude.com";
var AMPLITUDE_ORIGIN_STAGING = "https://apps.stag2.amplitude.com";
var AMPLITUDE_ORIGINS_MAP = {
  US: AMPLITUDE_ORIGIN,
  EU: AMPLITUDE_ORIGIN_EU,
  STAGING: AMPLITUDE_ORIGIN_STAGING
};
var AMPLITUDE_VISUAL_TAGGING_SELECTOR_SCRIPT_URL = "https://cdn.amplitude.com/libs/visual-tagging-selector-1.0.0-alpha.js.gz";
var AMPLITUDE_VISUAL_TAGGING_HIGHLIGHT_CLASS = "amp-visual-tagging-selector-highlight";
var DATA_AMP_MASK_ATTRIBUTES = "data-amp-mask-attributes";
var MAX_MASK_TEXT_PATTERNS = 25;
var MAX_ATTRIBUTE_LENGTH = 128;

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/helpers.js
var SENSITIVE_TAGS = ["input", "select", "textarea"];
var isElementPointerCursor = function(element, actionType) {
  var _a;
  var computedStyle = (_a = window === null || window === void 0 ? void 0 : window.getComputedStyle) === null || _a === void 0 ? void 0 : _a.call(window, element);
  return (computedStyle === null || computedStyle === void 0 ? void 0 : computedStyle.getPropertyValue("cursor")) === "pointer" && actionType === "click";
};
var createShouldTrackEvent = function(autocaptureOptions, allowlist, isAlwaysCaptureCursorPointer) {
  if (isAlwaysCaptureCursorPointer === void 0) {
    isAlwaysCaptureCursorPointer = false;
  }
  return function(actionType, element) {
    var _a, _b;
    var pageUrlAllowlist = autocaptureOptions.pageUrlAllowlist, pageUrlExcludelist = autocaptureOptions.pageUrlExcludelist, shouldTrackEventResolver = autocaptureOptions.shouldTrackEventResolver;
    var tag = (_b = (_a = element === null || element === void 0 ? void 0 : element.tagName) === null || _a === void 0 ? void 0 : _a.toLowerCase) === null || _b === void 0 ? void 0 : _b.call(_a);
    if (!tag) {
      return false;
    }
    if (shouldTrackEventResolver) {
      return shouldTrackEventResolver(actionType, element);
    }
    if (!isUrlMatchAllowlist(window.location.href, pageUrlAllowlist)) {
      return false;
    }
    if (pageUrlExcludelist && pageUrlExcludelist.length > 0 && isUrlMatchAllowlist(window.location.href, pageUrlExcludelist)) {
      return false;
    }
    var elementType = String(element === null || element === void 0 ? void 0 : element.getAttribute("type")) || "";
    if (typeof elementType === "string") {
      switch (elementType.toLowerCase()) {
        case "hidden":
          return false;
        case "password":
          return false;
      }
    }
    var isCursorPointer = isElementPointerCursor(element, actionType);
    if (isAlwaysCaptureCursorPointer && isCursorPointer) {
      return true;
    }
    if (allowlist) {
      var hasMatchAnyAllowedSelector = allowlist.some(function(selector) {
        var _a2;
        return !!((_a2 = element === null || element === void 0 ? void 0 : element.matches) === null || _a2 === void 0 ? void 0 : _a2.call(element, selector));
      });
      if (!hasMatchAnyAllowedSelector) {
        return false;
      }
    }
    switch (tag) {
      case "input":
      case "select":
      case "textarea":
        return actionType === "change" || actionType === "click";
      default: {
        if (isCursorPointer) {
          return true;
        }
        return actionType === "click";
      }
    }
  };
};
var isNonSensitiveElement = function(element) {
  var _a, _b, _c;
  var tag = (_b = (_a = element === null || element === void 0 ? void 0 : element.tagName) === null || _a === void 0 ? void 0 : _a.toLowerCase) === null || _b === void 0 ? void 0 : _b.call(_a);
  var isContentEditable = element instanceof HTMLElement ? ((_c = element.getAttribute("contenteditable")) === null || _c === void 0 ? void 0 : _c.toLowerCase()) === "true" : false;
  return !SENSITIVE_TAGS.includes(tag) && !isContentEditable;
};
var parseAttributesToMask = function(attributeString) {
  return attributeString ? attributeString.split(",").map(function(attr) {
    return attr.trim();
  }).filter(function(attr) {
    return attr.length > 0 && attr !== "id" && attr !== "class";
  }) : [];
};
var extractPrefixedAttributes = function(attrs, prefix) {
  return Object.entries(attrs).reduce(function(attributes, _a) {
    var _b = __read5(_a, 2), attributeName = _b[0], attributeValue = _b[1];
    if (attributeName.startsWith(prefix)) {
      var attributeKey = attributeName.replace(prefix, "");
      if (attributeKey) {
        attributes[attributeKey] = attributeValue || "";
      }
    }
    return attributes;
  }, {});
};
var isEmpty = function(value) {
  return value === void 0 || value === null || typeof value === "object" && Object.keys(value).length === 0 || typeof value === "string" && value.trim().length === 0;
};
var removeEmptyProperties = function(properties) {
  return Object.keys(properties).reduce(function(filteredProperties, key) {
    var value = properties[key];
    if (!isEmpty(value)) {
      filteredProperties[key] = value;
    }
    return filteredProperties;
  }, {});
};
var getClosestElement = function(element, selectors) {
  if (!element) {
    return null;
  }
  if (selectors.some(function(selector) {
    var _a;
    return (_a = element === null || element === void 0 ? void 0 : element.matches) === null || _a === void 0 ? void 0 : _a.call(element, selector);
  })) {
    return element;
  }
  return getClosestElement(element === null || element === void 0 ? void 0 : element.parentElement, selectors);
};
var asyncLoadScript = function(url) {
  return new Promise(function(resolve, reject) {
    var _a;
    try {
      var scriptElement = document.createElement("script");
      scriptElement.type = "text/javascript";
      scriptElement.async = true;
      scriptElement.src = url;
      scriptElement.addEventListener("load", function() {
        resolve({ status: true });
      }, { once: true });
      scriptElement.addEventListener("error", function() {
        reject({
          status: false,
          message: "Failed to load the script ".concat(url)
        });
      });
      (_a = document.head) === null || _a === void 0 ? void 0 : _a.appendChild(scriptElement);
    } catch (error) {
      reject(error);
    }
  });
};
function generateUniqueId() {
  return "".concat(Date.now(), "-").concat(Math.random().toString(36).substr(2, 9));
}
var filterOutNonTrackableEvents = function(event) {
  if (event.event.target === null || !event.closestTrackedAncestor) {
    return false;
  }
  return true;
};
function isElementBasedEvent(event) {
  return event.type === "click" || event.type === "change";
}
var MouseButton;
(function(MouseButton2) {
  MouseButton2[MouseButton2["LEFT_OR_TOUCH_CONTACT"] = 0] = "LEFT_OR_TOUCH_CONTACT";
  MouseButton2[MouseButton2["MIDDLE"] = 1] = "MIDDLE";
  MouseButton2[MouseButton2["RIGHT"] = 2] = "RIGHT";
})(MouseButton || (MouseButton = {}));

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/hierarchy.js
var BLOCKED_ATTRIBUTES = /* @__PURE__ */ new Set([
  // Already captured elsewhere in the hierarchy object
  "id",
  "class",
  // non-useful and potentially large attribute
  "style",
  // sensitive as prefilled form data may populate this attribute
  "value",
  // DOM events
  "onclick",
  "onchange",
  "oninput",
  "onblur",
  "onsubmit",
  "onfocus",
  "onkeydown",
  "onkeyup",
  "onkeypress",
  // React specific
  "data-reactid",
  "data-react-checksum",
  "data-reactroot",
  // Amplitude specific - used for redaction but should not be included in getElementProperties
  DATA_AMP_MASK_ATTRIBUTES,
  TEXT_MASK_ATTRIBUTE
]);
var SENSITIVE_ELEMENT_ATTRIBUTE_ALLOWLIST = ["type"];
var SVG_TAGS = ["svg", "path", "g"];
var HIGHLY_SENSITIVE_INPUT_TYPES = ["password", "hidden"];
function getElementProperties(element, userMaskedAttributeNames) {
  var e_1, _a;
  var _b, _c, _d, _e;
  if (element === null) {
    return null;
  }
  var tagName = String(element.tagName).toLowerCase();
  var properties = {
    tag: tagName
  };
  var siblings = Array.from((_c = (_b = element.parentElement) === null || _b === void 0 ? void 0 : _b.children) !== null && _c !== void 0 ? _c : []);
  if (siblings.length) {
    properties.index = siblings.indexOf(element);
    properties.indexOfType = siblings.filter(function(el) {
      return el.tagName === element.tagName;
    }).indexOf(element);
  }
  var prevSiblingTag = (_e = (_d = element.previousElementSibling) === null || _d === void 0 ? void 0 : _d.tagName) === null || _e === void 0 ? void 0 : _e.toLowerCase();
  if (prevSiblingTag) {
    properties.prevSib = String(prevSiblingTag);
  }
  var id = element.getAttribute("id");
  if (id) {
    properties.id = String(id);
  }
  var classes = Array.from(element.classList);
  if (classes.length) {
    properties.classes = classes;
  }
  var attributes = {};
  var attributesArray = Array.from(element.attributes);
  var filteredAttributes = attributesArray.filter(function(attr2) {
    return !BLOCKED_ATTRIBUTES.has(attr2.name);
  });
  var isSensitiveElement = !isNonSensitiveElement(element);
  if (!HIGHLY_SENSITIVE_INPUT_TYPES.includes(String(element.getAttribute("type"))) && !SVG_TAGS.includes(tagName)) {
    try {
      for (var filteredAttributes_1 = __values4(filteredAttributes), filteredAttributes_1_1 = filteredAttributes_1.next(); !filteredAttributes_1_1.done; filteredAttributes_1_1 = filteredAttributes_1.next()) {
        var attr = filteredAttributes_1_1.value;
        if (isSensitiveElement && !SENSITIVE_ELEMENT_ATTRIBUTE_ALLOWLIST.includes(attr.name)) {
          continue;
        }
        if (userMaskedAttributeNames.has(attr.name)) {
          attributes[attr.name] = MASKED_TEXT_VALUE;
          continue;
        }
        attributes[attr.name] = String(attr.value).substring(0, MAX_ATTRIBUTE_LENGTH);
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (filteredAttributes_1_1 && !filteredAttributes_1_1.done && (_a = filteredAttributes_1.return)) _a.call(filteredAttributes_1);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
  }
  if (Object.keys(attributes).length) {
    properties.attrs = attributes;
  }
  return properties;
}
function getAncestors(targetEl) {
  var ancestors = [];
  if (!targetEl) {
    return ancestors;
  }
  ancestors.push(targetEl);
  var current = targetEl.parentElement;
  while (current && current.tagName !== "HTML") {
    ancestors.push(current);
    current = current.parentElement;
  }
  return ancestors;
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/pageActions/actions.js
var getDataSource = function(dataSource, contextElement) {
  try {
    if (dataSource.sourceType === "DOM_ELEMENT") {
      var scopingElement = document.documentElement;
      if (dataSource.scope && contextElement) {
        scopingElement = contextElement.closest(dataSource.scope);
      }
      if (scopingElement && dataSource.selector) {
        return scopingElement.querySelector(dataSource.selector);
      }
      return scopingElement;
    }
  } catch (error) {
    return void 0;
  }
  return void 0;
};
var executeActions = function(actions, ev, dataExtractor) {
  actions.forEach(function(action) {
    if (typeof action === "string") {
      return;
    }
    if (action.actionType === "ATTACH_EVENT_PROPERTY") {
      var data = dataExtractor.extractDataFromDataSource(action.dataSource, ev.closestTrackedAncestor);
      ev.targetElementProperties[action.destinationKey] = data;
    }
  });
};

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/data-extractor.js
var DataExtractor = (
  /** @class */
  /* @__PURE__ */ (function() {
    function DataExtractor2(options, context) {
      var e_1, _a;
      var _this = this;
      var _b;
      this.replaceSensitiveString = function(text) {
        return replaceSensitiveString(text, _this.additionalMaskTextPatterns);
      };
      this.getHierarchy = function(element) {
        var e_2, _a2;
        var _b2, _c;
        var startTime = performance.now();
        var hierarchy = [];
        if (!element) {
          return [];
        }
        var ancestors = getAncestors(element);
        var elementToAttributesToMaskMap = /* @__PURE__ */ new Map();
        for (var i2 = ancestors.length - 1; i2 >= 0; i2--) {
          var node = ancestors[i2];
          if (node) {
            var attributesToMask = parseAttributesToMask(node.getAttribute(DATA_AMP_MASK_ATTRIBUTES));
            var ancestorAttributesToMask = i2 === ancestors.length - 1 ? [] : (_b2 = elementToAttributesToMaskMap.get(ancestors[i2 + 1])) !== null && _b2 !== void 0 ? _b2 : /* @__PURE__ */ new Set();
            var combinedAttributesToMask = new Set(__spreadArray4(__spreadArray4([], __read5(ancestorAttributesToMask), false), __read5(attributesToMask), false));
            elementToAttributesToMaskMap.set(node, combinedAttributesToMask);
          }
        }
        hierarchy = ancestors.map(function(el) {
          var _a3;
          return getElementProperties(el, (_a3 = elementToAttributesToMaskMap.get(el)) !== null && _a3 !== void 0 ? _a3 : /* @__PURE__ */ new Set());
        });
        var _loop_1 = function(hierarchyNode2) {
          if (hierarchyNode2 === null || hierarchyNode2 === void 0 ? void 0 : hierarchyNode2.attrs) {
            Object.entries(hierarchyNode2.attrs).forEach(function(_a3) {
              var _b3 = __read5(_a3, 2), key = _b3[0], value = _b3[1];
              if (hierarchyNode2.attrs) {
                hierarchyNode2.attrs[key] = _this.replaceSensitiveString(value);
              }
            });
          }
        };
        try {
          for (var hierarchy_1 = __values4(hierarchy), hierarchy_1_1 = hierarchy_1.next(); !hierarchy_1_1.done; hierarchy_1_1 = hierarchy_1.next()) {
            var hierarchyNode = hierarchy_1_1.value;
            _loop_1(hierarchyNode);
          }
        } catch (e_2_1) {
          e_2 = { error: e_2_1 };
        } finally {
          try {
            if (hierarchy_1_1 && !hierarchy_1_1.done && (_a2 = hierarchy_1.return)) _a2.call(hierarchy_1);
          } finally {
            if (e_2) throw e_2.error;
          }
        }
        var endTime = performance.now();
        (_c = _this.diagnosticsClient) === null || _c === void 0 ? void 0 : _c.recordHistogram("autocapturePlugin.getHierarchy", endTime - startTime);
        return hierarchy;
      };
      this.getNearestLabel = function(element) {
        var parent = element.parentElement;
        if (!parent) {
          return "";
        }
        var labelElement;
        try {
          labelElement = parent.querySelector(":scope>span,h1,h2,h3,h4,h5,h6");
        } catch (_a2) {
          labelElement = null;
        }
        if (labelElement) {
          return _this.getText(labelElement);
        }
        return _this.getNearestLabel(parent);
      };
      this.getEventProperties = function(actionType, element, dataAttributePrefix) {
        var _a2;
        var _b2, _c, _d;
        var tag = (_c = (_b2 = element === null || element === void 0 ? void 0 : element.tagName) === null || _b2 === void 0 ? void 0 : _b2.toLowerCase) === null || _c === void 0 ? void 0 : _c.call(_b2);
        var rect = typeof element.getBoundingClientRect === "function" ? element.getBoundingClientRect() : { left: null, top: null };
        var hierarchy = _this.getHierarchy(element);
        var currentElementAttributes = (_d = hierarchy[0]) === null || _d === void 0 ? void 0 : _d.attrs;
        var nearestLabel = _this.getNearestLabel(element);
        var attributes = extractPrefixedAttributes(currentElementAttributes !== null && currentElementAttributes !== void 0 ? currentElementAttributes : {}, dataAttributePrefix);
        var properties = (_a2 = {}, _a2[AMPLITUDE_EVENT_PROP_ELEMENT_HIERARCHY] = hierarchy, _a2[AMPLITUDE_EVENT_PROP_ELEMENT_TAG] = tag, _a2[AMPLITUDE_EVENT_PROP_ELEMENT_TEXT] = _this.getText(element), _a2[AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_LEFT] = rect.left == null ? null : Math.round(rect.left), _a2[AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_TOP] = rect.top == null ? null : Math.round(rect.top), _a2[AMPLITUDE_EVENT_PROP_ELEMENT_ATTRIBUTES] = attributes, _a2[AMPLITUDE_EVENT_PROP_ELEMENT_PARENT_LABEL] = nearestLabel, _a2[AMPLITUDE_EVENT_PROP_PAGE_URL] = getDecodeURI(window.location.href.split("?")[0]), _a2[AMPLITUDE_EVENT_PROP_PAGE_TITLE] = getPageTitle(_this.replaceSensitiveString), _a2[AMPLITUDE_EVENT_PROP_VIEWPORT_HEIGHT] = window.innerHeight, _a2[AMPLITUDE_EVENT_PROP_VIEWPORT_WIDTH] = window.innerWidth, _a2);
        properties[AMPLITUDE_EVENT_PROP_ELEMENT_ID] = element.getAttribute("id") || "";
        properties[AMPLITUDE_EVENT_PROP_ELEMENT_CLASS] = element.getAttribute("class");
        properties[AMPLITUDE_EVENT_PROP_ELEMENT_ARIA_LABEL] = currentElementAttributes === null || currentElementAttributes === void 0 ? void 0 : currentElementAttributes["aria-label"];
        if (tag === "a" && actionType === "click" && element instanceof HTMLAnchorElement) {
          var href = element.href.substring(0, MAX_ATTRIBUTE_LENGTH);
          properties[AMPLITUDE_EVENT_PROP_ELEMENT_HREF] = _this.replaceSensitiveString(href);
        }
        return removeEmptyProperties(properties);
      };
      this.addTypeAndTimestamp = function(event, type) {
        return {
          event,
          timestamp: Date.now(),
          type
        };
      };
      this.addAdditionalEventProperties = function(event, type, selectorAllowlist, dataAttributePrefix, isCapturingCursorPointer) {
        if (isCapturingCursorPointer === void 0) {
          isCapturingCursorPointer = false;
        }
        var baseEvent = _this.addTypeAndTimestamp(event, type);
        if (isElementBasedEvent(baseEvent) && baseEvent.event.target !== null) {
          if (isCapturingCursorPointer) {
            var isCursorPointer = isElementPointerCursor(baseEvent.event.target, baseEvent.type);
            if (isCursorPointer) {
              baseEvent.closestTrackedAncestor = baseEvent.event.target;
              baseEvent.targetElementProperties = _this.getEventProperties(baseEvent.type, baseEvent.closestTrackedAncestor, dataAttributePrefix);
              return baseEvent;
            }
          }
          var closestTrackedAncestor = getClosestElement(baseEvent.event.target, selectorAllowlist);
          if (closestTrackedAncestor) {
            baseEvent.closestTrackedAncestor = closestTrackedAncestor;
            baseEvent.targetElementProperties = _this.getEventProperties(baseEvent.type, closestTrackedAncestor, dataAttributePrefix);
          }
          return baseEvent;
        }
        return baseEvent;
      };
      this.extractDataFromDataSource = function(dataSource, contextElement) {
        if (dataSource.sourceType === "DOM_ELEMENT") {
          var sourceElement = getDataSource(dataSource, contextElement);
          if (!sourceElement) {
            return void 0;
          }
          if (dataSource.elementExtractType === "TEXT") {
            return _this.getText(sourceElement);
          } else if (dataSource.elementExtractType === "ATTRIBUTE" && dataSource.attribute) {
            return sourceElement.getAttribute(dataSource.attribute);
          }
          return void 0;
        }
        return void 0;
      };
      this.getText = function(element) {
        var hasMaskAttribute = element.closest("[".concat(TEXT_MASK_ATTRIBUTE, "]")) !== null;
        if (hasMaskAttribute) {
          return MASKED_TEXT_VALUE;
        }
        var output = "";
        if (!element.querySelector("[".concat(TEXT_MASK_ATTRIBUTE, "], [contenteditable]"))) {
          output = element.innerText || "";
        } else {
          var clonedTree = element.cloneNode(true);
          clonedTree.querySelectorAll("[".concat(TEXT_MASK_ATTRIBUTE, "], [contenteditable]")).forEach(function(node) {
            node.innerText = MASKED_TEXT_VALUE;
          });
          output = clonedTree.innerText || "";
        }
        return _this.replaceSensitiveString(output.substring(0, 255)).replace(/\s+/g, " ").trim();
      };
      this.getEventTagProps = function(element) {
        var _a2;
        var _b2, _c;
        if (!element) {
          return {};
        }
        var tag = (_c = (_b2 = element === null || element === void 0 ? void 0 : element.tagName) === null || _b2 === void 0 ? void 0 : _b2.toLowerCase) === null || _c === void 0 ? void 0 : _c.call(_b2);
        var properties = (_a2 = {}, _a2[AMPLITUDE_EVENT_PROP_ELEMENT_TAG] = tag, _a2[AMPLITUDE_EVENT_PROP_ELEMENT_TEXT] = _this.getText(element), _a2[AMPLITUDE_EVENT_PROP_PAGE_URL] = window.location.href.split("?")[0], _a2);
        return removeEmptyProperties(properties);
      };
      this.diagnosticsClient = context === null || context === void 0 ? void 0 : context.diagnosticsClient;
      var rawPatterns = (_b = options.maskTextRegex) !== null && _b !== void 0 ? _b : [];
      var compiled = [];
      try {
        for (var rawPatterns_1 = __values4(rawPatterns), rawPatterns_1_1 = rawPatterns_1.next(); !rawPatterns_1_1.done; rawPatterns_1_1 = rawPatterns_1.next()) {
          var entry = rawPatterns_1_1.value;
          if (compiled.length >= MAX_MASK_TEXT_PATTERNS) {
            break;
          }
          if (entry instanceof RegExp) {
            compiled.push(entry);
          } else if ("pattern" in entry && typeof entry.pattern === "string") {
            try {
              compiled.push(new RegExp(entry.pattern, "i"));
            } catch (_c) {
            }
          }
        }
      } catch (e_1_1) {
        e_1 = { error: e_1_1 };
      } finally {
        try {
          if (rawPatterns_1_1 && !rawPatterns_1_1.done && (_a = rawPatterns_1.return)) _a.call(rawPatterns_1);
        } finally {
          if (e_1) throw e_1.error;
        }
      }
      this.additionalMaskTextPatterns = compiled;
    }
    return DataExtractor2;
  })()
);

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/libs/messenger.js
var WindowMessenger = (
  /** @class */
  (function() {
    function WindowMessenger2(_a) {
      var _b = _a === void 0 ? {} : _a, _c = _b.origin, origin = _c === void 0 ? AMPLITUDE_ORIGIN : _c;
      var _this = this;
      this.endpoint = AMPLITUDE_ORIGIN;
      this.requestCallbacks = {};
      this.onSelect = function(data) {
        _this.notify({ action: "element-selected", data });
      };
      this.onTrack = function(type, properties) {
        if (type === "selector-mode-changed") {
          _this.notify({ action: "track-selector-mode-changed", data: properties });
        } else if (type === "selector-moved") {
          _this.notify({ action: "track-selector-moved", data: properties });
        }
      };
      this.endpoint = origin;
    }
    WindowMessenger2.prototype.notify = function(message) {
      var _a, _b, _c, _d;
      (_b = (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug) === null || _b === void 0 ? void 0 : _b.call(_a, "Message sent: ", JSON.stringify(message));
      (_d = (_c = window.opener) === null || _c === void 0 ? void 0 : _c.postMessage) === null || _d === void 0 ? void 0 : _d.call(_c, message, this.endpoint);
    };
    WindowMessenger2.prototype.sendRequest = function(action, args, options) {
      var _this = this;
      if (options === void 0) {
        options = { timeout: 15e3 };
      }
      var id = generateUniqueId();
      var request = {
        id,
        action,
        args
      };
      var promise = new Promise(function(resolve, reject) {
        _this.requestCallbacks[id] = { resolve, reject };
        _this.notify(request);
        if ((options === null || options === void 0 ? void 0 : options.timeout) > 0) {
          setTimeout(function() {
            reject(new Error("".concat(action, " timed out (id: ").concat(id, ")")));
            delete _this.requestCallbacks[id];
          }, options.timeout);
        }
      });
      return promise;
    };
    WindowMessenger2.prototype.handleResponse = function(response) {
      var _a;
      if (!this.requestCallbacks[response.id]) {
        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.warn("No callback found for request id: ".concat(response.id));
        return;
      }
      this.requestCallbacks[response.id].resolve(response.responseData);
      delete this.requestCallbacks[response.id];
    };
    WindowMessenger2.prototype.setup = function(_a) {
      var _this = this;
      var _b = _a === void 0 ? { dataExtractor: new DataExtractor({}) } : _a, logger = _b.logger, endpoint = _b.endpoint, isElementSelectable = _b.isElementSelectable, cssSelectorAllowlist = _b.cssSelectorAllowlist, actionClickAllowlist = _b.actionClickAllowlist, dataExtractor = _b.dataExtractor;
      this.logger = logger;
      if (endpoint && this.endpoint === AMPLITUDE_ORIGIN) {
        this.endpoint = endpoint;
      }
      var amplitudeVisualTaggingSelectorInstance = null;
      window.addEventListener("message", function(event) {
        var _a2, _b2, _c, _d, _e;
        (_b2 = (_a2 = _this.logger) === null || _a2 === void 0 ? void 0 : _a2.debug) === null || _b2 === void 0 ? void 0 : _b2.call(_a2, "Message received: ", JSON.stringify(event));
        if (_this.endpoint !== event.origin) {
          return;
        }
        var eventData = event === null || event === void 0 ? void 0 : event.data;
        var action = eventData === null || eventData === void 0 ? void 0 : eventData.action;
        if (!action) {
          return;
        }
        if ("id" in eventData) {
          (_d = (_c = _this.logger) === null || _c === void 0 ? void 0 : _c.debug) === null || _d === void 0 ? void 0 : _d.call(_c, "Received Response to previous request: ", JSON.stringify(event));
          _this.handleResponse(eventData);
        } else {
          if (action === "ping") {
            _this.notify({ action: "pong" });
          } else if (action === "initialize-visual-tagging-selector") {
            var actionData_1 = eventData === null || eventData === void 0 ? void 0 : eventData.data;
            asyncLoadScript(AMPLITUDE_VISUAL_TAGGING_SELECTOR_SCRIPT_URL).then(function() {
              var _a3;
              amplitudeVisualTaggingSelectorInstance = (_a3 = window === null || window === void 0 ? void 0 : window.amplitudeVisualTaggingSelector) === null || _a3 === void 0 ? void 0 : _a3.call(window, {
                getEventTagProps: dataExtractor.getEventTagProps,
                isElementSelectable: function(element) {
                  if (isElementSelectable) {
                    return isElementSelectable((actionData_1 === null || actionData_1 === void 0 ? void 0 : actionData_1.actionType) || "click", element);
                  }
                  return true;
                },
                onTrack: _this.onTrack,
                onSelect: _this.onSelect,
                visualHighlightClass: AMPLITUDE_VISUAL_TAGGING_HIGHLIGHT_CLASS,
                messenger: _this,
                cssSelectorAllowlist,
                actionClickAllowlist,
                extractDataFromDataSource: dataExtractor.extractDataFromDataSource,
                dataExtractor,
                diagnostics: {
                  autocapture: {
                    version: VERSION2
                  }
                }
              });
              _this.notify({ action: "selector-loaded" });
            }).catch(function() {
              var _a3;
              (_a3 = _this.logger) === null || _a3 === void 0 ? void 0 : _a3.warn("Failed to initialize visual tagging selector");
            });
          } else if (action === "close-visual-tagging-selector") {
            (_e = amplitudeVisualTaggingSelectorInstance === null || amplitudeVisualTaggingSelectorInstance === void 0 ? void 0 : amplitudeVisualTaggingSelectorInstance.close) === null || _e === void 0 ? void 0 : _e.call(amplitudeVisualTaggingSelectorInstance);
          }
        }
      });
      this.notify({ action: "page-loaded" });
    };
    return WindowMessenger2;
  })()
);

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/autocapture/track-click.js
function trackClicks(_a) {
  var amplitude = _a.amplitude, allObservables = _a.allObservables, shouldTrackEvent = _a.shouldTrackEvent, evaluateTriggers = _a.evaluateTriggers;
  var clickObservable = allObservables.clickObservable;
  var clickObservableFiltered = clickObservable.filter(filterOutNonTrackableEvents).filter(function(click) {
    return shouldTrackEvent("click", click.closestTrackedAncestor);
  }).map(function(click) {
    return evaluateTriggers(click);
  });
  var clicks = clickObservableFiltered;
  return clicks.subscribe(function(click) {
    amplitude === null || amplitude === void 0 ? void 0 : amplitude.track(AMPLITUDE_ELEMENT_CLICKED_EVENT, click.targetElementProperties);
  });
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/autocapture/track-change.js
function trackChange(_a) {
  var amplitude = _a.amplitude, allObservables = _a.allObservables, getEventProperties = _a.getEventProperties, shouldTrackEvent = _a.shouldTrackEvent, evaluateTriggers = _a.evaluateTriggers;
  var changeObservable = allObservables.changeObservable;
  var filteredChangeObservable = changeObservable.filter(filterOutNonTrackableEvents).filter(function(changeEvent) {
    return shouldTrackEvent("change", changeEvent.closestTrackedAncestor);
  }).map(function(changeEvent) {
    return evaluateTriggers(changeEvent);
  });
  return filteredChangeObservable.subscribe(function(changeEvent) {
    amplitude === null || amplitude === void 0 ? void 0 : amplitude.track(AMPLITUDE_ELEMENT_CHANGED_EVENT, getEventProperties("change", changeEvent.closestTrackedAncestor));
  });
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/autocapture/track-action-click.js
function trackActionClick(_a) {
  var amplitude = _a.amplitude, allObservables = _a.allObservables, options = _a.options, getEventProperties = _a.getEventProperties, shouldTrackEvent = _a.shouldTrackEvent, shouldTrackActionClick = _a.shouldTrackActionClick;
  var clickObservable = allObservables.clickObservable, mutationObservable = allObservables.mutationObservable, navigateObservable = allObservables.navigateObservable;
  var filteredClickObservable = clickObservable.filter(function(click) {
    return !shouldTrackEvent("click", click.closestTrackedAncestor);
  }).map(function(click) {
    var closestActionClickEl = getClosestElement(click.event.target, options.actionClickAllowlist);
    click.closestTrackedAncestor = closestActionClickEl;
    if (click.closestTrackedAncestor !== null) {
      click.targetElementProperties = getEventProperties(click.type, click.closestTrackedAncestor);
    }
    return click;
  }).filter(filterOutNonTrackableEvents).filter(function(clickEvent) {
    return shouldTrackActionClick("click", clickEvent.closestTrackedAncestor);
  });
  var mutationOrNavigate = navigateObservable ? merge(mutationObservable, navigateObservable) : mutationObservable;
  var clickMutationNavigateObservable = merge(filteredClickObservable, mutationOrNavigate);
  var actionClickTimer = null;
  var lastClickEvent = null;
  var actionClickObservable = asyncMap(clickMutationNavigateObservable, function(event) {
    if (actionClickTimer) {
      clearTimeout(actionClickTimer);
      actionClickTimer = null;
    }
    if (event.type === "click") {
      lastClickEvent = event;
      actionClickTimer = setTimeout(function() {
        actionClickTimer = null;
        lastClickEvent = null;
      }, 500);
      return Promise.resolve(null);
    } else {
      if (lastClickEvent) {
        var event_1 = lastClickEvent;
        lastClickEvent = null;
        return Promise.resolve(event_1);
      }
    }
    return Promise.resolve(null);
  });
  return actionClickObservable.subscribe(function(actionClick) {
    if (!actionClick)
      return;
    amplitude === null || amplitude === void 0 ? void 0 : amplitude.track(AMPLITUDE_ELEMENT_CLICKED_EVENT, getEventProperties("click", actionClick.closestTrackedAncestor));
  });
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/observables.js
var globalScope2 = getGlobalScope();
var createMutationObservable = function() {
  return new Observable(function(observer) {
    var mutationObserver = new MutationObserver(function(mutations) {
      observer.next(mutations);
    });
    if (document.body) {
      mutationObserver.observe(document.body, {
        childList: true,
        attributes: true,
        characterData: true,
        subtree: true
      });
    }
    return function() {
      return mutationObserver.disconnect();
    };
  });
};
var createClickObservable = function(clickType) {
  if (clickType === void 0) {
    clickType = "click";
  }
  return new Observable(function(observer) {
    var handler = function(event) {
      observer.next(event);
    };
    globalScope2.document.addEventListener(clickType, handler, { capture: true });
    return function() {
      globalScope2.document.removeEventListener(clickType, handler, { capture: true });
    };
  });
};
var createConsoleErrorObservable = function() {
  return new Observable(function(observer) {
    var handler = function(_2) {
      var args = [];
      for (var _i = 1; _i < arguments.length; _i++) {
        args[_i - 1] = arguments[_i];
      }
      var message = void 0;
      if (Array.isArray(args[0]) && typeof args[0][0] === "string") {
        message = args[0][0];
      }
      observer.next({ kind: "console", message });
    };
    consoleObserver.addListener("error", handler);
    return function() {
      consoleObserver.removeListener(handler);
    };
  });
};
var createUnhandledErrorObservable = function() {
  return new Observable(function(observer) {
    var handler = function(event) {
      var output = {
        kind: "error"
      };
      if (event.error instanceof Error) {
        output = __assign5(__assign5({}, output), { message: event.error.message, stack: event.error.stack, filename: event.filename, lineNumber: event.lineno, columnNumber: event.colno });
      } else if (typeof event.error === "string") {
        output.message = event.error;
      }
      observer.next(output);
    };
    globalScope2.addEventListener("error", handler);
    return function() {
      globalScope2.removeEventListener("error", handler);
    };
  });
};
var createUnhandledRejectionObservable = function() {
  return new Observable(function(observer) {
    var handler = function(event) {
      var output = {
        kind: "unhandledrejection"
      };
      if (event.reason instanceof Error) {
        output.message = event.reason.message;
        output.stack = event.reason.stack;
      } else if (typeof event.reason === "string") {
        output.message = event.reason;
      }
      observer.next(output);
    };
    globalScope2.addEventListener("unhandledrejection", handler);
    return function() {
      globalScope2.removeEventListener("unhandledrejection", handler);
    };
  });
};
var createErrorObservable = function() {
  var unhandledErrorObservable = merge(createUnhandledErrorObservable(), createUnhandledRejectionObservable());
  return merge(unhandledErrorObservable, createConsoleErrorObservable());
};

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/pageActions/matchEventToFilter.js
var matchEventToFilter = function(event, filter) {
  try {
    if (filter.subprop_key === "[Amplitude] Element Text") {
      return filter.subprop_op === "is" && filter.subprop_value.includes(event.targetElementProperties["[Amplitude] Element Text"]);
    } else if (filter.subprop_key === "[Amplitude] Element Hierarchy") {
      return filter.subprop_op === "autotrack css match" && !!event.closestTrackedAncestor.closest(filter.subprop_value.toString());
    }
  } catch (error) {
    console.error("Error matching event to filter", error);
    return false;
  }
  return false;
};

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/pageActions/triggers.js
var eventTypeToBrowserEventMap = {
  "[Amplitude] Element Clicked": "click",
  "[Amplitude] Element Changed": "change"
};
var groupLabeledEventIdsByEventType = function(labeledEvents) {
  var e_1, _a, e_2, _b;
  var groupedLabeledEvents = Object.values(eventTypeToBrowserEventMap).reduce(function(acc, browserEvent2) {
    acc[browserEvent2] = /* @__PURE__ */ new Set();
    return acc;
  }, {});
  if (!labeledEvents) {
    return groupedLabeledEvents;
  }
  try {
    for (var labeledEvents_1 = __values4(labeledEvents), labeledEvents_1_1 = labeledEvents_1.next(); !labeledEvents_1_1.done; labeledEvents_1_1 = labeledEvents_1.next()) {
      var le = labeledEvents_1_1.value;
      try {
        try {
          for (var _c = (e_2 = void 0, __values4(le.definition)), _d = _c.next(); !_d.done; _d = _c.next()) {
            var def = _d.value;
            var browserEvent = eventTypeToBrowserEventMap[def.event_type];
            if (browserEvent) {
              groupedLabeledEvents[browserEvent].add(le.id);
            }
          }
        } catch (e_2_1) {
          e_2 = { error: e_2_1 };
        } finally {
          try {
            if (_d && !_d.done && (_b = _c.return)) _b.call(_c);
          } finally {
            if (e_2) throw e_2.error;
          }
        }
      } catch (e2) {
        console.warn("Skipping Labeled Event due to malformed definition", le === null || le === void 0 ? void 0 : le.id, e2);
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (labeledEvents_1_1 && !labeledEvents_1_1.done && (_a = labeledEvents_1.return)) _a.call(labeledEvents_1);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
  return groupedLabeledEvents;
};
var createLabeledEventToTriggerMap = function(triggers) {
  var e_3, _a, e_4, _b;
  var labeledEventToTriggerMap = /* @__PURE__ */ new Map();
  try {
    for (var triggers_1 = __values4(triggers), triggers_1_1 = triggers_1.next(); !triggers_1_1.done; triggers_1_1 = triggers_1.next()) {
      var trigger = triggers_1_1.value;
      try {
        for (var _c = (e_4 = void 0, __values4(trigger.conditions)), _d = _c.next(); !_d.done; _d = _c.next()) {
          var condition = _d.value;
          if (condition.type === "LABELED_EVENT") {
            var eventId = condition.match.eventId;
            var existingTriggers = labeledEventToTriggerMap.get(eventId);
            if (!existingTriggers) {
              existingTriggers = [];
              labeledEventToTriggerMap.set(eventId, existingTriggers);
            }
            existingTriggers.push(trigger);
          }
        }
      } catch (e_4_1) {
        e_4 = { error: e_4_1 };
      } finally {
        try {
          if (_d && !_d.done && (_b = _c.return)) _b.call(_c);
        } finally {
          if (e_4) throw e_4.error;
        }
      }
    }
  } catch (e_3_1) {
    e_3 = { error: e_3_1 };
  } finally {
    try {
      if (triggers_1_1 && !triggers_1_1.done && (_a = triggers_1.return)) _a.call(triggers_1);
    } finally {
      if (e_3) throw e_3.error;
    }
  }
  return labeledEventToTriggerMap;
};
var matchEventToLabeledEvents = function(event, labeledEvents) {
  return labeledEvents.filter(function(le) {
    return le.definition.some(function(def) {
      return eventTypeToBrowserEventMap[def.event_type] === event.type && def.filters.every(function(filter) {
        return matchEventToFilter(event, filter);
      });
    });
  });
};
var matchLabeledEventsToTriggers = function(labeledEvents, leToTriggerMap) {
  var e_5, _a, e_6, _b;
  var matchingTriggers = /* @__PURE__ */ new Set();
  try {
    for (var labeledEvents_2 = __values4(labeledEvents), labeledEvents_2_1 = labeledEvents_2.next(); !labeledEvents_2_1.done; labeledEvents_2_1 = labeledEvents_2.next()) {
      var le = labeledEvents_2_1.value;
      var triggers = leToTriggerMap.get(le.id);
      if (triggers) {
        try {
          for (var triggers_2 = (e_6 = void 0, __values4(triggers)), triggers_2_1 = triggers_2.next(); !triggers_2_1.done; triggers_2_1 = triggers_2.next()) {
            var trigger = triggers_2_1.value;
            matchingTriggers.add(trigger);
          }
        } catch (e_6_1) {
          e_6 = { error: e_6_1 };
        } finally {
          try {
            if (triggers_2_1 && !triggers_2_1.done && (_b = triggers_2.return)) _b.call(triggers_2);
          } finally {
            if (e_6) throw e_6.error;
          }
        }
      }
    }
  } catch (e_5_1) {
    e_5 = { error: e_5_1 };
  } finally {
    try {
      if (labeledEvents_2_1 && !labeledEvents_2_1.done && (_a = labeledEvents_2.return)) _a.call(labeledEvents_2);
    } finally {
      if (e_5) throw e_5.error;
    }
  }
  return Array.from(matchingTriggers);
};
var TriggerEvaluator = (
  /** @class */
  (function() {
    function TriggerEvaluator2(groupedLabeledEvents, labeledEventToTriggerMap, dataExtractor, options) {
      this.groupedLabeledEvents = groupedLabeledEvents;
      this.labeledEventToTriggerMap = labeledEventToTriggerMap;
      this.dataExtractor = dataExtractor;
      this.options = options;
    }
    TriggerEvaluator2.prototype.evaluate = function(event) {
      var e_7, _a;
      var pageActions = this.options.pageActions;
      if (!pageActions) {
        return event;
      }
      var matchingLabeledEvents = matchEventToLabeledEvents(event, Array.from(this.groupedLabeledEvents[event.type]).map(function(id) {
        return pageActions.labeledEvents[id];
      }));
      var matchingTriggers = matchLabeledEventsToTriggers(matchingLabeledEvents, this.labeledEventToTriggerMap);
      try {
        for (var matchingTriggers_1 = __values4(matchingTriggers), matchingTriggers_1_1 = matchingTriggers_1.next(); !matchingTriggers_1_1.done; matchingTriggers_1_1 = matchingTriggers_1.next()) {
          var trigger = matchingTriggers_1_1.value;
          executeActions(trigger.actions, event, this.dataExtractor);
        }
      } catch (e_7_1) {
        e_7 = { error: e_7_1 };
      } finally {
        try {
          if (matchingTriggers_1_1 && !matchingTriggers_1_1.done && (_a = matchingTriggers_1.return)) _a.call(matchingTriggers_1);
        } finally {
          if (e_7) throw e_7.error;
        }
      }
      return event;
    };
    TriggerEvaluator2.prototype.update = function(groupedLabeledEvents, labeledEventToTriggerMap, options) {
      this.groupedLabeledEvents = groupedLabeledEvents;
      this.labeledEventToTriggerMap = labeledEventToTriggerMap;
      this.options = options;
    };
    return TriggerEvaluator2;
  })()
);
var createTriggerEvaluator = function(groupedLabeledEvents, labeledEventToTriggerMap, dataExtractor, options) {
  return new TriggerEvaluator(groupedLabeledEvents, labeledEventToTriggerMap, dataExtractor, options);
};

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/autocapture-plugin.js
var ObservablesEnum;
(function(ObservablesEnum3) {
  ObservablesEnum3["ClickObservable"] = "clickObservable";
  ObservablesEnum3["ChangeObservable"] = "changeObservable";
  ObservablesEnum3["NavigateObservable"] = "navigateObservable";
  ObservablesEnum3["MutationObservable"] = "mutationObservable";
  ObservablesEnum3["BrowserErrorObservable"] = "browserErrorObservable";
  ObservablesEnum3["SelectionObservable"] = "selectionObservable";
})(ObservablesEnum || (ObservablesEnum = {}));
var autocapturePlugin = function(options, context) {
  var _a, _b, _c, _d, _e, _f, _g, _h;
  if (options === void 0) {
    options = {};
  }
  context === null || context === void 0 ? void 0 : context.diagnosticsClient.setTag("plugin.autocapture.version", VERSION2);
  var _j = options.dataAttributePrefix, dataAttributePrefix = _j === void 0 ? DEFAULT_DATA_ATTRIBUTE_PREFIX : _j, _k = options.visualTaggingOptions, visualTaggingOptions = _k === void 0 ? {
    enabled: true,
    messenger: new WindowMessenger()
  } : _k;
  options.cssSelectorAllowlist = (_a = options.cssSelectorAllowlist) !== null && _a !== void 0 ? _a : DEFAULT_CSS_SELECTOR_ALLOWLIST;
  options.actionClickAllowlist = (_b = options.actionClickAllowlist) !== null && _b !== void 0 ? _b : DEFAULT_ACTION_CLICK_ALLOWLIST;
  options.debounceTime = (_c = options.debounceTime) !== null && _c !== void 0 ? _c : 0;
  options.pageUrlExcludelist = (_d = options.pageUrlExcludelist) === null || _d === void 0 ? void 0 : _d.reduce(function(acc, excludePattern) {
    if (typeof excludePattern === "string") {
      acc.push(excludePattern);
    }
    if (excludePattern instanceof RegExp) {
      acc.push(excludePattern);
    }
    if (typeof excludePattern === "object" && excludePattern !== null && "pattern" in excludePattern) {
      try {
        acc.push(new RegExp(excludePattern.pattern));
      } catch (regexError) {
        console.warn("Invalid regex pattern: ".concat(excludePattern.pattern), regexError);
        return acc;
      }
    }
    return acc;
  }, []);
  var name = PLUGIN_NAME;
  var type = "enrichment";
  var subscriptions = [];
  var dataExtractor = new DataExtractor(options, context);
  var createObservables = function() {
    var _a2;
    var clickObservable = multicast(createClickObservable().map(function(click) {
      return dataExtractor.addAdditionalEventProperties(click, "click", options.cssSelectorAllowlist, dataAttributePrefix);
    }));
    var changeObservable = multicast(new Observable(function(observer) {
      var _a3;
      var handler = function(changeEvent) {
        var enrichedChangeEvent = dataExtractor.addAdditionalEventProperties(changeEvent, "change", options.cssSelectorAllowlist, dataAttributePrefix);
        observer.next(enrichedChangeEvent);
      };
      (_a3 = getGlobalScope()) === null || _a3 === void 0 ? void 0 : _a3.document.addEventListener("change", handler, { capture: true });
      return function() {
        var _a4;
        return (_a4 = getGlobalScope()) === null || _a4 === void 0 ? void 0 : _a4.document.removeEventListener("change", handler);
      };
    }));
    var navigateObservable;
    if (window.navigation) {
      navigateObservable = multicast(new Observable(function(observer) {
        var handler = function(navigateEvent) {
          var enrichedNavigateEvent = dataExtractor.addAdditionalEventProperties(navigateEvent, "navigate", options.cssSelectorAllowlist, dataAttributePrefix);
          observer.next(enrichedNavigateEvent);
        };
        window.navigation.addEventListener("navigate", handler);
        return function() {
          window.navigation.removeEventListener("navigate", handler);
        };
      }));
    }
    var mutationObservable = multicast(createMutationObservable().map(function(mutation) {
      return dataExtractor.addAdditionalEventProperties(mutation, "mutation", options.cssSelectorAllowlist, dataAttributePrefix);
    }));
    return _a2 = {}, _a2[ObservablesEnum.ChangeObservable] = changeObservable, // [ObservablesEnum.ErrorObservable]: errorObservable,
    _a2[ObservablesEnum.ClickObservable] = clickObservable, _a2[ObservablesEnum.MutationObservable] = mutationObservable, _a2[ObservablesEnum.NavigateObservable] = navigateObservable, _a2;
  };
  var groupedLabeledEvents = groupLabeledEventIdsByEventType(Object.values((_f = (_e = options.pageActions) === null || _e === void 0 ? void 0 : _e.labeledEvents) !== null && _f !== void 0 ? _f : {}));
  var labeledEventToTriggerMap = createLabeledEventToTriggerMap((_h = (_g = options.pageActions) === null || _g === void 0 ? void 0 : _g.triggers) !== null && _h !== void 0 ? _h : []);
  var evaluateTriggers = createTriggerEvaluator(groupedLabeledEvents, labeledEventToTriggerMap, dataExtractor, options);
  var recomputePageActionsData = function(remotePageActions) {
    var _a2, _b2;
    if (remotePageActions) {
      options.pageActions = __assign5(__assign5({}, options.pageActions), remotePageActions);
      groupedLabeledEvents = groupLabeledEventIdsByEventType(Object.values((_a2 = options.pageActions.labeledEvents) !== null && _a2 !== void 0 ? _a2 : {}));
      labeledEventToTriggerMap = createLabeledEventToTriggerMap((_b2 = options.pageActions.triggers) !== null && _b2 !== void 0 ? _b2 : []);
      evaluateTriggers.update(groupedLabeledEvents, labeledEventToTriggerMap, options);
    }
  };
  var setup = function(config, amplitude) {
    return __awaiter4(void 0, void 0, void 0, function() {
      var shouldTrackEvent, shouldTrackActionClick, allObservables, clickTrackingSubscription, changeSubscription, actionClickSubscription, allowlist, actionClickAllowlist;
      var _a2, _b2;
      return __generator4(this, function(_c2) {
        if (typeof document === "undefined") {
          return [
            2
            /*return*/
          ];
        }
        if (config.fetchRemoteConfig) {
          if (!config.remoteConfigClient) {
            config.loggerProvider.debug("Remote config client is not provided, skipping remote config fetch");
          } else {
            config.remoteConfigClient.subscribe("configs.analyticsSDK.pageActions", "all", function(remoteConfig) {
              recomputePageActionsData(remoteConfig);
            });
          }
        }
        shouldTrackEvent = createShouldTrackEvent(options, options.cssSelectorAllowlist);
        shouldTrackActionClick = createShouldTrackEvent(options, options.actionClickAllowlist);
        allObservables = createObservables();
        clickTrackingSubscription = trackClicks({
          allObservables,
          amplitude,
          shouldTrackEvent,
          evaluateTriggers: evaluateTriggers.evaluate.bind(evaluateTriggers)
        });
        subscriptions.push(clickTrackingSubscription);
        changeSubscription = trackChange({
          allObservables,
          getEventProperties: function() {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
              args[_i] = arguments[_i];
            }
            return dataExtractor.getEventProperties.apply(dataExtractor, __spreadArray4(__spreadArray4([], __read5(args), false), [dataAttributePrefix], false));
          },
          amplitude,
          shouldTrackEvent,
          evaluateTriggers: evaluateTriggers.evaluate.bind(evaluateTriggers)
        });
        subscriptions.push(changeSubscription);
        actionClickSubscription = trackActionClick({
          allObservables,
          options,
          getEventProperties: function() {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
              args[_i] = arguments[_i];
            }
            return dataExtractor.getEventProperties.apply(dataExtractor, __spreadArray4(__spreadArray4([], __read5(args), false), [dataAttributePrefix], false));
          },
          amplitude,
          shouldTrackEvent,
          shouldTrackActionClick
        });
        if (actionClickSubscription) {
          subscriptions.push(actionClickSubscription);
        }
        (_a2 = config === null || config === void 0 ? void 0 : config.loggerProvider) === null || _a2 === void 0 ? void 0 : _a2.log("".concat(name, " has been successfully added."));
        if (window.opener && visualTaggingOptions.enabled) {
          allowlist = options.cssSelectorAllowlist;
          actionClickAllowlist = options.actionClickAllowlist;
          (_b2 = visualTaggingOptions.messenger) === null || _b2 === void 0 ? void 0 : _b2.setup(__assign5(__assign5({ dataExtractor, logger: config === null || config === void 0 ? void 0 : config.loggerProvider }, (config === null || config === void 0 ? void 0 : config.serverZone) && { endpoint: AMPLITUDE_ORIGINS_MAP[config.serverZone] }), { isElementSelectable: createShouldTrackEvent(options, __spreadArray4(__spreadArray4([], __read5(allowlist), false), __read5(actionClickAllowlist), false)), cssSelectorAllowlist: allowlist, actionClickAllowlist }));
        }
        return [
          2
          /*return*/
        ];
      });
    });
  };
  var execute = function(event) {
    return __awaiter4(void 0, void 0, void 0, function() {
      return __generator4(this, function(_a2) {
        return [2, event];
      });
    });
  };
  var teardown = function() {
    return __awaiter4(void 0, void 0, void 0, function() {
      var subscriptions_1, subscriptions_1_1, subscription2;
      var e_1, _a2;
      return __generator4(this, function(_b2) {
        try {
          for (subscriptions_1 = __values4(subscriptions), subscriptions_1_1 = subscriptions_1.next(); !subscriptions_1_1.done; subscriptions_1_1 = subscriptions_1.next()) {
            subscription2 = subscriptions_1_1.value;
            subscription2.unsubscribe();
          }
        } catch (e_1_1) {
          e_1 = { error: e_1_1 };
        } finally {
          try {
            if (subscriptions_1_1 && !subscriptions_1_1.done && (_a2 = subscriptions_1.return)) _a2.call(subscriptions_1);
          } finally {
            if (e_1) throw e_1.error;
          }
        }
        return [
          2
          /*return*/
        ];
      });
    });
  };
  return {
    name,
    type,
    setup,
    execute,
    teardown
  };
};

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/autocapture/track-dead-click.js
var DEAD_CLICK_TIMEOUT = 3e3;
var CHANGE_EVENTS = ["mutation", "navigate"];
function trackDeadClick(_a) {
  var amplitude = _a.amplitude, allObservables = _a.allObservables, getEventProperties = _a.getEventProperties, shouldTrackDeadClick = _a.shouldTrackDeadClick;
  var clickObservable = allObservables.clickObservable, mutationObservable = allObservables.mutationObservable, navigateObservable = allObservables.navigateObservable;
  var filteredClickObservable = clickObservable.filter(function(click) {
    return filterOutNonTrackableEvents(click) && shouldTrackDeadClick("click", click.closestTrackedAncestor) && click.event.target instanceof Element && click.event.target.closest('a[target="_blank"]') === null && click.event.button === MouseButton.LEFT_OR_TOUCH_CONTACT;
  });
  var changeObservables = navigateObservable ? merge(mutationObservable, navigateObservable) : mutationObservable;
  var clicksAndChangeObservable = merge(filteredClickObservable, changeObservables);
  var deadClickTimer = null;
  var deadClickObservable = asyncMap(clicksAndChangeObservable, function(event) {
    if (deadClickTimer && CHANGE_EVENTS.includes(event.type)) {
      clearTimeout(deadClickTimer);
      deadClickTimer = null;
      return Promise.resolve(null);
    } else if (event.type === "click") {
      if (deadClickTimer) {
        return Promise.resolve(null);
      }
      return new Promise(function(resolve) {
        deadClickTimer = setTimeout(function() {
          resolve(event);
          deadClickTimer = null;
        }, DEAD_CLICK_TIMEOUT);
      });
    }
    return Promise.resolve(null);
  });
  return deadClickObservable.subscribe(function(actionClick) {
    if (!actionClick)
      return;
    var deadClickEvent = {
      "[Amplitude] X": actionClick.event.clientX,
      "[Amplitude] Y": actionClick.event.clientY
    };
    amplitude.track(AMPLITUDE_ELEMENT_DEAD_CLICKED_EVENT, __assign5(__assign5({}, getEventProperties("click", actionClick.closestTrackedAncestor)), deadClickEvent), { time: actionClick.timestamp });
  });
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/autocapture/track-rage-click.js
var RAGE_CLICK_THRESHOLD = DEFAULT_RAGE_CLICK_THRESHOLD;
var RAGE_CLICK_WINDOW_MS = DEFAULT_RAGE_CLICK_WINDOW_MS;
var RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD = DEFAULT_RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD;
function addCoordinates(regionBox, click) {
  var _a, _b, _c, _d;
  var _e = click.event, pageX = _e.pageX, pageY = _e.pageY;
  regionBox.yMin = Math.min((_a = regionBox.yMin) !== null && _a !== void 0 ? _a : pageY, pageY);
  regionBox.yMax = Math.max((_b = regionBox.yMax) !== null && _b !== void 0 ? _b : pageY, pageY);
  regionBox.xMin = Math.min((_c = regionBox.xMin) !== null && _c !== void 0 ? _c : pageX, pageX);
  regionBox.xMax = Math.max((_d = regionBox.xMax) !== null && _d !== void 0 ? _d : pageX, pageX);
  regionBox.isOutOfBounds = regionBox.yMax - regionBox.yMin > RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD || regionBox.xMax - regionBox.xMin > RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD;
}
function getRageClickAnalyticsEvent(clickWindow) {
  if (clickWindow.length === 0) {
    return null;
  }
  var firstClick = clickWindow[0];
  var lastClick = clickWindow[clickWindow.length - 1];
  var rageClickEvent = __assign5({ "[Amplitude] Begin Time": new Date(firstClick.timestamp).toISOString(), "[Amplitude] End Time": new Date(lastClick.timestamp).toISOString(), "[Amplitude] Duration": lastClick.timestamp - firstClick.timestamp, "[Amplitude] Clicks": clickWindow.map(function(click) {
    return {
      X: click.event.pageX,
      Y: click.event.pageY,
      Time: click.timestamp
    };
  }), "[Amplitude] Click Count": clickWindow.length }, firstClick.targetElementProperties);
  return { rageClickEvent, time: firstClick.timestamp };
}
function isClickOutsideRageClickWindow(clickWindow, click) {
  var firstIndex = Math.max(0, clickWindow.length - RAGE_CLICK_THRESHOLD + 1);
  var firstClick = clickWindow[firstIndex];
  return click.timestamp - firstClick.timestamp >= RAGE_CLICK_WINDOW_MS;
}
function isNewElement(clickWindow, click) {
  return clickWindow.length > 0 && clickWindow[clickWindow.length - 1].closestTrackedAncestor !== click.closestTrackedAncestor;
}
function trackRageClicks(_a) {
  var _this = this;
  var amplitude = _a.amplitude, allObservables = _a.allObservables, shouldTrackRageClick = _a.shouldTrackRageClick;
  var clickObservable = allObservables.clickObservable, selectionObservable = allObservables.selectionObservable;
  var clickWindow = [];
  var clickBoundingBox = {};
  var pendingRageClick = null;
  function resetClickWindow(click) {
    clickWindow = [];
    clickBoundingBox = {};
    if (click) {
      addCoordinates(clickBoundingBox, click);
      clickWindow.push(click);
    }
  }
  var rageClickObservable = asyncMap(clickObservable.filter(function(click) {
    return shouldTrackRageClick("click", click.closestTrackedAncestor);
  }), function(click) {
    return __awaiter4(_this, void 0, void 0, function() {
      var resolutionValue;
      return __generator4(this, function(_a2) {
        addCoordinates(clickBoundingBox, click);
        resolutionValue = null;
        if (clickWindow.length === 0 || isNewElement(clickWindow, click) || isClickOutsideRageClickWindow(clickWindow, click) || clickBoundingBox.isOutOfBounds) {
          if (pendingRageClick) {
            resolutionValue = getRageClickAnalyticsEvent(clickWindow);
          }
          resetClickWindow(click);
        } else {
          clickWindow.push(click);
        }
        if (pendingRageClick) {
          clearTimeout(pendingRageClick.timerId);
          pendingRageClick.resolve(resolutionValue);
          pendingRageClick = null;
        }
        if (clickWindow.length >= RAGE_CLICK_THRESHOLD) {
          return [2, new Promise(function(resolve) {
            pendingRageClick = {
              resolve,
              timerId: setTimeout(function() {
                resolve(getRageClickAnalyticsEvent(clickWindow));
              }, RAGE_CLICK_WINDOW_MS)
            };
          })];
        }
        return [2, null];
      });
    });
  });
  var selectionSubscription = selectionObservable === null || selectionObservable === void 0 ? void 0 : selectionObservable.subscribe(function() {
    resetClickWindow();
  });
  var rageClickSubscription = rageClickObservable.subscribe(function(data) {
    if (data === null) {
      return;
    }
    amplitude.track(AMPLITUDE_ELEMENT_RAGE_CLICKED_EVENT, data.rageClickEvent, { time: data.time });
  });
  return {
    unsubscribe: function() {
      rageClickSubscription.unsubscribe();
      selectionSubscription === null || selectionSubscription === void 0 ? void 0 : selectionSubscription.unsubscribe();
    }
  };
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/autocapture/track-error-click.js
var ERROR_CLICK_TIMEOUT = 2e3;
function trackErrorClicks(_a) {
  var amplitude = _a.amplitude, allObservables = _a.allObservables, shouldTrackErrorClick = _a.shouldTrackErrorClick;
  var clickObservable = allObservables.clickObservable, browserErrorObservable = allObservables.browserErrorObservable;
  var filteredClickObservable = clickObservable.filter(function(click) {
    return filterOutNonTrackableEvents(click) && shouldTrackErrorClick("click", click.closestTrackedAncestor) && click.event.target instanceof Element && click.event.target.closest('a[target="_blank"]') === null && click.event.button === MouseButton.LEFT_OR_TOUCH_CONTACT;
  });
  var errorClickTimer = null;
  var latestClickEvent = null;
  var clearClickTimer = function() {
    if (errorClickTimer !== null) {
      clearTimeout(errorClickTimer);
      errorClickTimer = null;
    }
    latestClickEvent = null;
  };
  return merge(filteredClickObservable, browserErrorObservable).subscribe(function(event) {
    var _a2;
    if (event.type === "click") {
      clearClickTimer();
      latestClickEvent = event;
      errorClickTimer = setTimeout(clearClickTimer, ERROR_CLICK_TIMEOUT);
      return;
    }
    if (event.type === "error" && latestClickEvent) {
      amplitude.track(AMPLITUDE_ELEMENT_ERROR_CLICKED_EVENT, __assign5((_a2 = {}, _a2["[Amplitude] Kind"] = event.event.kind, _a2["[Amplitude] Message"] = event.event.message, _a2["[Amplitude] Stack"] = event.event.stack, _a2["[Amplitude] Filename"] = event.event.filename, _a2["[Amplitude] Line Number"] = event.event.lineNumber, _a2["[Amplitude] Column Number"] = event.event.columnNumber, _a2), latestClickEvent.targetElementProperties));
      clearClickTimer();
    }
  });
}

// node_modules/@amplitude/plugin-autocapture-browser/lib/esm/frustration-plugin.js
function getCssSelectorAllowlist(options, attribute, defaultAllowlist, enabled) {
  if (!enabled) {
    return [];
  }
  var config = options[attribute];
  if (typeof config === "object" && config !== null && "cssSelectorAllowlist" in config && Array.isArray(config.cssSelectorAllowlist)) {
    return config.cssSelectorAllowlist;
  }
  return defaultAllowlist;
}
var frustrationPlugin = function(options) {
  var _a;
  if (options === void 0) {
    options = {};
  }
  var name = FRUSTRATION_PLUGIN_NAME;
  var type = "enrichment";
  var subscriptions = [];
  var isErrorClicksEnabled = options.errorClicks !== false;
  if (!options.errorClicks) {
    isErrorClicksEnabled = false;
  }
  var deadClicksEnabled = options.deadClicks !== false && options.deadClicks !== null;
  var rageClicksEnabled = options.rageClicks !== false && options.rageClicks !== null;
  var rageCssSelectors = getCssSelectorAllowlist(options, "rageClicks", DEFAULT_RAGE_CLICK_ALLOWLIST, rageClicksEnabled);
  var deadCssSelectors = getCssSelectorAllowlist(options, "deadClicks", DEFAULT_DEAD_CLICK_ALLOWLIST, deadClicksEnabled);
  var errorCssSelectors = getCssSelectorAllowlist(options, "errorClicks", DEFAULT_ERROR_CLICK_ALLOWLIST, isErrorClicksEnabled);
  var dataAttributePrefix = (_a = options.dataAttributePrefix) !== null && _a !== void 0 ? _a : DEFAULT_DATA_ATTRIBUTE_PREFIX;
  var dataExtractor = new DataExtractor(options);
  var combinedCssSelectors = __spreadArray4([], __read5(new Set(__spreadArray4(__spreadArray4(__spreadArray4([], __read5(rageCssSelectors), false), __read5(deadCssSelectors), false), __read5(errorCssSelectors), false))), false);
  var createObservables = function() {
    var _a2;
    var clickObservable = multicast(createClickObservable("pointerdown").map(function(click) {
      return dataExtractor.addAdditionalEventProperties(click, "click", combinedCssSelectors, dataAttributePrefix, true);
    }));
    var browserErrorObservables = multicast(createErrorObservable().map(function(error) {
      return dataExtractor.addTypeAndTimestamp(error, "error");
    }));
    var enrichedMutationObservable = multicast(createMutationObservable().map(function(mutation) {
      return dataExtractor.addAdditionalEventProperties(mutation, "mutation", combinedCssSelectors, dataAttributePrefix);
    }));
    var enrichedNavigateObservable;
    if (window.navigation) {
      var navigateObservable = new Observable(function(observer) {
        var handler = function(event) {
          observer.next(__assign5(__assign5({}, event), { type: "navigate" }));
        };
        window.navigation.addEventListener("navigate", handler);
        return function() {
          window.navigation.removeEventListener("navigate", handler);
        };
      });
      enrichedNavigateObservable = multicast(navigateObservable.map(function(navigate) {
        return dataExtractor.addAdditionalEventProperties(navigate, "navigate", combinedCssSelectors, dataAttributePrefix);
      }));
    }
    var selectionObservable = multicast(new Observable(function(observer) {
      var handler = function() {
        var el = document.activeElement;
        if (el && (el.tagName === "TEXTAREA" || el.tagName === "INPUT")) {
          var start = void 0;
          var end = void 0;
          try {
            start = el.selectionStart;
            end = el.selectionEnd;
            if (start === end)
              return;
          } catch (error) {
            return;
          }
          return observer.next();
        }
        var selection = window.getSelection();
        if (!selection || selection.isCollapsed)
          return;
        return observer.next();
      };
      window.document.addEventListener("selectionchange", handler);
      return function() {
        window.document.removeEventListener("selectionchange", handler);
      };
    }));
    return _a2 = {}, _a2[ObservablesEnum.ClickObservable] = clickObservable, _a2[ObservablesEnum.MutationObservable] = enrichedMutationObservable, _a2[ObservablesEnum.NavigateObservable] = enrichedNavigateObservable, _a2[ObservablesEnum.BrowserErrorObservable] = browserErrorObservables, _a2[ObservablesEnum.SelectionObservable] = selectionObservable, _a2;
  };
  var setup = function(config, amplitude) {
    return __awaiter4(void 0, void 0, void 0, function() {
      var allObservables, shouldTrackRageClick, rageClickSubscription, shouldTrackDeadClick, deadClickSubscription, shouldTrackErrorClick, errorClickSubscription;
      var _a2;
      return __generator4(this, function(_b) {
        if (typeof document === "undefined") {
          return [
            2
            /*return*/
          ];
        }
        allObservables = createObservables();
        if (rageClicksEnabled) {
          shouldTrackRageClick = createShouldTrackEvent(options, rageCssSelectors);
          rageClickSubscription = trackRageClicks({
            allObservables,
            amplitude,
            shouldTrackRageClick
          });
          subscriptions.push(rageClickSubscription);
        }
        if (deadClicksEnabled) {
          shouldTrackDeadClick = createShouldTrackEvent(options, deadCssSelectors);
          deadClickSubscription = trackDeadClick({
            amplitude,
            allObservables,
            getEventProperties: function(actionType, element) {
              return dataExtractor.getEventProperties(actionType, element, dataAttributePrefix);
            },
            shouldTrackDeadClick
          });
          subscriptions.push(deadClickSubscription);
        }
        if (isErrorClicksEnabled) {
          shouldTrackErrorClick = createShouldTrackEvent(options, errorCssSelectors);
          errorClickSubscription = trackErrorClicks({
            amplitude,
            allObservables,
            shouldTrackErrorClick
          });
          subscriptions.push(errorClickSubscription);
        }
        (_a2 = config === null || config === void 0 ? void 0 : config.loggerProvider) === null || _a2 === void 0 ? void 0 : _a2.log("".concat(name, " has been successfully added."));
        return [
          2
          /*return*/
        ];
      });
    });
  };
  var execute = function(event) {
    return __awaiter4(void 0, void 0, void 0, function() {
      return __generator4(this, function(_a2) {
        return [2, event];
      });
    });
  };
  var teardown = function() {
    return __awaiter4(void 0, void 0, void 0, function() {
      var subscriptions_1, subscriptions_1_1, subscription2;
      var e_1, _a2;
      return __generator4(this, function(_b) {
        try {
          for (subscriptions_1 = __values4(subscriptions), subscriptions_1_1 = subscriptions_1.next(); !subscriptions_1_1.done; subscriptions_1_1 = subscriptions_1.next()) {
            subscription2 = subscriptions_1_1.value;
            subscription2.unsubscribe();
          }
        } catch (e_1_1) {
          e_1 = { error: e_1_1 };
        } finally {
          try {
            if (subscriptions_1_1 && !subscriptions_1_1.done && (_a2 = subscriptions_1.return)) _a2.call(subscriptions_1);
          } finally {
            if (e_1) throw e_1.error;
          }
        }
        return [
          2
          /*return*/
        ];
      });
    });
  };
  return {
    name,
    type,
    setup,
    execute,
    teardown
  };
};

// node_modules/@amplitude/plugin-network-capture-browser/node_modules/tslib/tslib.es6.mjs
function __awaiter5(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e2) {
        reject(e2);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e2) {
        reject(e2);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator5(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t2[0] & 1) throw t2[1];
    return t2[1];
  }, trys: [], ops: [] }, f2, y2, t2, g2 = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
  return g2.next = verb(0), g2["throw"] = verb(1), g2["return"] = verb(2), typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n2) {
    return function(v2) {
      return step([n2, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t2 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t2 = y2["return"]) && t2.call(y2), 0) : y2.next) && !(t2 = t2.call(y2, op[1])).done) return t2;
      if (y2 = 0, t2) op = [op[0] & 2, t2.value];
      switch (op[0]) {
        case 0:
        case 1:
          t2 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t2 = _2.trys, t2 = t2.length > 0 && t2[t2.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t2 || op[1] > t2[0] && op[1] < t2[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t2[1]) {
            _2.label = t2[1];
            t2 = op;
            break;
          }
          if (t2 && _2.label < t2[2]) {
            _2.label = t2[2];
            _2.ops.push(op);
            break;
          }
          if (t2[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e2) {
      op = [6, e2];
      y2 = 0;
    } finally {
      f2 = t2 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}
function __values5(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
function __read6(o2, n2) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r2, ar = [], e2;
  try {
    while ((n2 === void 0 || n2-- > 0) && !(r2 = i2.next()).done) ar.push(r2.value);
  } catch (error) {
    e2 = { error };
  } finally {
    try {
      if (r2 && !r2.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e2) throw e2.error;
    }
  }
  return ar;
}
function __spreadArray5(to, from, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from.length, ar; i2 < l2; i2++) {
    if (ar || !(i2 in from)) {
      if (!ar) ar = Array.prototype.slice.call(from, 0, i2);
      ar[i2] = from[i2];
    }
  }
  return to.concat(ar || Array.prototype.slice.call(from));
}

// node_modules/@amplitude/plugin-network-capture-browser/lib/esm/constants.js
var PLUGIN_NAME2 = "@amplitude/plugin-network-capture-browser";
var AMPLITUDE_NETWORK_REQUEST_EVENT = "[Amplitude] Network Request";
var IS_HEADER_CAPTURE_EXPERIMENTAL = true;

// node_modules/@amplitude/plugin-network-capture-browser/lib/esm/track-network-event.js
var DEFAULT_STATUS_CODE_RANGE = "500-599";
function wildcardMatch(str, pattern) {
  var escapedPattern = pattern.replace(/[-[\]{}()+?.,\\^$|#\s]/g, "\\$&");
  var regexPattern = "^" + escapedPattern.replace(/\*/g, ".*") + "$";
  var regex = new RegExp(regexPattern);
  return regex.test(str);
}
function isStatusCodeInRange(statusCode, range) {
  var e_1, _a;
  var ranges = range.split(",");
  try {
    for (var ranges_1 = __values5(ranges), ranges_1_1 = ranges_1.next(); !ranges_1_1.done; ranges_1_1 = ranges_1.next()) {
      var r2 = ranges_1_1.value;
      var _b = __read6(r2.split("-").map(Number), 2), start = _b[0], end = _b[1];
      if (statusCode === start && end === void 0) {
        return true;
      }
      if (statusCode >= start && statusCode <= end) {
        return true;
      }
    }
  } catch (e_1_1) {
    e_1 = { error: e_1_1 };
  } finally {
    try {
      if (ranges_1_1 && !ranges_1_1.done && (_a = ranges_1.return)) _a.call(ranges_1);
    } finally {
      if (e_1) throw e_1.error;
    }
  }
  return false;
}
function isCaptureRuleMatch(rule, hostname, status, url, method) {
  if (rule.hosts && !rule.hosts.find(function(host) {
    return wildcardMatch(hostname, host);
  })) {
    return;
  }
  if (url && rule.urls && !isUrlMatchAllowlist(url, rule.urls)) {
    return;
  }
  if (method && rule.methods && !rule.methods.find(function(allowedMethod) {
    return method.toLowerCase() === allowedMethod.toLowerCase() || allowedMethod === "*";
  })) {
    return;
  }
  if (status || status === 0) {
    var statusCodeRange = rule.statusCodeRange || DEFAULT_STATUS_CODE_RANGE;
    if (!isStatusCodeInRange(status, statusCodeRange)) {
      return false;
    }
  }
  return true;
}
function parseUrl(url) {
  var _a;
  if (!url) {
    return;
  }
  try {
    var currentHref = (_a = getGlobalScope()) === null || _a === void 0 ? void 0 : _a.location.href;
    var urlObj = new URL(url, currentHref);
    var query = urlObj.searchParams.toString();
    var fragment = urlObj.hash.replace("#", "");
    var href = urlObj.href;
    var host = urlObj.host;
    urlObj.hash = "";
    urlObj.search = "";
    var hrefWithoutQueryOrHash = urlObj.href;
    return { query, fragment, href, hrefWithoutQueryOrHash, host };
  } catch (e2) {
    return;
  }
}
function isAmplitudeNetworkRequestEvent(host, requestWrapper) {
  if (host.includes("amplitude.com")) {
    try {
      var body = requestWrapper.body;
      if (typeof body !== "string") {
        return false;
      }
      var bodyObj = JSON.parse(body);
      var events = bodyObj.events;
      if (events.find(function(event) {
        return event.event_type === AMPLITUDE_NETWORK_REQUEST_EVENT;
      })) {
        return true;
      }
    } catch (e2) {
    }
  }
  return false;
}
function parseHeaderCaptureRule(rule) {
  if (typeof rule !== "object" || rule === null) {
    if (rule) {
      return __spreadArray5([], __read6(SAFE_HEADERS), false);
    } else if (rule === void 0) {
      var res = IS_HEADER_CAPTURE_EXPERIMENTAL ? void 0 : __spreadArray5([], __read6(SAFE_HEADERS), false);
      return res;
    }
    return;
  }
  if (rule.length === 0) {
    return;
  }
  return rule;
}
function isBodyCaptureRuleEmpty(rule) {
  var _a, _b;
  return !((_a = rule === null || rule === void 0 ? void 0 : rule.allowlist) === null || _a === void 0 ? void 0 : _a.length) && !((_b = rule === null || rule === void 0 ? void 0 : rule.blocklist) === null || _b === void 0 ? void 0 : _b.length);
}
function shouldTrackNetworkEvent(networkEvent, options) {
  var _a;
  if (options === void 0) {
    options = {};
  }
  var urlObj = parseUrl(networkEvent.url);
  if (!urlObj) {
    return false;
  }
  var host = urlObj.host;
  if (options.ignoreAmplitudeRequests !== false && (wildcardMatch(host, "*.amplitude.com") || wildcardMatch(host, "amplitude.com"))) {
    return false;
  }
  if ((_a = options.ignoreHosts) === null || _a === void 0 ? void 0 : _a.find(function(ignoreHost) {
    return wildcardMatch(host, ignoreHost);
  })) {
    return false;
  }
  if (!options.captureRules && networkEvent.status !== void 0 && !isStatusCodeInRange(networkEvent.status, DEFAULT_STATUS_CODE_RANGE)) {
    return false;
  }
  if (options.captureRules) {
    var isMatch_1;
    __spreadArray5([], __read6(options.captureRules), false).reverse().find(function(rule) {
      isMatch_1 = isCaptureRuleMatch(rule, host, networkEvent.status, networkEvent.url, networkEvent.method);
      if (isMatch_1) {
        var responseHeadersRule = parseHeaderCaptureRule(rule.responseHeaders);
        if (networkEvent.responseWrapper && responseHeadersRule) {
          var responseHeaders = networkEvent.responseWrapper.headers(responseHeadersRule);
          if (responseHeaders) {
            networkEvent.responseHeaders = responseHeaders;
          }
        }
        var requestHeadersRule = parseHeaderCaptureRule(rule.requestHeaders);
        if (networkEvent.requestWrapper && requestHeadersRule) {
          var requestHeaders = networkEvent.requestWrapper.headers(requestHeadersRule);
          if (requestHeaders) {
            networkEvent.requestHeaders = requestHeaders;
          }
        }
        if (networkEvent.responseWrapper && rule.responseBody && !isBodyCaptureRuleEmpty(rule.responseBody)) {
          networkEvent.responseBodyJson = networkEvent.responseWrapper.json(rule.responseBody.allowlist, rule.responseBody.blocklist);
        }
        if (networkEvent.requestWrapper && rule.requestBody && !isBodyCaptureRuleEmpty(rule.requestBody)) {
          networkEvent.requestBodyJson = networkEvent.requestWrapper.json(rule.requestBody.allowlist, rule.requestBody.blocklist);
        }
      }
      return isMatch_1 !== void 0;
    });
    if (!isMatch_1) {
      return false;
    }
  }
  if (networkEvent.requestWrapper && isAmplitudeNetworkRequestEvent(host, networkEvent.requestWrapper)) {
    return false;
  }
  return true;
}
function logNetworkAnalyticsEvent(networkAnalyticsEvent, request, amplitude, loggerProvider) {
  return __awaiter5(this, void 0, void 0, function() {
    var _a, requestBody, responseBody;
    return __generator5(this, function(_b) {
      switch (_b.label) {
        case 0:
          if (!(request.requestBodyJson || request.responseBodyJson)) return [3, 2];
          return [4, Promise.all([request.requestBodyJson, request.responseBodyJson])];
        case 1:
          _a = __read6.apply(void 0, [_b.sent(), 2]), requestBody = _a[0], responseBody = _a[1];
          if (requestBody) {
            try {
              networkAnalyticsEvent["[Amplitude] Request Body"] = JSON.stringify(requestBody);
            } catch (e2) {
              loggerProvider === null || loggerProvider === void 0 ? void 0 : loggerProvider.debug("Failed to stringify request body", e2);
            }
          }
          if (responseBody) {
            try {
              networkAnalyticsEvent["[Amplitude] Response Body"] = JSON.stringify(responseBody);
            } catch (e2) {
              loggerProvider === null || loggerProvider === void 0 ? void 0 : loggerProvider.debug("Failed to stringify response body");
            }
          }
          _b.label = 2;
        case 2:
          amplitude === null || amplitude === void 0 ? void 0 : amplitude.track(AMPLITUDE_NETWORK_REQUEST_EVENT, networkAnalyticsEvent);
          return [
            2
            /*return*/
          ];
      }
    });
  });
}
function trackNetworkEvents(_a) {
  var allObservables = _a.allObservables, networkTrackingOptions = _a.networkTrackingOptions, amplitude = _a.amplitude, loggerProvider = _a.loggerProvider;
  var networkObservable = allObservables.networkObservable;
  var filteredNetworkObservable = networkObservable.filter(function(event) {
    return shouldTrackNetworkEvent(event.event, networkTrackingOptions);
  });
  return filteredNetworkObservable.subscribe(function(networkEvent) {
    var _a2;
    var _b, _c;
    var request = networkEvent.event;
    var urlObj = parseUrl(request.url);
    if (!urlObj) {
      return;
    }
    var responseBodySize = (_b = request.responseWrapper) === null || _b === void 0 ? void 0 : _b.bodySize;
    var requestBodySize = (_c = request.requestWrapper) === null || _c === void 0 ? void 0 : _c.bodySize;
    var networkAnalyticsEvent = (_a2 = {}, _a2["[Amplitude] URL"] = urlObj.hrefWithoutQueryOrHash, _a2["[Amplitude] URL Query"] = urlObj.query, _a2["[Amplitude] URL Fragment"] = urlObj.fragment, _a2["[Amplitude] Request Method"] = request.method, _a2["[Amplitude] Status Code"] = request.status, _a2["[Amplitude] Start Time"] = request.startTime, _a2["[Amplitude] Completion Time"] = request.endTime, _a2["[Amplitude] Duration"] = request.duration, _a2["[Amplitude] Request Body Size"] = requestBodySize, _a2["[Amplitude] Response Body Size"] = responseBodySize, _a2["[Amplitude] Request Type"] = request.type, _a2["[Amplitude] Request Headers"] = request.requestHeaders, _a2["[Amplitude] Response Headers"] = request.responseHeaders, _a2);
    void logNetworkAnalyticsEvent(networkAnalyticsEvent, request, amplitude, loggerProvider);
  });
}

// node_modules/@amplitude/plugin-network-capture-browser/lib/esm/network-capture-plugin.js
var ObservablesEnum2;
(function(ObservablesEnum3) {
  ObservablesEnum3["NetworkObservable"] = "networkObservable";
})(ObservablesEnum2 || (ObservablesEnum2 = {}));
var subscription;
var networkCapturePlugin = function(options) {
  if (options === void 0) {
    options = {};
  }
  var name = PLUGIN_NAME2;
  var type = "enrichment";
  var logger;
  var addAdditionalEventProperties = function(event, type2) {
    var baseEvent = {
      event,
      timestamp: Date.now(),
      type: type2
    };
    return baseEvent;
  };
  var createObservables = function() {
    var _a;
    var networkObservable = new Observable(function(observer) {
      var callback = new NetworkEventCallback(function(event) {
        var eventWithProperties = addAdditionalEventProperties(event, "network");
        observer.next(eventWithProperties);
      });
      networkObserver.subscribe(callback, logger);
      return function() {
        networkObserver.unsubscribe(callback);
      };
    });
    return _a = {}, _a[ObservablesEnum2.NetworkObservable] = networkObservable, _a;
  };
  var setup = function(config, amplitude) {
    return __awaiter5(void 0, void 0, void 0, function() {
      var allObservables;
      return __generator5(this, function(_a) {
        if (typeof document === "undefined") {
          return [
            2
            /*return*/
          ];
        }
        allObservables = createObservables();
        logger = config === null || config === void 0 ? void 0 : config.loggerProvider;
        subscription = trackNetworkEvents({
          allObservables,
          networkTrackingOptions: options,
          amplitude,
          loggerProvider: logger
        });
        logger === null || logger === void 0 ? void 0 : logger.log("".concat(name, " has been successfully added."));
        return [
          2
          /*return*/
        ];
      });
    });
  };
  var execute = function(event) {
    return __awaiter5(void 0, void 0, void 0, function() {
      return __generator5(this, function(_a) {
        return [2, event];
      });
    });
  };
  var teardown = function() {
    return __awaiter5(void 0, void 0, void 0, function() {
      return __generator5(this, function(_a) {
        subscription.unsubscribe();
        return [
          2
          /*return*/
        ];
      });
    });
  };
  return {
    name,
    type,
    setup,
    execute,
    teardown
  };
};

// node_modules/@amplitude/plugin-web-vitals-browser/node_modules/tslib/tslib.es6.mjs
function __awaiter6(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e2) {
        reject(e2);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e2) {
        reject(e2);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator6(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t2[0] & 1) throw t2[1];
    return t2[1];
  }, trys: [], ops: [] }, f2, y2, t2, g2 = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
  return g2.next = verb(0), g2["throw"] = verb(1), g2["return"] = verb(2), typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n2) {
    return function(v2) {
      return step([n2, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t2 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t2 = y2["return"]) && t2.call(y2), 0) : y2.next) && !(t2 = t2.call(y2, op[1])).done) return t2;
      if (y2 = 0, t2) op = [op[0] & 2, t2.value];
      switch (op[0]) {
        case 0:
        case 1:
          t2 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t2 = _2.trys, t2 = t2.length > 0 && t2[t2.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t2 || op[1] > t2[0] && op[1] < t2[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t2[1]) {
            _2.label = t2[1];
            t2 = op;
            break;
          }
          if (t2 && _2.label < t2[2]) {
            _2.label = t2[2];
            _2.ops.push(op);
            break;
          }
          if (t2[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e2) {
      op = [6, e2];
      y2 = 0;
    } finally {
      f2 = t2 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}

// node_modules/@amplitude/plugin-web-vitals-browser/lib/esm/constants.js
var PLUGIN_NAME3 = "web-vitals-browser";
var WEB_VITALS_EVENT_NAME = "[Amplitude] Web Vitals";

// node_modules/web-vitals/dist/web-vitals.js
var e = -1;
var t = (t2) => {
  addEventListener("pageshow", ((n2) => {
    n2.persisted && (e = n2.timeStamp, t2(n2));
  }), true);
};
var n = (e2, t2, n2, i2) => {
  let s2, o2;
  return (r2) => {
    t2.value >= 0 && (r2 || i2) && (o2 = t2.value - (s2 ?? 0), (o2 || void 0 === s2) && (s2 = t2.value, t2.delta = o2, t2.rating = ((e3, t3) => e3 > t3[1] ? "poor" : e3 > t3[0] ? "needs-improvement" : "good")(t2.value, n2), e2(t2)));
  };
};
var i = (e2) => {
  requestAnimationFrame((() => requestAnimationFrame((() => e2()))));
};
var s = () => {
  const e2 = performance.getEntriesByType("navigation")[0];
  if (e2 && e2.responseStart > 0 && e2.responseStart < performance.now()) return e2;
};
var o = () => {
  const e2 = s();
  return e2?.activationStart ?? 0;
};
var r = (t2, n2 = -1) => {
  const i2 = s();
  let r2 = "navigate";
  e >= 0 ? r2 = "back-forward-cache" : i2 && (document.prerendering || o() > 0 ? r2 = "prerender" : document.wasDiscarded ? r2 = "restore" : i2.type && (r2 = i2.type.replace(/_/g, "-")));
  return { name: t2, value: n2, rating: "good", delta: 0, entries: [], id: `v5-${Date.now()}-${Math.floor(8999999999999 * Math.random()) + 1e12}`, navigationType: r2 };
};
var c = /* @__PURE__ */ new WeakMap();
function a(e2, t2) {
  return c.get(e2) || c.set(e2, new t2()), c.get(e2);
}
var d = class {
  t;
  i = 0;
  o = [];
  h(e2) {
    if (e2.hadRecentInput) return;
    const t2 = this.o[0], n2 = this.o.at(-1);
    this.i && t2 && n2 && e2.startTime - n2.startTime < 1e3 && e2.startTime - t2.startTime < 5e3 ? (this.i += e2.value, this.o.push(e2)) : (this.i = e2.value, this.o = [e2]), this.t?.(e2);
  }
};
var h = (e2, t2, n2 = {}) => {
  try {
    if (PerformanceObserver.supportedEntryTypes.includes(e2)) {
      const i2 = new PerformanceObserver(((e3) => {
        Promise.resolve().then((() => {
          t2(e3.getEntries());
        }));
      }));
      return i2.observe({ type: e2, buffered: true, ...n2 }), i2;
    }
  } catch {
  }
};
var f = (e2) => {
  let t2 = false;
  return () => {
    t2 || (e2(), t2 = true);
  };
};
var u = -1;
var l = /* @__PURE__ */ new Set();
var m = () => "hidden" !== document.visibilityState || document.prerendering ? 1 / 0 : 0;
var p = (e2) => {
  if ("hidden" === document.visibilityState) {
    if ("visibilitychange" === e2.type) for (const e3 of l) e3();
    isFinite(u) || (u = "visibilitychange" === e2.type ? e2.timeStamp : 0, removeEventListener("prerenderingchange", p, true));
  }
};
var v = () => {
  if (u < 0) {
    const e2 = o(), n2 = document.prerendering ? void 0 : globalThis.performance.getEntriesByType("visibility-state").filter(((t2) => "hidden" === t2.name && t2.startTime > e2))[0]?.startTime;
    u = n2 ?? m(), addEventListener("visibilitychange", p, true), addEventListener("prerenderingchange", p, true), t((() => {
      setTimeout((() => {
        u = m();
      }));
    }));
  }
  return { get firstHiddenTime() {
    return u;
  }, onHidden(e2) {
    l.add(e2);
  } };
};
var g = (e2) => {
  document.prerendering ? addEventListener("prerenderingchange", (() => e2()), true) : e2();
};
var y = [1800, 3e3];
var E = (e2, s2 = {}) => {
  g((() => {
    const c2 = v();
    let a2, d2 = r("FCP");
    const f2 = h("paint", ((e3) => {
      for (const t2 of e3) "first-contentful-paint" === t2.name && (f2.disconnect(), t2.startTime < c2.firstHiddenTime && (d2.value = Math.max(t2.startTime - o(), 0), d2.entries.push(t2), a2(true)));
    }));
    f2 && (a2 = n(e2, d2, y, s2.reportAllChanges), t(((t2) => {
      d2 = r("FCP"), a2 = n(e2, d2, y, s2.reportAllChanges), i((() => {
        d2.value = performance.now() - t2.timeStamp, a2(true);
      }));
    })));
  }));
};
var b = [0.1, 0.25];
var L = (e2, s2 = {}) => {
  const o2 = v();
  E(f((() => {
    let c2, f2 = r("CLS", 0);
    const u2 = a(s2, d), l2 = (e3) => {
      for (const t2 of e3) u2.h(t2);
      u2.i > f2.value && (f2.value = u2.i, f2.entries = u2.o, c2());
    }, m2 = h("layout-shift", l2);
    m2 && (c2 = n(e2, f2, b, s2.reportAllChanges), o2.onHidden((() => {
      l2(m2.takeRecords()), c2(true);
    })), t((() => {
      u2.i = 0, f2 = r("CLS", 0), c2 = n(e2, f2, b, s2.reportAllChanges), i((() => c2()));
    })), setTimeout(c2));
  })));
};
var P = 0;
var T = 1 / 0;
var _ = 0;
var M = (e2) => {
  for (const t2 of e2) t2.interactionId && (T = Math.min(T, t2.interactionId), _ = Math.max(_, t2.interactionId), P = _ ? (_ - T) / 7 + 1 : 0);
};
var w;
var C = () => w ? P : performance.interactionCount ?? 0;
var I = () => {
  "interactionCount" in performance || w || (w = h("event", M, { type: "event", buffered: true, durationThreshold: 0 }));
};
var F = 0;
var k = class {
  u = [];
  l = /* @__PURE__ */ new Map();
  m;
  p;
  v() {
    F = C(), this.u.length = 0, this.l.clear();
  }
  L() {
    const e2 = Math.min(this.u.length - 1, Math.floor((C() - F) / 50));
    return this.u[e2];
  }
  h(e2) {
    if (this.m?.(e2), !e2.interactionId && "first-input" !== e2.entryType) return;
    const t2 = this.u.at(-1);
    let n2 = this.l.get(e2.interactionId);
    if (n2 || this.u.length < 10 || e2.duration > t2.P) {
      if (n2 ? e2.duration > n2.P ? (n2.entries = [e2], n2.P = e2.duration) : e2.duration === n2.P && e2.startTime === n2.entries[0].startTime && n2.entries.push(e2) : (n2 = { id: e2.interactionId, entries: [e2], P: e2.duration }, this.l.set(n2.id, n2), this.u.push(n2)), this.u.sort(((e3, t3) => t3.P - e3.P)), this.u.length > 10) {
        const e3 = this.u.splice(10);
        for (const t3 of e3) this.l.delete(t3.id);
      }
      this.p?.(n2);
    }
  }
};
var A = (e2) => {
  const t2 = globalThis.requestIdleCallback || setTimeout;
  "hidden" === document.visibilityState ? e2() : (e2 = f(e2), addEventListener("visibilitychange", e2, { once: true, capture: true }), t2((() => {
    e2(), removeEventListener("visibilitychange", e2, { capture: true });
  })));
};
var B = [200, 500];
var S = (e2, i2 = {}) => {
  if (!globalThis.PerformanceEventTiming || !("interactionId" in PerformanceEventTiming.prototype)) return;
  const s2 = v();
  g((() => {
    I();
    let o2, c2 = r("INP");
    const d2 = a(i2, k), f2 = (e3) => {
      A((() => {
        for (const t3 of e3) d2.h(t3);
        const t2 = d2.L();
        t2 && t2.P !== c2.value && (c2.value = t2.P, c2.entries = t2.entries, o2());
      }));
    }, u2 = h("event", f2, { durationThreshold: i2.durationThreshold ?? 40 });
    o2 = n(e2, c2, B, i2.reportAllChanges), u2 && (u2.observe({ type: "first-input", buffered: true }), s2.onHidden((() => {
      f2(u2.takeRecords()), o2(true);
    })), t((() => {
      d2.v(), c2 = r("INP"), o2 = n(e2, c2, B, i2.reportAllChanges);
    })));
  }));
};
var N = class {
  m;
  h(e2) {
    this.m?.(e2);
  }
};
var q = [2500, 4e3];
var x = (e2, s2 = {}) => {
  g((() => {
    const c2 = v();
    let d2, u2 = r("LCP");
    const l2 = a(s2, N), m2 = (e3) => {
      s2.reportAllChanges || (e3 = e3.slice(-1));
      for (const t2 of e3) l2.h(t2), t2.startTime < c2.firstHiddenTime && (u2.value = Math.max(t2.startTime - o(), 0), u2.entries = [t2], d2());
    }, p2 = h("largest-contentful-paint", m2);
    if (p2) {
      d2 = n(e2, u2, q, s2.reportAllChanges);
      const o2 = f((() => {
        m2(p2.takeRecords()), p2.disconnect(), d2(true);
      })), c3 = (e3) => {
        e3.isTrusted && (A(o2), removeEventListener(e3.type, c3, { capture: true }));
      };
      for (const e3 of ["keydown", "click", "visibilitychange"]) addEventListener(e3, c3, { capture: true });
      t(((t2) => {
        u2 = r("LCP"), d2 = n(e2, u2, q, s2.reportAllChanges), i((() => {
          u2.value = performance.now() - t2.timeStamp, d2(true);
        }));
      }));
    }
  }));
};
var H = [800, 1800];
var O = (e2) => {
  document.prerendering ? g((() => O(e2))) : "complete" !== document.readyState ? addEventListener("load", (() => O(e2)), true) : setTimeout(e2);
};
var $ = (e2, i2 = {}) => {
  let c2 = r("TTFB"), a2 = n(e2, c2, H, i2.reportAllChanges);
  O((() => {
    const d2 = s();
    d2 && (c2.value = Math.max(d2.responseStart - o(), 0), c2.entries = [d2], a2(true), t((() => {
      c2 = r("TTFB", 0), a2 = n(e2, c2, H, i2.reportAllChanges), a2(true);
    })));
  }));
};

// node_modules/@amplitude/plugin-web-vitals-browser/lib/esm/web-vitals-plugin.js
function getMetricStartTime(metric) {
  var _a;
  var startTime = ((_a = metric.entries[0]) === null || _a === void 0 ? void 0 : _a.startTime) || 0;
  return performance.timeOrigin + startTime;
}
function processMetric(metric) {
  return {
    value: metric.value,
    rating: metric.rating,
    delta: metric.delta,
    navigationType: metric.navigationType,
    id: metric.id,
    timestamp: Math.floor(getMetricStartTime(metric)),
    navigationStart: Math.floor(performance.timeOrigin)
  };
}
var webVitalsPlugin = function() {
  var visibilityListener = null;
  var globalScope3 = getGlobalScope();
  var doc = globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.document;
  var location2 = globalScope3 === null || globalScope3 === void 0 ? void 0 : globalScope3.location;
  var setup = function(config, amplitude) {
    return __awaiter6(void 0, void 0, void 0, function() {
      var locationHref, webVitalsPayload;
      return __generator6(this, function(_a) {
        if (doc === void 0) {
          return [
            2
            /*return*/
          ];
        }
        locationHref = getDecodeURI(
          /* istanbul ignore next */
          (location2 === null || location2 === void 0 ? void 0 : location2.href) || "",
          config.loggerProvider
        );
        webVitalsPayload = {
          "[Amplitude] Page Domain": (
            /* istanbul ignore next */
            (location2 === null || location2 === void 0 ? void 0 : location2.hostname) || ""
          ),
          "[Amplitude] Page Location": locationHref,
          "[Amplitude] Page Path": getDecodeURI(
            /* istanbul ignore next */
            (location2 === null || location2 === void 0 ? void 0 : location2.pathname) || "",
            config.loggerProvider
          ),
          "[Amplitude] Page Title": (
            /* istanbul ignore next */
            typeof document !== "undefined" && document.title || ""
          ),
          "[Amplitude] Page URL": getDecodeURI(locationHref.split("?")[0], config.loggerProvider)
        };
        x(function(metric) {
          webVitalsPayload["[Amplitude] LCP"] = processMetric(metric);
        });
        E(function(metric) {
          webVitalsPayload["[Amplitude] FCP"] = processMetric(metric);
        });
        S(function(metric) {
          webVitalsPayload["[Amplitude] INP"] = processMetric(metric);
        });
        L(function(metric) {
          webVitalsPayload["[Amplitude] CLS"] = processMetric(metric);
        });
        $(function(metric) {
          webVitalsPayload["[Amplitude] TTFB"] = processMetric(metric);
        });
        visibilityListener = function() {
          if (doc.visibilityState === "hidden" && visibilityListener) {
            amplitude.track(WEB_VITALS_EVENT_NAME, webVitalsPayload);
            doc.removeEventListener("visibilitychange", visibilityListener);
            visibilityListener = null;
          }
        };
        doc.addEventListener("visibilitychange", visibilityListener);
        return [
          2
          /*return*/
        ];
      });
    });
  };
  var execute = function(event) {
    return __awaiter6(void 0, void 0, void 0, function() {
      return __generator6(this, function(_a) {
        return [2, event];
      });
    });
  };
  var teardown = function() {
    return __awaiter6(void 0, void 0, void 0, function() {
      return __generator6(this, function(_a) {
        if (visibilityListener) {
          doc === null || doc === void 0 ? void 0 : doc.removeEventListener("visibilitychange", visibilityListener);
        }
        return [
          2
          /*return*/
        ];
      });
    });
  };
  return {
    name: PLUGIN_NAME3,
    type: "enrichment",
    setup,
    execute,
    teardown
  };
};

// node_modules/@amplitude/analytics-browser/lib/esm/attribution/helpers.js
var domainWithoutSubdomain = function(domain) {
  var parts = domain.split(".");
  if (parts.length <= 2) {
    return domain;
  }
  return parts.slice(parts.length - 2, parts.length).join(".");
};
var isDirectTraffic = function(current) {
  return Object.values(current).every(function(value) {
    return !value;
  });
};
var isNewCampaign = function(current, previous, options, logger, isNewSession2) {
  if (isNewSession2 === void 0) {
    isNewSession2 = true;
  }
  var referrer = current.referrer, referring_domain = current.referring_domain, currentCampaign = __rest2(current, ["referrer", "referring_domain"]);
  var _a = previous || {}, _previous_referrer = _a.referrer, prevReferringDomain = _a.referring_domain, previousCampaign = __rest2(_a, ["referrer", "referring_domain"]);
  if (isExcludedReferrer(options.excludeReferrers, current.referring_domain)) {
    logger.debug("This is not a new campaign because ".concat(current.referring_domain, " is in the exclude referrer list."));
    return false;
  }
  if (!isNewSession2 && isDirectTraffic(current) && previous) {
    logger.debug("This is not a new campaign because this is a direct traffic in the same session.");
    return false;
  }
  var hasNewCampaign = JSON.stringify(currentCampaign) !== JSON.stringify(previousCampaign);
  var hasNewDomain = domainWithoutSubdomain(referring_domain || "") !== domainWithoutSubdomain(prevReferringDomain || "");
  var result = !previous || hasNewCampaign || hasNewDomain;
  if (!result) {
    logger.debug("This is not a new campaign because it's the same as the previous one.");
  } else {
    logger.debug("This is a new campaign. An $identify event will be sent.");
  }
  return result;
};
var isExcludedReferrer = function(excludeReferrers, referringDomain) {
  if (excludeReferrers === void 0) {
    excludeReferrers = [];
  }
  if (referringDomain === void 0) {
    referringDomain = "";
  }
  return excludeReferrers.some(function(value) {
    return value instanceof RegExp ? value.test(referringDomain) : value === referringDomain;
  });
};
var createCampaignEvent = function(campaign, options) {
  var campaignParameters = __assign3(__assign3({}, BASE_CAMPAIGN), campaign);
  var identifyEvent = Object.entries(campaignParameters).reduce(function(identify2, _a) {
    var _b;
    var _c = __read3(_a, 2), key = _c[0], value = _c[1];
    identify2.setOnce("initial_".concat(key), (_b = value !== null && value !== void 0 ? value : options.initialEmptyValue) !== null && _b !== void 0 ? _b : "EMPTY");
    if (value) {
      return identify2.set(key, value);
    }
    return identify2.unset(key);
  }, new Identify());
  return createIdentifyEvent(identifyEvent);
};
var getDefaultExcludedReferrers = function(cookieDomain) {
  var domain = cookieDomain;
  if (domain) {
    if (domain.startsWith(".")) {
      domain = domain.substring(1);
    }
    return [new RegExp("".concat(domain.replace(".", "\\."), "$"))];
  }
  return [];
};

// node_modules/@amplitude/analytics-browser/lib/esm/attribution/web-attribution.js
var WebAttribution = (
  /** @class */
  (function() {
    function WebAttribution2(options, config) {
      var _a;
      this.shouldTrackNewCampaign = false;
      this.options = __assign3({ initialEmptyValue: "EMPTY", resetSessionOnNewCampaign: false, excludeReferrers: getDefaultExcludedReferrers((_a = config.cookieOptions) === null || _a === void 0 ? void 0 : _a.domain) }, options);
      this.storage = config.cookieStorage;
      this.storageKey = getStorageKey(config.apiKey, "MKTG");
      this.webExpStorageKey = getStorageKey(config.apiKey, "MKTG_ORIGINAL");
      this.currentCampaign = BASE_CAMPAIGN;
      this.sessionTimeout = config.sessionTimeout;
      this.lastEventTime = config.lastEventTime;
      this.logger = config.loggerProvider;
      config.loggerProvider.log("Installing web attribution tracking.");
    }
    WebAttribution2.prototype.init = function() {
      return __awaiter2(this, void 0, void 0, function() {
        var isEventInNewSession;
        var _a;
        return __generator2(this, function(_b) {
          switch (_b.label) {
            case 0:
              return [4, this.fetchCampaign()];
            case 1:
              _a = __read3.apply(void 0, [_b.sent(), 2]), this.currentCampaign = _a[0], this.previousCampaign = _a[1];
              isEventInNewSession = !this.lastEventTime ? true : isNewSession(this.sessionTimeout, this.lastEventTime);
              if (!isNewCampaign(this.currentCampaign, this.previousCampaign, this.options, this.logger, isEventInNewSession)) return [3, 3];
              this.shouldTrackNewCampaign = true;
              return [4, this.storage.set(this.storageKey, this.currentCampaign)];
            case 2:
              _b.sent();
              _b.label = 3;
            case 3:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    WebAttribution2.prototype.fetchCampaign = function() {
      return __awaiter2(this, void 0, void 0, function() {
        var originalCampaign;
        return __generator2(this, function(_a) {
          switch (_a.label) {
            case 0:
              return [4, this.storage.get(this.webExpStorageKey)];
            case 1:
              originalCampaign = _a.sent();
              if (!originalCampaign) return [3, 3];
              return [4, this.storage.remove(this.webExpStorageKey)];
            case 2:
              _a.sent();
              _a.label = 3;
            case 3:
              return [4, Promise.all([originalCampaign || new CampaignParser().parse(), this.storage.get(this.storageKey)])];
            case 4:
              return [2, _a.sent()];
          }
        });
      });
    };
    WebAttribution2.prototype.generateCampaignEvent = function(event_id) {
      this.shouldTrackNewCampaign = false;
      var campaignEvent = createCampaignEvent(this.currentCampaign, this.options);
      if (event_id) {
        campaignEvent.event_id = event_id;
      }
      return campaignEvent;
    };
    WebAttribution2.prototype.shouldSetSessionIdOnNewCampaign = function() {
      return this.shouldTrackNewCampaign && !!this.options.resetSessionOnNewCampaign;
    };
    return WebAttribution2;
  })()
);

// node_modules/@amplitude/plugin-page-url-enrichment-browser/node_modules/tslib/tslib.es6.mjs
var __assign6 = function() {
  __assign6 = Object.assign || function __assign7(t2) {
    for (var s2, i2 = 1, n2 = arguments.length; i2 < n2; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2)) t2[p2] = s2[p2];
    }
    return t2;
  };
  return __assign6.apply(this, arguments);
};
function __awaiter7(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e2) {
        reject(e2);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e2) {
        reject(e2);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator7(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t2[0] & 1) throw t2[1];
    return t2[1];
  }, trys: [], ops: [] }, f2, y2, t2, g2 = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
  return g2.next = verb(0), g2["throw"] = verb(1), g2["return"] = verb(2), typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n2) {
    return function(v2) {
      return step([n2, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t2 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t2 = y2["return"]) && t2.call(y2), 0) : y2.next) && !(t2 = t2.call(y2, op[1])).done) return t2;
      if (y2 = 0, t2) op = [op[0] & 2, t2.value];
      switch (op[0]) {
        case 0:
        case 1:
          t2 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t2 = _2.trys, t2 = t2.length > 0 && t2[t2.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t2 || op[1] > t2[0] && op[1] < t2[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t2[1]) {
            _2.label = t2[1];
            t2 = op;
            break;
          }
          if (t2 && _2.label < t2[2]) {
            _2.label = t2[2];
            _2.ops.push(op);
            break;
          }
          if (t2[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e2) {
      op = [6, e2];
      y2 = 0;
    } finally {
      f2 = t2 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}
function __read7(o2, n2) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r2, ar = [], e2;
  try {
    while ((n2 === void 0 || n2-- > 0) && !(r2 = i2.next()).done) ar.push(r2.value);
  } catch (error) {
    e2 = { error };
  } finally {
    try {
      if (r2 && !r2.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e2) throw e2.error;
    }
  }
  return ar;
}

// node_modules/@amplitude/plugin-page-url-enrichment-browser/lib/esm/page-url-enrichment.js
var CURRENT_PAGE_STORAGE_KEY = "AMP_CURRENT_PAGE";
var PREVIOUS_PAGE_STORAGE_KEY = "AMP_PREVIOUS_PAGE";
var URL_INFO_STORAGE_KEY = "AMP_URL_INFO";
var PreviousPageType;
(function(PreviousPageType2) {
  PreviousPageType2["Direct"] = "direct";
  PreviousPageType2["Internal"] = "internal";
  PreviousPageType2["External"] = "external";
})(PreviousPageType || (PreviousPageType = {}));
var EXCLUDED_DEFAULT_EVENT_TYPES = /* @__PURE__ */ new Set([
  SpecialEventType.IDENTIFY,
  SpecialEventType.GROUP_IDENTIFY,
  SpecialEventType.REVENUE
]);
var pageUrlEnrichmentPlugin = function(_a) {
  var _b = _a === void 0 ? {} : _a, _c = _b.internalDomains, internalDomains = _c === void 0 ? [] : _c;
  var globalScope3 = getGlobalScope();
  var sessionStorage = void 0;
  var isStorageEnabled = false;
  var loggerProvider = void 0;
  var isProxied = false;
  var isTracking = false;
  var getHostname = function(url) {
    var hostname;
    try {
      var decodedUrl = getDecodeURI(url, loggerProvider);
      hostname = new URL(decodedUrl).hostname;
    } catch (e2) {
      loggerProvider === null || loggerProvider === void 0 ? void 0 : loggerProvider.error("Could not parse URL: ", e2);
    }
    return hostname;
  };
  var getPrevPageType = function(previousPage) {
    var currentDomain = typeof location !== "undefined" && location.hostname || "";
    var previousPageDomain = previousPage ? getHostname(previousPage) : void 0;
    if (!previousPageDomain) {
      return PreviousPageType.Direct;
    }
    var isCurrentInternal = internalDomains.some(function(domain) {
      return currentDomain.indexOf(domain) !== -1;
    });
    var isPrevInternal = internalDomains.some(function(domain) {
      return previousPageDomain.indexOf(domain) !== -1;
    });
    if (currentDomain === previousPageDomain || isPrevInternal && isCurrentInternal) {
      return PreviousPageType.Internal;
    }
    return PreviousPageType.External;
  };
  var saveURLInfo = function() {
    return __awaiter7(void 0, void 0, void 0, function() {
      var URLInfo, currentURL, storedCurrentURL, previousURL;
      var _a2;
      return __generator7(this, function(_b2) {
        switch (_b2.label) {
          case 0:
            if (!(sessionStorage && isStorageEnabled)) return [3, 3];
            return [4, sessionStorage.get(URL_INFO_STORAGE_KEY)];
          case 1:
            URLInfo = _b2.sent();
            currentURL = getDecodeURI(typeof location !== "undefined" && location.href || "");
            storedCurrentURL = (URLInfo === null || URLInfo === void 0 ? void 0 : URLInfo[CURRENT_PAGE_STORAGE_KEY]) || "";
            previousURL = void 0;
            if (currentURL === storedCurrentURL) {
              previousURL = (URLInfo === null || URLInfo === void 0 ? void 0 : URLInfo[PREVIOUS_PAGE_STORAGE_KEY]) || "";
            } else if (storedCurrentURL) {
              previousURL = storedCurrentURL;
            } else {
              previousURL = document.referrer || "";
            }
            return [4, sessionStorage.set(URL_INFO_STORAGE_KEY, (_a2 = {}, _a2[CURRENT_PAGE_STORAGE_KEY] = currentURL, _a2[PREVIOUS_PAGE_STORAGE_KEY] = previousURL, _a2))];
          case 2:
            _b2.sent();
            _b2.label = 3;
          case 3:
            return [
              2
              /*return*/
            ];
        }
      });
    });
  };
  var saveUrlInfoWrapper = function() {
    void saveURLInfo();
  };
  var plugin = {
    name: "@amplitude/plugin-page-url-enrichment-browser",
    type: "enrichment",
    setup: function(config, _2) {
      return __awaiter7(void 0, void 0, void 0, function() {
        return __generator7(this, function(_a2) {
          switch (_a2.label) {
            case 0:
              loggerProvider = config.loggerProvider;
              loggerProvider.log("Installing @amplitude/plugin-page-url-enrichment-browser");
              isTracking = true;
              if (!globalScope3) return [3, 2];
              sessionStorage = new BrowserStorage(globalScope3.sessionStorage);
              return [4, sessionStorage.isEnabled()];
            case 1:
              isStorageEnabled = _a2.sent();
              globalScope3.addEventListener("popstate", saveUrlInfoWrapper);
              if (!isProxied) {
                globalScope3.history.pushState = new Proxy(globalScope3.history.pushState, {
                  apply: function(target, thisArg, _a3) {
                    var _b2 = __read7(_a3, 3), state = _b2[0], unused = _b2[1], url = _b2[2];
                    target.apply(thisArg, [state, unused, url]);
                    if (isTracking) {
                      saveUrlInfoWrapper();
                    }
                  }
                });
                globalScope3.history.replaceState = new Proxy(globalScope3.history.replaceState, {
                  apply: function(target, thisArg, _a3) {
                    var _b2 = __read7(_a3, 3), state = _b2[0], unused = _b2[1], url = _b2[2];
                    target.apply(thisArg, [state, unused, url]);
                    if (isTracking) {
                      saveUrlInfoWrapper();
                    }
                  }
                });
                isProxied = true;
              }
              _a2.label = 2;
            case 2:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    },
    execute: function(event) {
      return __awaiter7(void 0, void 0, void 0, function() {
        var locationHREF, URLInfo, updatedURLInfo, previousPage;
        var _a2;
        return __generator7(this, function(_b2) {
          switch (_b2.label) {
            case 0:
              locationHREF = getDecodeURI(typeof location !== "undefined" && location.href || "");
              if (!(sessionStorage && isStorageEnabled)) return [3, 5];
              return [4, sessionStorage.get(URL_INFO_STORAGE_KEY)];
            case 1:
              URLInfo = _b2.sent();
              if (!!(URLInfo === null || URLInfo === void 0 ? void 0 : URLInfo[CURRENT_PAGE_STORAGE_KEY])) return [3, 3];
              return [4, sessionStorage.set(URL_INFO_STORAGE_KEY, (_a2 = {}, _a2[CURRENT_PAGE_STORAGE_KEY] = locationHREF, _a2[PREVIOUS_PAGE_STORAGE_KEY] = document.referrer || "", _a2))];
            case 2:
              _b2.sent();
              _b2.label = 3;
            case 3:
              return [4, sessionStorage.get(URL_INFO_STORAGE_KEY)];
            case 4:
              updatedURLInfo = _b2.sent();
              previousPage = "";
              if (updatedURLInfo) {
                previousPage = updatedURLInfo[PREVIOUS_PAGE_STORAGE_KEY] || "";
              }
              if (EXCLUDED_DEFAULT_EVENT_TYPES.has(event.event_type)) {
                return [2, event];
              }
              event.event_properties = __assign6(__assign6({}, event.event_properties || {}), { "[Amplitude] Page Domain": addIfNotExist(event, "[Amplitude] Page Domain", typeof location !== "undefined" && location.hostname || ""), "[Amplitude] Page Location": addIfNotExist(event, "[Amplitude] Page Location", locationHREF), "[Amplitude] Page Path": addIfNotExist(event, "[Amplitude] Page Path", typeof location !== "undefined" && getDecodeURI(location.pathname) || ""), "[Amplitude] Page Title": addIfNotExist(event, "[Amplitude] Page Title", getPageTitle(replaceSensitiveString)), "[Amplitude] Page URL": addIfNotExist(event, "[Amplitude] Page URL", locationHREF.split("?")[0]), "[Amplitude] Previous Page Location": previousPage, "[Amplitude] Previous Page Type": getPrevPageType(previousPage) });
              _b2.label = 5;
            case 5:
              return [2, event];
          }
        });
      });
    },
    teardown: function() {
      return __awaiter7(void 0, void 0, void 0, function() {
        return __generator7(this, function(_a2) {
          switch (_a2.label) {
            case 0:
              if (globalScope3) {
                globalScope3.removeEventListener("popstate", saveUrlInfoWrapper);
                isTracking = false;
              }
              if (!(sessionStorage && isStorageEnabled)) return [3, 2];
              return [4, sessionStorage.set(URL_INFO_STORAGE_KEY, {})];
            case 1:
              _a2.sent();
              _a2.label = 2;
            case 2:
              return [
                2
                /*return*/
              ];
          }
        });
      });
    }
  };
  return plugin;
};
function addIfNotExist(event, key, value) {
  if (!event.event_properties) {
    event.event_properties = {};
  }
  if (event.event_properties[key] === void 0) {
    return value;
  }
  return event.event_properties[key];
}

// node_modules/@amplitude/analytics-browser/lib/esm/browser-client.js
var AmplitudeBrowser = (
  /** @class */
  (function(_super) {
    __extends2(AmplitudeBrowser2, _super);
    function AmplitudeBrowser2() {
      var _this = _super !== null && _super.apply(this, arguments) || this;
      _this._diagnosticsSampleRate = 0;
      return _this;
    }
    AmplitudeBrowser2.prototype.init = function(apiKey, userIdOrOptions, maybeOptions) {
      if (apiKey === void 0) {
        apiKey = "";
      }
      var userId;
      var options;
      if (arguments.length > 2) {
        userId = userIdOrOptions;
        options = maybeOptions;
      } else {
        if (typeof userIdOrOptions === "string") {
          userId = userIdOrOptions;
          options = void 0;
        } else {
          userId = userIdOrOptions === null || userIdOrOptions === void 0 ? void 0 : userIdOrOptions.userId;
          options = userIdOrOptions;
        }
      }
      return returnWrapper(this._init(__assign3(__assign3({}, options), { userId, apiKey })));
    };
    AmplitudeBrowser2.prototype._init = function(options) {
      var _a, _b, _c, _d, _e, _f, _g;
      return __awaiter2(this, void 0, void 0, function() {
        var fetchRemoteConfig, loggerProvider, serverZone, remoteConfigClient, diagnosticsSampleRate, enableDiagnostics, diagnosticsClient, browserOptions, attributionTrackingOptions, queryParams, ampTimestamp, isWithinTimeLimit, querySessionId, connector;
        var _this = this;
        return __generator2(this, function(_h) {
          switch (_h.label) {
            case 0:
              if (this.initializing) {
                return [
                  2
                  /*return*/
                ];
              }
              this.initializing = true;
              fetchRemoteConfig = shouldFetchRemoteConfig(options);
              loggerProvider = (_a = options.loggerProvider) !== null && _a !== void 0 ? _a : new Logger();
              serverZone = (_b = options.serverZone) !== null && _b !== void 0 ? _b : DEFAULT_SERVER_ZONE;
              diagnosticsSampleRate = this._diagnosticsSampleRate;
              enableDiagnostics = (_c = options.enableDiagnostics) !== null && _c !== void 0 ? _c : true;
              if (!fetchRemoteConfig) return [3, 2];
              remoteConfigClient = new RemoteConfigClient(
                options.apiKey,
                loggerProvider,
                serverZone,
                /* istanbul ignore next */
                (_d = options.remoteConfig) === null || _d === void 0 ? void 0 : _d.serverUrl
              );
              return [4, new Promise(function(resolve) {
                remoteConfigClient === null || remoteConfigClient === void 0 ? void 0 : remoteConfigClient.subscribe("configs.diagnostics.browserSDK", "all", function(remoteConfig, source, lastFetch) {
                  loggerProvider.debug("Diagnostics remote configuration received:", JSON.stringify({
                    remoteConfig,
                    source,
                    lastFetch
                  }, null, 2));
                  if (remoteConfig) {
                    var sampleRate = remoteConfig.sampleRate;
                    if (typeof sampleRate === "number" && !isNaN(sampleRate)) {
                      diagnosticsSampleRate = sampleRate;
                    }
                    var enabled = remoteConfig.enabled;
                    if (typeof enabled === "boolean") {
                      enableDiagnostics = enabled;
                    }
                  }
                  resolve();
                });
              })];
            case 1:
              _h.sent();
              _h.label = 2;
            case 2:
              diagnosticsClient = new DiagnosticsClient(options.apiKey, loggerProvider, serverZone, {
                enabled: enableDiagnostics,
                sampleRate: diagnosticsSampleRate
              });
              diagnosticsClient.setTag("library", "".concat(LIBPREFIX, "/").concat(VERSION));
              if (typeof navigator !== "undefined") {
                diagnosticsClient.setTag("user_agent", navigator.userAgent);
              }
              return [4, useBrowserConfig(options.apiKey, options, this, diagnosticsClient, {
                loggerProvider,
                serverZone,
                enableDiagnostics,
                diagnosticsSampleRate
              })];
            case 3:
              browserOptions = _h.sent();
              if (!(fetchRemoteConfig && remoteConfigClient)) return [3, 5];
              return [4, new Promise(function(resolve) {
                remoteConfigClient === null || remoteConfigClient === void 0 ? void 0 : remoteConfigClient.subscribe("configs.analyticsSDK.browserSDK", "all", function(remoteConfig, source, lastFetch) {
                  browserOptions.loggerProvider.debug("Remote configuration received:", JSON.stringify({
                    remoteConfig,
                    source,
                    lastFetch
                  }, null, 2));
                  if (remoteConfig) {
                    updateBrowserConfigWithRemoteConfig(remoteConfig, browserOptions);
                  }
                  resolve();
                });
              })];
            case 4:
              _h.sent();
              _h.label = 5;
            case 5:
              return [4, _super.prototype._init.call(this, browserOptions)];
            case 6:
              _h.sent();
              this.logBrowserOptions(browserOptions);
              this.config.remoteConfigClient = remoteConfigClient;
              if (!isAttributionTrackingEnabled(this.config.defaultTracking)) return [3, 8];
              attributionTrackingOptions = getAttributionTrackingConfig(this.config);
              this.webAttribution = new WebAttribution(attributionTrackingOptions, this.config);
              return [4, this.webAttribution.init()];
            case 7:
              _h.sent();
              _h.label = 8;
            case 8:
              queryParams = getQueryParams();
              ampTimestamp = queryParams.ampTimestamp ? Number(queryParams.ampTimestamp) : void 0;
              isWithinTimeLimit = ampTimestamp ? Date.now() < ampTimestamp : true;
              querySessionId = isWithinTimeLimit && !Number.isNaN(Number(queryParams.ampSessionId)) ? Number(queryParams.ampSessionId) : void 0;
              this.setSessionId((_g = (_f = (_e = options.sessionId) !== null && _e !== void 0 ? _e : querySessionId) !== null && _f !== void 0 ? _f : this.config.sessionId) !== null && _g !== void 0 ? _g : Date.now());
              connector = getAnalyticsConnector(options.instanceName);
              connector.identityStore.setIdentity({
                userId: this.config.userId,
                deviceId: this.config.deviceId
              });
              if (!(this.config.offline !== OfflineDisabled)) return [3, 10];
              return [4, this.add(networkConnectivityCheckerPlugin()).promise];
            case 9:
              _h.sent();
              _h.label = 10;
            case 10:
              return [4, this.add(new Destination({ diagnosticsClient })).promise];
            case 11:
              _h.sent();
              return [4, this.add(new Context()).promise];
            case 12:
              _h.sent();
              return [4, this.add(new IdentityEventSender()).promise];
            case 13:
              _h.sent();
              detNotify(this.config);
              if (!isFileDownloadTrackingEnabled(this.config.defaultTracking)) return [3, 15];
              this.config.loggerProvider.debug("Adding file download tracking plugin");
              return [4, this.add(fileDownloadTracking()).promise];
            case 14:
              _h.sent();
              _h.label = 15;
            case 15:
              if (!isFormInteractionTrackingEnabled(this.config.defaultTracking)) return [3, 17];
              this.config.loggerProvider.debug("Adding form interaction plugin");
              return [4, this.add(formInteractionTracking()).promise];
            case 16:
              _h.sent();
              _h.label = 17;
            case 17:
              if (!isPageViewTrackingEnabled(this.config.defaultTracking)) return [3, 19];
              this.config.loggerProvider.debug("Adding page view tracking plugin");
              return [4, this.add(pageViewTrackingPlugin(getPageViewTrackingConfig(this.config))).promise];
            case 18:
              _h.sent();
              _h.label = 19;
            case 19:
              if (!isElementInteractionsEnabled(this.config.autocapture)) return [3, 21];
              this.config.loggerProvider.debug("Adding user interactions plugin (autocapture plugin)");
              return [4, this.add(autocapturePlugin(getElementInteractionsConfig(this.config), { diagnosticsClient })).promise];
            case 20:
              _h.sent();
              _h.label = 21;
            case 21:
              if (!isFrustrationInteractionsEnabled(this.config.autocapture)) return [3, 23];
              this.config.loggerProvider.debug("Adding frustration interactions plugin");
              return [4, this.add(frustrationPlugin(getFrustrationInteractionsConfig(this.config))).promise];
            case 22:
              _h.sent();
              _h.label = 23;
            case 23:
              if (!isNetworkTrackingEnabled(this.config.autocapture)) return [3, 25];
              this.config.loggerProvider.debug("Adding network tracking plugin");
              return [4, this.add(networkCapturePlugin(getNetworkTrackingConfig(this.config))).promise];
            case 24:
              _h.sent();
              _h.label = 25;
            case 25:
              if (!isWebVitalsEnabled(this.config.autocapture)) return [3, 27];
              this.config.loggerProvider.debug("Adding web vitals plugin");
              return [4, this.add(webVitalsPlugin()).promise];
            case 26:
              _h.sent();
              _h.label = 27;
            case 27:
              if (!isPageUrlEnrichmentEnabled(this.config.autocapture)) return [3, 29];
              this.config.loggerProvider.debug("Adding referrer page url plugin");
              return [4, this.add(pageUrlEnrichmentPlugin()).promise];
            case 28:
              _h.sent();
              _h.label = 29;
            case 29:
              this.initializing = false;
              return [4, this.runQueuedFunctions("dispatchQ")];
            case 30:
              _h.sent();
              connector.eventBridge.setEventReceiver(function(event) {
                var _a2 = event.eventProperties || {}, time = _a2.time, cleanEventProperties = __rest2(_a2, ["time"]);
                var eventOptions = typeof time === "number" ? { time } : void 0;
                void _this.track(event.eventType, cleanEventProperties, eventOptions);
              });
              return [
                2
                /*return*/
              ];
          }
        });
      });
    };
    AmplitudeBrowser2.prototype.getUserId = function() {
      var _a;
      return (_a = this.config) === null || _a === void 0 ? void 0 : _a.userId;
    };
    AmplitudeBrowser2.prototype.setUserId = function(userId) {
      if (!this.config) {
        this.q.push(this.setUserId.bind(this, userId));
        return;
      }
      this.config.loggerProvider.debug("function setUserId: ", userId);
      if (userId !== this.config.userId || userId === void 0) {
        this.config.userId = userId;
        this.timeline.onIdentityChanged({ userId });
        setConnectorUserId(userId, this.config.instanceName);
      }
    };
    AmplitudeBrowser2.prototype.getDeviceId = function() {
      var _a;
      return (_a = this.config) === null || _a === void 0 ? void 0 : _a.deviceId;
    };
    AmplitudeBrowser2.prototype.setDeviceId = function(deviceId) {
      if (!this.config) {
        this.q.push(this.setDeviceId.bind(this, deviceId));
        return;
      }
      this.config.loggerProvider.debug("function setDeviceId: ", deviceId);
      if (deviceId !== this.config.deviceId) {
        this.config.deviceId = deviceId;
        this.timeline.onIdentityChanged({ deviceId });
        setConnectorDeviceId(deviceId, this.config.instanceName);
      }
    };
    AmplitudeBrowser2.prototype.reset = function() {
      this.setDeviceId(UUID());
      this.setUserId(void 0);
      this.timeline.onReset();
    };
    AmplitudeBrowser2.prototype.getIdentity = function() {
      var _a, _b;
      return {
        deviceId: (_a = this.config) === null || _a === void 0 ? void 0 : _a.deviceId,
        userId: (_b = this.config) === null || _b === void 0 ? void 0 : _b.userId,
        userProperties: this.userProperties
      };
    };
    AmplitudeBrowser2.prototype.getOptOut = function() {
      var _a;
      return (_a = this.config) === null || _a === void 0 ? void 0 : _a.optOut;
    };
    AmplitudeBrowser2.prototype.getSessionId = function() {
      var _a;
      return (_a = this.config) === null || _a === void 0 ? void 0 : _a.sessionId;
    };
    AmplitudeBrowser2.prototype.setSessionId = function(sessionId) {
      var _a;
      var promises = [];
      if (!this.config) {
        this.q.push(this.setSessionId.bind(this, sessionId));
        return returnWrapper(Promise.resolve());
      }
      if (sessionId === this.config.sessionId) {
        return returnWrapper(Promise.resolve());
      }
      this.config.loggerProvider.debug("function setSessionId: ", sessionId);
      var previousSessionId = this.getSessionId();
      if (previousSessionId !== sessionId) {
        this.timeline.onSessionIdChanged(sessionId);
      }
      var lastEventTime = this.config.lastEventTime;
      var lastEventId = (_a = this.config.lastEventId) !== null && _a !== void 0 ? _a : -1;
      this.config.sessionId = sessionId;
      this.config.lastEventTime = void 0;
      this.config.pageCounter = 0;
      if (isSessionTrackingEnabled(this.config.defaultTracking)) {
        if (previousSessionId && lastEventTime) {
          promises.push(this.track(DEFAULT_SESSION_END_EVENT, void 0, {
            device_id: this.previousSessionDeviceId,
            event_id: ++lastEventId,
            session_id: previousSessionId,
            time: lastEventTime + 1,
            user_id: this.previousSessionUserId
          }).promise);
        }
        this.config.lastEventTime = this.config.sessionId;
      }
      var isCampaignEventTracked = this.trackCampaignEventIfNeeded(++lastEventId, promises);
      if (this.config.identify) {
        promises.push(this.track(createIdentifyEvent(this.config.identify)).promise);
      }
      if (isSessionTrackingEnabled(this.config.defaultTracking)) {
        promises.push(this.track(DEFAULT_SESSION_START_EVENT, void 0, {
          event_id: isCampaignEventTracked ? ++lastEventId : lastEventId,
          session_id: this.config.sessionId,
          time: this.config.lastEventTime
        }).promise);
      }
      this.previousSessionDeviceId = this.config.deviceId;
      this.previousSessionUserId = this.config.userId;
      return returnWrapper(Promise.all(promises));
    };
    AmplitudeBrowser2.prototype.extendSession = function() {
      if (!this.config) {
        this.q.push(this.extendSession.bind(this));
        return;
      }
      this.config.lastEventTime = Date.now();
    };
    AmplitudeBrowser2.prototype.setTransport = function(transport) {
      if (!this.config) {
        this.q.push(this.setTransport.bind(this, transport));
        return;
      }
      this.config.transportProvider = createTransport(transport);
    };
    AmplitudeBrowser2.prototype.identify = function(identify2, eventOptions) {
      if (isInstanceProxy(identify2)) {
        var queue = identify2._q;
        identify2._q = [];
        identify2 = convertProxyObjectToRealObject(new Identify(), queue);
      }
      if (eventOptions === null || eventOptions === void 0 ? void 0 : eventOptions.user_id) {
        this.setUserId(eventOptions.user_id);
      }
      if (eventOptions === null || eventOptions === void 0 ? void 0 : eventOptions.device_id) {
        this.setDeviceId(eventOptions.device_id);
      }
      return _super.prototype.identify.call(this, identify2, eventOptions);
    };
    AmplitudeBrowser2.prototype.groupIdentify = function(groupType, groupName, identify2, eventOptions) {
      if (isInstanceProxy(identify2)) {
        var queue = identify2._q;
        identify2._q = [];
        identify2 = convertProxyObjectToRealObject(new Identify(), queue);
      }
      return _super.prototype.groupIdentify.call(this, groupType, groupName, identify2, eventOptions);
    };
    AmplitudeBrowser2.prototype.revenue = function(revenue2, eventOptions) {
      if (isInstanceProxy(revenue2)) {
        var queue = revenue2._q;
        revenue2._q = [];
        revenue2 = convertProxyObjectToRealObject(new Revenue(), queue);
      }
      return _super.prototype.revenue.call(this, revenue2, eventOptions);
    };
    AmplitudeBrowser2.prototype.trackCampaignEventIfNeeded = function(lastEventId, promises) {
      if (!this.webAttribution || !this.webAttribution.shouldTrackNewCampaign) {
        return false;
      }
      var campaignEvent = this.webAttribution.generateCampaignEvent(lastEventId);
      if (promises) {
        promises.push(this.track(campaignEvent).promise);
      } else {
        this.track(campaignEvent);
      }
      this.config.loggerProvider.log("Tracking attribution.");
      return true;
    };
    AmplitudeBrowser2.prototype.process = function(event) {
      return __awaiter2(this, void 0, void 0, function() {
        var currentTime, isEventInNewSession, shouldSetSessionIdOnNewCampaign;
        return __generator2(this, function(_a) {
          currentTime = Date.now();
          isEventInNewSession = isNewSession(this.config.sessionTimeout, this.config.lastEventTime);
          shouldSetSessionIdOnNewCampaign = this.webAttribution && this.webAttribution.shouldSetSessionIdOnNewCampaign();
          if (event.event_type !== DEFAULT_SESSION_START_EVENT && event.event_type !== DEFAULT_SESSION_END_EVENT && (!event.session_id || event.session_id === this.getSessionId())) {
            if (isEventInNewSession || shouldSetSessionIdOnNewCampaign) {
              this.setSessionId(currentTime);
              if (shouldSetSessionIdOnNewCampaign) {
                this.config.loggerProvider.log("Created a new session for new campaign.");
              }
            } else if (!isEventInNewSession) {
              this.trackCampaignEventIfNeeded();
            }
          }
          if (event.event_type === SpecialEventType.IDENTIFY && event.user_properties) {
            this.userProperties = this.getOperationAppliedUserProperties(event.user_properties);
          }
          return [2, _super.prototype.process.call(this, event)];
        });
      });
    };
    AmplitudeBrowser2.prototype.logBrowserOptions = function(browserConfig) {
      try {
        var browserConfigCopy = __assign3(__assign3({}, browserConfig), { apiKey: browserConfig.apiKey.substring(0, 10) + "********" });
        this.config.loggerProvider.debug("Initialized Amplitude with BrowserConfig:", JSON.stringify(browserConfigCopy));
      } catch (e2) {
        this.config.loggerProvider.error("Error logging browser config", e2);
      }
    };
    AmplitudeBrowser2.prototype._setDiagnosticsSampleRate = function(sampleRate) {
      if (sampleRate > 1 || sampleRate < 0) {
        return;
      }
      if (!this.config) {
        this._diagnosticsSampleRate = sampleRate;
        return;
      }
    };
    return AmplitudeBrowser2;
  })(AmplitudeCore)
);

// node_modules/@amplitude/analytics-browser/lib/esm/browser-client-factory.js
var createInstance = function() {
  var client = new AmplitudeBrowser();
  return {
    init: debugWrapper(client.init.bind(client), "init", getClientLogConfig(client), getClientStates(client, ["config"])),
    add: debugWrapper(client.add.bind(client), "add", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.plugins"])),
    remove: debugWrapper(client.remove.bind(client), "remove", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.plugins"])),
    track: debugWrapper(client.track.bind(client), "track", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.queue.length"])),
    logEvent: debugWrapper(client.logEvent.bind(client), "logEvent", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.queue.length"])),
    identify: debugWrapper(client.identify.bind(client), "identify", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.queue.length"])),
    groupIdentify: debugWrapper(client.groupIdentify.bind(client), "groupIdentify", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.queue.length"])),
    setGroup: debugWrapper(client.setGroup.bind(client), "setGroup", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.queue.length"])),
    revenue: debugWrapper(client.revenue.bind(client), "revenue", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.queue.length"])),
    flush: debugWrapper(client.flush.bind(client), "flush", getClientLogConfig(client), getClientStates(client, ["config.apiKey", "timeline.queue.length"])),
    getUserId: debugWrapper(client.getUserId.bind(client), "getUserId", getClientLogConfig(client), getClientStates(client, ["config", "config.userId"])),
    setUserId: debugWrapper(client.setUserId.bind(client), "setUserId", getClientLogConfig(client), getClientStates(client, ["config", "config.userId"])),
    getDeviceId: debugWrapper(client.getDeviceId.bind(client), "getDeviceId", getClientLogConfig(client), getClientStates(client, ["config", "config.deviceId"])),
    setDeviceId: debugWrapper(client.setDeviceId.bind(client), "setDeviceId", getClientLogConfig(client), getClientStates(client, ["config", "config.deviceId"])),
    reset: debugWrapper(client.reset.bind(client), "reset", getClientLogConfig(client), getClientStates(client, ["config", "config.userId", "config.deviceId"])),
    getSessionId: debugWrapper(client.getSessionId.bind(client), "getSessionId", getClientLogConfig(client), getClientStates(client, ["config"])),
    setSessionId: debugWrapper(client.setSessionId.bind(client), "setSessionId", getClientLogConfig(client), getClientStates(client, ["config"])),
    extendSession: debugWrapper(client.extendSession.bind(client), "extendSession", getClientLogConfig(client), getClientStates(client, ["config"])),
    setOptOut: debugWrapper(client.setOptOut.bind(client), "setOptOut", getClientLogConfig(client), getClientStates(client, ["config"])),
    setTransport: debugWrapper(client.setTransport.bind(client), "setTransport", getClientLogConfig(client), getClientStates(client, ["config"])),
    getIdentity: debugWrapper(client.getIdentity.bind(client), "getIdentity", getClientLogConfig(client), getClientStates(client, ["config"])),
    getOptOut: debugWrapper(client.getOptOut.bind(client), "getOptOut", getClientLogConfig(client), getClientStates(client, ["config"])),
    _setDiagnosticsSampleRate: debugWrapper(client._setDiagnosticsSampleRate.bind(client), "_setDiagnosticsSampleRate", getClientLogConfig(client), getClientStates(client, ["config"]))
  };
};
var browser_client_factory_default = createInstance();

// node_modules/@amplitude/analytics-browser/lib/esm/types.js
var types_exports = {};
__export(types_exports, {
  DEFAULT_ACTION_CLICK_ALLOWLIST: () => DEFAULT_ACTION_CLICK_ALLOWLIST,
  DEFAULT_CSS_SELECTOR_ALLOWLIST: () => DEFAULT_CSS_SELECTOR_ALLOWLIST,
  DEFAULT_DATA_ATTRIBUTE_PREFIX: () => DEFAULT_DATA_ATTRIBUTE_PREFIX,
  IdentifyOperation: () => IdentifyOperation,
  LogLevel: () => LogLevel,
  OfflineDisabled: () => OfflineDisabled,
  RevenueProperty: () => RevenueProperty,
  ServerZone: () => ServerZone,
  SpecialEventType: () => SpecialEventType
});

// node_modules/@amplitude/analytics-browser/lib/esm/index.js
var add = browser_client_factory_default.add;
var extendSession = browser_client_factory_default.extendSession;
var flush = browser_client_factory_default.flush;
var getDeviceId = browser_client_factory_default.getDeviceId;
var getIdentity = browser_client_factory_default.getIdentity;
var getOptOut = browser_client_factory_default.getOptOut;
var getSessionId = browser_client_factory_default.getSessionId;
var getUserId = browser_client_factory_default.getUserId;
var groupIdentify = browser_client_factory_default.groupIdentify;
var identify = browser_client_factory_default.identify;
var init = browser_client_factory_default.init;
var logEvent = browser_client_factory_default.logEvent;
var remove = browser_client_factory_default.remove;
var reset = browser_client_factory_default.reset;
var revenue = browser_client_factory_default.revenue;
var setDeviceId = browser_client_factory_default.setDeviceId;
var setGroup = browser_client_factory_default.setGroup;
var setOptOut = browser_client_factory_default.setOptOut;
var setSessionId = browser_client_factory_default.setSessionId;
var setTransport = browser_client_factory_default.setTransport;
var setUserId = browser_client_factory_default.setUserId;
var track = browser_client_factory_default.track;
var _setDiagnosticsSampleRate = browser_client_factory_default._setDiagnosticsSampleRate;
export {
  AmplitudeBrowser,
  Identify,
  Revenue,
  types_exports as Types,
  _setDiagnosticsSampleRate,
  add,
  createInstance,
  extendSession,
  flush,
  getDeviceId,
  getIdentity,
  getOptOut,
  getSessionId,
  getUserId,
  groupIdentify,
  identify,
  init,
  logEvent,
  remove,
  reset,
  revenue,
  runQueuedFunctions,
  setDeviceId,
  setGroup,
  setOptOut,
  setSessionId,
  setTransport,
  setUserId,
  track
};
//# sourceMappingURL=@amplitude_analytics-browser.js.map
