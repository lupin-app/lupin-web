{
  "version": 3,
  "sources": ["../../@amplitude/analytics-core/node_modules/tslib/tslib.es6.mjs", "../../@amplitude/analytics-core/src/types/event/event.ts", "../../@amplitude/analytics-core/src/types/constants.ts", "../../@amplitude/analytics-core/src/utils/valid-properties.ts", "../../@amplitude/analytics-core/src/identify.ts", "../../@amplitude/analytics-core/src/types/messages.ts", "../../@amplitude/analytics-core/src/types/status.ts", "../../@amplitude/analytics-core/src/utils/result-builder.ts", "../../@amplitude/analytics-core/src/global-scope.ts", "../../@amplitude/analytics-core/src/utils/uuid.ts", "../../@amplitude/analytics-core/src/timeline.ts", "../../@amplitude/analytics-core/src/utils/event-builder.ts", "../../@amplitude/analytics-core/src/utils/return-wrapper.ts", "../../@amplitude/analytics-core/src/core-client.ts", "../../@amplitude/analytics-core/src/revenue.ts", "../../@amplitude/analytics-core/src/utils/chunk.ts", "../../@amplitude/analytics-core/src/types/loglevel.ts", "../../@amplitude/analytics-core/src/logger.ts", "../../@amplitude/analytics-core/src/config.ts", "../../@amplitude/analytics-core/src/utils/status-code.ts", "../../@amplitude/analytics-core/src/utils/debug.ts", "../../@amplitude/analytics-core/src/plugins/destination.ts", "../../@amplitude/analytics-connector/dist/analytics-connector.esm.js", "../../@amplitude/analytics-core/src/analytics-connector.ts", "../../@amplitude/analytics-core/src/plugins/identity.ts", "../../@amplitude/analytics-core/src/session.ts", "../../@amplitude/analytics-core/src/cookie-name.ts", "../../@amplitude/analytics-core/src/language.ts", "../../@amplitude/analytics-core/src/query-params.ts", "../../@amplitude/analytics-core/src/utils/url-utils.ts", "../../@amplitude/analytics-core/src/utils/sampling.ts", "../../@amplitude/analytics-core/src/storage/memory.ts", "../../@amplitude/analytics-core/src/storage/cookie.ts", "../../@amplitude/analytics-core/src/storage/helpers.ts", "../../@amplitude/analytics-core/src/storage/browser-storage.ts", "../../@amplitude/analytics-core/src/diagnostics/diagnostics-storage.ts", "../../@amplitude/analytics-core/src/diagnostics/uncaught-sdk-errors.ts", "../../@amplitude/analytics-core/src/diagnostics/diagnostics-client.ts", "../../@amplitude/analytics-core/src/transports/base.ts", "../../@amplitude/analytics-core/src/transports/fetch.ts", "../../@amplitude/analytics-core/src/remote-config/remote-config-localstorage.ts", "../../@amplitude/analytics-core/src/remote-config/remote-config.ts", "../../@amplitude/analytics-core/src/observers/console.ts", "../../@amplitude/analytics-core/src/types/server-zone.ts", "../../@amplitude/analytics-core/src/types/offline.ts", "../../@amplitude/analytics-core/src/types/element-interactions.ts", "../../@amplitude/analytics-core/src/types/frustration-interactions.ts", "../../@amplitude/analytics-core/src/utils/json-query.ts", "../../@amplitude/analytics-core/src/network-request-event.ts", "../../@amplitude/analytics-core/src/observers/network.ts", "../../@amplitude/analytics-core/src/campaign/campaign-parser.ts", "../../@amplitude/analytics-core/src/plugins/helpers.ts", "../../zen-observable-ts/module.js", "../../@amplitude/analytics-core/src/utils/observable.ts", "../../@amplitude/analytics-browser/node_modules/tslib/tslib.es6.mjs", "../../@amplitude/analytics-browser/src/default-tracking.ts", "../../@amplitude/analytics-browser/src/utils/snippet-helper.ts", "../../@amplitude/analytics-browser/src/version.ts", "../../@amplitude/analytics-browser/src/lib-prefix.ts", "../../@amplitude/analytics-browser/src/plugins/context.ts", "../../@amplitude/analytics-browser/src/storage/local-storage.ts", "../../@amplitude/analytics-browser/src/storage/session-storage.ts", "../../@amplitude/analytics-browser/src/transports/xhr.ts", "../../@amplitude/analytics-browser/src/transports/send-beacon.ts", "../../@amplitude/analytics-browser/src/cookie-migration/index.ts", "../../@amplitude/analytics-browser/src/constants.ts", "../../@amplitude/analytics-browser/src/config.ts", "../../@amplitude/plugin-page-view-tracking-browser/node_modules/tslib/tslib.es6.mjs", "../../@amplitude/plugin-page-view-tracking-browser/src/utils.ts", "../../@amplitude/plugin-page-view-tracking-browser/src/page-view-tracking.ts", "../../@amplitude/analytics-browser/src/plugins/form-interaction-tracking.ts", "../../@amplitude/analytics-browser/src/plugins/file-download-tracking.ts", "../../@amplitude/analytics-browser/src/det-notification.ts", "../../@amplitude/analytics-browser/src/plugins/network-connectivity-checker.ts", "../../@amplitude/analytics-browser/src/config/joined-config.ts", "../../@amplitude/plugin-autocapture-browser/node_modules/tslib/tslib.es6.mjs", "../../@amplitude/plugin-autocapture-browser/src/version.ts", "../../@amplitude/plugin-autocapture-browser/src/constants.ts", "../../@amplitude/plugin-autocapture-browser/src/helpers.ts", "../../@amplitude/plugin-autocapture-browser/src/hierarchy.ts", "../../@amplitude/plugin-autocapture-browser/src/pageActions/actions.ts", "../../@amplitude/plugin-autocapture-browser/src/data-extractor.ts", "../../@amplitude/plugin-autocapture-browser/src/libs/messenger.ts", "../../@amplitude/plugin-autocapture-browser/src/autocapture/track-click.ts", "../../@amplitude/plugin-autocapture-browser/src/autocapture/track-change.ts", "../../@amplitude/plugin-autocapture-browser/src/autocapture/track-action-click.ts", "../../@amplitude/plugin-autocapture-browser/src/observables.ts", "../../@amplitude/plugin-autocapture-browser/src/pageActions/matchEventToFilter.ts", "../../@amplitude/plugin-autocapture-browser/src/pageActions/triggers.ts", "../../@amplitude/plugin-autocapture-browser/src/autocapture-plugin.ts", "../../@amplitude/plugin-autocapture-browser/src/autocapture/track-dead-click.ts", "../../@amplitude/plugin-autocapture-browser/src/autocapture/track-rage-click.ts", "../../@amplitude/plugin-autocapture-browser/src/autocapture/track-error-click.ts", "../../@amplitude/plugin-autocapture-browser/src/frustration-plugin.ts", "../../@amplitude/plugin-network-capture-browser/node_modules/tslib/tslib.es6.mjs", "../../@amplitude/plugin-network-capture-browser/src/constants.ts", "../../@amplitude/plugin-network-capture-browser/src/track-network-event.ts", "../../@amplitude/plugin-network-capture-browser/src/network-capture-plugin.ts", "../../@amplitude/plugin-web-vitals-browser/node_modules/tslib/tslib.es6.mjs", "../../@amplitude/plugin-web-vitals-browser/src/constants.ts", "../../web-vitals/dist/web-vitals.js", "../../@amplitude/plugin-web-vitals-browser/src/web-vitals-plugin.ts", "../../@amplitude/analytics-browser/src/attribution/helpers.ts", "../../@amplitude/analytics-browser/src/attribution/web-attribution.ts", "../../@amplitude/plugin-page-url-enrichment-browser/node_modules/tslib/tslib.es6.mjs", "../../@amplitude/plugin-page-url-enrichment-browser/src/page-url-enrichment.ts", "../../@amplitude/analytics-browser/src/browser-client.ts", "../../@amplitude/analytics-browser/src/browser-client-factory.ts", "../../@amplitude/analytics-browser/src/types.ts", "../../@amplitude/analytics-browser/src/index.ts"],
  "sourcesContent": ["/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "import { BaseEvent } from './base-event';\nimport { RevenueEventProperties } from '../../revenue';\n\nexport enum IdentifyOperation {\n  // Base Operations to set values\n  SET = '$set',\n  SET_ONCE = '$setOnce',\n\n  // Operations around modifying existing values\n  ADD = '$add',\n  APPEND = '$append',\n  PREPEND = '$prepend',\n  REMOVE = '$remove',\n\n  // Operations around appending values *if* they aren't present\n  PREINSERT = '$preInsert',\n  POSTINSERT = '$postInsert',\n\n  // Operations around removing properties/values\n  UNSET = '$unset',\n  CLEAR_ALL = '$clearAll',\n}\n\nexport type ValidPropertyType =\n  | number\n  | string\n  | boolean\n  | Array<string | number>\n  | { [key: string]: ValidPropertyType }\n  | Array<{ [key: string]: ValidPropertyType }>;\n\ninterface BaseOperationConfig {\n  [key: string]: ValidPropertyType;\n}\n\nexport interface IdentifyUserProperties {\n  // Add operations can only take numbers\n  [IdentifyOperation.ADD]?: { [key: string]: number };\n\n  // This reads the keys of the passed object, but the values are not used\n  [IdentifyOperation.UNSET]?: BaseOperationConfig;\n  // This option does not read the key as it unsets all user properties\n  [IdentifyOperation.CLEAR_ALL]?: any;\n\n  // These operations can take numbers, strings, or arrays of both.\n  [IdentifyOperation.SET]?: BaseOperationConfig;\n  [IdentifyOperation.SET_ONCE]?: BaseOperationConfig;\n  [IdentifyOperation.APPEND]?: BaseOperationConfig;\n  [IdentifyOperation.PREPEND]?: BaseOperationConfig;\n  [IdentifyOperation.POSTINSERT]?: BaseOperationConfig;\n  [IdentifyOperation.PREINSERT]?: BaseOperationConfig;\n  [IdentifyOperation.REMOVE]?: BaseOperationConfig;\n}\n\n/**\n * Represents the structure of user properties that can be sent with an Identify or GroupIdentify event.\n *\n * This type supports both:\n *\n * 1. Reserved Amplitude identify operations via `IdentifyUserProperties`:\n *    These operations enable structured updates to user properties.\n *\n *    Example:\n *    ```ts\n *    {\n *      $set: { plan: 'premium', login_count: 1 },\n *      $add: { login_count: 1 },\n *      $unset: { plan: '-' },\n *      $clearAll: '-'\n *    }\n *    ```\n *\n * 2. Custom user-defined properties (excluding reserved operation keys):\n *    Useful for assigning static properties without using Identify operations.\n *\n *    Example:\n *    ```ts\n *    {\n *      custom_flag: true,\n *      experiment_group: 'B',\n *      favorite_color: 'blue'\n *    }\n *    ```\n *\n * This union ensures compatibility with Amplitude's identify semantics\n * while allowing flexibility to define arbitrary non-reserved properties.\n */\nexport type UserProperties =\n  | IdentifyUserProperties\n  | {\n      [key in Exclude<string, IdentifyOperation>]: any;\n    };\n\n/**\n * Strings that have special meaning when used as an event's type\n * and have different specifications.\n */\nexport enum SpecialEventType {\n  IDENTIFY = '$identify',\n  GROUP_IDENTIFY = '$groupidentify',\n  REVENUE = 'revenue_amount',\n}\n\nexport interface TrackEvent extends BaseEvent {\n  event_type: Exclude<string, SpecialEventType>;\n}\n\nexport interface IdentifyEvent extends BaseEvent {\n  event_type: SpecialEventType.IDENTIFY;\n  user_properties: UserProperties;\n}\n\nexport interface GroupIdentifyEvent extends BaseEvent {\n  event_type: SpecialEventType.GROUP_IDENTIFY;\n  group_properties: UserProperties;\n}\n\nexport interface RevenueEvent extends BaseEvent {\n  event_type: SpecialEventType.REVENUE;\n  event_properties:\n    | RevenueEventProperties\n    | {\n        [key: string]: any;\n      };\n}\n\nexport type Event = TrackEvent | IdentifyEvent | GroupIdentifyEvent | RevenueEvent;\n", "import { Campaign } from './campaign';\n\nexport const UNSET_VALUE = '-';\nexport const AMPLITUDE_PREFIX = 'AMP';\nexport const STORAGE_PREFIX = `${AMPLITUDE_PREFIX}_unsent`;\nexport const DEFAULT_INSTANCE_NAME = '$default_instance';\nexport const AMPLITUDE_SERVER_URL = 'https://api2.amplitude.com/2/httpapi';\nexport const EU_AMPLITUDE_SERVER_URL = 'https://api.eu.amplitude.com/2/httpapi';\nexport const AMPLITUDE_BATCH_SERVER_URL = 'https://api2.amplitude.com/batch';\nexport const EU_AMPLITUDE_BATCH_SERVER_URL = 'https://api.eu.amplitude.com/batch';\n\n// Campaign constants\nexport const UTM_CAMPAIGN = 'utm_campaign';\nexport const UTM_CONTENT = 'utm_content';\nexport const UTM_ID = 'utm_id';\nexport const UTM_MEDIUM = 'utm_medium';\nexport const UTM_SOURCE = 'utm_source';\nexport const UTM_TERM = 'utm_term';\n\nexport const DCLID = 'dclid';\nexport const FBCLID = 'fbclid';\nexport const GBRAID = 'gbraid';\nexport const GCLID = 'gclid';\nexport const KO_CLICK_ID = 'ko_click_id';\nexport const LI_FAT_ID = 'li_fat_id';\nexport const MSCLKID = 'msclkid';\nexport const RDT_CID = 'rdt_cid';\nexport const TTCLID = 'ttclid';\nexport const TWCLID = 'twclid';\nexport const WBRAID = 'wbraid';\n\nexport const EMPTY_VALUE = 'EMPTY';\n\nexport const BASE_CAMPAIGN: Campaign = {\n  utm_campaign: undefined,\n  utm_content: undefined,\n  utm_id: undefined,\n  utm_medium: undefined,\n  utm_source: undefined,\n  utm_term: undefined,\n  referrer: undefined,\n  referring_domain: undefined,\n  dclid: undefined,\n  gbraid: undefined,\n  gclid: undefined,\n  fbclid: undefined,\n  ko_click_id: undefined,\n  li_fat_id: undefined,\n  msclkid: undefined,\n  rdt_cid: undefined,\n  ttclid: undefined,\n  twclid: undefined,\n  wbraid: undefined,\n};\n\nexport const MKTG = 'MKTG';\n\n// list of Network headers that are safe to capture\nexport const SAFE_HEADERS = [\n  'access-control-allow-origin',\n  'access-control-allow-credentials',\n  'access-control-expose-headers',\n  'access-control-max-age',\n  'access-control-allow-methods',\n  'access-control-allow-headers',\n  'accept-patch',\n  'accept-ranges',\n  'age',\n  'allow',\n  'alt-svc',\n  'cache-control',\n  'connection',\n  'content-disposition',\n  'content-encoding',\n  'content-language',\n  'content-length',\n  'content-location',\n  'content-md5',\n  'content-range',\n  'content-type',\n  'date',\n  'delta-base',\n  'etag',\n  'expires',\n  'im',\n  'last-modified',\n  'link',\n  'location',\n  'permanent',\n  'p3p',\n  'pragma',\n  'proxy-authenticate',\n  'public-key-pins',\n  'retry-after',\n  'server',\n  'status',\n  'strict-transport-security',\n  'trailer',\n  'transfer-encoding',\n  'tk',\n  'upgrade',\n  'vary',\n  'via',\n  'warning',\n  'www-authenticate',\n  'x-b3-traceid',\n  'x-frame-options',\n];\n\n// list of Network headers to never capture\nexport const FORBIDDEN_HEADERS = ['authorization', 'cookie', 'set-cookie'];\n", "const MAX_PROPERTY_KEYS = 1000;\n\nexport const isValidObject = (properties: { [key: string]: any }): boolean => {\n  if (Object.keys(properties).length > MAX_PROPERTY_KEYS) {\n    return false;\n  }\n  for (const key in properties) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    const value = properties[key];\n    if (!isValidProperties(key, value)) return false;\n  }\n  return true;\n};\n\nexport const isValidProperties = (property: string, value: any): boolean => {\n  if (typeof property !== 'string') return false;\n  if (Array.isArray(value)) {\n    let isValid = true;\n    for (const valueElement of value) {\n      if (Array.isArray(valueElement)) {\n        return false;\n      } else if (typeof valueElement === 'object') {\n        isValid = isValid && isValidObject(valueElement as object);\n      } else if (!['number', 'string'].includes(typeof valueElement)) {\n        return false;\n      }\n      if (!isValid) {\n        return false;\n      }\n    }\n  } else if (value === null || value === undefined) {\n    return false;\n  } else if (typeof value === 'object') {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return isValidObject(value);\n  } else if (!['number', 'string', 'boolean'].includes(typeof value)) {\n    return false;\n  }\n  return true;\n};\n", "import { UNSET_VALUE } from './types/constants';\nimport { isValidProperties } from './utils/valid-properties';\n\nexport interface IIdentify {\n  getUserProperties(): IdentifyUserProperties;\n  set(property: string, value: ValidPropertyType): IIdentify;\n  setOnce(property: string, value: ValidPropertyType): IIdentify;\n  append(property: string, value: ValidPropertyType): IIdentify;\n  prepend(property: string, value: ValidPropertyType): IIdentify;\n  postInsert(property: string, value: ValidPropertyType): IIdentify;\n  preInsert(property: string, value: ValidPropertyType): IIdentify;\n  remove(property: string, value: ValidPropertyType): IIdentify;\n  add(property: string, value: number): IIdentify;\n  unset(property: string): IIdentify;\n  clearAll(): IIdentify;\n}\n\nexport class Identify implements IIdentify {\n  protected readonly _propertySet: Set<string> = new Set<string>();\n  protected _properties: IdentifyUserProperties = {};\n\n  public getUserProperties(): IdentifyUserProperties {\n    return { ...this._properties };\n  }\n\n  public set(property: string, value: ValidPropertyType): Identify {\n    this._safeSet(IdentifyOperation.SET, property, value);\n    return this;\n  }\n\n  public setOnce(property: string, value: ValidPropertyType): Identify {\n    this._safeSet(IdentifyOperation.SET_ONCE, property, value);\n    return this;\n  }\n\n  public append(property: string, value: ValidPropertyType): Identify {\n    this._safeSet(IdentifyOperation.APPEND, property, value);\n    return this;\n  }\n\n  public prepend(property: string, value: ValidPropertyType): Identify {\n    this._safeSet(IdentifyOperation.PREPEND, property, value);\n    return this;\n  }\n\n  public postInsert(property: string, value: ValidPropertyType): Identify {\n    this._safeSet(IdentifyOperation.POSTINSERT, property, value);\n    return this;\n  }\n\n  public preInsert(property: string, value: ValidPropertyType): Identify {\n    this._safeSet(IdentifyOperation.PREINSERT, property, value);\n    return this;\n  }\n\n  public remove(property: string, value: ValidPropertyType): Identify {\n    this._safeSet(IdentifyOperation.REMOVE, property, value);\n    return this;\n  }\n\n  public add(property: string, value: number): Identify {\n    this._safeSet(IdentifyOperation.ADD, property, value);\n    return this;\n  }\n\n  public unset(property: string): Identify {\n    this._safeSet(IdentifyOperation.UNSET, property, UNSET_VALUE);\n    return this;\n  }\n\n  public clearAll(): Identify {\n    // When clear all happens, all properties are unset. Reset the entire object.\n    this._properties = {};\n    this._properties[IdentifyOperation.CLEAR_ALL] = UNSET_VALUE;\n\n    return this;\n  }\n\n  // Returns whether or not this set actually worked.\n  private _safeSet(operation: IdentifyOperation, property: string, value: ValidPropertyType): boolean {\n    if (this._validate(operation, property, value)) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      let userPropertyMap: any = this._properties[operation];\n      if (userPropertyMap === undefined) {\n        userPropertyMap = {};\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        this._properties[operation] = userPropertyMap;\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      userPropertyMap[property] = value;\n      this._propertySet.add(property);\n      return true;\n    }\n\n    return false;\n  }\n\n  private _validate(operation: IdentifyOperation, property: string, value: ValidPropertyType): boolean {\n    if (this._properties[IdentifyOperation.CLEAR_ALL] !== undefined) {\n      // clear all already set. Skipping operation;\n      return false;\n    }\n\n    if (this._propertySet.has(property)) {\n      // Property already used. Skipping operation\n      return false;\n    }\n\n    if (operation === IdentifyOperation.ADD) {\n      return typeof value === 'number';\n    }\n\n    if (operation !== IdentifyOperation.UNSET && operation !== IdentifyOperation.REMOVE) {\n      return isValidProperties(property, value);\n    }\n    return true;\n  }\n}\n\nexport type ValidPropertyType =\n  | number\n  | string\n  | boolean\n  | Array<string | number>\n  | { [key: string]: ValidPropertyType }\n  | Array<{ [key: string]: ValidPropertyType }>;\n\ninterface BaseOperationConfig {\n  [key: string]: ValidPropertyType;\n}\n\nexport interface IdentifyUserProperties {\n  // Add operations can only take numbers\n  [IdentifyOperation.ADD]?: { [key: string]: number };\n\n  // This reads the keys of the passed object, but the values are not used\n  [IdentifyOperation.UNSET]?: BaseOperationConfig;\n  // This option does not read the key as it unsets all user properties\n  [IdentifyOperation.CLEAR_ALL]?: any;\n\n  // These operations can take numbers, strings, or arrays of both.\n  [IdentifyOperation.SET]?: BaseOperationConfig;\n  [IdentifyOperation.SET_ONCE]?: BaseOperationConfig;\n  [IdentifyOperation.APPEND]?: BaseOperationConfig;\n  [IdentifyOperation.PREPEND]?: BaseOperationConfig;\n  [IdentifyOperation.POSTINSERT]?: BaseOperationConfig;\n  [IdentifyOperation.PREINSERT]?: BaseOperationConfig;\n  [IdentifyOperation.REMOVE]?: BaseOperationConfig;\n}\n\nexport enum IdentifyOperation {\n  // Base Operations to set values\n  SET = '$set',\n  SET_ONCE = '$setOnce',\n\n  // Operations around modifying existing values\n  ADD = '$add',\n  APPEND = '$append',\n  PREPEND = '$prepend',\n  REMOVE = '$remove',\n\n  // Operations around appending values *if* they aren't present\n  PREINSERT = '$preInsert',\n  POSTINSERT = '$postInsert',\n\n  // Operations around removing properties/values\n  UNSET = '$unset',\n  CLEAR_ALL = '$clearAll',\n}\n\n/**\n * Note that the order of operations should align with https://github.com/amplitude/nova/blob/7701b5986b565d4b2fb53b99a9f2175df055dea8/src/main/java/com/amplitude/ingestion/core/UserPropertyUtils.java#L210\n */\nexport const OrderedIdentifyOperations = [\n  IdentifyOperation.CLEAR_ALL,\n  IdentifyOperation.UNSET,\n  IdentifyOperation.SET,\n  IdentifyOperation.SET_ONCE,\n  IdentifyOperation.ADD,\n  IdentifyOperation.APPEND,\n  IdentifyOperation.PREPEND,\n  IdentifyOperation.PREINSERT,\n  IdentifyOperation.POSTINSERT,\n  IdentifyOperation.REMOVE,\n];\n", "export const SUCCESS_MESSAGE = 'Event tracked successfully';\nexport const UNEXPECTED_ERROR_MESSAGE = 'Unexpected error occurred';\nexport const MAX_RETRIES_EXCEEDED_MESSAGE = 'Event rejected due to exceeded retry count';\nexport const OPT_OUT_MESSAGE = 'Event skipped due to optOut config';\nexport const MISSING_API_KEY_MESSAGE = 'Event rejected due to missing API key';\nexport const INVALID_API_KEY = 'Invalid API key';\nexport const CLIENT_NOT_INITIALIZED = 'Client not initialized';\n", "/** The status of an event. */\nexport enum Status {\n  /** The status could not be determined. */\n  Unknown = 'unknown',\n  /** The event was skipped due to configuration or callbacks. */\n  Skipped = 'skipped',\n  /** The event was sent successfully. */\n  Success = 'success',\n  /** A user or device in the payload is currently rate limited and should try again later. */\n  RateLimit = 'rate_limit',\n  /** The sent payload was too large to be processed. */\n  PayloadTooLarge = 'payload_too_large',\n  /** The event could not be processed. */\n  Invalid = 'invalid',\n  /** A server-side error ocurred during submission. */\n  Failed = 'failed',\n  /** a server or client side error occuring when a request takes too long and is cancelled */\n  Timeout = 'Timeout',\n  /** NodeJS runtime environment error.. E.g. disconnected from network */\n  SystemError = 'SystemError',\n}\n", "import { Event } from '../types/event/event';\nimport { Result } from '../types/result';\nimport { Status } from '../types/status';\n\nexport const buildResult = (event: Event, code = 0, message: string = Status.Unknown): Result => {\n  return { event, code, message };\n};\n", "/* eslint-disable no-restricted-globals */\n/* Only file allowed to access to globalThis, window, self */\n\nexport const getGlobalScope = (): typeof globalThis | undefined => {\n  // This should only be used for integrations with Amplitude that are not running in a browser environment\n  //   We need to specify the name of the global variable as a string to prevent it from being minified\n  const ampIntegrationContextName = 'ampIntegrationContext' as keyof typeof globalThis;\n  if (typeof globalThis !== 'undefined' && typeof globalThis[ampIntegrationContextName] !== 'undefined') {\n    return globalThis[ampIntegrationContextName] as typeof globalThis;\n  }\n  if (typeof globalThis !== 'undefined') {\n    return globalThis;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  return undefined;\n};\n", "/**\n * Source: [jed's gist's comment]{@link https://gist.github.com/jed/982883?permalink_comment_id=3223002#gistcomment-3223002}.\n * Returns a random v4 UUID of the form xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx,\n * where each x is replaced with a random hexadecimal digit from 0 to f, and\n * y is replaced with a random hexadecimal digit from 8 to b.\n * Used to generate UUIDs for deviceIds.\n * @private\n */\n\nimport { getGlobalScope } from '../global-scope';\n\nconst legacyUUID = function (a?: any): string {\n  return a // if the placeholder was passed, return\n    ? // a random number from 0 to 15\n      (\n        a ^ // unless b is 8,\n        ((Math.random() * // in which case\n          16) >> // a random number from\n          (a / 4))\n      ) // 8 to 11\n        .toString(16) // in hexadecimal\n    : // or otherwise a concatenated string:\n      (\n        String(1e7) + // 10000000 +\n        String(-1e3) + // -1000 +\n        String(-4e3) + // -4000 +\n        String(-8e3) + // -80000000 +\n        String(-1e11)\n      ) // -100000000000,\n        .replace(\n          // replacing\n          /[018]/g, // zeroes, ones, and eights with\n          UUID, // random hex digits\n        );\n};\n\nconst hex: string[] = [...Array(256).keys()].map((index) => index.toString(16).padStart(2, '0'));\n\nexport const UUID = (a?: any): string => {\n  const globalScope = getGlobalScope();\n\n  /* istanbul ignore next */\n  if (!globalScope?.crypto?.getRandomValues) {\n    // Fallback to legacy UUID generation if crypto is not available\n    return legacyUUID(a);\n  }\n\n  const r = globalScope.crypto.getRandomValues(new Uint8Array(16));\n\n  r[6] = (r[6] & 0x0f) | 0x40;\n  r[8] = (r[8] & 0x3f) | 0x80;\n\n  return [...r.entries()].map(([index, int]) => ([4, 6, 8, 10].includes(index) ? `-${hex[int]}` : hex[int])).join('');\n};\n", "import { AnalyticsIdentity, BeforePlugin, DestinationPlugin, EnrichmentPlugin, Plugin } from './types/plugin';\nimport { CoreClient } from './types/client/core-client';\nimport { IConfig } from './types/config/core-config';\nimport { ILogger } from './logger';\nimport { EventCallback } from './types/event-callback';\nimport { Event } from './types/event/event';\nimport { Result } from './types/result';\nimport { buildResult } from './utils/result-builder';\nimport { UUID } from './utils/uuid';\n\nexport class Timeline {\n  queue: [Event, EventCallback][] = [];\n  // Flag to guarantee one schedule apply is running\n  applying = false;\n  // Flag indicates whether timeline is ready to process event\n  // Events collected before timeline is ready will stay in the queue to be processed later\n  plugins: Plugin[] = [];\n  // loggerProvider is set by the client at _init()\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  loggerProvider: ILogger;\n\n  constructor(private client: CoreClient) {}\n\n  async register(plugin: Plugin, config: IConfig) {\n    if (this.plugins.some((existingPlugin) => existingPlugin.name === plugin.name)) {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      this.loggerProvider.warn(`Plugin with name ${plugin.name} already exists, skipping registration`);\n      return;\n    }\n\n    if (plugin.name === undefined) {\n      plugin.name = UUID();\n      this.loggerProvider.warn(`Plugin name is undefined. \n      Generating a random UUID for plugin name: ${plugin.name}. \n      Set a name for the plugin to prevent it from being added multiple times.`);\n    }\n\n    plugin.type = plugin.type ?? 'enrichment';\n    await plugin.setup?.(config, this.client);\n    this.plugins.push(plugin);\n  }\n\n  async deregister(pluginName: string, config: IConfig) {\n    const index = this.plugins.findIndex((plugin) => plugin.name === pluginName);\n    if (index === -1) {\n      config.loggerProvider.warn(`Plugin with name ${pluginName} does not exist, skipping deregistration`);\n      return;\n    }\n    const plugin = this.plugins[index];\n    this.plugins.splice(index, 1);\n    await plugin.teardown?.();\n  }\n\n  reset(client: CoreClient) {\n    this.applying = false;\n    const plugins = this.plugins;\n    plugins.map((plugin) => plugin.teardown?.());\n    this.plugins = [];\n    this.client = client;\n  }\n\n  push(event: Event) {\n    return new Promise<Result>((resolve) => {\n      this.queue.push([event, resolve]);\n      this.scheduleApply(0);\n    });\n  }\n\n  scheduleApply(timeout: number) {\n    if (this.applying) return;\n    this.applying = true;\n    setTimeout(() => {\n      void this.apply(this.queue.shift()).then(() => {\n        this.applying = false;\n        if (this.queue.length > 0) {\n          this.scheduleApply(0);\n        }\n      });\n    }, timeout);\n  }\n\n  async apply(item: [Event, EventCallback] | undefined) {\n    if (!item) {\n      return;\n    }\n\n    let [event] = item;\n    const [, resolve] = item;\n\n    // Log initial event\n    this.loggerProvider.log('Timeline.apply: Initial event', event);\n\n    const before = this.plugins.filter<BeforePlugin>(\n      (plugin: Plugin): plugin is BeforePlugin => plugin.type === 'before',\n    );\n\n    for (const plugin of before) {\n      /* istanbul ignore if */\n      if (!plugin.execute) {\n        // do nothing\n        continue;\n      }\n      const e = await plugin.execute({ ...event });\n      if (e === null) {\n        this.loggerProvider.log(\n          `Timeline.apply: Event filtered out by before plugin '${String(plugin.name)}', event: ${JSON.stringify(\n            event,\n          )}`,\n        );\n        resolve({ event, code: 0, message: '' });\n        return;\n      } else {\n        event = e;\n        this.loggerProvider.log(\n          `Timeline.apply: Event after before plugin '${String(plugin.name)}', event: ${JSON.stringify(event)}`,\n        );\n      }\n    }\n\n    const enrichment = this.plugins.filter<EnrichmentPlugin>(\n      (plugin: Plugin): plugin is EnrichmentPlugin => plugin.type === 'enrichment' || plugin.type === undefined,\n    );\n\n    for (const plugin of enrichment) {\n      /* istanbul ignore if */\n      if (!plugin.execute) {\n        // do nothing\n        continue;\n      }\n      const e = await plugin.execute({ ...event });\n      if (e === null) {\n        this.loggerProvider.log(\n          `Timeline.apply: Event filtered out by enrichment plugin '${String(plugin.name)}', event: ${JSON.stringify(\n            event,\n          )}`,\n        );\n        resolve({ event, code: 0, message: '' });\n        return;\n      } else {\n        event = e;\n        this.loggerProvider.log(\n          `Timeline.apply: Event after enrichment plugin '${String(plugin.name)}', event: ${JSON.stringify(event)}`,\n        );\n      }\n    }\n\n    const destination = this.plugins.filter<DestinationPlugin>(\n      (plugin: Plugin): plugin is DestinationPlugin => plugin.type === 'destination',\n    );\n\n    // Log final event before sending to destinations\n    this.loggerProvider.log(`Timeline.apply: Final event before destinations, event: ${JSON.stringify(event)}`);\n\n    const executeDestinations = destination.map((plugin) => {\n      const eventClone = { ...event };\n      return plugin.execute(eventClone).catch((e) => buildResult(eventClone, 0, String(e)));\n    });\n\n    void Promise.all(executeDestinations).then(([result]) => {\n      const resolveResult =\n        result || buildResult(event, 100, 'Event not tracked, no destination plugins on the instance');\n      resolve(resolveResult);\n    });\n\n    return;\n  }\n\n  async flush() {\n    const queue = this.queue;\n    this.queue = [];\n\n    await Promise.all(queue.map((item) => this.apply(item)));\n\n    const destination = this.plugins.filter<DestinationPlugin>(\n      (plugin: Plugin): plugin is DestinationPlugin => plugin.type === 'destination',\n    );\n\n    const executeDestinations = destination.map((plugin) => {\n      return plugin.flush && plugin.flush();\n    });\n\n    await Promise.all(executeDestinations);\n  }\n\n  onIdentityChanged(identity: AnalyticsIdentity) {\n    this.plugins.forEach((plugin) => {\n      // Intentionally to not await plugin.onIdentityChanged() for non-blocking.\n      // Ignore optional channing next line for test coverage.\n      // If the plugin doesn't implement it, it won't be called.\n      /* istanbul ignore next */\n      void plugin.onIdentityChanged?.(identity);\n    });\n  }\n\n  onSessionIdChanged(sessionId: number) {\n    this.plugins.forEach((plugin) => {\n      // Intentionally to not await plugin.onSessionIdChanged() for non-blocking.\n      // Ignore optional channing next line for test coverage.\n      // If the plugin doesn't implement it, it won't be called.\n      /* istanbul ignore next */\n      void plugin.onSessionIdChanged?.(sessionId);\n    });\n  }\n\n  onOptOutChanged(optOut: boolean) {\n    this.plugins.forEach((plugin) => {\n      // Intentionally to not await plugin.onOptOutChanged() for non-blocking.\n      // Ignore optional channing next line for test coverage.\n      // If the plugin doesn't implement it, it won't be called.\n      /* istanbul ignore next */\n      void plugin.onOptOutChanged?.(optOut);\n    });\n  }\n\n  onReset() {\n    this.plugins.forEach((plugin) => {\n      // Intentionally to not await plugin.onReset() for non-blocking.\n      // Ignore optional channing next line for test coverage.\n      // If the plugin doesn't implement it, it won't be called.\n      /* istanbul ignore next */\n      void plugin.onReset?.();\n    });\n  }\n}\n", "import { Identify, IIdentify } from '../identify';\nimport { IRevenue } from '../revenue';\nimport { BaseEvent, EventOptions } from '../types/event/base-event';\nimport { TrackEvent, IdentifyEvent, GroupIdentifyEvent, SpecialEventType, RevenueEvent } from '../types/event/event';\n\nexport const createTrackEvent = (\n  eventInput: BaseEvent | string,\n  eventProperties?: Record<string, any>,\n  eventOptions?: EventOptions,\n): TrackEvent => {\n  const baseEvent: BaseEvent = typeof eventInput === 'string' ? { event_type: eventInput } : eventInput;\n  return {\n    ...baseEvent,\n    ...eventOptions,\n    ...(eventProperties && { event_properties: eventProperties }),\n  };\n};\n\nexport const createIdentifyEvent = (identify: IIdentify, eventOptions?: EventOptions): IdentifyEvent => {\n  const identifyEvent: IdentifyEvent = {\n    ...eventOptions,\n    event_type: SpecialEventType.IDENTIFY,\n    user_properties: identify.getUserProperties(),\n  };\n\n  return identifyEvent;\n};\n\nexport const createGroupIdentifyEvent = (\n  groupType: string,\n  groupName: string | string[],\n  identify: IIdentify,\n  eventOptions?: EventOptions,\n): GroupIdentifyEvent => {\n  const groupIdentify: GroupIdentifyEvent = {\n    ...eventOptions,\n    event_type: SpecialEventType.GROUP_IDENTIFY,\n    group_properties: identify.getUserProperties(),\n    groups: {\n      [groupType]: groupName,\n    },\n  };\n\n  return groupIdentify;\n};\n\nexport const createGroupEvent = (groupType: string, groupName: string | string[], eventOptions?: EventOptions) => {\n  const identify = new Identify();\n  identify.set(groupType, groupName);\n\n  const groupEvent: IdentifyEvent = {\n    ...eventOptions,\n    event_type: SpecialEventType.IDENTIFY,\n    user_properties: identify.getUserProperties(),\n    groups: {\n      [groupType]: groupName,\n    },\n  };\n  return groupEvent;\n};\n\nexport const createRevenueEvent = (revenue: IRevenue, eventOptions?: EventOptions): RevenueEvent => {\n  return {\n    ...eventOptions,\n    event_type: SpecialEventType.REVENUE,\n    event_properties: revenue.getEventProperties(),\n  };\n};\n", "export interface AmplitudeReturn<T> {\n  promise: Promise<T>;\n}\n\nexport const returnWrapper: {\n  (): AmplitudeReturn<void>;\n  <T>(awaitable: Promise<T>): AmplitudeReturn<T>;\n} = <T>(awaitable?: Promise<T>) => ({\n  promise: awaitable || Promise.resolve(),\n});\n", "import { Plugin } from './types/plugin';\nimport { IConfig } from './types/config/core-config';\nimport { BaseEvent, EventOptions } from './types/event/base-event';\nimport { Result } from './types/result';\nimport {\n  Event,\n  IdentifyOperation,\n  IdentifyUserProperties,\n  SpecialEventType,\n  UserProperties,\n} from './types/event/event';\nimport { IIdentify, OrderedIdentifyOperations } from './identify';\nimport { IRevenue } from './revenue';\nimport { CLIENT_NOT_INITIALIZED, OPT_OUT_MESSAGE } from './types/messages';\nimport { Timeline } from './timeline';\nimport {\n  createGroupEvent,\n  createGroupIdentifyEvent,\n  createIdentifyEvent,\n  createRevenueEvent,\n  createTrackEvent,\n} from './utils/event-builder';\nimport { buildResult } from './utils/result-builder';\nimport { returnWrapper } from './utils/return-wrapper';\nimport { CoreClient, PluginHost } from './types/client/core-client';\nexport class AmplitudeCore implements CoreClient, PluginHost {\n  protected initializing = false;\n  protected name: string;\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  config: IConfig;\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  timeline: Timeline;\n  isReady = false;\n  protected q: Array<CallableFunction | typeof returnWrapper> = [];\n  protected dispatchQ: Array<CallableFunction> = [];\n\n  constructor(name = '$default') {\n    this.timeline = new Timeline(this);\n    this.name = name;\n  }\n\n  protected async _init(config: IConfig) {\n    this.config = config;\n    this.timeline.reset(this);\n    this.timeline.loggerProvider = this.config.loggerProvider;\n    await this.runQueuedFunctions('q');\n    this.isReady = true;\n  }\n\n  async runQueuedFunctions(queueName: 'q' | 'dispatchQ') {\n    const queuedFunctions = this[queueName];\n    this[queueName] = [];\n    for (const queuedFunction of queuedFunctions) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const val: ReturnType<typeof returnWrapper> | Promise<any> = queuedFunction();\n      if (val && 'promise' in val) {\n        await val.promise;\n      } else {\n        await val;\n      }\n    }\n    // Rerun queued functions if the queue has accrued more while awaiting promises\n    if (this[queueName].length) {\n      await this.runQueuedFunctions(queueName);\n    }\n  }\n\n  track(eventInput: BaseEvent | string, eventProperties?: Record<string, any>, eventOptions?: EventOptions) {\n    const event = createTrackEvent(eventInput, eventProperties, eventOptions);\n    return returnWrapper(this.dispatch(event));\n  }\n\n  logEvent = this.track.bind(this);\n\n  identify(identify: IIdentify, eventOptions?: EventOptions) {\n    const event = createIdentifyEvent(identify, eventOptions);\n    return returnWrapper(this.dispatch(event));\n  }\n\n  groupIdentify(groupType: string, groupName: string | string[], identify: IIdentify, eventOptions?: EventOptions) {\n    const event = createGroupIdentifyEvent(groupType, groupName, identify, eventOptions);\n    return returnWrapper(this.dispatch(event));\n  }\n\n  setGroup(groupType: string, groupName: string | string[], eventOptions?: EventOptions) {\n    const event = createGroupEvent(groupType, groupName, eventOptions);\n    return returnWrapper(this.dispatch(event));\n  }\n\n  revenue(revenue: IRevenue, eventOptions?: EventOptions) {\n    const event = createRevenueEvent(revenue, eventOptions);\n    return returnWrapper(this.dispatch(event));\n  }\n\n  add(plugin: Plugin) {\n    if (!this.isReady) {\n      this.q.push(this._addPlugin.bind(this, plugin));\n      return returnWrapper();\n    }\n    return this._addPlugin(plugin);\n  }\n\n  _addPlugin(plugin: Plugin) {\n    return returnWrapper(this.timeline.register(plugin, this.config));\n  }\n\n  remove(pluginName: string) {\n    if (!this.isReady) {\n      this.q.push(this._removePlugin.bind(this, pluginName));\n      return returnWrapper();\n    }\n    return this._removePlugin(pluginName);\n  }\n\n  _removePlugin(pluginName: string) {\n    return returnWrapper(this.timeline.deregister(pluginName, this.config));\n  }\n\n  dispatchWithCallback(event: Event, callback: (result: Result) => void): void {\n    if (!this.isReady) {\n      return callback(buildResult(event, 0, CLIENT_NOT_INITIALIZED));\n    }\n    void this.process(event).then(callback);\n  }\n\n  async dispatch(event: Event): Promise<Result> {\n    if (!this.isReady) {\n      return new Promise<Result>((resolve) => {\n        this.dispatchQ.push(this.dispatchWithCallback.bind(this, event, resolve));\n      });\n    }\n\n    return this.process(event);\n  }\n\n  /**\n   *\n   * This method applies identify operations to user properties and\n   * returns a single object representing the final user property state.\n   *\n   * This is a best-effort api that only supports $set, $clearAll, and $unset.\n   * Other operations are not supported and are ignored.\n   *\n   *\n   * @param userProperties The `event.userProperties` object from an Identify event.\n   * @returns A key-value object user properties without operations.\n   *\n   * @example\n   * Input:\n   * {\n   *   $set: { plan: 'premium' },\n   *   custom_flag: true\n   * }\n   *\n   * Output:\n   * {\n   *   plan: 'premium',\n   *   custom_flag: true\n   * }\n   */\n  getOperationAppliedUserProperties(userProperties: UserProperties | undefined): { [key: string]: any } {\n    const updatedProperties: { [key: string]: any } = {};\n\n    if (userProperties === undefined) {\n      return updatedProperties;\n    }\n\n    // Keep non-operation keys for later merge\n    const nonOpProperties: {\n      [key in Exclude<string, IdentifyOperation>]: any;\n    } = {};\n    Object.keys(userProperties).forEach((key) => {\n      if (!Object.values(IdentifyOperation).includes(key as IdentifyOperation)) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        nonOpProperties[key] = userProperties[key];\n      }\n    });\n\n    OrderedIdentifyOperations.forEach((operation) => {\n      // Skip when key is an operation.\n      if (!Object.keys(userProperties).includes(operation)) return;\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const opProperties: IdentifyUserProperties = userProperties[operation];\n\n      switch (operation) {\n        case IdentifyOperation.CLEAR_ALL:\n          // Due to operation order, the following line will never execute.\n          /* istanbul ignore next */\n          Object.keys(updatedProperties).forEach((prop) => {\n            delete updatedProperties[prop];\n          });\n          break;\n        case IdentifyOperation.UNSET:\n          Object.keys(opProperties).forEach((prop) => {\n            delete updatedProperties[prop];\n          });\n          break;\n        case IdentifyOperation.SET:\n          Object.assign(updatedProperties, opProperties);\n          break;\n      }\n    });\n\n    // Merge non-operation properties.\n    // Custom properties should not be affected by operations.\n    // https://github.com/amplitude/nova/blob/343f678ded83c032e83b189796b3c2be161b48f5/src/main/java/com/amplitude/userproperty/model/ModifyUserPropertiesIdent.java#L79-L83\n    Object.assign(updatedProperties, nonOpProperties);\n\n    return updatedProperties;\n  }\n\n  async process(event: Event): Promise<Result> {\n    try {\n      // skip event processing if opt out\n      if (this.config.optOut) {\n        return buildResult(event, 0, OPT_OUT_MESSAGE);\n      }\n\n      if (event.event_type === SpecialEventType.IDENTIFY) {\n        const userProperties = this.getOperationAppliedUserProperties(event.user_properties);\n        this.timeline.onIdentityChanged({ userProperties: userProperties });\n      }\n\n      const result = await this.timeline.push(event);\n\n      result.code === 200\n        ? this.config.loggerProvider.log(result.message)\n        : result.code === 100\n        ? this.config.loggerProvider.warn(result.message)\n        : this.config.loggerProvider.error(result.message);\n\n      return result;\n    } catch (e) {\n      const message = String(e);\n      this.config.loggerProvider.error(message);\n      const result = buildResult(event, 0, message);\n\n      return result;\n    }\n  }\n\n  setOptOut(optOut: boolean) {\n    if (!this.isReady) {\n      this.q.push(this._setOptOut.bind(this, Boolean(optOut)));\n      return;\n    }\n    this._setOptOut(optOut);\n  }\n\n  _setOptOut(optOut: boolean) {\n    if (this.config.optOut !== optOut) {\n      this.timeline.onOptOutChanged(optOut);\n      this.config.optOut = Boolean(optOut);\n    }\n  }\n\n  flush() {\n    return returnWrapper(this.timeline.flush());\n  }\n\n  plugin(name: string): Plugin | undefined {\n    const plugin = this.timeline.plugins.find((plugin) => plugin.name === name);\n    if (plugin === undefined) {\n      this.config.loggerProvider.debug(`Cannot find plugin with name ${name}`);\n      return undefined;\n    }\n\n    return plugin;\n  }\n\n  plugins<T extends Plugin>(pluginClass: { new (...args: any[]): T }): T[] {\n    return this.timeline.plugins.filter((plugin) => plugin instanceof pluginClass) as T[];\n  }\n}\n", "import { isValidObject } from './utils/valid-properties';\n\nexport interface IRevenue {\n  getEventProperties(): RevenueEventProperties;\n  setProductId(productId: string): IRevenue;\n  setQuantity(quantity: number): IRevenue;\n  setPrice(price: number): IRevenue;\n  setRevenueType(revenueType: string): IRevenue;\n  setCurrency(currency: string): IRevenue;\n  setEventProperties(properties: { [key: string]: any }): IRevenue;\n  setRevenue(revenue: number): IRevenue;\n  setReceipt(receipt: string): IRevenue;\n  setReceiptSig(receiptSig: string): IRevenue;\n}\n\nexport class Revenue implements IRevenue {\n  private productId: string;\n  private quantity: number;\n  private price: number;\n  private revenueType?: string;\n  private currency?: string;\n  private properties?: { [key: string]: any };\n  private revenue?: number;\n  private receipt?: string;\n  private receiptSig?: string;\n\n  constructor() {\n    this.productId = '';\n    this.quantity = 1;\n    this.price = 0.0;\n  }\n\n  setProductId(productId: string) {\n    this.productId = productId;\n    return this;\n  }\n\n  setQuantity(quantity: number) {\n    if (quantity > 0) {\n      this.quantity = quantity;\n    }\n    return this;\n  }\n\n  setPrice(price: number) {\n    this.price = price;\n    return this;\n  }\n\n  setRevenueType(revenueType: string) {\n    this.revenueType = revenueType;\n    return this;\n  }\n\n  setCurrency(currency: string) {\n    this.currency = currency;\n    return this;\n  }\n\n  setRevenue(revenue: number) {\n    this.revenue = revenue;\n    return this;\n  }\n\n  setReceipt(receipt: string) {\n    this.receipt = receipt;\n    return this;\n  }\n\n  setReceiptSig(receiptSig: string) {\n    this.receiptSig = receiptSig;\n    return this;\n  }\n\n  setEventProperties(properties: { [key: string]: ValidPropertyType }) {\n    if (isValidObject(properties)) {\n      this.properties = properties;\n    }\n    return this;\n  }\n\n  getEventProperties(): RevenueEventProperties {\n    const eventProperties: RevenueEventProperties = this.properties ? { ...this.properties } : {};\n    eventProperties[RevenueProperty.REVENUE_PRODUCT_ID] = this.productId;\n    eventProperties[RevenueProperty.REVENUE_QUANTITY] = this.quantity;\n    eventProperties[RevenueProperty.REVENUE_PRICE] = this.price;\n    eventProperties[RevenueProperty.REVENUE_TYPE] = this.revenueType;\n    eventProperties[RevenueProperty.REVENUE_CURRENCY] = this.currency;\n    eventProperties[RevenueProperty.REVENUE] = this.revenue;\n    eventProperties[RevenueProperty.RECEIPT] = this.receipt;\n    eventProperties[RevenueProperty.RECEIPT_SIG] = this.receiptSig;\n    return eventProperties;\n  }\n}\n\nexport interface RevenueEventProperties {\n  [RevenueProperty.REVENUE_PRODUCT_ID]?: string;\n  [RevenueProperty.REVENUE_QUANTITY]?: number;\n  [RevenueProperty.REVENUE_PRICE]?: number;\n  [RevenueProperty.REVENUE_TYPE]?: string;\n  [RevenueProperty.REVENUE_CURRENCY]?: string;\n  [RevenueProperty.REVENUE]?: number;\n  [RevenueProperty.RECEIPT]?: string;\n  [RevenueProperty.RECEIPT_SIG]?: string;\n}\n\nexport enum RevenueProperty {\n  REVENUE_PRODUCT_ID = '$productId',\n  REVENUE_QUANTITY = '$quantity',\n  REVENUE_PRICE = '$price',\n  REVENUE_TYPE = '$revenueType',\n  REVENUE_CURRENCY = '$currency',\n  REVENUE = '$revenue',\n  RECEIPT = '$receipt',\n  RECEIPT_SIG = '$receiptSig',\n}\n\nexport type ValidPropertyType =\n  | number\n  | string\n  | boolean\n  | Array<string | number>\n  | { [key: string]: ValidPropertyType }\n  | Array<{ [key: string]: ValidPropertyType }>;\n", "// Creates an array of elements split into groups the length of size.\n// If array can't be split evenly, the final chunk will be the remaining elements.\n// Works similary as https://lodash.com/docs/4.17.15#chunk\n\nexport const chunk = <T>(arr: T[], size: number) => {\n  const chunkSize = Math.max(size, 1);\n  return arr.reduce<T[][]>((chunks, element, index) => {\n    const chunkIndex = Math.floor(index / chunkSize);\n    if (!chunks[chunkIndex]) {\n      chunks[chunkIndex] = [];\n    }\n    chunks[chunkIndex].push(element);\n    return chunks;\n  }, []);\n};\n", "export enum LogLevel {\n  None = 0,\n  Error = 1,\n  Warn = 2,\n  Verbose = 3,\n  Debug = 4,\n}\n", "import { LogLevel } from './types/loglevel';\n\nconst PREFIX = 'Amplitude Logger ';\n\nexport interface ILogger {\n  disable(): void;\n  enable(logLevel: LogLevel): void;\n  log(...args: any[]): void;\n  warn(...args: any[]): void;\n  error(...args: any[]): void;\n  debug(...args: any[]): void;\n}\n\nexport interface LogConfig {\n  logger: ILogger;\n  logLevel: LogLevel;\n}\n\ntype TimeKey = 'start' | 'end';\n\nexport interface DebugContext {\n  type: string;\n  name: string;\n  args: string[] | string;\n  stacktrace?: string[] | string;\n  time?: { [key in TimeKey]?: string };\n  states?: { [key: string]: any };\n}\n\nexport class Logger implements ILogger {\n  logLevel: LogLevel;\n\n  constructor() {\n    this.logLevel = LogLevel.None;\n  }\n\n  disable(): void {\n    this.logLevel = LogLevel.None;\n  }\n\n  enable(logLevel: LogLevel = LogLevel.Warn): void {\n    this.logLevel = logLevel;\n  }\n\n  log(...args: any[]): void {\n    if (this.logLevel < LogLevel.Verbose) {\n      return;\n    }\n    console.log(`${PREFIX}[Log]: ${args.join(' ')}`);\n  }\n\n  warn(...args: any[]): void {\n    if (this.logLevel < LogLevel.Warn) {\n      return;\n    }\n    console.warn(`${PREFIX}[Warn]: ${args.join(' ')}`);\n  }\n\n  error(...args: any[]): void {\n    if (this.logLevel < LogLevel.Error) {\n      return;\n    }\n    console.error(`${PREFIX}[Error]: ${args.join(' ')}`);\n  }\n\n  debug(...args: any[]): void {\n    if (this.logLevel < LogLevel.Debug) {\n      return;\n    }\n    // console.debug output is hidden by default in chrome\n    console.log(`${PREFIX}[Debug]: ${args.join(' ')}`);\n  }\n}\n", "import { OfflineDisabled } from './types/offline';\nimport { ServerZoneType } from './types/server-zone';\nimport { Transport } from './types/transport';\nimport { Event } from './types/event/event';\nimport { Plan } from './types/event/plan';\nimport { IngestionMetadata } from './types/event/ingestion-metadata';\nimport { Storage } from './types/storage';\nimport {\n  AMPLITUDE_SERVER_URL,\n  AMPLITUDE_BATCH_SERVER_URL,\n  EU_AMPLITUDE_SERVER_URL,\n  EU_AMPLITUDE_BATCH_SERVER_URL,\n  DEFAULT_INSTANCE_NAME,\n} from './types/constants';\n\nimport { Logger, ILogger } from './logger';\nimport { LogLevel } from './types/loglevel';\nimport { ConfigOptions, IRequestMetadata, IHistogramOptions, HistogramKey, IConfig } from './types/config/core-config';\n\nexport const getDefaultConfig = () => ({\n  flushMaxRetries: 12,\n  flushQueueSize: 200,\n  flushIntervalMillis: 10000,\n  instanceName: DEFAULT_INSTANCE_NAME,\n  logLevel: LogLevel.Warn,\n  loggerProvider: new Logger(),\n  offline: false,\n  optOut: false,\n  serverUrl: AMPLITUDE_SERVER_URL,\n  serverZone: 'US' as ServerZoneType,\n  useBatch: false,\n});\nexport class Config implements IConfig {\n  apiKey: string;\n  flushIntervalMillis: number;\n  flushMaxRetries: number;\n  flushQueueSize: number;\n  instanceName?: string;\n  loggerProvider: ILogger;\n  logLevel: LogLevel;\n  minIdLength?: number;\n  offline?: boolean | typeof OfflineDisabled;\n  plan?: Plan;\n  ingestionMetadata?: IngestionMetadata;\n  serverUrl: string | undefined;\n  serverZone?: ServerZoneType;\n  transportProvider: Transport;\n  storageProvider?: Storage<Event[]>;\n  useBatch: boolean;\n  requestMetadata?: RequestMetadata;\n\n  protected _optOut = false;\n  get optOut() {\n    return this._optOut;\n  }\n  set optOut(optOut: boolean) {\n    this._optOut = optOut;\n  }\n\n  constructor(options: ConfigOptions) {\n    const defaultConfig = getDefaultConfig();\n    this.apiKey = options.apiKey;\n    this.flushIntervalMillis = options.flushIntervalMillis ?? defaultConfig.flushIntervalMillis;\n    this.flushMaxRetries = options.flushMaxRetries || defaultConfig.flushMaxRetries;\n    this.flushQueueSize = options.flushQueueSize || defaultConfig.flushQueueSize;\n    this.instanceName = options.instanceName || defaultConfig.instanceName;\n    this.loggerProvider = options.loggerProvider || defaultConfig.loggerProvider;\n    this.logLevel = options.logLevel ?? defaultConfig.logLevel;\n    this.minIdLength = options.minIdLength;\n    this.plan = options.plan;\n    this.ingestionMetadata = options.ingestionMetadata;\n    this.offline = options.offline !== undefined ? options.offline : defaultConfig.offline;\n    this.optOut = options.optOut ?? defaultConfig.optOut;\n    this.serverUrl = options.serverUrl;\n    this.serverZone = options.serverZone || defaultConfig.serverZone;\n    this.storageProvider = options.storageProvider;\n    this.transportProvider = options.transportProvider;\n    this.useBatch = options.useBatch ?? defaultConfig.useBatch;\n    this.loggerProvider.enable(this.logLevel);\n\n    const serverConfig = createServerConfig(options.serverUrl, options.serverZone, options.useBatch);\n    this.serverZone = serverConfig.serverZone;\n    this.serverUrl = serverConfig.serverUrl;\n  }\n}\n\nexport const getServerUrl = (serverZone: ServerZoneType, useBatch: boolean) => {\n  if (serverZone === 'EU') {\n    return useBatch ? EU_AMPLITUDE_BATCH_SERVER_URL : EU_AMPLITUDE_SERVER_URL;\n  }\n  return useBatch ? AMPLITUDE_BATCH_SERVER_URL : AMPLITUDE_SERVER_URL;\n};\n\nexport const createServerConfig = (\n  serverUrl = '',\n  serverZone: ServerZoneType = getDefaultConfig().serverZone,\n  useBatch: boolean = getDefaultConfig().useBatch,\n) => {\n  if (serverUrl) {\n    return { serverUrl, serverZone: undefined };\n  }\n  const _serverZone = ['US', 'EU'].includes(serverZone) ? serverZone : getDefaultConfig().serverZone;\n  return {\n    serverZone: _serverZone,\n    serverUrl: getServerUrl(_serverZone, useBatch),\n  };\n};\n\nexport class RequestMetadata implements IRequestMetadata {\n  sdk: {\n    metrics: {\n      histogram: HistogramOptions;\n    };\n  };\n\n  constructor() {\n    this.sdk = {\n      metrics: {\n        histogram: {},\n      },\n    };\n  }\n\n  recordHistogram<T extends HistogramKey>(key: T, value: HistogramOptions[T]) {\n    this.sdk.metrics.histogram[key] = value;\n  }\n}\n\nclass HistogramOptions implements IHistogramOptions {\n  remote_config_fetch_time_IDB?: number;\n  remote_config_fetch_time_API_success?: number;\n  remote_config_fetch_time_API_fail?: number;\n}\n", "/**\n * Checks if an HTTP status code indicates success (2xx range)\n * @param code - The HTTP status code to check\n * @returns true if the status code is in the 2xx range, false otherwise\n */\nexport function isSuccessStatusCode(code: number): boolean {\n  return code >= 200 && code < 300;\n}\n", "/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { AmplitudeCore } from '../core-client';\nimport { LogConfig, DebugContext } from '../logger';\nimport { LogLevel } from '../types/loglevel';\n\nexport const getStacktrace = (ignoreDepth = 0): string[] => {\n  const trace = new Error().stack || '';\n  return trace\n    .split('\\n')\n    .slice(2 + ignoreDepth)\n    .map((text) => text.trim());\n};\n\n// This hook makes sure we always get the latest logger and logLevel.\nexport const getClientLogConfig = (client: AmplitudeCore) => (): LogConfig => {\n  const { loggerProvider: logger, logLevel } = { ...client.config };\n  return {\n    logger,\n    logLevel,\n  };\n};\n\n// This is a convenient function to get the attribute from object with string path, similar to lodash '#get'.\nexport const getValueByStringPath = (obj: any, path: string): any => {\n  path = path.replace(/\\[(\\w+)\\]/g, '.$1'); // convert indexes to properties\n  path = path.replace(/^\\./, ''); // strip a leading dot\n  for (const attr of path.split('.')) {\n    if (attr in obj) {\n      obj = obj[attr];\n    } else {\n      return;\n    }\n  }\n  return obj;\n};\n\nexport const getClientStates = (client: AmplitudeCore, paths: Array<string>) => (): { [key: string]: any } => {\n  const res: { [key: string]: any } = {};\n  for (const path of paths) {\n    res[path] = getValueByStringPath(client, path);\n  }\n  return res;\n};\n\nexport const debugWrapper =\n  <T extends Array<any>, R>(\n    fn: (...args: T) => R,\n    fnName: string,\n    getLogConfig: () => LogConfig,\n    getStates?: () => { [key: string]: any },\n    fnContext: any = null,\n  ) =>\n  (...args: T): R => {\n    const { logger, logLevel } = getLogConfig();\n    // return early if possible to reduce overhead\n    if ((logLevel && logLevel < LogLevel.Debug) || !logLevel || !logger) {\n      return fn.apply(fnContext, args);\n    }\n    const debugContext: DebugContext = {\n      type: 'invoke public method',\n      name: fnName,\n      args,\n      stacktrace: getStacktrace(1),\n      time: {\n        start: new Date().toISOString(),\n      },\n      states: {},\n    };\n    if (getStates && debugContext.states) {\n      debugContext.states.before = getStates();\n    }\n    const result = fn.apply(fnContext, args);\n    if (result && (result as any).promise) {\n      // if result is a promise, add the callback\n      (result as any).promise.then(() => {\n        if (getStates && debugContext.states) {\n          debugContext.states.after = getStates();\n        }\n        if (debugContext.time) {\n          debugContext.time.end = new Date().toISOString();\n        }\n        logger.debug(JSON.stringify(debugContext, null, 2));\n      });\n    } else {\n      if (getStates && debugContext.states) {\n        debugContext.states.after = getStates();\n      }\n      if (debugContext.time) {\n        debugContext.time.end = new Date().toISOString();\n      }\n      logger.debug(JSON.stringify(debugContext, null, 2));\n    }\n    return result;\n  };\n", "import { DestinationPlugin } from '../types/plugin';\nimport { Event } from '../types/event/event';\nimport { Result } from '../types/result';\nimport { Status } from '../types/status';\nimport {\n  Response,\n  InvalidResponse,\n  PayloadTooLargeResponse,\n  RateLimitResponse,\n  SuccessResponse,\n} from '../types/response';\nimport {\n  INVALID_API_KEY,\n  MAX_RETRIES_EXCEEDED_MESSAGE,\n  MISSING_API_KEY_MESSAGE,\n  SUCCESS_MESSAGE,\n  UNEXPECTED_ERROR_MESSAGE,\n} from '../types/messages';\nimport { STORAGE_PREFIX } from '../types/constants';\nimport { chunk } from '../utils/chunk';\nimport { buildResult } from '../utils/result-builder';\nimport { createServerConfig, RequestMetadata } from '../config';\nimport { UUID } from '../utils/uuid';\nimport { IConfig } from '../types/config/core-config';\nimport { EventCallback } from '../types/event-callback';\nimport { IDiagnosticsClient } from '../diagnostics/diagnostics-client';\nimport { isSuccessStatusCode } from '../utils/status-code';\nimport { getStacktrace } from '../utils/debug';\n\nexport interface Context {\n  event: Event;\n  attempts: number;\n  callback: EventCallback;\n  timeout: number;\n}\n\nfunction getErrorMessage(error: unknown) {\n  if (error instanceof Error) return error.message;\n  return String(error);\n}\n\nexport function getResponseBodyString(res: Response) {\n  let responseBodyString = '';\n  try {\n    if ('body' in res) {\n      responseBodyString = JSON.stringify(res.body, null, 2);\n    }\n  } catch {\n    // to avoid crash, but don't care about the error, add comment to avoid empty block lint error\n  }\n  return responseBodyString;\n}\n\nexport class Destination implements DestinationPlugin {\n  name = 'amplitude';\n  type = 'destination' as const;\n\n  retryTimeout = 1000;\n  throttleTimeout = 30000;\n  storageKey = '';\n  // this.config is defined in setup() which will always be called first\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  config: IConfig;\n  // Indicator of whether events that are scheduled (but not flushed yet).\n  // When flush:\n  //   1. assign `scheduleId` to `flushId`\n  //   2. set `scheduleId` to null\n  scheduleId: ReturnType<typeof setTimeout> | null = null;\n  // Timeout in milliseconds of current schedule\n  scheduledTimeout = 0;\n  // Indicator of whether current flush resolves.\n  // When flush resolves, set `flushId` to null\n  flushId: ReturnType<typeof setTimeout> | null = null;\n  queue: Context[] = [];\n  diagnosticsClient: IDiagnosticsClient | undefined;\n\n  constructor(context?: { diagnosticsClient: IDiagnosticsClient }) {\n    this.diagnosticsClient = context?.diagnosticsClient;\n  }\n\n  async setup(config: IConfig): Promise<undefined> {\n    this.config = config;\n\n    this.storageKey = `${STORAGE_PREFIX}_${this.config.apiKey.substring(0, 10)}`;\n    const unsent = await this.config.storageProvider?.get(this.storageKey);\n    if (unsent && unsent.length > 0) {\n      void Promise.all(unsent.map((event: Event) => this.execute(event))).catch();\n    }\n\n    return Promise.resolve(undefined);\n  }\n\n  execute(event: Event): Promise<Result> {\n    // Assign insert_id for dropping invalid event later\n    if (!event.insert_id) {\n      event.insert_id = UUID();\n    }\n\n    return new Promise((resolve) => {\n      const context = {\n        event,\n        attempts: 0,\n        callback: (result: Result) => resolve(result),\n        timeout: 0,\n      };\n      this.queue.push(context);\n      this.schedule(this.config.flushIntervalMillis);\n      this.saveEvents();\n    });\n  }\n\n  removeEventsExceedFlushMaxRetries(list: Context[]) {\n    return list.filter((context) => {\n      context.attempts += 1;\n      if (context.attempts < this.config.flushMaxRetries) {\n        return true;\n      }\n      void this.fulfillRequest([context], 500, MAX_RETRIES_EXCEEDED_MESSAGE);\n      return false;\n    });\n  }\n\n  scheduleEvents(list: Context[]) {\n    list.forEach((context) => {\n      this.schedule(context.timeout === 0 ? this.config.flushIntervalMillis : context.timeout);\n    });\n  }\n\n  // Schedule a flush in timeout when\n  // 1. No schedule\n  // 2. Timeout greater than existing timeout.\n  // This makes sure that when throttled, no flush when throttle timeout expires.\n  schedule(timeout: number) {\n    if (this.config.offline) {\n      return;\n    }\n\n    if (this.scheduleId === null || (this.scheduleId && timeout > this.scheduledTimeout)) {\n      if (this.scheduleId) {\n        clearTimeout(this.scheduleId);\n      }\n      this.scheduledTimeout = timeout;\n      this.scheduleId = setTimeout(() => {\n        this.queue = this.queue.map((context) => {\n          context.timeout = 0;\n          return context;\n        });\n        void this.flush(true);\n      }, timeout);\n      return;\n    }\n  }\n\n  // Mark current schedule is flushed.\n  resetSchedule() {\n    this.scheduleId = null;\n    this.scheduledTimeout = 0;\n  }\n\n  // Flush all events regardless of their timeout\n  async flush(useRetry = false) {\n    // Skip flush if offline\n    if (this.config.offline) {\n      this.resetSchedule();\n      this.config.loggerProvider.debug('Skipping flush while offline.');\n      return;\n    }\n\n    if (this.flushId) {\n      this.resetSchedule();\n      this.config.loggerProvider.debug('Skipping flush because previous flush has not resolved.');\n      return;\n    }\n\n    this.flushId = this.scheduleId;\n    this.resetSchedule();\n\n    const list: Context[] = [];\n    const later: Context[] = [];\n    this.queue.forEach((context) => (context.timeout === 0 ? list.push(context) : later.push(context)));\n\n    const batches = chunk(list, this.config.flushQueueSize);\n\n    // Promise.all() doesn't guarantee resolve order.\n    // Sequentially resolve to make sure backend receives events in order\n    await batches.reduce(async (promise, batch) => {\n      await promise;\n      return await this.send(batch, useRetry);\n    }, Promise.resolve());\n\n    // Mark current flush is done\n    this.flushId = null;\n\n    this.scheduleEvents(this.queue);\n  }\n\n  async send(list: Context[], useRetry = true) {\n    if (!this.config.apiKey) {\n      return this.fulfillRequest(list, 400, MISSING_API_KEY_MESSAGE);\n    }\n\n    const payload = {\n      api_key: this.config.apiKey,\n      events: list.map((context) => {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { extra, ...eventWithoutExtra } = context.event;\n        return eventWithoutExtra;\n      }),\n      options: {\n        min_id_length: this.config.minIdLength,\n      },\n      client_upload_time: new Date().toISOString(),\n      request_metadata: this.config.requestMetadata,\n    };\n    this.config.requestMetadata = new RequestMetadata();\n\n    try {\n      const { serverUrl } = createServerConfig(this.config.serverUrl, this.config.serverZone, this.config.useBatch);\n      const res = await this.config.transportProvider.send(serverUrl, payload);\n      if (res === null) {\n        this.fulfillRequest(list, 0, UNEXPECTED_ERROR_MESSAGE);\n        return;\n      }\n      if (!useRetry) {\n        if ('body' in res) {\n          this.fulfillRequest(list, res.statusCode, `${res.status}: ${getResponseBodyString(res)}`);\n        } else {\n          this.fulfillRequest(list, res.statusCode, res.status);\n        }\n        return;\n      }\n      this.handleResponse(res, list);\n    } catch (e) {\n      const errorMessage = getErrorMessage(e);\n      this.config.loggerProvider.error(errorMessage);\n\n      this.diagnosticsClient?.recordEvent('analytics.events.unsuccessful.from.catch.error', {\n        events: list.map((context) => context.event.event_type),\n        message: errorMessage,\n        stack_trace: getStacktrace(),\n      });\n\n      this.handleResponse({ status: Status.Failed, statusCode: 0 }, list);\n    }\n  }\n\n  handleResponse(res: Response, list: Context[]) {\n    if (!isSuccessStatusCode(res.statusCode)) {\n      this.diagnosticsClient?.recordEvent('analytics.events.unsuccessful', {\n        events: list.map((context) => context.event.event_type),\n        code: res.statusCode,\n        status: res.status,\n        body: getResponseBodyString(res),\n        stack_trace: getStacktrace(),\n      });\n    }\n\n    const { status } = res;\n\n    switch (status) {\n      case Status.Success: {\n        this.handleSuccessResponse(res, list);\n        break;\n      }\n      case Status.Invalid: {\n        this.handleInvalidResponse(res, list);\n        break;\n      }\n      case Status.PayloadTooLarge: {\n        this.handlePayloadTooLargeResponse(res, list);\n        break;\n      }\n      case Status.RateLimit: {\n        this.handleRateLimitResponse(res, list);\n        break;\n      }\n      default: {\n        // log intermediate event status before retry\n        this.config.loggerProvider.warn(`{code: 0, error: \"Status '${status}' provided for ${list.length} events\"}`);\n        this.handleOtherResponse(list);\n        break;\n      }\n    }\n  }\n\n  handleSuccessResponse(res: SuccessResponse, list: Context[]) {\n    this.fulfillRequest(list, res.statusCode, SUCCESS_MESSAGE);\n  }\n\n  handleInvalidResponse(res: InvalidResponse, list: Context[]) {\n    if (res.body.missingField || res.body.error.startsWith(INVALID_API_KEY)) {\n      this.fulfillRequest(list, res.statusCode, res.body.error);\n      return;\n    }\n\n    const dropIndex = [\n      ...Object.values(res.body.eventsWithInvalidFields),\n      ...Object.values(res.body.eventsWithMissingFields),\n      ...Object.values(res.body.eventsWithInvalidIdLengths),\n      ...res.body.silencedEvents,\n    ].flat();\n    const dropIndexSet = new Set(dropIndex);\n\n    const retry = list.filter((context, index) => {\n      if (dropIndexSet.has(index)) {\n        this.fulfillRequest([context], res.statusCode, res.body.error);\n        return;\n      }\n      return true;\n    });\n\n    if (retry.length > 0) {\n      // log intermediate event status before retry\n      this.config.loggerProvider.warn(getResponseBodyString(res));\n    }\n\n    const tryable = this.removeEventsExceedFlushMaxRetries(retry);\n    this.scheduleEvents(tryable);\n  }\n\n  handlePayloadTooLargeResponse(res: PayloadTooLargeResponse, list: Context[]) {\n    if (list.length === 1) {\n      this.fulfillRequest(list, res.statusCode, res.body.error);\n      return;\n    }\n\n    // log intermediate event status before retry\n    this.config.loggerProvider.warn(getResponseBodyString(res));\n\n    this.config.flushQueueSize /= 2;\n\n    const tryable = this.removeEventsExceedFlushMaxRetries(list);\n    this.scheduleEvents(tryable);\n  }\n\n  handleRateLimitResponse(res: RateLimitResponse, list: Context[]) {\n    const dropUserIds = Object.keys(res.body.exceededDailyQuotaUsers);\n    const dropDeviceIds = Object.keys(res.body.exceededDailyQuotaDevices);\n    const throttledIndex = res.body.throttledEvents;\n    const dropUserIdsSet = new Set(dropUserIds);\n    const dropDeviceIdsSet = new Set(dropDeviceIds);\n    const throttledIndexSet = new Set(throttledIndex);\n\n    const retry = list.filter((context, index) => {\n      if (\n        (context.event.user_id && dropUserIdsSet.has(context.event.user_id)) ||\n        (context.event.device_id && dropDeviceIdsSet.has(context.event.device_id))\n      ) {\n        this.fulfillRequest([context], res.statusCode, res.body.error);\n        return;\n      }\n      if (throttledIndexSet.has(index)) {\n        context.timeout = this.throttleTimeout;\n      }\n      return true;\n    });\n\n    if (retry.length > 0) {\n      // log intermediate event status before retry\n      this.config.loggerProvider.warn(getResponseBodyString(res));\n    }\n\n    const tryable = this.removeEventsExceedFlushMaxRetries(retry);\n    this.scheduleEvents(tryable);\n  }\n\n  handleOtherResponse(list: Context[]) {\n    const later = list.map((context) => {\n      context.timeout = context.attempts * this.retryTimeout;\n      return context;\n    });\n\n    const tryable = this.removeEventsExceedFlushMaxRetries(later);\n    this.scheduleEvents(tryable);\n  }\n\n  fulfillRequest(list: Context[], code: number, message: string) {\n    // Record diagnostics for dropped events (non-success status codes)\n    if (!isSuccessStatusCode(code)) {\n      this.diagnosticsClient?.increment('analytics.events.dropped', list.length);\n      this.diagnosticsClient?.recordEvent('analytics.events.dropped', {\n        events: list.map((context) => context.event.event_type),\n        code: code,\n        message: message,\n        stack_trace: getStacktrace(),\n      });\n    } else {\n      this.diagnosticsClient?.increment('analytics.events.sent', list.length);\n    }\n    this.removeEvents(list);\n    list.forEach((context) => context.callback(buildResult(context.event, code, message)));\n  }\n\n  /**\n   * This is called on\n   * 1) new events are added to queue; or\n   * 2) response comes back for a request\n   *\n   * Update the event storage based on the queue\n   */\n  saveEvents() {\n    if (!this.config.storageProvider) {\n      return;\n    }\n\n    const updatedEvents = this.queue.map((context) => context.event);\n    void this.config.storageProvider.set(this.storageKey, updatedEvents);\n  }\n\n  /**\n   * This is called on response comes back for a request\n   */\n  removeEvents(eventsToRemove: Context[]) {\n    this.queue = this.queue.filter(\n      (queuedContext) => !eventsToRemove.some((context) => context.event.insert_id === queuedContext.event.insert_id),\n    );\n\n    this.saveEvents();\n  }\n}\n", "var ApplicationContextProviderImpl = /** @class */ (function () {\n    function ApplicationContextProviderImpl() {\n    }\n    ApplicationContextProviderImpl.prototype.getApplicationContext = function () {\n        return {\n            versionName: this.versionName,\n            language: getLanguage(),\n            platform: 'Web',\n            os: undefined,\n            deviceModel: undefined,\n        };\n    };\n    return ApplicationContextProviderImpl;\n}());\nvar getLanguage = function () {\n    return ((typeof navigator !== 'undefined' &&\n        ((navigator.languages && navigator.languages[0]) ||\n            navigator.language)) ||\n        '');\n};\n\nvar EventBridgeImpl = /** @class */ (function () {\n    function EventBridgeImpl() {\n        this.queue = [];\n    }\n    EventBridgeImpl.prototype.logEvent = function (event) {\n        if (!this.receiver) {\n            if (this.queue.length < 512) {\n                this.queue.push(event);\n            }\n        }\n        else {\n            this.receiver(event);\n        }\n    };\n    EventBridgeImpl.prototype.setEventReceiver = function (receiver) {\n        this.receiver = receiver;\n        if (this.queue.length > 0) {\n            this.queue.forEach(function (event) {\n                receiver(event);\n            });\n            this.queue = [];\n        }\n    };\n    return EventBridgeImpl;\n}());\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nfunction __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n}\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar isEqual = function (obj1, obj2) {\n    var e_1, _a;\n    var primitive = ['string', 'number', 'boolean', 'undefined'];\n    var typeA = typeof obj1;\n    var typeB = typeof obj2;\n    if (typeA !== typeB) {\n        return false;\n    }\n    try {\n        for (var primitive_1 = __values(primitive), primitive_1_1 = primitive_1.next(); !primitive_1_1.done; primitive_1_1 = primitive_1.next()) {\n            var p = primitive_1_1.value;\n            if (p === typeA) {\n                return obj1 === obj2;\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (primitive_1_1 && !primitive_1_1.done && (_a = primitive_1.return)) _a.call(primitive_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    // check null\n    if (obj1 == null && obj2 == null) {\n        return true;\n    }\n    else if (obj1 == null || obj2 == null) {\n        return false;\n    }\n    // if got here - objects\n    if (obj1.length !== obj2.length) {\n        return false;\n    }\n    //check if arrays\n    var isArrayA = Array.isArray(obj1);\n    var isArrayB = Array.isArray(obj2);\n    if (isArrayA !== isArrayB) {\n        return false;\n    }\n    if (isArrayA && isArrayB) {\n        //arrays\n        for (var i = 0; i < obj1.length; i++) {\n            if (!isEqual(obj1[i], obj2[i])) {\n                return false;\n            }\n        }\n    }\n    else {\n        //objects\n        var sorted1 = Object.keys(obj1).sort();\n        var sorted2 = Object.keys(obj2).sort();\n        if (!isEqual(sorted1, sorted2)) {\n            return false;\n        }\n        //compare object values\n        var result_1 = true;\n        Object.keys(obj1).forEach(function (key) {\n            if (!isEqual(obj1[key], obj2[key])) {\n                result_1 = false;\n            }\n        });\n        return result_1;\n    }\n    return true;\n};\n\nvar ID_OP_SET = '$set';\nvar ID_OP_UNSET = '$unset';\nvar ID_OP_CLEAR_ALL = '$clearAll';\n// Polyfill for Object.entries\nif (!Object.entries) {\n    Object.entries = function (obj) {\n        var ownProps = Object.keys(obj);\n        var i = ownProps.length;\n        var resArray = new Array(i);\n        while (i--) {\n            resArray[i] = [ownProps[i], obj[ownProps[i]]];\n        }\n        return resArray;\n    };\n}\nvar IdentityStoreImpl = /** @class */ (function () {\n    function IdentityStoreImpl() {\n        this.identity = { userProperties: {} };\n        this.listeners = new Set();\n    }\n    IdentityStoreImpl.prototype.editIdentity = function () {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var self = this;\n        var actingUserProperties = __assign({}, this.identity.userProperties);\n        var actingIdentity = __assign(__assign({}, this.identity), { userProperties: actingUserProperties });\n        return {\n            setUserId: function (userId) {\n                actingIdentity.userId = userId;\n                return this;\n            },\n            setDeviceId: function (deviceId) {\n                actingIdentity.deviceId = deviceId;\n                return this;\n            },\n            setUserProperties: function (userProperties) {\n                actingIdentity.userProperties = userProperties;\n                return this;\n            },\n            setOptOut: function (optOut) {\n                actingIdentity.optOut = optOut;\n                return this;\n            },\n            updateUserProperties: function (actions) {\n                var e_1, _a, e_2, _b, e_3, _c;\n                var actingProperties = actingIdentity.userProperties || {};\n                try {\n                    for (var _d = __values(Object.entries(actions)), _e = _d.next(); !_e.done; _e = _d.next()) {\n                        var _f = __read(_e.value, 2), action = _f[0], properties = _f[1];\n                        switch (action) {\n                            case ID_OP_SET:\n                                try {\n                                    for (var _g = (e_2 = void 0, __values(Object.entries(properties))), _h = _g.next(); !_h.done; _h = _g.next()) {\n                                        var _j = __read(_h.value, 2), key = _j[0], value = _j[1];\n                                        actingProperties[key] = value;\n                                    }\n                                }\n                                catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                                finally {\n                                    try {\n                                        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n                                    }\n                                    finally { if (e_2) throw e_2.error; }\n                                }\n                                break;\n                            case ID_OP_UNSET:\n                                try {\n                                    for (var _k = (e_3 = void 0, __values(Object.keys(properties))), _l = _k.next(); !_l.done; _l = _k.next()) {\n                                        var key = _l.value;\n                                        delete actingProperties[key];\n                                    }\n                                }\n                                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                                finally {\n                                    try {\n                                        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n                                    }\n                                    finally { if (e_3) throw e_3.error; }\n                                }\n                                break;\n                            case ID_OP_CLEAR_ALL:\n                                actingProperties = {};\n                                break;\n                        }\n                    }\n                }\n                catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                finally {\n                    try {\n                        if (_e && !_e.done && (_a = _d.return)) _a.call(_d);\n                    }\n                    finally { if (e_1) throw e_1.error; }\n                }\n                actingIdentity.userProperties = actingProperties;\n                return this;\n            },\n            commit: function () {\n                self.setIdentity(actingIdentity);\n                return this;\n            },\n        };\n    };\n    IdentityStoreImpl.prototype.getIdentity = function () {\n        return __assign({}, this.identity);\n    };\n    IdentityStoreImpl.prototype.setIdentity = function (identity) {\n        var originalIdentity = __assign({}, this.identity);\n        this.identity = __assign({}, identity);\n        if (!isEqual(originalIdentity, this.identity)) {\n            this.listeners.forEach(function (listener) {\n                listener(identity);\n            });\n        }\n    };\n    IdentityStoreImpl.prototype.addIdentityListener = function (listener) {\n        this.listeners.add(listener);\n    };\n    IdentityStoreImpl.prototype.removeIdentityListener = function (listener) {\n        this.listeners.delete(listener);\n    };\n    return IdentityStoreImpl;\n}());\n\nvar safeGlobal = typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof global !== 'undefined'\n        ? global\n        : self;\n\nvar AnalyticsConnector = /** @class */ (function () {\n    function AnalyticsConnector() {\n        this.identityStore = new IdentityStoreImpl();\n        this.eventBridge = new EventBridgeImpl();\n        this.applicationContextProvider = new ApplicationContextProviderImpl();\n    }\n    AnalyticsConnector.getInstance = function (instanceName) {\n        if (!safeGlobal['analyticsConnectorInstances']) {\n            safeGlobal['analyticsConnectorInstances'] = {};\n        }\n        if (!safeGlobal['analyticsConnectorInstances'][instanceName]) {\n            safeGlobal['analyticsConnectorInstances'][instanceName] =\n                new AnalyticsConnector();\n        }\n        return safeGlobal['analyticsConnectorInstances'][instanceName];\n    };\n    return AnalyticsConnector;\n}());\n\nexport { AnalyticsConnector };\n", "import { AnalyticsConnector } from '@amplitude/analytics-connector';\nimport { DEFAULT_INSTANCE_NAME } from './types/constants';\n\nexport const getAnalyticsConnector = (instanceName = DEFAULT_INSTANCE_NAME): AnalyticsConnector => {\n  return AnalyticsConnector.getInstance(instanceName);\n};\n\nexport const setConnectorUserId = (userId: string | undefined, instanceName?: string): void => {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  getAnalyticsConnector(instanceName).identityStore.editIdentity().setUserId(userId).commit();\n};\n\nexport const setConnectorDeviceId = (deviceId: string, instanceName?: string): void => {\n  getAnalyticsConnector(instanceName).identityStore.editIdentity().setDeviceId(deviceId).commit();\n};\n", "import { BeforePlugin } from '../types/plugin';\nimport { IConfig } from '../types/config/core-config';\nimport { Event } from '../types/event/event';\nimport { getAnalyticsConnector } from '../analytics-connector';\n\nexport class IdentityEventSender implements BeforePlugin {\n  name = 'identity';\n  type = 'before' as const;\n\n  identityStore = getAnalyticsConnector().identityStore;\n\n  async execute(context: Event): Promise<Event> {\n    const userProperties = context.user_properties as Record<string, any>;\n    if (userProperties) {\n      this.identityStore.editIdentity().updateUserProperties(userProperties).commit();\n    }\n    return context;\n  }\n\n  async setup(config: IConfig) {\n    if (config.instanceName) {\n      this.identityStore = getAnalyticsConnector(config.instanceName).identityStore;\n    }\n  }\n}\n", "export const isNewSession = (sessionTimeout: number, lastEventTime: number = Date.now()): boolean => {\n  const currentTime = Date.now();\n  const timeSinceLastEvent = currentTime - lastEventTime;\n\n  return timeSinceLastEvent > sessionTimeout;\n};\n", "import { AMPLITUDE_PREFIX } from './types/constants';\n\nexport const getCookieName = (apiKey: string, postKey = '', limit = 10) => {\n  return [AMPLITUDE_PREFIX, postKey, apiKey.substring(0, limit)].filter(Boolean).join('_');\n};\n\nexport const getOldCookieName = (apiKey: string) => {\n  return `${AMPLITUDE_PREFIX.toLowerCase()}_${apiKey.substring(0, 6)}`;\n};\n", "export const getLanguage = (): string => {\n  if (typeof navigator === 'undefined') return '';\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  const userLanguage = (navigator as any).userLanguage as string | undefined;\n\n  return navigator.languages?.[0] ?? navigator.language ?? userLanguage ?? '';\n};\n", "import { getGlobalScope } from './global-scope';\n\nexport const getQueryParams = (): Record<string, string | undefined> => {\n  const globalScope = getGlobalScope();\n  /* istanbul ignore if */\n  if (!globalScope?.location?.search) {\n    return {};\n  }\n  const pairs = globalScope.location.search.substring(1).split('&').filter(Boolean);\n  const params = pairs.reduce<Record<string, string | undefined>>((acc, curr) => {\n    const query = curr.split('=', 2);\n    const key = tryDecodeURIComponent(query[0]);\n    const value = tryDecodeURIComponent(query[1]);\n    if (!value) {\n      return acc;\n    }\n    acc[key] = value;\n    return acc;\n  }, {});\n  return params;\n};\n\nexport const tryDecodeURIComponent = (value = '') => {\n  try {\n    return decodeURIComponent(value);\n  } catch {\n    return '';\n  }\n};\n", "import { ILogger } from '../logger';\n\n/**\n * Checks if a given URL matches any pattern in an allowlist of URLs or regex patterns.\n * @param url - The URL to check\n * @param allowlist - Array of allowed URLs (strings) or regex patterns\n * @returns true if the URL matches any pattern in the allowlist, false otherwise\n */\nexport const isUrlMatchAllowlist = (url: string, allowlist: (string | RegExp)[] | undefined): boolean => {\n  if (!allowlist || !allowlist.length) {\n    return true;\n  }\n  return allowlist.some((allowedUrl) => {\n    if (typeof allowedUrl === 'string') {\n      return url === allowedUrl;\n    }\n    return url.match(allowedUrl);\n  });\n};\n\nexport const getDecodeURI = (locationStr: string, loggerProvider?: ILogger): string => {\n  let decodedLocationStr = locationStr;\n  try {\n    decodedLocationStr = decodeURI(locationStr);\n  } catch (e) {\n    /* istanbul ignore next */\n    loggerProvider?.error('Malformed URI sequence: ', e);\n  }\n\n  return decodedLocationStr;\n};\n", "export const generateHashCode = function (str: string) {\n  let hash = 0;\n  if (str.length === 0) return hash;\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i);\n    hash = (hash << 5) - hash + chr;\n    hash |= 0;\n  }\n  return hash;\n};\n\nexport const isTimestampInSample = function (timestamp: string | number, sampleRate: number) {\n  const hashNumber = generateHashCode(timestamp.toString());\n  const absHash = Math.abs(hashNumber);\n  const absHashMultiply = absHash * 31;\n  const mod = absHashMultiply % 1000000;\n  return mod / 1000000 < sampleRate;\n};\n\n// TODO(xinyi): replace the temp one in diagnostics client after the fix\n// istanbul ignore next\nexport const isTimestampInSampleTemp = function (timestamp: string | number, sampleRate: number) {\n  const hashNumber = generateHashCode(timestamp.toString());\n  const absHash = Math.abs(hashNumber);\n  const absHashMultiply = absHash * 31;\n  const mod = absHashMultiply % 100000;\n  return mod / 100000 < sampleRate;\n};\n", "import { Storage } from '../types/storage';\n\nexport class MemoryStorage<T> implements Storage<T> {\n  memoryStorage: Map<string, T> = new Map();\n\n  async isEnabled(): Promise<boolean> {\n    return true;\n  }\n\n  async get(key: string): Promise<T | undefined> {\n    return this.memoryStorage.get(key);\n  }\n\n  async getRaw(key: string): Promise<string | undefined> {\n    const value = await this.get(key);\n    return value ? JSON.stringify(value) : undefined;\n  }\n\n  async set(key: string, value: T): Promise<void> {\n    this.memoryStorage.set(key, value);\n  }\n\n  async remove(key: string): Promise<void> {\n    this.memoryStorage.delete(key);\n  }\n\n  async reset(): Promise<void> {\n    this.memoryStorage.clear();\n  }\n}\n", "import { Storage, CookieStorageOptions, CookieStorageConfig } from '../types/storage';\nimport { getGlobalScope } from '../global-scope';\nimport { UUID } from '../utils/uuid';\n\n// CookieStore is a Web API not included in standard TypeScript lib types\n// https://developer.mozilla.org/en-US/docs/Web/API/CookieStore\ninterface CookieStoreSetOptions {\n  name: string;\n  value: string;\n  expires?: number;\n  domain?: string;\n  sameSite?: 'strict' | 'lax' | 'none';\n}\n\ninterface CookieStore {\n  getAll(key: string): Promise<CookieStoreSetOptions[] | undefined>;\n}\n\ntype GlobalScopeWithCookieStore = {\n  cookieStore?: CookieStore;\n} & typeof global;\n\nexport class CookieStorage<T> implements Storage<T> {\n  options: CookieStorageOptions;\n  config: CookieStorageConfig;\n  private static testValue: undefined | string;\n\n  constructor(options?: CookieStorageOptions, config: CookieStorageConfig = {}) {\n    this.options = { ...options };\n    this.config = config;\n  }\n\n  async isEnabled(): Promise<boolean> {\n    /* istanbul ignore if */\n    if (!getGlobalScope()) {\n      return false;\n    }\n\n    CookieStorage.testValue = String(Date.now());\n    const testCookieOptions = {\n      ...this.options,\n      expirationDays: 0.003, // expire in ~5 minutes\n    };\n    const testStorage = new CookieStorage<string>(testCookieOptions);\n    const testKey = `AMP_TEST_${UUID().substring(0, 8)}`;\n    try {\n      await testStorage.set(testKey, CookieStorage.testValue);\n      const value = await testStorage.get(testKey);\n      return value === CookieStorage.testValue;\n    } catch {\n      /* istanbul ignore next */\n      return false;\n    } finally {\n      await testStorage.remove(testKey);\n    }\n  }\n\n  async get(key: string): Promise<T | undefined> {\n    const value = await this.getRaw(key);\n    if (!value) {\n      return undefined;\n    }\n    try {\n      const decodedValue = decodeCookieValue(value);\n      if (decodedValue === undefined) {\n        console.error(`Amplitude Logger [Error]: Failed to decode cookie value for key: ${key}, value: ${value}`);\n        return undefined;\n      }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return JSON.parse(decodedValue);\n    } catch {\n      console.error(`Amplitude Logger [Error]: Failed to parse cookie value for key: ${key}, value: ${value}`);\n      return undefined;\n    }\n  }\n\n  async getRaw(key: string): Promise<string | undefined> {\n    const globalScope = getGlobalScope();\n\n    // use CookieStore if available and enabled\n    const globalScopeWithCookiesStore = globalScope as GlobalScopeWithCookieStore;\n    try {\n      const cookieStore = globalScopeWithCookiesStore?.cookieStore;\n      if (cookieStore) {\n        const cookies = await cookieStore.getAll(key);\n        if (cookies) {\n          /* istanbul ignore if */\n          if (cookies.length > 1) {\n            this.config.diagnosticsClient?.recordEvent('cookies.duplicate', {\n              cookies: cookies.map((cookie) => cookie.domain),\n            });\n            this.config.diagnosticsClient?.increment('cookies.duplicate.occurrence.cookieStore');\n          }\n\n          for (const cookie of cookies) {\n            if (isDomainEqual(cookie.domain, this.options.domain)) {\n              return cookie.value;\n            }\n          }\n        }\n      }\n    } catch (ignoreError) {\n      /* istanbul ignore next */\n      // if cookieStore had a surprise failure, fallback to document.cookie\n    }\n\n    const cookies = (globalScope?.document?.cookie.split('; ') ?? []).filter((c) => c.indexOf(key + '=') === 0);\n    let match: string | undefined = undefined;\n\n    // if matcher function is provided, use it to de-duplicate when there's more than one cookie\n    /* istanbul ignore if */\n    const duplicateResolverFn = this.config.duplicateResolverFn;\n    if (typeof duplicateResolverFn === 'function' && cookies.length > 1) {\n      match = cookies.find((c) => {\n        try {\n          const res = duplicateResolverFn(c.substring(key.length + 1));\n          if (!res) {\n            this.config.diagnosticsClient?.increment('cookies.duplicate.occurrence.document.cookie');\n          }\n          return res;\n        } catch (ignoreError) {\n          /* istanbul ignore next */\n          return false;\n        }\n      });\n    }\n\n    // if match was not found, just get the first one that matches the key\n    if (!match) {\n      match = cookies[0];\n    }\n    if (!match) {\n      return undefined;\n    }\n    return match.substring(key.length + 1);\n  }\n\n  async set(key: string, value: T | null): Promise<void> {\n    try {\n      const expirationDays = this.options.expirationDays ?? 0;\n      const expires = value !== null ? expirationDays : -1;\n      let expireDate: Date | undefined = undefined;\n      if (expires) {\n        const date = new Date();\n        date.setTime(date.getTime() + expires * 24 * 60 * 60 * 1000);\n        expireDate = date;\n      }\n      let str = `${key}=${btoa(encodeURIComponent(JSON.stringify(value)))}`;\n      if (expireDate) {\n        str += `; expires=${expireDate.toUTCString()}`;\n      }\n      str += '; path=/';\n      if (this.options.domain) {\n        str += `; domain=${this.options.domain}`;\n      }\n      if (this.options.secure) {\n        str += '; Secure';\n      }\n      if (this.options.sameSite) {\n        str += `; SameSite=${this.options.sameSite}`;\n      }\n      const globalScope = getGlobalScope();\n      if (globalScope) {\n        globalScope.document.cookie = str;\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      console.error(`Amplitude Logger [Error]: Failed to set cookie for key: ${key}. Error: ${errorMessage}`);\n    }\n  }\n\n  async remove(key: string): Promise<void> {\n    await this.set(key, null);\n  }\n\n  async reset(): Promise<void> {\n    return;\n  }\n}\n\nconst decodeCookiesAsDefault = (value: string): string | undefined => {\n  try {\n    return decodeURIComponent(atob(value));\n  } catch {\n    return undefined;\n  }\n};\n\nconst decodeCookiesWithDoubleUrlEncoding = (value: string): string | undefined => {\n  // Modern Ruby (v7+) automatically encodes cookies with URL encoding by\n  // https://api.rubyonrails.org/classes/ActionDispatch/Cookies.html\n  try {\n    return decodeURIComponent(atob(decodeURIComponent(value)));\n  } catch {\n    return undefined;\n  }\n};\n\n/**\n * Decodes a cookie value that was encoded with btoa(encodeURIComponent(...)).\n * Handles both standard encoding and double URL encoding (used by Ruby Rails v7+).\n */\nexport const decodeCookieValue = (value: string): string | undefined => {\n  return decodeCookiesAsDefault(value) ?? decodeCookiesWithDoubleUrlEncoding(value);\n};\n\n/**\n * Compares two domain strings for equality, ignoring leading dots.\n * This is useful for comparing cookie domains since \".example.com\" and \"example.com\"\n * are effectively equivalent for cookie scoping.\n */\nexport const isDomainEqual = (domain1: string | undefined, domain2: string | undefined): boolean => {\n  if (!domain1 || !domain2) {\n    return false;\n  }\n  const normalized1 = domain1.startsWith('.') ? domain1.substring(1) : domain1;\n  const normalized2 = domain2.startsWith('.') ? domain2.substring(1) : domain2;\n  return normalized1.toLowerCase() === normalized2.toLowerCase();\n};\n", "import { AMPLITUDE_PREFIX } from '../types/constants';\n\nexport const getStorageKey = (apiKey: string, postKey = '', limit = 10) => {\n  return [AMPLITUDE_PREFIX, postKey, apiKey.substring(0, limit)].filter(Boolean).join('_');\n};\n", "import { Storage as AmplitudeStorage } from '../types/storage';\n\nexport class BrowserStorage<T> implements AmplitudeStorage<T> {\n  constructor(private storage?: Storage) {}\n\n  async isEnabled(): Promise<boolean> {\n    /* istanbul ignore if */\n    if (!this.storage) {\n      return false;\n    }\n\n    const random = String(Date.now());\n    const testStorage = new BrowserStorage<string>(this.storage);\n    const testKey = 'AMP_TEST';\n    try {\n      await testStorage.set(testKey, random);\n      const value = await testStorage.get(testKey);\n      return value === random;\n    } catch {\n      /* istanbul ignore next */\n      return false;\n    } finally {\n      await testStorage.remove(testKey);\n    }\n  }\n\n  async get(key: string): Promise<T | undefined> {\n    try {\n      const value = await this.getRaw(key);\n      if (!value) {\n        return undefined;\n      }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return JSON.parse(value);\n    } catch {\n      console.error(`[Amplitude] Error: Could not get value from storage`);\n      return undefined;\n    }\n  }\n\n  async getRaw(key: string): Promise<string | undefined> {\n    return this.storage?.getItem(key) || undefined;\n  }\n\n  async set(key: string, value: T): Promise<void> {\n    try {\n      this.storage?.setItem(key, JSON.stringify(value));\n    } catch {\n      //\n    }\n  }\n\n  async remove(key: string): Promise<void> {\n    try {\n      this.storage?.removeItem(key);\n    } catch {\n      //\n    }\n  }\n\n  async reset(): Promise<void> {\n    try {\n      this.storage?.clear();\n    } catch {\n      //\n    }\n  }\n}\n", "import { getGlobalScope } from '../global-scope';\nimport { ILogger } from '../logger';\nimport { HistogramStats } from './diagnostics-client';\n\nconst MAX_PERSISTENT_STORAGE_EVENTS_COUNT = 10;\n\n// Database configuration\nconst DB_VERSION = 1;\n\n// Table names for different diagnostics types\nexport const TABLE_NAMES = {\n  TAGS: 'tags',\n  COUNTERS: 'counters',\n  HISTOGRAMS: 'histograms',\n  EVENTS: 'events',\n  INTERNAL: 'internal', // New table for internal storage like flush timestamps\n} as const;\n\n// Keys for internal storage table\nexport const INTERNAL_KEYS = {\n  LAST_FLUSH_TIMESTAMP: 'last_flush_timestamp',\n} as const;\n\n// Record interfaces for each table\nexport interface TagRecord {\n  key: string;\n  value: string;\n}\n\nexport interface CounterRecord {\n  key: string;\n  value: number;\n}\n\nexport interface HistogramRecord {\n  key: string;\n  count: number;\n  min: number;\n  max: number;\n  sum: number;\n}\n\nexport interface EventRecord {\n  id?: number; // Auto-increment primary key\n  event_name: string;\n  time: number;\n  event_properties: Record<string, any>;\n}\n\nexport interface InternalRecord {\n  key: string;\n  value: string;\n}\n\nexport interface IDiagnosticsStorage {\n  /**\n   * Set multiple tags in a single transaction (batch operation)\n   * Promise never rejects - errors are logged and operation continues gracefully\n   */\n  setTags(tags: Record<string, string>): Promise<void>;\n  /**\n   * Increment multiple counters in a single transaction (batch operation)\n   * Uses read-modify-write pattern to accumulate with existing values\n   * Promise never rejects - errors are logged and operation continues gracefully\n   */\n  incrementCounters(counters: Record<string, number>): Promise<void>;\n  /**\n   * Set multiple histogram stats in a single transaction (batch operation)\n   * Uses read-modify-write pattern to accumulate count/sum and update min/max with existing values\n   * Promise never rejects - errors are logged and operation continues gracefully\n   */\n  setHistogramStats(\n    histogramStats: Record<string, { count: number; min: number; max: number; sum: number }>,\n  ): Promise<void>;\n  /**\n   * Add multiple event records in a single transaction (batch operation)\n   * Promise never rejects - errors are logged and operation continues gracefully\n   */\n  addEventRecords(\n    events: Array<{ event_name: string; time: number; event_properties: Record<string, any> }>,\n  ): Promise<void>;\n\n  setLastFlushTimestamp(timestamp: number): Promise<void>;\n\n  getLastFlushTimestamp(): Promise<number | undefined>;\n\n  /**\n   * Get all data except internal data from storage and clear it\n   */\n  getAllAndClear(): Promise<{\n    tags: TagRecord[];\n    counters: CounterRecord[];\n    histogramStats: HistogramRecord[];\n    events: EventRecord[];\n  }>;\n}\n\n/**\n * Purpose-specific IndexedDB storage for diagnostics data\n * Provides optimized methods for each type of diagnostics data\n */\nexport class DiagnosticsStorage implements IDiagnosticsStorage {\n  dbPromise: Promise<IDBDatabase> | null = null;\n  dbName: string;\n  logger: ILogger;\n\n  constructor(apiKey: string, logger: ILogger) {\n    this.logger = logger;\n    this.dbName = `AMP_diagnostics_${apiKey.substring(0, 10)}`;\n  }\n\n  /**\n   * Check if IndexedDB is supported in the current environment\n   * @returns true if IndexedDB is available, false otherwise\n   */\n  static isSupported(): boolean {\n    return getGlobalScope()?.indexedDB !== undefined;\n  }\n\n  async getDB(): Promise<IDBDatabase> {\n    if (!this.dbPromise) {\n      this.dbPromise = this.openDB();\n    }\n    return this.dbPromise;\n  }\n\n  openDB(): Promise<IDBDatabase> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, DB_VERSION);\n\n      request.onerror = () => {\n        // Clear dbPromise when it rejects for the first time\n        this.dbPromise = null;\n        reject(new Error('Failed to open IndexedDB'));\n      };\n\n      request.onsuccess = () => {\n        const db = request.result;\n        // Clear dbPromise when connection was on but went off later\n        db.onclose = () => {\n          this.dbPromise = null;\n          this.logger.debug('DiagnosticsStorage: DB connection closed.');\n        };\n\n        db.onerror = (event) => {\n          this.logger.debug('DiagnosticsStorage: A global database error occurred.', event);\n          db.close();\n        };\n        resolve(db);\n      };\n\n      request.onupgradeneeded = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        this.createTables(db);\n      };\n    });\n  }\n\n  createTables(db: IDBDatabase): void {\n    // Create tags table\n    if (!db.objectStoreNames.contains(TABLE_NAMES.TAGS)) {\n      db.createObjectStore(TABLE_NAMES.TAGS, { keyPath: 'key' });\n    }\n\n    // Create counters table\n    if (!db.objectStoreNames.contains(TABLE_NAMES.COUNTERS)) {\n      db.createObjectStore(TABLE_NAMES.COUNTERS, { keyPath: 'key' });\n    }\n\n    // Create histograms table for storing histogram stats (count, min, max, sum)\n    if (!db.objectStoreNames.contains(TABLE_NAMES.HISTOGRAMS)) {\n      db.createObjectStore(TABLE_NAMES.HISTOGRAMS, {\n        keyPath: 'key',\n      });\n    }\n\n    // Create events table\n    if (!db.objectStoreNames.contains(TABLE_NAMES.EVENTS)) {\n      const eventsStore = db.createObjectStore(TABLE_NAMES.EVENTS, {\n        keyPath: 'id',\n        autoIncrement: true,\n      });\n\n      // Create index on time for chronological queries\n      eventsStore.createIndex('time_idx', 'time', { unique: false });\n    }\n\n    // Create internal table for storing internal data like flush timestamps\n    if (!db.objectStoreNames.contains(TABLE_NAMES.INTERNAL)) {\n      db.createObjectStore(TABLE_NAMES.INTERNAL, { keyPath: 'key' });\n    }\n  }\n\n  async setTags(tags: Record<string, string>): Promise<void> {\n    try {\n      if (Object.entries(tags).length === 0) {\n        return;\n      }\n\n      const db = await this.getDB();\n      const transaction = db.transaction([TABLE_NAMES.TAGS], 'readwrite');\n      const store = transaction.objectStore(TABLE_NAMES.TAGS);\n\n      return new Promise((resolve) => {\n        const entries = Object.entries(tags);\n\n        transaction.oncomplete = () => {\n          resolve();\n        };\n\n        transaction.onabort = (event) => {\n          this.logger.debug('DiagnosticsStorage: Failed to set tags', event);\n          resolve();\n        };\n\n        entries.forEach(([key, value]) => {\n          const putRequest = store.put({ key, value });\n\n          putRequest.onerror = (event) => {\n            this.logger.debug('DiagnosticsStorage: Failed to set tag', key, value, event);\n          };\n        });\n      });\n    } catch (error) {\n      this.logger.debug('DiagnosticsStorage: Failed to set tags', error);\n    }\n  }\n\n  async incrementCounters(counters: Record<string, number>): Promise<void> {\n    try {\n      if (Object.entries(counters).length === 0) {\n        return;\n      }\n\n      const db = await this.getDB();\n      const transaction = db.transaction([TABLE_NAMES.COUNTERS], 'readwrite');\n      const store = transaction.objectStore(TABLE_NAMES.COUNTERS);\n\n      return new Promise((resolve) => {\n        const entries = Object.entries(counters);\n\n        transaction.oncomplete = () => {\n          resolve();\n        };\n\n        transaction.onabort = (event) => {\n          this.logger.debug('DiagnosticsStorage: Failed to increment counters', event);\n          resolve();\n        };\n\n        // Read existing values and update them\n        entries.forEach(([key, incrementValue]) => {\n          const getRequest = store.get(key);\n\n          getRequest.onsuccess = () => {\n            const existingRecord = getRequest.result as CounterRecord | undefined;\n            /* istanbul ignore next */\n            const existingValue = existingRecord ? existingRecord.value : 0;\n            const putRequest = store.put({ key, value: existingValue + incrementValue });\n\n            putRequest.onerror = (event) => {\n              this.logger.debug('DiagnosticsStorage: Failed to update counter', key, event);\n            };\n          };\n\n          getRequest.onerror = (event) => {\n            this.logger.debug('DiagnosticsStorage: Failed to read existing counter', key, event);\n          };\n        });\n      });\n    } catch (error) {\n      this.logger.debug('DiagnosticsStorage: Failed to increment counters', error);\n    }\n  }\n\n  async setHistogramStats(histogramStats: Record<string, HistogramStats>): Promise<void> {\n    try {\n      if (Object.entries(histogramStats).length === 0) {\n        return;\n      }\n\n      const db = await this.getDB();\n      const transaction = db.transaction([TABLE_NAMES.HISTOGRAMS], 'readwrite');\n      const store = transaction.objectStore(TABLE_NAMES.HISTOGRAMS);\n\n      return new Promise((resolve) => {\n        const entries = Object.entries(histogramStats);\n\n        transaction.oncomplete = () => {\n          resolve();\n        };\n\n        transaction.onabort = (event) => {\n          this.logger.debug('DiagnosticsStorage: Failed to set histogram stats', event);\n          resolve();\n        };\n\n        // Read existing values and update them\n        entries.forEach(([key, newStats]) => {\n          const getRequest = store.get(key);\n\n          getRequest.onsuccess = () => {\n            const existingRecord = getRequest.result as HistogramRecord | undefined;\n            let updatedStats: HistogramRecord;\n\n            /* istanbul ignore next */\n            if (existingRecord) {\n              // Accumulate with existing stats\n              updatedStats = {\n                key,\n                count: existingRecord.count + newStats.count,\n                min: Math.min(existingRecord.min, newStats.min),\n                max: Math.max(existingRecord.max, newStats.max),\n                sum: existingRecord.sum + newStats.sum,\n              };\n            } else {\n              // Create new stats\n              updatedStats = {\n                key,\n                count: newStats.count,\n                min: newStats.min,\n                max: newStats.max,\n                sum: newStats.sum,\n              };\n            }\n\n            const putRequest = store.put(updatedStats);\n\n            putRequest.onerror = (event) => {\n              this.logger.debug('DiagnosticsStorage: Failed to set histogram stats', key, event);\n            };\n          };\n\n          getRequest.onerror = (event) => {\n            this.logger.debug('DiagnosticsStorage: Failed to read existing histogram stats', key, event);\n          };\n        });\n      });\n    } catch (error) {\n      this.logger.debug('DiagnosticsStorage: Failed to set histogram stats', error);\n    }\n  }\n\n  async addEventRecords(\n    events: Array<{ event_name: string; time: number; event_properties: Record<string, any> }>,\n  ): Promise<void> {\n    try {\n      if (events.length === 0) {\n        return;\n      }\n\n      const db = await this.getDB();\n      const transaction = db.transaction([TABLE_NAMES.EVENTS], 'readwrite');\n      const store = transaction.objectStore(TABLE_NAMES.EVENTS);\n\n      return new Promise((resolve) => {\n        transaction.oncomplete = () => {\n          resolve();\n        };\n\n        /* istanbul ignore next */\n        transaction.onabort = (event) => {\n          this.logger.debug('DiagnosticsStorage: Failed to add event records', event);\n          resolve();\n        };\n\n        // First, check how many events are currently stored\n        const countRequest = store.count();\n\n        countRequest.onsuccess = () => {\n          const currentCount = countRequest.result;\n\n          // Calculate how many events we can add\n          const availableSlots = Math.max(0, MAX_PERSISTENT_STORAGE_EVENTS_COUNT - currentCount);\n\n          if (availableSlots < events.length) {\n            this.logger.debug(\n              `DiagnosticsStorage: Only added ${availableSlots} of ${events.length} events due to storage limit`,\n            );\n          }\n\n          // Only add events up to the available slots (take the least recent ones)\n          events.slice(0, availableSlots).forEach((event) => {\n            const request = store.add(event);\n\n            request.onerror = (event) => {\n              this.logger.debug('DiagnosticsStorage: Failed to add event record', event);\n            };\n          });\n        };\n\n        countRequest.onerror = (event) => {\n          this.logger.debug('DiagnosticsStorage: Failed to count existing events', event);\n        };\n      });\n    } catch (error) {\n      this.logger.debug('DiagnosticsStorage: Failed to add event records', error);\n    }\n  }\n\n  async setInternal(key: string, value: string): Promise<void> {\n    try {\n      const db = await this.getDB();\n      const transaction = db.transaction([TABLE_NAMES.INTERNAL], 'readwrite');\n      const store = transaction.objectStore(TABLE_NAMES.INTERNAL);\n\n      return new Promise((resolve, reject) => {\n        /* istanbul ignore next */\n        transaction.onabort = () => reject(new Error('Failed to set internal value'));\n\n        const request = store.put({ key, value });\n\n        request.onsuccess = () => resolve();\n\n        /* istanbul ignore next */\n        request.onerror = () => reject(new Error('Failed to set internal value'));\n      });\n    } catch (error) {\n      /* istanbul ignore next */\n      this.logger.debug('DiagnosticsStorage: Failed to set internal value', error);\n    }\n  }\n\n  async getInternal(key: string): Promise<InternalRecord | undefined> {\n    try {\n      const db = await this.getDB();\n      const transaction = db.transaction([TABLE_NAMES.INTERNAL], 'readonly');\n      const store = transaction.objectStore(TABLE_NAMES.INTERNAL);\n\n      return new Promise((resolve, reject) => {\n        /* istanbul ignore next */\n        transaction.onabort = () => reject(new Error('Failed to get internal value'));\n\n        const request = store.get(key);\n\n        request.onsuccess = () => resolve(request.result as InternalRecord | undefined);\n\n        /* istanbul ignore next */\n        request.onerror = () => reject(new Error('Failed to get internal value'));\n      });\n    } catch (error) {\n      this.logger.debug('DiagnosticsStorage: Failed to get internal value', error);\n      return undefined;\n    }\n  }\n\n  async getLastFlushTimestamp(): Promise<number | undefined> {\n    try {\n      const record = await this.getInternal(INTERNAL_KEYS.LAST_FLUSH_TIMESTAMP);\n      return record ? parseInt(record.value, 10) : undefined;\n    } catch (error) {\n      /* istanbul ignore next */\n      this.logger.debug('DiagnosticsStorage: Failed to get last flush timestamp', error);\n      /* istanbul ignore next */\n      return undefined;\n    }\n  }\n\n  async setLastFlushTimestamp(timestamp: number): Promise<void> {\n    try {\n      await this.setInternal(INTERNAL_KEYS.LAST_FLUSH_TIMESTAMP, timestamp.toString());\n    } catch (error) {\n      /* istanbul ignore next */\n      this.logger.debug('DiagnosticsStorage: Failed to set last flush timestamp', error);\n    }\n  }\n\n  /* istanbul ignore next */\n  clearTable(transaction: IDBTransaction, tableName: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const store = transaction.objectStore(tableName);\n      const request = store.clear();\n\n      request.onsuccess = () => resolve();\n      request.onerror = () => reject(new Error(`Failed to clear table ${tableName}`));\n    });\n  }\n\n  /* istanbul ignore next */\n  async getAllAndClear(): Promise<{\n    tags: TagRecord[];\n    counters: CounterRecord[];\n    histogramStats: HistogramRecord[];\n    events: EventRecord[];\n  }> {\n    try {\n      const db = await this.getDB();\n      const transaction = db.transaction(\n        [TABLE_NAMES.TAGS, TABLE_NAMES.COUNTERS, TABLE_NAMES.HISTOGRAMS, TABLE_NAMES.EVENTS],\n        'readwrite',\n      );\n\n      // Get all data first\n      const [tags, counters, histogramStats, events] = await Promise.all([\n        this.getAllFromStore<TagRecord>(transaction, TABLE_NAMES.TAGS),\n        this.getAllFromStore<CounterRecord>(transaction, TABLE_NAMES.COUNTERS),\n        this.getAllFromStore<HistogramRecord>(transaction, TABLE_NAMES.HISTOGRAMS),\n        this.getAllFromStore<EventRecord>(transaction, TABLE_NAMES.EVENTS),\n      ]);\n\n      // Clear all data in the same transaction\n      await Promise.all([\n        this.clearTable(transaction, TABLE_NAMES.COUNTERS),\n        this.clearTable(transaction, TABLE_NAMES.HISTOGRAMS),\n        this.clearTable(transaction, TABLE_NAMES.EVENTS),\n      ]);\n\n      return { tags, counters, histogramStats, events };\n    } catch (error) {\n      this.logger.debug('DiagnosticsStorage: Failed to get all and clear data', error);\n      return { tags: [], counters: [], histogramStats: [], events: [] };\n    }\n  }\n\n  /**\n   * Helper method to get all records from a store within a transaction\n   */\n  /* istanbul ignore next */\n  private getAllFromStore<T>(transaction: IDBTransaction, tableName: string): Promise<T[]> {\n    return new Promise((resolve, reject) => {\n      const store = transaction.objectStore(tableName);\n      const request = store.getAll();\n\n      request.onsuccess = () => resolve(request.result as T[]);\n      request.onerror = () => reject(new Error(`Failed to get all from ${tableName}`));\n    });\n  }\n}\n", "import { getGlobalScope } from '../global-scope';\nimport { IDiagnosticsClient } from './diagnostics-client';\n\ntype ErrorEventType = 'error' | 'unhandledrejection';\n\ninterface CapturedErrorContext {\n  readonly type: ErrorEventType;\n  readonly message: string;\n  readonly stack?: string;\n  readonly filename?: string;\n  readonly errorName?: string;\n  readonly metadata?: Record<string, unknown>;\n}\n\nexport const GLOBAL_KEY = '__AMPLITUDE_SCRIPT_URL__';\nexport const EVENT_NAME_ERROR_UNCAUGHT = 'sdk.error.uncaught';\n\nconst getNormalizedScriptUrl = (): string | undefined => {\n  const scope = getGlobalScope() as Record<string, unknown> | null;\n  /* istanbul ignore next */\n  return scope?.[GLOBAL_KEY] as string | undefined;\n};\n\nconst setNormalizedScriptUrl = (url: string) => {\n  const scope = getGlobalScope() as Record<string, unknown> | null;\n  if (scope) {\n    scope[GLOBAL_KEY] = url;\n  }\n};\n\nexport const registerSdkLoaderMetadata = (metadata: { scriptUrl?: string }) => {\n  if (metadata.scriptUrl) {\n    const normalized = normalizeUrl(metadata.scriptUrl);\n    if (normalized) {\n      setNormalizedScriptUrl(normalized);\n    }\n  }\n};\n\nexport const enableSdkErrorListeners = (client: IDiagnosticsClient) => {\n  const scope = getGlobalScope();\n\n  if (!scope || typeof scope.addEventListener !== 'function') {\n    return;\n  }\n\n  const handleError = (event: ErrorEvent) => {\n    const error = event.error instanceof Error ? event.error : undefined;\n    const stack = error?.stack;\n    const match = detectSdkOrigin({ filename: event.filename, stack });\n    if (!match) {\n      return;\n    }\n\n    capture({\n      type: 'error',\n      message: event.message,\n      stack,\n      filename: event.filename,\n      errorName: error?.name,\n      metadata: {\n        colno: event.colno,\n        lineno: event.lineno,\n        isTrusted: event.isTrusted,\n        matchReason: match,\n      },\n    });\n  };\n\n  const handleRejection = (event: PromiseRejectionEvent) => {\n    const error = event.reason instanceof Error ? event.reason : undefined;\n    const stack = error?.stack;\n    const filename = extractFilenameFromStack(stack);\n    const match = detectSdkOrigin({ filename, stack });\n\n    if (!match) {\n      return;\n    }\n\n    /* istanbul ignore next */\n    capture({\n      type: 'unhandledrejection',\n      message: error?.message ?? stringifyReason(event.reason),\n      stack,\n      filename,\n      errorName: error?.name,\n      metadata: {\n        isTrusted: event.isTrusted,\n        matchReason: match,\n      },\n    });\n  };\n\n  const capture = (context: CapturedErrorContext) => {\n    client.recordEvent(EVENT_NAME_ERROR_UNCAUGHT, {\n      type: context.type,\n      message: context.message,\n      filename: context.filename,\n      error_name: context.errorName,\n      stack: context.stack,\n      ...context.metadata,\n    });\n  };\n\n  scope.addEventListener('error', handleError, true);\n  scope.addEventListener('unhandledrejection', handleRejection, true);\n};\n\nconst detectSdkOrigin = (payload: { filename?: string; stack?: string }): 'filename' | 'stack' | undefined => {\n  const normalizedScriptUrl = getNormalizedScriptUrl();\n  if (!normalizedScriptUrl) {\n    return undefined;\n  }\n\n  if (payload.filename && payload.filename.includes(normalizedScriptUrl)) {\n    return 'filename';\n  }\n\n  if (payload.stack && payload.stack.includes(normalizedScriptUrl)) {\n    return 'stack';\n  }\n\n  return undefined;\n};\n\nconst normalizeUrl = (value: string) => {\n  try {\n    /* istanbul ignore next */\n    const url = new URL(value, getGlobalScope()?.location?.origin);\n    return url.origin + url.pathname;\n  } catch {\n    return undefined;\n  }\n};\n\nconst extractFilenameFromStack = (stack?: string) => {\n  if (!stack) {\n    return undefined;\n  }\n\n  const match = stack.match(/(https?:\\/\\/\\S+?)(?=[)\\s]|$)/);\n  /* istanbul ignore next */\n  return match ? match[1] : undefined;\n};\n\n/* istanbul ignore next */\nconst stringifyReason = (reason: unknown) => {\n  if (typeof reason === 'string') {\n    return reason;\n  }\n\n  try {\n    return JSON.stringify(reason);\n  } catch {\n    return '[object Object]';\n  }\n};\n", "import { ILogger } from '../logger';\nimport { DiagnosticsStorage, IDiagnosticsStorage } from './diagnostics-storage';\nimport { ServerZoneType } from '../types/server-zone';\nimport { getGlobalScope } from '../global-scope';\nimport { isTimestampInSampleTemp } from '../utils/sampling';\nimport { enableSdkErrorListeners } from './uncaught-sdk-errors';\n\nexport const SAVE_INTERVAL_MS = 1000; // 1 second\nexport const FLUSH_INTERVAL_MS = 5 * 60 * 1000; // 5 minutes\nexport const DIAGNOSTICS_US_SERVER_URL = 'https://diagnostics.prod.us-west-2.amplitude.com/v1/capture';\nexport const DIAGNOSTICS_EU_SERVER_URL = 'https://diagnostics.prod.eu-central-1.amplitude.com/v1/capture';\n\n// In-memory storage limits\nexport const MAX_MEMORY_STORAGE_COUNT = 10000; // for tags, counters, histograms separately\nexport const MAX_MEMORY_STORAGE_EVENTS_COUNT = 10;\n\n// === Core Data Types ===\n\n/**\n * Key-value pairs for environment/context information\n */\ntype DiagnosticsTags = Record<string, string>;\n\n/**\n * Numeric counters that can be incremented\n */\ntype DiagnosticsCounters = Record<string, number>;\n\n/**\n * Properties for diagnostic events\n */\ntype EventProperties = Record<string, any>;\n\n/**\n * Individual diagnostic event\n */\ninterface DiagnosticsEvent {\n  readonly event_name: string;\n  readonly time: number;\n  readonly event_properties: EventProperties;\n}\n\n/**\n * Computed histogram statistics for final payload\n */\ninterface HistogramResult {\n  readonly count: number;\n  readonly min: number;\n  readonly max: number;\n  readonly avg: number;\n}\n\n/**\n * Internal histogram statistics with sum for efficient incremental updates\n */\nexport interface HistogramStats {\n  count: number;\n  min: number;\n  max: number;\n  sum: number; // Used for avg calculation\n}\n\n/**\n * Collection of histogram results keyed by histogram name\n */\ntype DiagnosticsHistograms = Record<string, HistogramResult>;\n\n/**\n * Collection of histogram stats keyed by histogram name (internal use for memory + persistence storage)\n */\ntype DiagnosticsHistogramStats = Record<string, HistogramStats>;\n\n// === Payload Types ===\n\n/**\n * Complete diagnostics payload sent to backend\n */\ninterface FlushPayload {\n  readonly tags: DiagnosticsTags;\n  readonly histogram: DiagnosticsHistograms;\n  readonly counters: DiagnosticsCounters;\n  readonly events: readonly DiagnosticsEvent[];\n}\n\n/**\n * Amplitude Diagnostics Client\n *\n * A client for collecting and managing diagnostics data including tags, counters,\n * histograms, and events. Data is stored persistently using IndexedDB to survive browser restarts and offline scenarios.\n *\n * Key Features:\n * - IndexedDB storage\n * - Time-based persistent storage flush interval (5 minutes since last flush)\n * - 1 second time-based memory storage flush to persistent storage\n * - Histogram statistics calculation (min, max, avg)\n */\nexport interface IDiagnosticsClient {\n  /**\n   * Set or update a tag\n   *\n   * @example\n   * ```typescript\n   * // Set environment tags\n   * diagnostics.setTag('library', 'amplitude-typescript/2.0.0');\n   * diagnostics.setTag('user_agent', navigator.userAgent);\n   * ```\n   */\n  setTag(name: string, value: string): void;\n\n  /**\n   * Increment a counter. If doesn't exist, create a counter and set value to 1\n   *\n   * @example\n   * ```typescript\n   * // Track counters\n   * diagnostics.increment('analytics.fileNotFound');\n   * diagnostics.increment('network.retry', 3);\n   * ```\n   */\n  increment(name: string, size?: number): void;\n\n  /**\n   * Record a histogram value\n   *\n   * @example\n   * ```typescript\n   * // Record performance metrics\n   * diagnostics.recordHistogram('sr.time', 5.2);\n   * diagnostics.recordHistogram('network.latency', 150);\n   * ```\n   */\n  recordHistogram(name: string, value: number): void;\n\n  /**\n   * Record an event\n   *\n   * @example\n   * ```typescript\n   * // Record diagnostic events\n   * diagnostics.recordEvent('error', {\n   *   stack_trace: '...',\n   * });\n   * ```\n   */\n  recordEvent(name: string, properties: EventProperties): void;\n\n  // Flush storage\n  _flush(): void;\n\n  /**\n   * Sets the sample rate for diagnostics.\n   *\n   * @example\n   * ```typescript\n   * diagnostics.setSampleRate(0.5);\n   * ```\n   */\n  _setSampleRate(sampleRate: number): void;\n}\n\nexport class DiagnosticsClient implements IDiagnosticsClient {\n  storage?: IDiagnosticsStorage;\n  logger: ILogger;\n  serverUrl: string;\n  apiKey: string;\n  // Whether to track diagnostics data based on sample rate and enabled flag\n  shouldTrack: boolean;\n  config: {\n    enabled: boolean;\n    sampleRate: number;\n  };\n  /**\n   * The timestamp when the diagnostics client was initialized.\n   * Save in memory to keep lifecycle sample rate calculation consistency.\n   */\n  startTimestamp: number;\n\n  // In-memory storages\n  inMemoryTags: DiagnosticsTags = {};\n  inMemoryCounters: DiagnosticsCounters = {};\n  inMemoryHistograms: DiagnosticsHistogramStats = {};\n  inMemoryEvents: DiagnosticsEvent[] = [];\n\n  // Timer for 1-second persistence\n  saveTimer: ReturnType<typeof setTimeout> | null = null;\n  // Timer for flush interval\n  flushTimer: ReturnType<typeof setTimeout> | null = null;\n\n  constructor(\n    apiKey: string,\n    logger: ILogger,\n    serverZone: ServerZoneType = 'US',\n    options?: {\n      enabled?: boolean;\n      sampleRate?: number;\n    },\n  ) {\n    this.apiKey = apiKey;\n    this.logger = logger;\n    this.serverUrl = serverZone === 'US' ? DIAGNOSTICS_US_SERVER_URL : DIAGNOSTICS_EU_SERVER_URL;\n\n    this.logger.debug('DiagnosticsClient: Initializing with options', JSON.stringify(options, null, 2));\n    // Diagnostics is enabled by default with sample rate of 0 (no sampling)\n    this.config = { enabled: true, sampleRate: 0, ...options };\n    this.startTimestamp = Date.now();\n    this.shouldTrack = isTimestampInSampleTemp(this.startTimestamp, this.config.sampleRate) && this.config.enabled;\n\n    if (DiagnosticsStorage.isSupported()) {\n      this.storage = new DiagnosticsStorage(apiKey, logger);\n    } else {\n      this.logger.debug('DiagnosticsClient: IndexedDB is not supported');\n    }\n\n    void this.initializeFlushInterval();\n\n    // Track internal diagnostics metrics for sampling\n    if (this.shouldTrack) {\n      this.increment('sdk.diagnostics.sampled.in.and.enabled');\n      enableSdkErrorListeners(this);\n    }\n  }\n\n  /**\n   * Check if storage is available and tracking is enabled\n   */\n  isStorageAndTrackEnabled(): boolean {\n    return Boolean(this.storage) && Boolean(this.shouldTrack);\n  }\n\n  setTag(name: string, value: string) {\n    if (!this.isStorageAndTrackEnabled()) {\n      return;\n    }\n\n    if (Object.keys(this.inMemoryTags).length >= MAX_MEMORY_STORAGE_COUNT) {\n      this.logger.debug('DiagnosticsClient: Early return setTags as reaching memory limit');\n      return;\n    }\n\n    this.inMemoryTags[name] = value;\n    this.startTimersIfNeeded();\n  }\n\n  increment(name: string, size = 1) {\n    if (!this.isStorageAndTrackEnabled()) {\n      return;\n    }\n\n    if (Object.keys(this.inMemoryCounters).length >= MAX_MEMORY_STORAGE_COUNT) {\n      this.logger.debug('DiagnosticsClient: Early return increment as reaching memory limit');\n      return;\n    }\n\n    this.inMemoryCounters[name] = (this.inMemoryCounters[name] || 0) + size;\n    this.startTimersIfNeeded();\n  }\n\n  recordHistogram(name: string, value: number) {\n    if (!this.isStorageAndTrackEnabled()) {\n      return;\n    }\n\n    if (Object.keys(this.inMemoryHistograms).length >= MAX_MEMORY_STORAGE_COUNT) {\n      this.logger.debug('DiagnosticsClient: Early return recordHistogram as reaching memory limit');\n      return;\n    }\n\n    const existing = this.inMemoryHistograms[name];\n    if (existing) {\n      // Update existing stats incrementally\n      existing.count += 1;\n      existing.min = Math.min(existing.min, value);\n      existing.max = Math.max(existing.max, value);\n      existing.sum += value;\n    } else {\n      // Create new stats\n      this.inMemoryHistograms[name] = {\n        count: 1,\n        min: value,\n        max: value,\n        sum: value,\n      };\n    }\n    this.startTimersIfNeeded();\n  }\n\n  recordEvent(name: string, properties: EventProperties) {\n    if (!this.isStorageAndTrackEnabled()) {\n      return;\n    }\n\n    if (this.inMemoryEvents.length >= MAX_MEMORY_STORAGE_EVENTS_COUNT) {\n      this.logger.debug('DiagnosticsClient: Early return recordEvent as reaching memory limit');\n      return;\n    }\n\n    this.inMemoryEvents.push({\n      event_name: name,\n      time: Date.now(),\n      event_properties: properties,\n    });\n    this.startTimersIfNeeded();\n  }\n\n  startTimersIfNeeded() {\n    if (!this.saveTimer) {\n      this.saveTimer = setTimeout(() => {\n        this.saveAllDataToStorage()\n          .catch((error) => {\n            this.logger.debug('DiagnosticsClient: Failed to save all data to storage', error);\n          })\n          .finally(() => {\n            this.saveTimer = null;\n          });\n      }, SAVE_INTERVAL_MS);\n    }\n\n    if (!this.flushTimer) {\n      this.flushTimer = setTimeout(() => {\n        this._flush()\n          .catch((error) => {\n            this.logger.debug('DiagnosticsClient: Failed to flush', error);\n          })\n          .finally(() => {\n            this.flushTimer = null;\n          });\n      }, FLUSH_INTERVAL_MS);\n    }\n  }\n\n  async saveAllDataToStorage() {\n    if (!this.storage) {\n      return;\n    }\n    const tagsToSave = { ...this.inMemoryTags };\n    const countersToSave = { ...this.inMemoryCounters };\n    const histogramsToSave = { ...this.inMemoryHistograms };\n    const eventsToSave = [...this.inMemoryEvents];\n\n    this.inMemoryEvents = [];\n    this.inMemoryTags = {};\n    this.inMemoryCounters = {};\n    this.inMemoryHistograms = {};\n\n    await Promise.all([\n      this.storage.setTags(tagsToSave),\n      this.storage.incrementCounters(countersToSave),\n      this.storage.setHistogramStats(histogramsToSave),\n      this.storage.addEventRecords(eventsToSave),\n    ]);\n  }\n\n  async _flush() {\n    if (!this.storage) {\n      return;\n    }\n\n    await this.saveAllDataToStorage();\n    this.saveTimer = null;\n    this.flushTimer = null;\n\n    // Get all data from storage and clear it\n    const {\n      tags: tagRecords,\n      counters: counterRecords,\n      histogramStats: histogramStatsRecords,\n      events: eventRecords,\n    } = await this.storage.getAllAndClear();\n\n    // Update the last flush timestamp\n    void this.storage.setLastFlushTimestamp(Date.now());\n\n    // Convert metrics to the expected format\n    const tags: DiagnosticsTags = {};\n    tagRecords.forEach((record) => {\n      tags[record.key] = record.value;\n    });\n\n    const counters: DiagnosticsCounters = {};\n    counterRecords.forEach((record) => {\n      counters[record.key] = record.value;\n    });\n\n    const histogram: DiagnosticsHistograms = {};\n    histogramStatsRecords.forEach((stats) => {\n      histogram[stats.key] = {\n        count: stats.count,\n        min: stats.min,\n        max: stats.max,\n        avg: Math.round((stats.sum / stats.count) * 100) / 100, // round the average to 2 decimal places.\n      };\n    });\n\n    const events: DiagnosticsEvent[] = eventRecords.map((record) => ({\n      event_name: record.event_name,\n      time: record.time,\n      event_properties: record.event_properties,\n    }));\n\n    // Early return if all data collections are empty\n    if (Object.keys(counters).length === 0 && Object.keys(histogram).length === 0 && events.length === 0) {\n      return;\n    }\n\n    // Create flush payload\n    const payload: FlushPayload = {\n      tags,\n      histogram,\n      counters,\n      events,\n    };\n\n    // Send payload to diagnostics server\n    void this.fetch(payload);\n  }\n\n  /**\n   * Send diagnostics data to the server\n   */\n  async fetch(payload: FlushPayload) {\n    try {\n      if (!getGlobalScope()) {\n        throw new Error('DiagnosticsClient: Fetch is not supported');\n      }\n\n      const response = await fetch(this.serverUrl, {\n        method: 'POST',\n        headers: {\n          'X-ApiKey': this.apiKey,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        this.logger.debug('DiagnosticsClient: Failed to send diagnostics data.');\n        return;\n      }\n\n      this.logger.debug('DiagnosticsClient: Successfully sent diagnostics data');\n    } catch (error) {\n      this.logger.debug('DiagnosticsClient: Failed to send diagnostics data. ', error);\n    }\n  }\n\n  /**\n   * Initialize flush interval logic.\n   * Check if 5 minutes has passed since last flush, if so flush immediately.\n   * Otherwise set a timer to flush when the interval is reached.\n   */\n  async initializeFlushInterval() {\n    if (!this.storage) {\n      return;\n    }\n    const now = Date.now();\n    const lastFlushTimestamp = (await this.storage.getLastFlushTimestamp()) || -1;\n\n    // If last flush timestamp is -1, it means this is a new client\n    // Save current timestamp as the initial \"last flush timestamp\"\n    // and schedule the flush timer\n    if (lastFlushTimestamp === -1) {\n      void this.storage.setLastFlushTimestamp(now);\n      this._setFlushTimer(FLUSH_INTERVAL_MS);\n      return;\n    }\n\n    const timeSinceLastFlush = now - lastFlushTimestamp;\n    if (timeSinceLastFlush >= FLUSH_INTERVAL_MS) {\n      // More than 5 minutes has passed, flush immediately\n      void this._flush();\n      return;\n    } else {\n      // Set timer for remaining time\n      this._setFlushTimer(FLUSH_INTERVAL_MS - timeSinceLastFlush);\n    }\n  }\n\n  /**\n   * Helper method to set flush timer with consistent error handling\n   */\n  private _setFlushTimer(delay: number) {\n    this.flushTimer = setTimeout(() => {\n      this._flush()\n        .catch((error) => {\n          this.logger.debug('DiagnosticsClient: Failed to flush', error);\n        })\n        .finally(() => {\n          this.flushTimer = null;\n        });\n    }, delay);\n  }\n\n  _setSampleRate(sampleRate: number): void {\n    this.logger.debug('DiagnosticsClient: Setting sample rate to', sampleRate);\n    this.config.sampleRate = sampleRate;\n    this.shouldTrack = isTimestampInSampleTemp(this.startTimestamp, this.config.sampleRate) && this.config.enabled;\n    this.logger.debug('DiagnosticsClient: Should track is', this.shouldTrack);\n  }\n}\n", "/* eslint-disable @typescript-eslint/no-unsafe-argument */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\nimport { Transport } from '../types/transport';\nimport { Status } from '../types/status';\nimport { Payload } from '../types/payload';\nimport { Response } from '../types/response';\nimport { isSuccessStatusCode } from '../utils/status-code';\n\nexport class BaseTransport implements Transport {\n  send(_serverUrl: string, _payload: Payload): Promise<Response | null> {\n    return Promise.resolve(null);\n  }\n\n  buildResponse(responseJSON: Record<string, any>): Response | null {\n    if (typeof responseJSON !== 'object') {\n      return null;\n    }\n\n    const statusCode = responseJSON.code || 0;\n    const status = this.buildStatus(statusCode);\n\n    switch (status) {\n      case Status.Success:\n        return {\n          status,\n          statusCode,\n          body: {\n            eventsIngested: responseJSON.events_ingested ?? 0,\n            payloadSizeBytes: responseJSON.payload_size_bytes ?? 0,\n            serverUploadTime: responseJSON.server_upload_time ?? 0,\n          },\n        };\n\n      case Status.Invalid:\n        return {\n          status,\n          statusCode,\n          body: {\n            error: responseJSON.error ?? '',\n            missingField: responseJSON.missing_field ?? '',\n            eventsWithInvalidFields: responseJSON.events_with_invalid_fields ?? {},\n            eventsWithMissingFields: responseJSON.events_with_missing_fields ?? {},\n            eventsWithInvalidIdLengths: responseJSON.events_with_invalid_id_lengths ?? {},\n            epsThreshold: responseJSON.eps_threshold ?? 0,\n            exceededDailyQuotaDevices: responseJSON.exceeded_daily_quota_devices ?? {},\n            silencedDevices: responseJSON.silenced_devices ?? [],\n            silencedEvents: responseJSON.silenced_events ?? [],\n            throttledDevices: responseJSON.throttled_devices ?? {},\n            throttledEvents: responseJSON.throttled_events ?? [],\n          },\n        };\n      case Status.PayloadTooLarge:\n        return {\n          status,\n          statusCode,\n          body: {\n            error: responseJSON.error ?? '',\n          },\n        };\n      case Status.RateLimit:\n        return {\n          status,\n          statusCode,\n          body: {\n            error: responseJSON.error ?? '',\n            epsThreshold: responseJSON.eps_threshold ?? 0,\n            throttledDevices: responseJSON.throttled_devices ?? {},\n            throttledUsers: responseJSON.throttled_users ?? {},\n            exceededDailyQuotaDevices: responseJSON.exceeded_daily_quota_devices ?? {},\n            exceededDailyQuotaUsers: responseJSON.exceeded_daily_quota_users ?? {},\n            throttledEvents: responseJSON.throttled_events ?? [],\n          },\n        };\n      case Status.Timeout:\n      default:\n        return {\n          status,\n          statusCode,\n        };\n    }\n  }\n\n  buildStatus(code: number): Status {\n    if (isSuccessStatusCode(code)) {\n      return Status.Success;\n    }\n\n    if (code === 429) {\n      return Status.RateLimit;\n    }\n\n    if (code === 413) {\n      return Status.PayloadTooLarge;\n    }\n\n    if (code === 408) {\n      return Status.Timeout;\n    }\n\n    if (code >= 400 && code < 500) {\n      return Status.Invalid;\n    }\n\n    if (code >= 500) {\n      return Status.Failed;\n    }\n\n    return Status.Unknown;\n  }\n}\n", "import { BaseTransport } from './base';\nimport { Transport } from '../types/transport';\nimport { Payload } from '../types/payload';\nimport { Response } from '../types/response';\n\nexport class FetchTransport extends BaseTransport implements Transport {\n  private customHeaders: Record<string, string>;\n\n  constructor(customHeaders: Record<string, string> = {}) {\n    super();\n    this.customHeaders = customHeaders;\n  }\n\n  async send(serverUrl: string, payload: Payload): Promise<Response | null> {\n    /* istanbul ignore if */\n    if (typeof fetch === 'undefined') {\n      throw new Error('FetchTransport is not supported');\n    }\n    const options: RequestInit = {\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: '*/*',\n        ...this.customHeaders,\n      },\n      body: JSON.stringify(payload),\n      method: 'POST',\n    };\n    const response = await fetch(serverUrl, options);\n    const responseText = await response.text();\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      return this.buildResponse(JSON.parse(responseText));\n    } catch {\n      return this.buildResponse({ code: response.status });\n    }\n  }\n}\n", "import { RemoteConfigStorage, RemoteConfigInfo } from './remote-config';\nimport { ILogger } from '../logger';\n\nexport class RemoteConfigLocalStorage implements RemoteConfigStorage {\n  private readonly key: string;\n  private readonly logger: ILogger;\n\n  constructor(apiKey: string, logger: ILogger) {\n    this.key = `AMP_remote_config_${apiKey.substring(0, 10)}`;\n    this.logger = logger;\n  }\n\n  fetchConfig(): Promise<RemoteConfigInfo> {\n    let result: string | null = null;\n    const failedRemoteConfigInfo = {\n      remoteConfig: null,\n      lastFetch: new Date(),\n    };\n\n    try {\n      result = localStorage.getItem(this.key);\n    } catch (error) {\n      this.logger.debug('Remote config localstorage failed to access: ', error);\n      return Promise.resolve(failedRemoteConfigInfo);\n    }\n\n    if (result === null) {\n      this.logger.debug('Remote config localstorage gets null because the key does not exist');\n      return Promise.resolve(failedRemoteConfigInfo);\n    }\n\n    try {\n      const remoteConfigInfo: RemoteConfigInfo = JSON.parse(result) as RemoteConfigInfo;\n      this.logger.debug(`Remote config localstorage parsed successfully: ${JSON.stringify(remoteConfigInfo)}`);\n      return Promise.resolve({\n        remoteConfig: remoteConfigInfo.remoteConfig,\n        lastFetch: new Date(remoteConfigInfo.lastFetch),\n      });\n    } catch (error) {\n      this.logger.debug('Remote config localstorage failed to parse: ', error);\n      localStorage.removeItem(this.key);\n      return Promise.resolve(failedRemoteConfigInfo);\n    }\n  }\n\n  setConfig(config: RemoteConfigInfo): Promise<boolean> {\n    try {\n      localStorage.setItem(this.key, JSON.stringify(config));\n      this.logger.debug('Remote config localstorage set successfully.');\n      return Promise.resolve(true);\n    } catch (error) {\n      this.logger.debug('Remote config localstorage failed to set: ', error);\n    }\n    return Promise.resolve(false);\n  }\n}\n", "import { ServerZoneType } from '../types/server-zone';\nimport { ILogger } from '../logger';\nimport { RemoteConfigLocalStorage } from './remote-config-localstorage';\nimport { UUID } from '../utils/uuid';\n\n/**\n * Modes for receiving remote config updates:\n * - `'all'`  Optimized for both speed and freshness. Returns the fastest response first\n *   (cache or remote), then always waits for and returns the remote response to ensure\n *   the most up-to-date config. Callback may be called once (if remote wins) or twice\n *   (cache first, then remote).\n * - `{ timeout: number }`  Prefers remote data but with a fallback strategy. Waits for\n *   a remote response until the specified timeout (in milliseconds), then falls back to\n *   cached data if available. Callback is called exactly once.\n */\nexport type DeliveryMode = 'all' | { timeout: number };\n\n/**\n * Sources of returned remote config:\n * - `cache` - Fetched from local storage.\n * - `remote` - Fetched from remote.\n */\nexport type Source = 'cache' | 'remote';\n\nexport const US_SERVER_URL = 'https://sr-client-cfg.amplitude.com/config';\nexport const EU_SERVER_URL = 'https://sr-client-cfg.eu.amplitude.com/config';\nexport const DEFAULT_MAX_RETRIES = 3;\n\n/**\n * The default timeout for fetch in milliseconds.\n * Linear backoff policy: timeout / retry times is the interval between fetch retry.\n */\nconst DEFAULT_TIMEOUT = 1000;\n\n/**\n * The minimum time between fetches in milliseconds.\n * This prevents too many requests from being sent in a short period of time.\n */\nconst DEFAULT_MIN_TIME_BETWEEN_FETCHES = 5 * 60 * 1000; // 5 minutes\n\nexport interface RemoteConfig {\n  [key: string]: any;\n}\n\nexport interface RemoteConfigInfo {\n  remoteConfig: RemoteConfig | null;\n  // Timestamp of when the remote config was fetched.\n  lastFetch: Date;\n}\n\nexport interface RemoteConfigStorage {\n  /**\n   * Fetch remote config from storage asynchronously.\n   */\n  fetchConfig(): Promise<RemoteConfigInfo>;\n\n  /**\n   * Set remote config to storage asynchronously.\n   */\n  setConfig(config: RemoteConfigInfo): Promise<boolean>;\n}\n\n/**\n * Information about each callback registered by `RemoteConfigClient.subscribe()`,\n * managed internally by `RemoteConfigClient`.\n */\nexport interface CallbackInfo {\n  id: string;\n  key?: string;\n  deliveryMode: DeliveryMode;\n  callback: RemoteConfigCallback;\n  lastCallback?: Date;\n}\n\n/**\n * Callback used in `RemoteConfigClient.subscribe()`.\n * This function is called when the remote config is fetched.\n */\ntype RemoteConfigCallback = (remoteConfig: RemoteConfig | null, source: Source, lastFetch: Date) => void;\n\nexport interface IRemoteConfigClient {\n  /**\n   * Subscribe for updates to remote config.\n   * Callback is guaranteed to be called at least once,\n   * Whether we are able to fetch a config or not.\n   *\n   * @param key - a string containing a series of period delimited keys to filter the returned config.\n   * Ie, {a: {b: {c: ...}}} would return {b: {c: ...}} for \"a\" or {c: ...} for \"a.b\".\n   * Set to `undefined` to subscribe all keys.\n   * @param deliveryMode - how the initial callback is sent.\n   * @param callback - a block that will be called when remote config is fetched.\n   * @return id - identification of the subscribe and can be used to unsubscribe from updates.\n   */\n  subscribe(key: string | undefined, deliveryMode: DeliveryMode, callback: RemoteConfigCallback): string;\n\n  /**\n   * Unsubscribe a callback from receiving future updates.\n   *\n   * @param id - identification of the callback that you want to unsubscribe.\n   * It's the return value of subscribe().\n   * @return boolean - whether the callback is removed.\n   */\n  unsubscribe(id: string): boolean;\n\n  /**\n   * Request the remote config client to fetch from remote, update cache, and callback.\n   */\n  updateConfigs(): void;\n}\n\nexport class RemoteConfigClient implements IRemoteConfigClient {\n  static readonly CONFIG_GROUP = 'browser';\n\n  readonly apiKey: string;\n  readonly serverUrl: string;\n  readonly logger: ILogger;\n  readonly storage: RemoteConfigStorage;\n  // Registered callbackInfos by subscribe().\n  callbackInfos: CallbackInfo[] = [];\n  // Track the last successful fetch time for throttling (timestamp in milliseconds).\n  lastSuccessfulFetch: number | null = null;\n  // Store the in-flight fetch promise for deduplication.\n  fetchPromise: Promise<RemoteConfigInfo> | null = null;\n\n  constructor(apiKey: string, logger: ILogger, serverZone: ServerZoneType = 'US', serverUrl?: string) {\n    this.apiKey = apiKey;\n    this.serverUrl = serverUrl || (serverZone === 'US' ? US_SERVER_URL : EU_SERVER_URL);\n    this.logger = logger;\n    this.storage = new RemoteConfigLocalStorage(apiKey, logger);\n  }\n\n  subscribe(key: string | undefined, deliveryMode: DeliveryMode, callback: RemoteConfigCallback): string {\n    const id = UUID();\n    const callbackInfo = {\n      id: id,\n      key: key,\n      deliveryMode: deliveryMode,\n      callback: callback,\n    };\n    this.callbackInfos.push(callbackInfo);\n\n    if (deliveryMode === 'all') {\n      void this.subscribeAll(callbackInfo);\n    } else {\n      void this.subscribeWaitForRemote(callbackInfo, deliveryMode.timeout);\n    }\n\n    return id;\n  }\n\n  unsubscribe(id: string): boolean {\n    const index = this.callbackInfos.findIndex((callbackInfo) => callbackInfo.id === id);\n    if (index === -1) {\n      this.logger.debug(`Remote config client unsubscribe failed because callback with id ${id} doesn't exist.`);\n      return false;\n    }\n\n    this.callbackInfos.splice(index, 1);\n    this.logger.debug(`Remote config client unsubscribe succeeded removing callback with id ${id}.`);\n    return true;\n  }\n\n  async updateConfigs() {\n    // Check if we need to throttle based on last successful fetch time\n    if (this.lastSuccessfulFetch) {\n      const timeSinceLastFetch = Date.now() - this.lastSuccessfulFetch;\n      if (timeSinceLastFetch < DEFAULT_MIN_TIME_BETWEEN_FETCHES) {\n        this.logger.debug('Remote config client skipping updateConfigs: Too recent');\n        return;\n      }\n    }\n\n    const result = await this.getOrCreateFetchPromise();\n    void this.storage.setConfig(result);\n    this.callbackInfos.forEach((callbackInfo) => {\n      this.sendCallback(callbackInfo, result, 'remote');\n    });\n  }\n\n  /**\n   * Get the in-flight fetch promise or create a new one.\n   * This ensures multiple subscribe calls share the same network request.\n   */\n  getOrCreateFetchPromise(): Promise<RemoteConfigInfo> {\n    if (this.fetchPromise) {\n      return this.fetchPromise;\n    }\n\n    this.fetchPromise = this.fetch()\n      .then((result) => {\n        // Update last successful fetch time if we got a valid config\n        if (result.remoteConfig !== null) {\n          this.lastSuccessfulFetch = Date.now();\n        }\n        return result;\n      })\n      .finally(() => {\n        // Clear the promise after it settles (success or failure)\n        this.fetchPromise = null;\n      });\n\n    return this.fetchPromise;\n  }\n\n  /**\n   * Send remote first. If it's already complete, we can skip the cached response.\n   * - if remote is fetched first, no cache fetch.\n   * - if cache is fetched first, still fetching remote.\n   */\n  async subscribeAll(callbackInfo: CallbackInfo) {\n    const remotePromise = this.getOrCreateFetchPromise().then((result) => {\n      this.logger.debug(`Remote config client subscription all mode fetched from remote: ${JSON.stringify(result)}`);\n      this.sendCallback(callbackInfo, result, 'remote');\n      void this.storage.setConfig(result);\n    });\n\n    const cachePromise = this.storage.fetchConfig().then((result) => {\n      return result;\n    });\n\n    // Wait for the first result to resolve\n    const result = await Promise.race([remotePromise, cachePromise]);\n\n    // If cache is fetched first, wait for remote.\n    if (result !== undefined) {\n      this.logger.debug(`Remote config client subscription all mode fetched from cache: ${JSON.stringify(result)}`);\n      // Skip sending callback if cache is empty (first time user).\n      if (result.remoteConfig !== null) {\n        this.sendCallback(callbackInfo, result, 'cache');\n      } else {\n        this.logger.debug('Remote config client skips sending callback because cache is empty (first time user).');\n      }\n    }\n    await remotePromise;\n  }\n\n  /**\n   * Waits for a remote response until the given timeout, then return a cached copy, if available.\n   */\n  async subscribeWaitForRemote(callbackInfo: CallbackInfo, timeout: number) {\n    const timeoutPromise = new Promise((_, reject) => {\n      setTimeout(() => {\n        reject('Timeout exceeded');\n      }, timeout);\n    });\n\n    try {\n      const result: RemoteConfigInfo = (await Promise.race([\n        this.getOrCreateFetchPromise(),\n        timeoutPromise,\n      ])) as RemoteConfigInfo;\n\n      this.logger.debug('Remote config client subscription wait for remote mode returns from remote.');\n      this.sendCallback(callbackInfo, result, 'remote');\n      void this.storage.setConfig(result);\n    } catch (error) {\n      this.logger.debug(\n        'Remote config client subscription wait for remote mode exceeded timeout. Try to fetch from cache.',\n      );\n      const result = await this.storage.fetchConfig();\n      if (result.remoteConfig !== null) {\n        this.logger.debug('Remote config client subscription wait for remote mode returns a cached copy.');\n        this.sendCallback(callbackInfo, result, 'cache');\n      } else {\n        this.logger.debug('Remote config client subscription wait for remote mode failed to fetch cache.');\n        this.sendCallback(callbackInfo, result, 'remote');\n      }\n    }\n  }\n\n  /**\n   * Call the callback with filtered remote config based on key.\n   * @param remoteConfigInfo - the whole remote config object without filtering by key.\n   */\n  sendCallback(callbackInfo: CallbackInfo, remoteConfigInfo: RemoteConfigInfo, source: Source) {\n    callbackInfo.lastCallback = new Date();\n\n    let filteredConfig: RemoteConfig | null;\n    if (callbackInfo.key) {\n      // Filter remote config by key.\n      // For example, if remote config is {a: {b: {c: 1}}},\n      // if key = 'a', filter result is {b: {c: 1}};\n      // if key = 'a.b', filter result is {c: 1}\n      filteredConfig = callbackInfo.key.split('.').reduce((config, key) => {\n        if (config === null) {\n          return config;\n        }\n\n        return key in config ? (config[key] as RemoteConfig) : null;\n      }, remoteConfigInfo.remoteConfig);\n    } else {\n      filteredConfig = remoteConfigInfo.remoteConfig;\n    }\n\n    callbackInfo.callback(filteredConfig, source, remoteConfigInfo.lastFetch);\n  }\n\n  /**\n   * Fetch remote config from remote.\n   * @param retries - the number of retries. default is 3.\n   * @param timeout - the timeout in milliseconds. Default is 1000.\n   * This timeout serves two purposes:\n   * 1. It determines how long to wait for each remote config fetch request before aborting it.\n   *    If the fetch does not complete within the specified timeout, the request is cancelled using AbortController,\n   *    and the attempt is considered failed (and may be retried if retries remain).\n   * 2. It is also used to calculate the interval between retries. The total timeout is divided by the number of retries,\n   *    so each retry waits for (timeout / retries) milliseconds before the next attempt (linear backoff).\n   * @returns the remote config info. null if failed to fetch or the response is not valid JSON.\n   */\n  async fetch(retries: number = DEFAULT_MAX_RETRIES, timeout: number = DEFAULT_TIMEOUT): Promise<RemoteConfigInfo> {\n    const interval = timeout / retries;\n    const failedRemoteConfigInfo: RemoteConfigInfo = {\n      remoteConfig: null,\n      lastFetch: new Date(),\n    };\n\n    for (let attempt = 0; attempt < retries; attempt++) {\n      // Create AbortController for request timeout\n      const abortController = new AbortController();\n      const timeoutId = setTimeout(() => abortController.abort(), timeout);\n\n      try {\n        const res = await fetch(this.getUrlParams(), {\n          method: 'GET',\n          headers: {\n            Accept: '*/*',\n          },\n          signal: abortController.signal,\n        });\n\n        // Handle unsuccessful fetch\n        if (!res.ok) {\n          const body = await res.text();\n          this.logger.debug(`Remote config client fetch with retry time ${retries} failed with ${res.status}: ${body}`);\n        } else {\n          // Handle successful fetch\n          const remoteConfig: RemoteConfig = (await res.json()) as RemoteConfig;\n          return {\n            remoteConfig: remoteConfig,\n            lastFetch: new Date(),\n          };\n        }\n      } catch (error) {\n        // Handle rejects when the request fails, for example, a network error or timeout\n        if (error instanceof Error && error.name === 'AbortError') {\n          this.logger.debug(`Remote config client fetch with retry time ${retries} timed out after ${timeout}ms`);\n        } else {\n          this.logger.debug(`Remote config client fetch with retry time ${retries} is rejected because: `, error);\n        }\n      } finally {\n        // Clear the timeout since request completed or failed\n        clearTimeout(timeoutId);\n      }\n\n      // Linear backoff:\n      // wait for the specified interval before the next attempt\n      // except after the last attempt.\n      if (attempt < retries - 1) {\n        await new Promise((resolve) => setTimeout(resolve, this.getJitterDelay(interval)));\n      }\n    }\n\n    return failedRemoteConfigInfo;\n  }\n\n  /**\n   * Return jitter in the bound of [0,baseDelay) and then floor round.\n   */\n  getJitterDelay(baseDelay: number): number {\n    return Math.floor(Math.random() * baseDelay);\n  }\n\n  getUrlParams(): string {\n    // URL encode the API key to handle special characters\n    const encodedApiKey = encodeURIComponent(this.apiKey);\n\n    const urlParams = new URLSearchParams();\n    urlParams.append('config_group', RemoteConfigClient.CONFIG_GROUP);\n\n    return `${this.serverUrl}/${encodedApiKey}?${urlParams.toString()}`;\n  }\n}\n", "import { getGlobalScope } from '../global-scope';\n\ntype ConsoleLogLevel = keyof Console;\ntype Callback = (logLevel: ConsoleLogLevel, args: any[]) => void;\n\nconst globalScope = getGlobalScope();\n/* istanbul ignore next */\nconst originalConsole: any = globalScope?.console;\n\nlet handlers: { [key in ConsoleLogLevel]?: Array<Callback> } = {};\n\n// keeps reference to original console methods\nlet originalFn: { [key in ConsoleLogLevel]?: (...args: any[]) => void } = {};\n\nlet inConsoleOverride = false;\n\nfunction overrideConsole(logLevel: ConsoleLogLevel): boolean {\n  /* istanbul ignore if */\n  if (!originalConsole) {\n    return false;\n  }\n\n  // should not override if original console property is not a function\n  /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access */\n  if (typeof originalConsole[logLevel] !== 'function') {\n    return false;\n  }\n\n  // if console is already overridden, return true\n  if (originalFn[logLevel]) {\n    return true;\n  }\n\n  // override console method\n  const handler = function (...args: any[]) {\n    try {\n      if (handlers[logLevel] && !inConsoleOverride) {\n        // add a re-entrancy guard to prevent infinite recursion\n        inConsoleOverride = true;\n        const callbacks = handlers[logLevel];\n        if (callbacks) {\n          callbacks.forEach((callback) => {\n            try {\n              callback(logLevel, args);\n            } catch {\n              // do nothing\n            }\n          });\n        }\n      }\n    } catch {\n      // do nothing\n    }\n    inConsoleOverride = false;\n    return originalFn[logLevel]!.apply(originalConsole, args);\n  };\n  /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access */\n  originalFn[logLevel] = originalConsole[logLevel] as (...args: any[]) => void;\n  /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access */\n  originalConsole[logLevel] = handler;\n  return true;\n}\n\n/**\n * Observe a console log method (log, warn, error, etc.)\n * @param level - The console log level to observe\n * @param callback - The callback function to call when the console log level is observed\n */\nfunction addListener(level: ConsoleLogLevel, callback: Callback): Error | void {\n  const res = overrideConsole(level);\n\n  /* istanbul ignore if */\n  if (!res) {\n    return new Error('Console override failed');\n  }\n\n  if (handlers[level]) {\n    // using ! is safe because we know the key exists based on condition above\n    handlers[level]!.push(callback);\n  } else {\n    handlers[level] = [callback];\n  }\n}\n\n/**\n * Disconnect a callback function from a console log method\n * @param callback - The callback function to disconnect\n */\nfunction removeListener(callback: Callback) {\n  for (const callbacks of Object.values(handlers)) {\n    // iterate backwards to avoid index shifting\n    for (let i = callbacks.length - 1; i >= 0; i--) {\n      if (callbacks[i] === callback) {\n        callbacks.splice(i, 1);\n        break;\n      }\n    }\n  }\n}\n\n// this should only be used for testing\n// restoring console can break console overrides\nfunction _restoreConsole() {\n  for (const [key, originalHandler] of Object.entries(originalFn)) {\n    if (originalHandler) {\n      /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access */\n      originalConsole[key] = originalHandler;\n    }\n  }\n  originalFn = {};\n  handlers = {};\n}\n\nconst consoleObserver = {\n  addListener,\n  removeListener,\n  _restoreConsole,\n};\n\nexport { consoleObserver, ConsoleLogLevel };\n", "/**\n * @deprecated use ServerZoneType instead\n */\nexport enum ServerZone {\n  US = 'US',\n  EU = 'EU',\n  /**\n   * Add for session-replay-browser migration from analytics-type v1.x.\n   */\n  STAGING = 'STAGING',\n}\n\nexport type ServerZoneType = 'US' | 'EU';\n", "export const OfflineDisabled = null;\n", "import { ILogger } from '../logger';\n\nexport type ActionType = 'click' | 'change';\n\n/**\n * Default CSS selectors to define which elements on the page to track.\n * Extend this list to include additional elements to track. For example:\n * ```\n * autocapturePlugin({\n *    cssSelectorAllowlist: [...DEFAULT_CSS_SELECTOR_ALLOWLIST, \".my-class\"],\n * })\n * ```\n */\nexport const DEFAULT_CSS_SELECTOR_ALLOWLIST = [\n  'a',\n  'button',\n  'input',\n  'select',\n  'textarea',\n  'label',\n  'video',\n  'audio',\n  '[contenteditable=\"true\" i]',\n  '[data-amp-default-track]',\n  '.amp-default-track',\n];\n\n/**\n * Default prefix to allow the plugin to capture data attributes as an event property.\n */\nexport const DEFAULT_DATA_ATTRIBUTE_PREFIX = 'data-amp-track-';\n\n/**\n * Default list of elements on the page should be tracked when the page changes.\n */\nexport const DEFAULT_ACTION_CLICK_ALLOWLIST = ['div', 'span', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\nexport interface ElementInteractionsOptions {\n  /**\n   * List of CSS selectors to allow auto tracking on.\n   * When provided, allow elements matching any selector to be tracked.\n   * Default is ['a', 'button', 'input', 'select', 'textarea', 'label', '[data-amp-default-track]', '.amp-default-track'].\n   */\n  cssSelectorAllowlist?: string[];\n\n  /**\n   * List of page URLs to allow auto tracking on.\n   * When provided, only allow tracking on these URLs.\n   * Both full URLs and regex are supported.\n   */\n  pageUrlAllowlist?: (string | RegExp)[];\n\n  /**\n   * List of page URLs to exclude from auto tracking.\n   * When provided, tracking will be blocked on these URLs.\n   * Both full URLs and regex are supported.\n   * This takes precedence over pageUrlAllowlist.\n   */\n  pageUrlExcludelist?: (RegExp | string | { pattern: string })[];\n\n  /**\n   * Function to determine whether an event should be tracked.\n   * When provided, this function overwrites all other allowlists and configurations.\n   * If the function returns true, the event will be tracked.\n   * If the function returns false, the event will not be tracked.\n   * @param actionType - The type of action that triggered the event.\n   * @param element - The [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) that triggered the event.\n   */\n  shouldTrackEventResolver?: (actionType: ActionType, element: DomElement) => boolean;\n\n  /**\n   * Prefix for data attributes to allow auto collecting.\n   * Default is 'data-amp-track-'.\n   */\n  dataAttributePrefix?: string;\n\n  /**\n   * Options for integrating visual tagging selector.\n   */\n  visualTaggingOptions?: {\n    enabled?: boolean;\n    messenger?: Messenger;\n  };\n\n  /**\n   * This has been deprecated in favor of rage clicks tracking\n   * via frustrationInteractions.\n   *\n   * Setting this will have no effect.\n   *\n   * @deprecated\n   */\n  debounceTime?: number;\n\n  /**\n   * CSS selector allowlist for tracking clicks that result in a DOM change/navigation on elements not already allowed by the cssSelectorAllowlist\n   */\n  actionClickAllowlist?: string[];\n\n  /**\n   * Remote config for page actions\n   */\n  pageActions?: {\n    triggers: Trigger[];\n    labeledEvents: Record<string, LabeledEvent>;\n  };\n\n  /**\n   * RegExp pattern list to allow custom patterns for text masking\n   */\n  maskTextRegex?: (RegExp | { pattern: string; description: string })[];\n}\n\ntype MatchingCondition = {\n  type: 'LABELED_EVENT';\n  match: {\n    eventId: string;\n  };\n};\n\nexport type Trigger = {\n  id: string;\n  name: string; // Human friendly name for the trigger\n  conditions: MatchingCondition[]; // Configures when the actions should be executed; AND\n  actions: Array<PageAction | string>; // Actions to execute if conditions are met\n};\n\nexport type PageAction = {\n  id: string;\n  actionType: 'ATTACH_EVENT_PROPERTY';\n  dataSource: DataSource; // Defines where and how to get the data\n  destinationKey: string; // Property key name for the data (e.g. event property name, data layer key, user property name)\n};\n\nexport type DataSource = {\n  sourceType: 'DOM_ELEMENT' | 'PAGE_CONTEXT'; // | 'URL' ;\n} & (\n  | {\n      sourceType: 'DOM_ELEMENT';\n      selector?: string; // For DOM_ELEMENT: CSS selector for the target element\n      elementExtractType: 'TEXT' | 'ATTRIBUTE';\n      attribute?: string; // For DOM_ELEMENT: Attribute name to extract (null/empty for text content)\n      scope?: string; // CSS selector for the scope of the element, document by default\n    }\n  | {\n      sourceType: 'PAGE_CONTEXT';\n      propertyPath: string; // For PAGE_CONTEXT: e.g., 'document.title'\n    }\n);\n\nexport type EventSubpropKey = '[Amplitude] Element Text' | '[Amplitude] Element Hierarchy';\n\nexport type Filter = {\n  subprop_key: EventSubpropKey;\n  subprop_op: string; // exact, autotrack css match\n  subprop_value: string[];\n};\n\nexport type LabeledEvent = {\n  id: string;\n  definition: {\n    event_type: '[Amplitude] Element Clicked' | '[Amplitude] Element Changed';\n    filters: Filter[];\n  }[];\n};\n\nexport interface Messenger {\n  logger?: ILogger;\n  setup: () => void;\n}\n\n// DomElement is [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) if the dom library is included in tsconfig.json\n// and never if it is not included\n// eslint-disable-next-line no-restricted-globals\ntype DomElement = typeof globalThis extends {\n  Element: new (...args: any) => infer T;\n}\n  ? T\n  : never;\n", "import { ActionType } from './element-interactions';\n\n/**\n * Configuration options for dead clicks tracking\n */\nexport interface DeadClickOptions {\n  /**\n   * CSS selectors to define which elements on the page to track for dead clicks.\n   * A dead click is a click that doesn't result in any visible change or navigation.\n   */\n  cssSelectorAllowlist?: string[];\n}\n\n/**\n * Configuration options for rage clicks tracking\n */\nexport interface RageClickOptions {\n  /**\n   * CSS selectors to define which elements on the page to track for rage clicks.\n   * A rage click is multiple rapid clicks on the same element within a 3s time window.\n   */\n  cssSelectorAllowlist?: string[];\n}\n\n/**\n * Configuration options for error clicks tracking\n */\nexport interface ErrorClickOptions {\n  /**\n   * CSS selectors to define which elements on the page to track for error clicks.\n   * An error click is a click that results in an error.\n   */\n  cssSelectorAllowlist?: string[];\n}\n\n/**\n * Configuration options for frustration interactions tracking.\n * This includes dead clicks and rage clicks tracking.\n */\nexport interface FrustrationInteractionsOptions {\n  /**\n   * List of page URLs to allow auto tracking on.\n   * When provided, only allow tracking on these URLs.\n   * Both full URLs and regex are supported.\n   */\n  pageUrlAllowlist?: (string | RegExp)[];\n\n  /**\n   * List of page URLs to exclude from auto tracking.\n   * When provided, tracking will be blocked on these URLs.\n   * Both full URLs and regex are supported.\n   * This takes precedence over pageUrlAllowlist.\n   */\n  pageUrlExcludelist?: (string | RegExp)[];\n\n  /**\n   * Function to determine whether an event should be tracked.\n   * When provided, this function overwrites all other allowlists and configurations.\n   * If the function returns true, the event will be tracked.\n   * If the function returns false, the event will not be tracked.\n   * @param actionType - The type of action that triggered the event.\n   * @param element - The [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) that triggered the event.\n   */\n  shouldTrackEventResolver?: (actionType: ActionType, element: DomElement) => boolean;\n\n  /**\n   * Prefix for data attributes to allow auto collecting.\n   * Default is 'data-amp-track-'.\n   */\n  dataAttributePrefix?: string;\n\n  /**\n   * Configuration for dead clicks tracking.\n   * Set to `false` to disable dead click tracking.\n   * Set to `true` or an options object to enable with default or custom settings.\n   */\n  deadClicks?: boolean | DeadClickOptions;\n\n  /**\n   * Configuration for rage clicks tracking.\n   * Set to `false` to disable rage click tracking.\n   * Set to `true` or an options object to enable with default or custom settings.\n   */\n  rageClicks?: boolean | RageClickOptions;\n\n  /**\n   * Configuration for error clicks tracking\n   * @experimental this feature is experimental and may not be stable\n   */\n  errorClicks?: boolean | ErrorClickOptions;\n\n  /**\n   * RegExp pattern list to allow custom patterns for text masking\n   */\n  maskTextRegex?: (RegExp | { pattern: string; description: string })[];\n}\n\nconst CLICKABLE_ELEMENT_SELECTORS = [\n  'a',\n  'button',\n  '[role=\"button\"]',\n  '[role=\"link\"]',\n  '[role=\"menuitem\"]',\n  '[role=\"menuitemcheckbox\"]',\n  '[role=\"menuitemradio\"]',\n  '[role=\"option\"]',\n  '[role=\"tab\"]',\n  '[role=\"treeitem\"]',\n  '[contenteditable=\"true\" i]',\n];\n\nconst DEFAULT_ERROR_AND_DEAD_CLICK_ALLOWLIST = [\n  'input[type=\"button\"]',\n  'input[type=\"submit\"]',\n  'input[type=\"reset\"]',\n  'input[type=\"image\"]',\n  'input[type=\"file\"]',\n  ...CLICKABLE_ELEMENT_SELECTORS,\n];\n\n/**\n * Default CSS selectors for dead clicks tracking\n */\nexport const DEFAULT_DEAD_CLICK_ALLOWLIST = DEFAULT_ERROR_AND_DEAD_CLICK_ALLOWLIST;\n\n/**\n * Default CSS selectors for error tracking\n */\nexport const DEFAULT_ERROR_CLICK_ALLOWLIST = DEFAULT_ERROR_AND_DEAD_CLICK_ALLOWLIST;\n\n/**\n * Default CSS selectors for rage clicks tracking\n */\nexport const DEFAULT_RAGE_CLICK_ALLOWLIST = ['*'];\n\n/**\n * Default time window for dead clicks (3 seconds)\n */\nexport const DEFAULT_DEAD_CLICK_WINDOW_MS = 3_000;\n\n/**\n * Default time window for rage clicks (1 second)\n */\nexport const DEFAULT_RAGE_CLICK_WINDOW_MS = 1_000;\n\n/**\n * Default threshold for rage clicks (4 clicks)\n */\nexport const DEFAULT_RAGE_CLICK_THRESHOLD = 4;\n\n/**\n * Default threshold for rage clicks to be considered out of bounds (50 pixels)\n */\nexport const DEFAULT_RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD = 50; // pixels\n\n// DomElement is [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) if the dom library is included in tsconfig.json\n// and never if it is not included\n// eslint-disable-next-line no-restricted-globals\ntype DomElement = typeof globalThis extends {\n  Element: new (...args: any) => infer T;\n}\n  ? T\n  : never;\n", "type Json = Record<string, any>;\n\nfunction isJsonPrimitive(json?: Json): boolean {\n  return (\n    typeof json === 'string' ||\n    typeof json === 'number' ||\n    typeof json === 'boolean' ||\n    json === null ||\n    json === undefined\n  );\n}\n\n/**\n * Prune a JSON object to only include the keys in the allowlist and excludes the keys\n * in the exclude list.\n *\n * This function is a mutative function that will modify the original JSON object.\n * This is done to avoid creating a new JSON object and copying the data.\n *\n * @param json - The JSON object to prune.\n * @param allowlist - The keys to include in the pruned JSON object.\n * @param excludelist - The keys to exclude from the pruned JSON object.\n */\nexport function pruneJson(json: Json | null | undefined, allowlist: string[], excludelist: string[]) {\n  if (!json) return;\n  // tokenize the allowlist and excludelist\n  const allowlistTokens = allowlist.map(tokenizeJsonPath);\n  const excludelistTokens = excludelist.map(tokenizeJsonPath);\n\n  _pruneJson({\n    json,\n    allowlist: allowlistTokens,\n    excludelist: excludelistTokens,\n    ancestors: [],\n  });\n}\n\nexport function _pruneJson({\n  json,\n  targetObject,\n  allowlist,\n  excludelist,\n  ancestors,\n  parentObject,\n  targetKey,\n}: {\n  json: Json;\n  targetObject?: Json;\n  allowlist: string[][];\n  excludelist: string[][];\n  ancestors: string[];\n  parentObject?: Json;\n  targetKey?: string;\n}) {\n  if (!targetObject) {\n    targetObject = json;\n  }\n\n  const keys = Object.keys(targetObject);\n  for (const key of keys) {\n    const path = [...ancestors, key];\n    if (isJsonPrimitive(targetObject[key] as Json)) {\n      // if the value does not match allowlist or matches exclude list, delete it\n      if (!hasPathMatchInList(path, allowlist) || hasPathMatchInList(path, excludelist)) {\n        delete targetObject[key];\n      }\n    } else {\n      _pruneJson({\n        json,\n        targetObject: targetObject[key] as Json,\n        allowlist,\n        excludelist,\n        ancestors: path,\n        parentObject: targetObject,\n        targetKey: key,\n      });\n    }\n  }\n\n  // if this object is empty now, delete the whole object\n  if (Object.keys(targetObject).length === 0 && parentObject && targetKey) {\n    delete parentObject[targetKey];\n  }\n}\n\n/**\n * Tokenize a JSON path string into an array of strings.\n * Escapes ~0 and ~1 to ~ and / respectively.\n *\n * e.g.) turns string \"a/b/c\" into [\"a\", \"b\", \"c\"]\n *\n * @param path - The JSON path to tokenize.\n * @returns The tokenized JSON path.\n */\nexport function tokenizeJsonPath(path: string): string[] {\n  if (path.startsWith('/')) {\n    path = path.slice(1);\n  }\n  return path.split('/').map((token) => token.replace(/~0/g, '~').replace(/~1/g, '/'));\n}\n\n/**\n * Check if a JSON path matches a path matcher.\n *\n * Rules:\n * 1. If a key in a path and a matcher are the same, then they match, move to the next\n * 2. If the matcher is a *, then it matches the key, move to the next\n * 3. If the matcher is a **, then it matches >=0 keys\n *\n * @param path - The path to check.\n * @param pathMatcher - The path matcher to check against.\n * @param i - The current index of the path.\n * @param j - The current index of the path matcher.\n * @returns True if the path matches the path matcher, false otherwise.\n */\nexport function isPathMatch(path: string[], pathMatcher: string[], i = 0, j = 0): boolean {\n  if (j === pathMatcher.length) {\n    return i === path.length;\n  }\n\n  if (i === path.length) {\n    while (j < pathMatcher.length && pathMatcher[j] === '**') {\n      j++;\n    }\n    return j === pathMatcher.length;\n  }\n\n  const currentMatcher = pathMatcher[j];\n\n  if (currentMatcher === '**') {\n    if (j + 1 === pathMatcher.length) {\n      return true;\n    }\n    for (let k = i; k <= path.length; k++) {\n      if (isPathMatch(path, pathMatcher, k, j + 1)) {\n        return true;\n      }\n    }\n    return false;\n  } else if (currentMatcher === '*' || currentMatcher === path[i]) {\n    return isPathMatch(path, pathMatcher, i + 1, j + 1);\n  } else {\n    return false;\n  }\n}\n\n/**\n * Check if a JSON path matches any of the path matchers in the allow or exclude list.\n *\n * @param path - The JSON path to check.\n * @param allowOrExcludeList - The allow or exclude list to check against.\n * @returns True if the path matches any of the path matchers in the allow or exclude list, false otherwise.\n */\nfunction hasPathMatchInList(path: string[], allowOrExcludeList: string[][]): boolean {\n  return allowOrExcludeList.some((l) => isPathMatch(path, l));\n}\n", "import { getGlobalScope } from './global-scope';\nimport { pruneJson } from './utils/json-query';\nimport { SAFE_HEADERS, FORBIDDEN_HEADERS } from './';\n\n/* SAFE TYPE DEFINITIONS\n  These type definitions expose limited properties of the original types\n  to prevent the consumer from mutating them or consuming them.\n*/\ntype BlobSafe = {\n  size: number;\n};\n\ntype ArrayBufferSafe = {\n  byteLength: number;\n};\n\ntype ArrayBufferViewSafe = {\n  byteLength: number;\n};\n\ntype URLSearchParamsSafe = {\n  toString(): string;\n};\n\n// no method on readablestream is safe to call\ntype ReadableStreamSafe = Record<string, never>;\n\ntype FormDataEntryValueSafe = string | BlobSafe | null;\n\ntype BodyInitSafe =\n  | string\n  | Blob\n  | ArrayBufferSafe\n  | FormDataSafe\n  | URLSearchParamsSafe\n  | ArrayBufferViewSafe\n  | null\n  | undefined;\n\ntype HeadersRequestSafe = {\n  entries(): IterableIterator<[string, string]>;\n  forEach(callbackfn: (value: string, key: string) => void): void;\n};\n\ntype HeadersResponseSafe = {\n  get(name: string): string | null;\n  forEach(callbackfn: (value: string, key: string) => void): void;\n};\n\ntype HeadersInitSafe = HeadersRequestSafe | Record<string, string> | string[][];\n\ntype ResponseSafe = {\n  status: number;\n  headers: HeadersResponseSafe | undefined;\n  clone(): ResponseCloneSafe;\n};\n\ntype ResponseCloneSafe = {\n  text(): Promise<string>;\n};\n\nconst TEXT_READ_TIMEOUT = 500;\n\nexport type RequestInitSafe = {\n  method?: string;\n  headers?: HeadersInitSafe;\n  body?: BodyInitSafe;\n};\nexport interface FormDataSafe {\n  entries(): IterableIterator<[string, FormDataEntryValueSafe]>;\n}\nexport type XMLHttpRequestBodyInitSafe = BlobSafe | FormDataSafe | URLSearchParamsSafe | string;\n\nexport type FetchRequestBody =\n  | string\n  | BlobSafe\n  | ArrayBufferSafe\n  | FormDataSafe\n  | URLSearchParamsSafe\n  | ArrayBufferViewSafe\n  | null\n  | undefined;\n\nexport interface IRequestWrapper {\n  /**\n   * Get the headers of the request.\n   * @param allow - The headers to allow.\n   * @returns The pruned headers\n   */\n  headers(allow?: string[]): Record<string, string> | undefined;\n  bodySize?: number;\n  method?: string;\n  body?: FetchRequestBody | XMLHttpRequestBodyInitSafe | null;\n  json: (allow?: string[], exclude?: string[]) => Promise<JsonObject | null>;\n}\n\nexport const MAXIMUM_ENTRIES = 100;\n\n/**\n * This class encapsulates the RequestInit (https://developer.mozilla.org/en-US/docs/Web/API/RequestInit)\n * object so that the consumer can only get access to the headers, method and body size.\n *\n * This is to prevent consumers from directly accessing the Request object\n * and mutating it or running costly operations on it.\n *\n * IMPORTANT:\n *    * Do not make changes to this class without careful consideration\n *      of performance implications, memory usage and potential to mutate the customer's\n *      request.\n *   * NEVER .clone() the RequestInit object. This will 2x's the memory overhead of the request\n *   * NEVER: call .arrayBuffer(), text(), json() or any other method on the body that\n *     consumes the body's stream. This will cause the response to be consumed\n *     meaning the body will be empty when the customer tries to access it.\n *     (ie: if the body is an instanceof https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n *      never call any of the methods on it)\n */\nexport class RequestWrapperFetch implements IRequestWrapper {\n  private _bodySize: number | undefined;\n  constructor(private request: RequestInitSafe) {}\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    const headersUnsafe = this.request.headers;\n\n    // copy the headers into a new object\n    const headersSafeCopy: Record<string, string> = {};\n    if (Array.isArray(headersUnsafe)) {\n      headersUnsafe.forEach(([headerName, headerValue]) => {\n        headersSafeCopy[headerName] = headerValue;\n      });\n    } else if (headersUnsafe instanceof Headers) {\n      headersUnsafe.forEach((value: string, key: string) => {\n        headersSafeCopy[key] = value;\n      });\n    } else if (typeof headersUnsafe === 'object' && headersUnsafe !== null) {\n      for (const [key, value] of Object.entries(headersUnsafe as Record<string, string>)) {\n        headersSafeCopy[key] = value;\n      }\n    }\n\n    return pruneHeaders(headersSafeCopy, { allow });\n  }\n\n  get bodySize(): number | undefined {\n    if (typeof this._bodySize === 'number') return this._bodySize;\n    const global = getGlobalScope();\n\n    /* istanbul ignore if */\n    if (!global?.TextEncoder) {\n      return;\n    }\n    const body = this.request.body as FetchRequestBody;\n    this._bodySize = getBodySize(body, MAXIMUM_ENTRIES);\n    return this._bodySize;\n  }\n\n  get method(): string | undefined {\n    return this.request.method;\n  }\n\n  get body(): string | null {\n    if (typeof this.request.body === 'string') {\n      return this.request.body;\n    }\n    return null;\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const text = this.body;\n    return safeParseAndPruneBody(text, allow, exclude);\n  }\n}\n\nexport class RequestWrapperXhr implements IRequestWrapper {\n  constructor(readonly bodyRaw: XMLHttpRequestBodyInitSafe | null, readonly requestHeaders: Record<string, string>) {}\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    return pruneHeaders(this.requestHeaders, { allow });\n  }\n\n  get bodySize(): number | undefined {\n    return getBodySize(this.bodyRaw as FetchRequestBody, MAXIMUM_ENTRIES);\n  }\n\n  get body(): string | null {\n    if (typeof this.bodyRaw === 'string') {\n      return this.bodyRaw;\n    }\n    return null;\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const text = this.body;\n    return safeParseAndPruneBody(text, allow, exclude);\n  }\n}\n\nfunction getBodySize(bodyUnsafe: FetchRequestBody, maxEntries: number): number | undefined {\n  let bodySize: number | undefined;\n  const global = getGlobalScope();\n  /* istanbul ignore next */\n  const TextEncoder = global?.TextEncoder;\n  /* istanbul ignore next */\n  if (!TextEncoder) {\n    return;\n  }\n  let bodySafe;\n  if (typeof bodyUnsafe === 'string') {\n    bodySafe = bodyUnsafe;\n    bodySize = new TextEncoder().encode(bodySafe).length;\n  } else if (bodyUnsafe instanceof Blob) {\n    bodySafe = bodyUnsafe as BlobSafe;\n    bodySize = bodySafe.size;\n  } else if (bodyUnsafe instanceof URLSearchParams) {\n    bodySafe = bodyUnsafe as URLSearchParamsSafe;\n    bodySize = new TextEncoder().encode(bodySafe.toString()).length;\n  } else if (ArrayBuffer.isView(bodyUnsafe)) {\n    bodySafe = bodyUnsafe as ArrayBufferViewSafe;\n    bodySize = bodySafe.byteLength;\n  } else if (bodyUnsafe instanceof ArrayBuffer) {\n    bodySafe = bodyUnsafe as ArrayBufferSafe;\n    bodySize = bodySafe.byteLength;\n  } else if (bodyUnsafe instanceof FormData) {\n    // Estimating only for text parts; not accurate for files\n    const formData = bodyUnsafe as unknown as FormDataSafe;\n\n    let total = 0;\n    let count = 0;\n    for (const [key, value] of formData.entries()) {\n      total += key.length;\n      if (typeof value === 'string') {\n        total += new TextEncoder().encode(value).length;\n      } else if (value instanceof Blob) {\n        total += value.size;\n      } else {\n        // encountered an unknown type\n        // we can't estimate the size of this entry\n        return;\n      }\n      // terminate if we reach the maximum number of entries\n      // to avoid performance issues in case of very large FormData\n      if (++count >= maxEntries) {\n        return;\n      }\n    }\n    bodySize = total;\n  } else if (bodyUnsafe instanceof ReadableStream) {\n    // If bodyUnsafe is an instanceof ReadableStream, we can't determine the size,\n    // without consuming it, so we return undefined.\n    // Never ever consume ReadableStream! DO NOT DO IT!!!\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    bodySafe = bodyUnsafe as unknown as ReadableStreamSafe;\n    return;\n  }\n  return bodySize;\n}\n\nexport type JsonObject = {\n  [key: string]: JsonValue;\n};\n\nexport type JsonValue = string | number | boolean | null | JsonObject | JsonArray;\n\nexport type JsonArray = Array<JsonValue>;\n\nexport interface IResponseWrapper {\n  /**\n   * Get the headers of the response.\n   * @param allow - The headers to allow.\n   * @returns The pruned headers\n   */\n  headers(allow?: string[]): Record<string, string> | undefined;\n  bodySize?: number;\n  status?: number;\n  body?: string | Blob | ReadableStream | ArrayBuffer | FormDataSafe | URLSearchParams | ArrayBufferView | null;\n  json: (allow?: string[], exclude?: string[]) => Promise<JsonObject | null>;\n}\n\n/**\n * This class encapsulates the Fetch API Response object\n * (https://developer.mozilla.org/en-US/docs/Web/API/Response) so that the consumer can\n * only get access to the headers and body size.\n *\n * This is to prevent consumers from directly accessing the Response object\n * and mutating it or running costly operations on it.\n *\n * IMPORTANT:\n *   * Do not make changes to this class without careful consideration\n *     of performance implications, memory usage and potential to mutate the customer's\n *     response.\n *   * Do not .clone() the Response object unless you need to access the body.\n *     Cloning will 2x the memory overhead of the response.\n *   * NEVER consume the body's stream. This will cause the response to be consumed\n *     meaning the body will be empty when the customer tries to access it.\n *     (ie: if the body is an instanceof https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n *      never call any of the methods on it)\n */\nexport class ResponseWrapperFetch implements IResponseWrapper {\n  private _bodySize: number | undefined;\n  private clonedResponse?: ResponseCloneSafe;\n  constructor(private response: ResponseSafe) {}\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    if (this.response.headers instanceof Headers) {\n      const headersSafe = this.response.headers as HeadersResponseSafe;\n      const headersOut: Record<string, string> = {};\n      /* istanbul ignore next */\n      headersSafe?.forEach?.((value, key) => {\n        headersOut[key] = value;\n      });\n      return pruneHeaders(headersOut, { allow });\n    }\n\n    return;\n  }\n\n  get bodySize(): number | undefined {\n    if (this._bodySize !== undefined) return this._bodySize;\n    /* istanbul ignore next */\n    const contentLength = this.response.headers?.get?.('content-length');\n    const bodySize = contentLength ? parseInt(contentLength, 10) : undefined;\n    this._bodySize = bodySize;\n    return bodySize;\n  }\n\n  get status(): number {\n    return this.response.status;\n  }\n\n  async text(): Promise<string | null> {\n    // !!!IMPORTANT: we clone the response to avoid mutating the original response\n    // never call .text(), .json(), etc.. on the original response always clone it first\n    if (!this.clonedResponse) {\n      this.clonedResponse = this.response.clone();\n    }\n    try {\n      const textPromise = this.clonedResponse.text();\n      const timer = new Promise<null>((resolve) =>\n        setTimeout(\n          /* istanbul ignore next */\n          () => resolve(null),\n          TEXT_READ_TIMEOUT,\n        ),\n      );\n      const text = await Promise.race<string | null>([textPromise, timer]);\n      return text;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const text = await this.text();\n    return safeParseAndPruneBody(text, allow, exclude);\n  }\n}\n\nexport class ResponseWrapperXhr implements IResponseWrapper {\n  constructor(\n    readonly statusCode: number,\n    readonly headersString: string,\n    readonly size: number | undefined,\n    readonly getJson: () => any | null,\n  ) {}\n\n  get bodySize(): number | undefined {\n    return this.size;\n  }\n\n  get status(): number {\n    return this.statusCode;\n  }\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    if (!this.headersString) {\n      return {};\n    }\n    const headers: Record<string, string> = {};\n    const headerLines = this.headersString.split('\\r\\n');\n    for (const line of headerLines) {\n      const [key, value] = line.split(': ');\n      if (key && value) {\n        headers[key] = value;\n      }\n    }\n    return pruneHeaders(headers, { allow });\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const jsonBody = this.getJson() as JsonObject | null;\n    if (jsonBody) {\n      pruneJson(jsonBody, allow, exclude);\n      return jsonBody;\n    }\n    return null;\n  }\n}\n\nfunction safeParseAndPruneBody(text: string | null, allow: string[], exclude: string[]): JsonObject | null {\n  if (!text) return null;\n  try {\n    const json = JSON.parse(text) as JsonObject;\n    pruneJson(json, allow, exclude);\n    return json;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport enum PRUNE_STRATEGY {\n  REDACT = 'redact',\n  REMOVE = 'remove',\n}\n\nconst REDACTED_VALUE = '[REDACTED]';\n\n/**\n * Prune headers from a headers record object.\n * @param headers - The headers to prune.\n * @param options - The options to prune the headers.\n * @param options.exclude - List of headers to delete from headers\n * @param options.include - List of headers to keep in headers, if not provided, all headers are kept by default\n * @returns The pruned headers.\n */\nexport const pruneHeaders = (\n  headers: Record<string, string>,\n  options: {\n    allow?: string[];\n    strategy?: PRUNE_STRATEGY;\n  },\n): Record<string, string> => {\n  const { allow = [], strategy = PRUNE_STRATEGY.REMOVE } = options;\n  const exclude = [...FORBIDDEN_HEADERS];\n  const headersPruned: Record<string, string> = {};\n\n  for (const key of Object.keys(headers)) {\n    const lowerKey = key.toLowerCase();\n\n    if (exclude.find((e) => e.toLowerCase() === lowerKey)) {\n      if (strategy === PRUNE_STRATEGY.REDACT) {\n        headersPruned[key] = REDACTED_VALUE;\n      }\n    } else if (!allow.find((i) => i.toLowerCase() === lowerKey)) {\n      if (strategy === PRUNE_STRATEGY.REDACT) {\n        headersPruned[key] = REDACTED_VALUE;\n      }\n    } else {\n      headersPruned[key] = headers[key];\n    }\n  }\n  return headersPruned;\n};\nexport class NetworkRequestEvent {\n  public requestHeaders?: Record<string, string>;\n  public responseHeaders?: Record<string, string>;\n  public requestBodyJson?: Promise<JsonObject | null>;\n  public responseBodyJson?: Promise<JsonObject | null>;\n  constructor(\n    public readonly type: 'xhr' | 'fetch',\n    public readonly method: string,\n    public readonly timestamp: number,\n    public readonly startTime: number,\n    public readonly url?: string,\n    public readonly requestWrapper?: IRequestWrapper,\n    public readonly status: number = 0,\n    public readonly duration?: number,\n    public readonly responseWrapper?: IResponseWrapper,\n    public readonly error?: {\n      name: string;\n      message: string;\n    },\n    public readonly endTime?: number,\n  ) {}\n\n  toSerializable(): Record<string, any> {\n    const serialized: Record<string, any> = {\n      type: this.type,\n      method: this.method,\n      url: this.url,\n      timestamp: this.timestamp,\n      status: this.status,\n      duration: this.duration,\n      error: this.error,\n      startTime: this.startTime,\n      endTime: this.endTime,\n      requestHeaders: this.requestWrapper?.headers([...SAFE_HEADERS]),\n      requestBodySize: this.requestWrapper?.bodySize,\n      responseHeaders: this.responseWrapper?.headers([...SAFE_HEADERS]),\n      responseBodySize: this.responseWrapper?.bodySize,\n    };\n\n    return Object.fromEntries(Object.entries(serialized).filter(([_, v]) => v !== undefined));\n  }\n}\n", "import { getGlobalScope } from '..';\nimport { UUID } from '../utils/uuid';\nimport { ILogger } from '../logger';\nimport {\n  IRequestWrapper,\n  NetworkRequestEvent,\n  RequestWrapperFetch,\n  ResponseWrapperFetch,\n  RequestWrapperXhr,\n  ResponseWrapperXhr,\n  IResponseWrapper,\n  RequestInitSafe,\n  XMLHttpRequestBodyInitSafe,\n} from '../network-request-event';\n\n// object that is added to each XHR instance so\n// that info can be set in xhr.open and retrieved in xhr.send\ntype AmplitudeAnalyticsEvent = {\n  method: string;\n  url: string | URL;\n  startTime: number;\n  durationStart: number;\n  status?: number;\n  headers: Record<string, string>;\n};\n\n/**\n * Typeguard function checks if an input is a Request object.\n */\nfunction isRequest(requestInfo: any): requestInfo is Request {\n  return typeof requestInfo === 'object' && requestInfo !== null && 'url' in requestInfo && 'method' in requestInfo;\n}\n\nexport type NetworkEventCallbackFn = (event: NetworkRequestEvent) => void;\n\nexport class NetworkEventCallback {\n  constructor(public readonly callback: (event: NetworkRequestEvent) => void, public readonly id: string = UUID()) {}\n}\n\ntype RequestUrlAndMethod = {\n  url: string | URL | undefined;\n  method: string | undefined;\n};\n\n// A narrowed down [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) type\n// that only includes the properties we need to access and adds the $$AmplitudeAnalyticsEvent property\n// Use great care when modifying this type, make sure you only use read-only properties and only add\n// what you need to access, nothing more.\ntype AmplitudeXMLHttpRequestSafe = {\n  $$AmplitudeAnalyticsEvent: AmplitudeAnalyticsEvent;\n  status: number;\n  responseText: string;\n  responseType: XMLHttpRequestResponseType;\n  getAllResponseHeaders: typeof XMLHttpRequest.prototype.getAllResponseHeaders;\n  getResponseHeader: typeof XMLHttpRequest.prototype.getResponseHeader;\n  addEventListener: (type: 'loadend', listener: () => void) => void;\n};\n\nexport class NetworkObserver {\n  private eventCallbacks: Map<string, NetworkEventCallback> = new Map();\n  // eslint-disable-next-line no-restricted-globals\n  private globalScope?: typeof globalThis;\n  private logger?: ILogger;\n  private isObserving = false;\n  constructor(logger?: ILogger) {\n    this.logger = logger;\n    const globalScope = getGlobalScope();\n    if (!NetworkObserver.isSupported()) {\n      /* istanbul ignore next */\n      return;\n    }\n    this.globalScope = globalScope;\n  }\n\n  static isSupported(): boolean {\n    const globalScope = getGlobalScope();\n    return !!globalScope && !!globalScope.fetch;\n  }\n\n  subscribe(eventCallback: NetworkEventCallback, logger?: ILogger) {\n    if (!this.logger) {\n      this.logger = logger;\n    }\n    this.eventCallbacks.set(eventCallback.id, eventCallback);\n    if (!this.isObserving) {\n      /* istanbul ignore next */\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      const originalXhrOpen = this.globalScope?.XMLHttpRequest?.prototype?.open;\n      /* istanbul ignore next */\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      const originalXhrSend = this.globalScope?.XMLHttpRequest?.prototype?.send;\n      /* istanbul ignore next */\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      const originalXhrSetRequestHeader = this.globalScope?.XMLHttpRequest?.prototype?.setRequestHeader;\n      if (originalXhrOpen && originalXhrSend && originalXhrSetRequestHeader) {\n        this.observeXhr(originalXhrOpen, originalXhrSend, originalXhrSetRequestHeader);\n      }\n\n      /* istanbul ignore next */\n      const originalFetch = this.globalScope?.fetch;\n      /* istanbul ignore next */\n      if (originalFetch) {\n        this.observeFetch(originalFetch);\n      }\n\n      /* istanbul ignore next */\n      this.isObserving = true;\n    }\n  }\n\n  unsubscribe(eventCallback: NetworkEventCallback) {\n    this.eventCallbacks.delete(eventCallback.id);\n  }\n\n  protected triggerEventCallbacks(event: NetworkRequestEvent) {\n    this.eventCallbacks.forEach((callback) => {\n      try {\n        callback.callback(event);\n      } catch (err) {\n        // if the callback throws an error, we should catch it\n        // to avoid breaking the fetch promise chain\n        /* istanbul ignore next */\n        this.logger?.debug('an unexpected error occurred while triggering event callbacks', err);\n      }\n    });\n  }\n\n  handleNetworkRequestEvent(\n    requestType: 'fetch' | 'xhr',\n    requestInfo: RequestInfo | URL | RequestUrlAndMethod | undefined,\n    requestWrapper: IRequestWrapper | undefined,\n    responseWrapper: IResponseWrapper | undefined,\n    typedError: Error | undefined,\n    startTime?: number,\n    durationStart?: number,\n  ) {\n    /* istanbul ignore next */\n    if (startTime === undefined || durationStart === undefined) {\n      // if we reach this point, it means that the performance API is not supported\n      // so we can't construct a NetworkRequestEvent\n      return;\n    }\n\n    // parse the URL and Method\n    let url: string | undefined;\n    let method = 'GET';\n    if (isRequest(requestInfo)) {\n      url = requestInfo['url'];\n      method = requestInfo['method'];\n    } else {\n      url = requestInfo?.toString?.();\n    }\n\n    // strip basic auth from the URL\n    if (url) {\n      try {\n        const parsedUrl = new URL(url);\n        // reconstruct the URL without the basic auth\n        url = `${parsedUrl.protocol}//${parsedUrl.host}${parsedUrl.pathname}${parsedUrl.search}${parsedUrl.hash}`;\n        // eslint-disable-next-line no-empty\n      } catch (err) {}\n    }\n    method = requestWrapper?.method || method;\n\n    let status, error;\n    if (responseWrapper) {\n      status = responseWrapper.status;\n    }\n\n    if (typedError) {\n      error = {\n        name: typedError.name || 'UnknownError',\n        message: typedError.message || 'An unknown error occurred',\n      };\n      status = 0;\n    }\n\n    const duration = Math.floor(performance.now() - durationStart);\n    const endTime = Math.floor(startTime + duration);\n\n    const requestEvent = new NetworkRequestEvent(\n      requestType,\n      method,\n      startTime, // timestamp and startTime are aliases\n      startTime,\n      url,\n      requestWrapper,\n      status,\n      duration,\n      responseWrapper,\n      error,\n      endTime,\n    );\n\n    this.triggerEventCallbacks(requestEvent);\n  }\n\n  private getTimestamps() {\n    /* istanbul ignore next */\n    return {\n      startTime: Date.now?.(),\n      durationStart: performance?.now?.(),\n    };\n  }\n\n  private observeFetch(\n    originalFetch: (requestInfo: RequestInfo | URL, requestInit?: RequestInit) => Promise<Response>,\n  ) {\n    /* istanbul ignore next */\n    if (!this.globalScope || !originalFetch) {\n      return;\n    }\n    /**\n     * IMPORTANT: This overrides window.fetch in browsers.\n     * You probably never need to make changes to this function.\n     * If you do, please be careful to preserve the original functionality of fetch\n     * and make sure another developer who is an expert reviews this change throughly\n     */\n    this.globalScope.fetch = async (requestInfo?: RequestInfo | URL, requestInit?: RequestInit) => {\n      // 1: capture the start time and duration start time before the fetch call\n      let timestamps;\n      try {\n        timestamps = this.getTimestamps();\n      } catch (error) {\n        /* istanbul ignore next */\n        this.logger?.debug('an unexpected error occurred while retrieving timestamps', error);\n      }\n\n      // 2. make the call to the original fetch and preserve the response or error\n      let originalResponse, originalError;\n      try {\n        originalResponse = await originalFetch(requestInfo as RequestInfo | URL, requestInit);\n      } catch (err) {\n        // Capture error information\n        originalError = err;\n      }\n\n      // 3. call the handler after the fetch call is done\n      try {\n        this.handleNetworkRequestEvent(\n          'fetch',\n          requestInfo,\n          requestInit ? new RequestWrapperFetch(requestInit as RequestInitSafe) : undefined,\n          originalResponse ? new ResponseWrapperFetch(originalResponse) : undefined,\n          originalError as Error,\n          /* istanbul ignore next */\n          timestamps?.startTime,\n          /* istanbul ignore next */\n          timestamps?.durationStart,\n        );\n      } catch (err) {\n        // this catch shouldn't be reachable, but keep it here for safety\n        // because we're overriding the fetch function and better to be safe than sorry\n        /* istanbul ignore next */\n        this.logger?.debug('an unexpected error occurred while handling fetch', err);\n      }\n\n      // 4. return the original response or throw the original error\n      if (originalResponse) {\n        // if the response is not undefined, return it\n        return originalResponse;\n      } else {\n        throw originalError;\n      }\n    };\n  }\n\n  /**\n   * Creates a function that parses the response of an XMLHttpRequest as JSON.\n   *\n   * Returns function instead of JSON object to avoid unnecessary parsing if the\n   * body is not being captured.\n   *\n   * @param xhrSafe - The XMLHttpRequest object.\n   * @param context - The NetworkObserver instance.\n   * @returns A function that parses the response of an XMLHttpRequest as JSON.\n   */\n  static createXhrJsonParser(xhrUnsafe: XMLHttpRequest, context: NetworkObserver) {\n    return () => {\n      try {\n        if (xhrUnsafe.responseType === 'json') {\n          // if response is a JS object, clone it so that subscribers can't mutate it\n          if (context.globalScope?.structuredClone) {\n            /* eslint-disable-next-line @typescript-eslint/no-unsafe-return */\n            return context.globalScope.structuredClone(xhrUnsafe.response);\n          }\n        } else if (['text', ''].includes(xhrUnsafe.responseType)) {\n          // if response is a string, parse it as JSON\n          /* eslint-disable-next-line @typescript-eslint/no-unsafe-return */\n          return JSON.parse(xhrUnsafe.responseText);\n        }\n      } catch (err) {\n        /* istanbul ignore if */\n        if (err instanceof Error && err.name === 'InvalidStateError') {\n          // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText#exceptions\n          // if we reach here, it means we don't handle responseType correctly\n          context.logger?.error(\n            `unexpected error when retrieving responseText. responseType='${xhrUnsafe.responseType}'`,\n          );\n        }\n        // the other possible error is Json Parse error which we fail silently\n        return null;\n      }\n      return null;\n    };\n  }\n\n  private observeXhr(\n    originalXhrOpen:\n      | ((\n          method: string,\n          url: string | URL,\n          async?: boolean,\n          username?: string | null,\n          password?: string | null,\n        ) => void)\n      | undefined,\n    originalXhrSend: ((body?: Document | XMLHttpRequestBodyInit | null) => void) | undefined,\n    originalXhrSetRequestHeader: (headerName: string, headerValue: string) => void,\n  ) {\n    /* istanbul ignore next */\n    if (!this.globalScope || !originalXhrOpen || !originalXhrSend) {\n      return;\n    }\n\n    const xhrProto = this.globalScope.XMLHttpRequest.prototype;\n\n    const networkObserverContext = this as NetworkObserver;\n\n    /**\n     * IMPORTANT: This overrides window.XMLHttpRequest.prototype.open\n     * You probably never need to make changes to this function.\n     * If you do, please be careful to preserve the original functionality of xhr.open\n     * and make sure another developer who is an expert reviews this change throughly\n     */\n    xhrProto.open = function (...args: any[]) {\n      const xhrSafe = this as unknown as AmplitudeXMLHttpRequestSafe;\n      const [method, url] = args as [string, string | URL];\n      try {\n        /* istanbul ignore next */\n        xhrSafe.$$AmplitudeAnalyticsEvent = {\n          method,\n          url: url?.toString?.(),\n          headers: {},\n          ...networkObserverContext.getTimestamps(),\n        } as AmplitudeAnalyticsEvent;\n      } catch (err) {\n        /* istanbul ignore next */\n        networkObserverContext.logger?.error('an unexpected error occurred while calling xhr open', err);\n      }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      return originalXhrOpen.apply(xhrSafe, args as any);\n    };\n\n    /**\n     * IMPORTANT: This overrides window.XMLHttpRequest.prototype.send\n     * You probably never need to make changes to this function.\n     * If you do, please be careful to preserve the original functionality of xhr.send\n     * and make sure another developer who is an expert reviews this change throughly\n     */\n    // allow \"any\" type for args to reflect how it's used in the browser\n    /* eslint-disable-next-line @typescript-eslint/no-unsafe-argument */\n    xhrProto.send = function (...args: any[]) {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      const xhrUnsafe = this;\n      const xhrSafe = xhrUnsafe as unknown as AmplitudeXMLHttpRequestSafe;\n      const getJson = NetworkObserver.createXhrJsonParser(xhrUnsafe, networkObserverContext);\n      const body = args[0] as XMLHttpRequestBodyInitSafe;\n      const requestEvent = xhrSafe.$$AmplitudeAnalyticsEvent;\n\n      xhrSafe.addEventListener('loadend', function () {\n        try {\n          const responseHeaders = xhrSafe.getAllResponseHeaders();\n          const responseBodySize = xhrSafe.getResponseHeader('content-length');\n\n          const responseWrapper = new ResponseWrapperXhr(\n            xhrSafe.status,\n            responseHeaders,\n            /* istanbul ignore next */\n            responseBodySize ? parseInt(responseBodySize, 10) : undefined,\n            getJson,\n          );\n          const requestHeaders = xhrSafe.$$AmplitudeAnalyticsEvent.headers;\n          const requestWrapper = new RequestWrapperXhr(body, requestHeaders);\n          requestEvent.status = xhrSafe.status;\n          networkObserverContext.handleNetworkRequestEvent(\n            'xhr',\n            { url: requestEvent.url, method: requestEvent.method },\n            requestWrapper,\n            responseWrapper,\n            undefined,\n            requestEvent.startTime,\n            requestEvent.durationStart,\n          );\n        } catch (err) {\n          /* istanbul ignore next */\n          networkObserverContext.logger?.error('an unexpected error occurred while handling xhr send', err);\n        }\n      });\n      /* eslint-disable-next-line @typescript-eslint/no-unsafe-argument */\n      return originalXhrSend.apply(xhrSafe, args as any);\n    };\n\n    /**\n     * IMPORTANT: This overrides window.XMLHttpRequest.prototype.setRequestHeader\n     * You probably never need to make changes to this function.\n     * If you do, please be careful to preserve the original functionality of xhr.setRequestHeader\n     * and make sure another developer who is an expert reviews this change throughly\n     */\n    // allow \"any\" type for args to reflect how it's used in the browser\n    /* eslint-disable-next-line @typescript-eslint/no-unsafe-argument */\n    xhrProto.setRequestHeader = function (headerName: any, headerValue: any) {\n      const xhrSafe = this as unknown as AmplitudeXMLHttpRequestSafe;\n      try {\n        /* eslint-disable-next-line @typescript-eslint/no-unsafe-assignment */\n        xhrSafe.$$AmplitudeAnalyticsEvent.headers[headerName as string] = headerValue as string;\n      } catch (err) {\n        /* istanbul ignore next */\n        networkObserverContext.logger?.error('an unexpected error occurred while calling xhr setRequestHeader', err);\n      }\n      /* eslint-disable-next-line @typescript-eslint/no-unsafe-argument */\n      originalXhrSetRequestHeader.apply(xhrSafe, [headerName, headerValue]);\n    };\n  }\n}\n\n// singleton instance of NetworkObserver\nexport const networkObserver = new NetworkObserver();\n", "import { getQueryParams } from '../query-params';\nimport {\n  UTM_CAMPAIGN,\n  UTM_CONTENT,\n  UTM_MEDIUM,\n  UTM_SOURCE,\n  UTM_TERM,\n  GCLID,\n  FBCLID,\n  BASE_CAMPAIGN,\n  DCLID,\n  MSCLKID,\n  RDT_CID,\n  TWCLID,\n  TTCLID,\n  KO_CLICK_ID,\n  LI_FAT_ID,\n  GBRAID,\n  WBRAID,\n  UTM_ID,\n} from '../types/constants';\nimport { Campaign, ICampaignParser, ClickIdParameters, ReferrerParameters, UTMParameters } from '../types/campaign';\n\nexport class CampaignParser implements ICampaignParser {\n  async parse(): Promise<Campaign> {\n    return {\n      ...BASE_CAMPAIGN,\n      ...this.getUtmParam(),\n      ...this.getReferrer(),\n      ...this.getClickIds(),\n    } as Campaign;\n  }\n\n  getUtmParam(): UTMParameters {\n    const params = getQueryParams();\n\n    const utmCampaign = params[UTM_CAMPAIGN];\n    const utmContent = params[UTM_CONTENT];\n    const utmId = params[UTM_ID];\n    const utmMedium = params[UTM_MEDIUM];\n    const utmSource = params[UTM_SOURCE];\n    const utmTerm = params[UTM_TERM];\n\n    return {\n      utm_campaign: utmCampaign,\n      utm_content: utmContent,\n      utm_id: utmId,\n      utm_medium: utmMedium,\n      utm_source: utmSource,\n      utm_term: utmTerm,\n    };\n  }\n\n  getReferrer(): ReferrerParameters {\n    const data: ReferrerParameters = {\n      referrer: undefined,\n      referring_domain: undefined,\n    };\n    try {\n      data.referrer = document.referrer || undefined;\n      data.referring_domain = data.referrer?.split('/')[2] ?? undefined;\n    } catch {\n      // nothing to track\n    }\n    return data;\n  }\n\n  getClickIds(): ClickIdParameters {\n    const params = getQueryParams();\n    return {\n      [DCLID]: params[DCLID],\n      [FBCLID]: params[FBCLID],\n      [GBRAID]: params[GBRAID],\n      [GCLID]: params[GCLID],\n      [KO_CLICK_ID]: params[KO_CLICK_ID],\n      [LI_FAT_ID]: params[LI_FAT_ID],\n      [MSCLKID]: params[MSCLKID],\n      [RDT_CID]: params[RDT_CID],\n      [TTCLID]: params[TTCLID],\n      [TWCLID]: params[TWCLID],\n      [WBRAID]: params[WBRAID],\n    };\n  }\n}\n", "export const TEXT_MASK_ATTRIBUTE = 'data-amp-mask';\nexport const MASKED_TEXT_VALUE = '*****';\n\n// Regex patterns for sensitive data\nexport const CC_REGEX = /\\b(?:\\d[ -]*?){13,16}\\b/;\nexport const SSN_REGEX = /(\\d{3}-?\\d{2}-?\\d{4})/g;\nexport const EMAIL_REGEX = /[^\\s@]+@[^\\s@.]+\\.[^\\s@]+/g;\n\n/**\n * Replaces sensitive strings (credit cards, SSNs, emails) and custom patterns with masked text\n * @param text - The text to search for sensitive data\n * @param additionalMaskTextPatterns - Optional array of additional regex patterns to mask\n * @returns The text with sensitive data replaced by masked text\n */\nexport const replaceSensitiveString = (text: string | null, additionalMaskTextPatterns: RegExp[] = []): string => {\n  if (typeof text !== 'string') {\n    return '';\n  }\n\n  let result = text;\n\n  // Check for credit card number (with or without spaces/dashes)\n  result = result.replace(CC_REGEX, MASKED_TEXT_VALUE);\n\n  // Check for social security number\n  result = result.replace(SSN_REGEX, MASKED_TEXT_VALUE);\n\n  // Check for email\n  result = result.replace(EMAIL_REGEX, MASKED_TEXT_VALUE);\n\n  // Check for additional mask text patterns\n  for (const pattern of additionalMaskTextPatterns) {\n    try {\n      result = result.replace(pattern, MASKED_TEXT_VALUE);\n    } catch {\n      // ignore invalid pattern\n    }\n  }\n\n  return result;\n};\n\n/**\n * Gets the page title, checking if the title element has data-amp-mask attribute\n * @returns The page title, masked if the title element has data-amp-mask attribute\n */\nexport const getPageTitle = (parseTitleFunction?: (title: string) => string): string => {\n  if (typeof document === 'undefined' || !document.title) {\n    return '';\n  }\n  const titleElement = document.querySelector('title');\n  if (titleElement && titleElement.hasAttribute(TEXT_MASK_ATTRIBUTE)) {\n    return MASKED_TEXT_VALUE;\n  }\n  return parseTitleFunction ? parseTitleFunction(document.title) : document.title; // document.title is always synced to the first title element\n};\n", "function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n// === Symbol Support ===\nvar hasSymbols = function () {\n  return typeof Symbol === 'function';\n};\n\nvar hasSymbol = function (name) {\n  return hasSymbols() && Boolean(Symbol[name]);\n};\n\nvar getSymbol = function (name) {\n  return hasSymbol(name) ? Symbol[name] : '@@' + name;\n};\n\nif (hasSymbols() && !hasSymbol('observable')) {\n  Symbol.observable = Symbol('observable');\n}\n\nvar SymbolIterator = getSymbol('iterator');\nvar SymbolObservable = getSymbol('observable');\nvar SymbolSpecies = getSymbol('species'); // === Abstract Operations ===\n\nfunction getMethod(obj, key) {\n  var value = obj[key];\n  if (value == null) return undefined;\n  if (typeof value !== 'function') throw new TypeError(value + ' is not a function');\n  return value;\n}\n\nfunction getSpecies(obj) {\n  var ctor = obj.constructor;\n\n  if (ctor !== undefined) {\n    ctor = ctor[SymbolSpecies];\n\n    if (ctor === null) {\n      ctor = undefined;\n    }\n  }\n\n  return ctor !== undefined ? ctor : Observable;\n}\n\nfunction isObservable(x) {\n  return x instanceof Observable; // SPEC: Brand check\n}\n\nfunction hostReportError(e) {\n  if (hostReportError.log) {\n    hostReportError.log(e);\n  } else {\n    setTimeout(function () {\n      throw e;\n    });\n  }\n}\n\nfunction enqueue(fn) {\n  Promise.resolve().then(function () {\n    try {\n      fn();\n    } catch (e) {\n      hostReportError(e);\n    }\n  });\n}\n\nfunction cleanupSubscription(subscription) {\n  var cleanup = subscription._cleanup;\n  if (cleanup === undefined) return;\n  subscription._cleanup = undefined;\n\n  if (!cleanup) {\n    return;\n  }\n\n  try {\n    if (typeof cleanup === 'function') {\n      cleanup();\n    } else {\n      var unsubscribe = getMethod(cleanup, 'unsubscribe');\n\n      if (unsubscribe) {\n        unsubscribe.call(cleanup);\n      }\n    }\n  } catch (e) {\n    hostReportError(e);\n  }\n}\n\nfunction closeSubscription(subscription) {\n  subscription._observer = undefined;\n  subscription._queue = undefined;\n  subscription._state = 'closed';\n}\n\nfunction flushSubscription(subscription) {\n  var queue = subscription._queue;\n\n  if (!queue) {\n    return;\n  }\n\n  subscription._queue = undefined;\n  subscription._state = 'ready';\n\n  for (var i = 0; i < queue.length; ++i) {\n    notifySubscription(subscription, queue[i].type, queue[i].value);\n    if (subscription._state === 'closed') break;\n  }\n}\n\nfunction notifySubscription(subscription, type, value) {\n  subscription._state = 'running';\n  var observer = subscription._observer;\n\n  try {\n    var m = getMethod(observer, type);\n\n    switch (type) {\n      case 'next':\n        if (m) m.call(observer, value);\n        break;\n\n      case 'error':\n        closeSubscription(subscription);\n        if (m) m.call(observer, value);else throw value;\n        break;\n\n      case 'complete':\n        closeSubscription(subscription);\n        if (m) m.call(observer);\n        break;\n    }\n  } catch (e) {\n    hostReportError(e);\n  }\n\n  if (subscription._state === 'closed') cleanupSubscription(subscription);else if (subscription._state === 'running') subscription._state = 'ready';\n}\n\nfunction onNotify(subscription, type, value) {\n  if (subscription._state === 'closed') return;\n\n  if (subscription._state === 'buffering') {\n    subscription._queue.push({\n      type: type,\n      value: value\n    });\n\n    return;\n  }\n\n  if (subscription._state !== 'ready') {\n    subscription._state = 'buffering';\n    subscription._queue = [{\n      type: type,\n      value: value\n    }];\n    enqueue(function () {\n      return flushSubscription(subscription);\n    });\n    return;\n  }\n\n  notifySubscription(subscription, type, value);\n}\n\nvar Subscription = /*#__PURE__*/function () {\n  function Subscription(observer, subscriber) {\n    // ASSERT: observer is an object\n    // ASSERT: subscriber is callable\n    this._cleanup = undefined;\n    this._observer = observer;\n    this._queue = undefined;\n    this._state = 'initializing';\n    var subscriptionObserver = new SubscriptionObserver(this);\n\n    try {\n      this._cleanup = subscriber.call(undefined, subscriptionObserver);\n    } catch (e) {\n      subscriptionObserver.error(e);\n    }\n\n    if (this._state === 'initializing') this._state = 'ready';\n  }\n\n  var _proto = Subscription.prototype;\n\n  _proto.unsubscribe = function unsubscribe() {\n    if (this._state !== 'closed') {\n      closeSubscription(this);\n      cleanupSubscription(this);\n    }\n  };\n\n  _createClass(Subscription, [{\n    key: \"closed\",\n    get: function () {\n      return this._state === 'closed';\n    }\n  }]);\n\n  return Subscription;\n}();\n\nvar SubscriptionObserver = /*#__PURE__*/function () {\n  function SubscriptionObserver(subscription) {\n    this._subscription = subscription;\n  }\n\n  var _proto2 = SubscriptionObserver.prototype;\n\n  _proto2.next = function next(value) {\n    onNotify(this._subscription, 'next', value);\n  };\n\n  _proto2.error = function error(value) {\n    onNotify(this._subscription, 'error', value);\n  };\n\n  _proto2.complete = function complete() {\n    onNotify(this._subscription, 'complete');\n  };\n\n  _createClass(SubscriptionObserver, [{\n    key: \"closed\",\n    get: function () {\n      return this._subscription._state === 'closed';\n    }\n  }]);\n\n  return SubscriptionObserver;\n}();\n\nvar Observable = /*#__PURE__*/function () {\n  function Observable(subscriber) {\n    if (!(this instanceof Observable)) throw new TypeError('Observable cannot be called as a function');\n    if (typeof subscriber !== 'function') throw new TypeError('Observable initializer must be a function');\n    this._subscriber = subscriber;\n  }\n\n  var _proto3 = Observable.prototype;\n\n  _proto3.subscribe = function subscribe(observer) {\n    if (typeof observer !== 'object' || observer === null) {\n      observer = {\n        next: observer,\n        error: arguments[1],\n        complete: arguments[2]\n      };\n    }\n\n    return new Subscription(observer, this._subscriber);\n  };\n\n  _proto3.forEach = function forEach(fn) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      if (typeof fn !== 'function') {\n        reject(new TypeError(fn + ' is not a function'));\n        return;\n      }\n\n      function done() {\n        subscription.unsubscribe();\n        resolve();\n      }\n\n      var subscription = _this.subscribe({\n        next: function (value) {\n          try {\n            fn(value, done);\n          } catch (e) {\n            reject(e);\n            subscription.unsubscribe();\n          }\n        },\n        error: reject,\n        complete: resolve\n      });\n    });\n  };\n\n  _proto3.map = function map(fn) {\n    var _this2 = this;\n\n    if (typeof fn !== 'function') throw new TypeError(fn + ' is not a function');\n    var C = getSpecies(this);\n    return new C(function (observer) {\n      return _this2.subscribe({\n        next: function (value) {\n          try {\n            value = fn(value);\n          } catch (e) {\n            return observer.error(e);\n          }\n\n          observer.next(value);\n        },\n        error: function (e) {\n          observer.error(e);\n        },\n        complete: function () {\n          observer.complete();\n        }\n      });\n    });\n  };\n\n  _proto3.filter = function filter(fn) {\n    var _this3 = this;\n\n    if (typeof fn !== 'function') throw new TypeError(fn + ' is not a function');\n    var C = getSpecies(this);\n    return new C(function (observer) {\n      return _this3.subscribe({\n        next: function (value) {\n          try {\n            if (!fn(value)) return;\n          } catch (e) {\n            return observer.error(e);\n          }\n\n          observer.next(value);\n        },\n        error: function (e) {\n          observer.error(e);\n        },\n        complete: function () {\n          observer.complete();\n        }\n      });\n    });\n  };\n\n  _proto3.reduce = function reduce(fn) {\n    var _this4 = this;\n\n    if (typeof fn !== 'function') throw new TypeError(fn + ' is not a function');\n    var C = getSpecies(this);\n    var hasSeed = arguments.length > 1;\n    var hasValue = false;\n    var seed = arguments[1];\n    var acc = seed;\n    return new C(function (observer) {\n      return _this4.subscribe({\n        next: function (value) {\n          var first = !hasValue;\n          hasValue = true;\n\n          if (!first || hasSeed) {\n            try {\n              acc = fn(acc, value);\n            } catch (e) {\n              return observer.error(e);\n            }\n          } else {\n            acc = value;\n          }\n        },\n        error: function (e) {\n          observer.error(e);\n        },\n        complete: function () {\n          if (!hasValue && !hasSeed) return observer.error(new TypeError('Cannot reduce an empty sequence'));\n          observer.next(acc);\n          observer.complete();\n        }\n      });\n    });\n  };\n\n  _proto3.concat = function concat() {\n    var _this5 = this;\n\n    for (var _len = arguments.length, sources = new Array(_len), _key = 0; _key < _len; _key++) {\n      sources[_key] = arguments[_key];\n    }\n\n    var C = getSpecies(this);\n    return new C(function (observer) {\n      var subscription;\n      var index = 0;\n\n      function startNext(next) {\n        subscription = next.subscribe({\n          next: function (v) {\n            observer.next(v);\n          },\n          error: function (e) {\n            observer.error(e);\n          },\n          complete: function () {\n            if (index === sources.length) {\n              subscription = undefined;\n              observer.complete();\n            } else {\n              startNext(C.from(sources[index++]));\n            }\n          }\n        });\n      }\n\n      startNext(_this5);\n      return function () {\n        if (subscription) {\n          subscription.unsubscribe();\n          subscription = undefined;\n        }\n      };\n    });\n  };\n\n  _proto3.flatMap = function flatMap(fn) {\n    var _this6 = this;\n\n    if (typeof fn !== 'function') throw new TypeError(fn + ' is not a function');\n    var C = getSpecies(this);\n    return new C(function (observer) {\n      var subscriptions = [];\n\n      var outer = _this6.subscribe({\n        next: function (value) {\n          if (fn) {\n            try {\n              value = fn(value);\n            } catch (e) {\n              return observer.error(e);\n            }\n          }\n\n          var inner = C.from(value).subscribe({\n            next: function (value) {\n              observer.next(value);\n            },\n            error: function (e) {\n              observer.error(e);\n            },\n            complete: function () {\n              var i = subscriptions.indexOf(inner);\n              if (i >= 0) subscriptions.splice(i, 1);\n              completeIfDone();\n            }\n          });\n          subscriptions.push(inner);\n        },\n        error: function (e) {\n          observer.error(e);\n        },\n        complete: function () {\n          completeIfDone();\n        }\n      });\n\n      function completeIfDone() {\n        if (outer.closed && subscriptions.length === 0) observer.complete();\n      }\n\n      return function () {\n        subscriptions.forEach(function (s) {\n          return s.unsubscribe();\n        });\n        outer.unsubscribe();\n      };\n    });\n  };\n\n  _proto3[SymbolObservable] = function () {\n    return this;\n  };\n\n  Observable.from = function from(x) {\n    var C = typeof this === 'function' ? this : Observable;\n    if (x == null) throw new TypeError(x + ' is not an object');\n    var method = getMethod(x, SymbolObservable);\n\n    if (method) {\n      var observable = method.call(x);\n      if (Object(observable) !== observable) throw new TypeError(observable + ' is not an object');\n      if (isObservable(observable) && observable.constructor === C) return observable;\n      return new C(function (observer) {\n        return observable.subscribe(observer);\n      });\n    }\n\n    if (hasSymbol('iterator')) {\n      method = getMethod(x, SymbolIterator);\n\n      if (method) {\n        return new C(function (observer) {\n          enqueue(function () {\n            if (observer.closed) return;\n\n            for (var _iterator = _createForOfIteratorHelperLoose(method.call(x)), _step; !(_step = _iterator()).done;) {\n              var item = _step.value;\n              observer.next(item);\n              if (observer.closed) return;\n            }\n\n            observer.complete();\n          });\n        });\n      }\n    }\n\n    if (Array.isArray(x)) {\n      return new C(function (observer) {\n        enqueue(function () {\n          if (observer.closed) return;\n\n          for (var i = 0; i < x.length; ++i) {\n            observer.next(x[i]);\n            if (observer.closed) return;\n          }\n\n          observer.complete();\n        });\n      });\n    }\n\n    throw new TypeError(x + ' is not observable');\n  };\n\n  Observable.of = function of() {\n    for (var _len2 = arguments.length, items = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      items[_key2] = arguments[_key2];\n    }\n\n    var C = typeof this === 'function' ? this : Observable;\n    return new C(function (observer) {\n      enqueue(function () {\n        if (observer.closed) return;\n\n        for (var i = 0; i < items.length; ++i) {\n          observer.next(items[i]);\n          if (observer.closed) return;\n        }\n\n        observer.complete();\n      });\n    });\n  };\n\n  _createClass(Observable, null, [{\n    key: SymbolSpecies,\n    get: function () {\n      return this;\n    }\n  }]);\n\n  return Observable;\n}();\n\nif (hasSymbols()) {\n  Object.defineProperty(Observable, Symbol('extensions'), {\n    value: {\n      symbol: SymbolObservable,\n      hostReportError: hostReportError\n    },\n    configurable: true\n  });\n}\n\nexport { Observable };\n", "export { Observable } from 'zen-observable-ts';\n\nimport { Observable as ZenObservable, Observer, Subscription } from 'zen-observable-ts';\n\n/**\n * asyncMap operator for Zen Observable\n *\n * Maps each value emitted by the source Observable using an async function,\n * emitting the resolved values in the same order they arrive.\n */\nfunction asyncMap<T, R>(observable: ZenObservable<T>, fn: (value: T) => Promise<R>): ZenObservable<R> {\n  return new ZenObservable(\n    (observer: { next: (value: R) => void; error: (error: any) => void; complete: () => void }) => {\n      observable.subscribe({\n        next: (value: T) => {\n          fn(value)\n            .then((result: R) => {\n              return observer.next(result);\n            })\n            .catch((error: any) => observer.error(error));\n        },\n        error: (error: any) => {\n          observer.error(error);\n        },\n        complete: () => {\n          observer.complete();\n        },\n      });\n    },\n  );\n}\n\ntype Unsubscribable = {\n  unsubscribe: () => void;\n};\n\n/**\n * merge operator for Zen Observable\n *\n * Merges two observables into a single observable, emitting values from both sources in the order they arrive.\n * @param sourceA Observable to merge\n * @param sourceB Observable to merge\n * @returns Unsubscribable cleanup function\n */\nfunction merge<A, B>(sourceA: ZenObservable<A>, sourceB: ZenObservable<B>): ZenObservable<A | B> {\n  return new ZenObservable<A | B>((observer) => {\n    let closed = false;\n\n    const subscriptions: Set<Unsubscribable> = new Set();\n\n    const cleanup = (): void => {\n      closed = true;\n      for (const sub of subscriptions) {\n        try {\n          sub.unsubscribe();\n        } catch {\n          /* do nothing */\n        }\n      }\n      subscriptions.clear();\n    };\n\n    const subscribeTo = <T>(source: ZenObservable<T>) => {\n      const sub = source.subscribe({\n        next(value: T) {\n          if (!closed) observer.next(value as A | B);\n        },\n        error(err) {\n          if (!closed) {\n            closed = true;\n            observer.error(err);\n            cleanup();\n          }\n        },\n        complete() {\n          subscriptions.delete(sub);\n          if (!closed && subscriptions.size === 0) {\n            observer.complete();\n            cleanup();\n            closed = true;\n          }\n        },\n      });\n\n      subscriptions.add(sub);\n    };\n\n    subscribeTo(sourceA);\n    subscribeTo(sourceB);\n\n    return cleanup;\n  });\n}\n\n// function share() {\nfunction multicast<T>(source: ZenObservable<T>): ZenObservable<T> {\n  const observers: Set<Observer<T>> = new Set();\n  let subscription: Subscription | null = null;\n\n  function cleanup() {\n    /* istanbul ignore next */\n    subscription?.unsubscribe();\n    subscription = null;\n    observers.clear();\n  }\n\n  return new ZenObservable<T>((observer) => {\n    observers.add(observer);\n\n    if (subscription === null) {\n      subscription = source.subscribe({\n        next(value) {\n          for (const obs of observers) {\n            /* istanbul ignore next */\n            obs.next?.(value);\n          }\n        },\n        error(err) {\n          for (const obs of observers) {\n            /* istanbul ignore next */\n            obs.error?.(err);\n          }\n          cleanup();\n        },\n        complete() {\n          for (const obs of observers) {\n            /* istanbul ignore next */\n            obs.complete?.();\n          }\n          cleanup();\n        },\n      });\n    }\n\n    // Return unsubscribe function for this observer\n    return () => {\n      observers.delete(observer);\n\n      // If no observers left, unsubscribe from the source\n      if (observers.size === 0 && subscription) {\n        subscription.unsubscribe();\n        subscription = null;\n      }\n    };\n  });\n}\n\nexport { asyncMap, multicast, merge, Unsubscribable };\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "import {\n  PageTrackingHistoryChanges,\n  PageTrackingOptions,\n  PageTrackingTrackOn,\n  ElementInteractionsOptions,\n  FormInteractionsOptions,\n  BrowserOptions,\n  AutocaptureOptions,\n  AttributionOptions,\n  NetworkTrackingOptions,\n  FrustrationInteractionsOptions,\n} from '@amplitude/analytics-core';\n\n/**\n * A subset of AutocaptureOptions that includes the autocapture features that\n * are made available to users by default (even if \"config.autocapture === undefined\")\n */\ntype AutocaptureOptionsDefaultAvailable = Pick<\n  AutocaptureOptions,\n  'pageViews' | 'sessions' | 'fileDownloads' | 'formInteractions' | 'attribution' | 'pageUrlEnrichment'\n>;\n\n/**\n * Returns false if autocapture === false or if autocapture[event],\n * otherwise returns true (even if \"config.autocapture === undefined\")\n */\nconst isTrackingEnabled = (\n  autocapture: AutocaptureOptionsDefaultAvailable | boolean | undefined,\n  event: keyof AutocaptureOptionsDefaultAvailable,\n) => {\n  if (typeof autocapture === 'boolean') {\n    return autocapture;\n  }\n\n  if (autocapture?.[event] === false) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const isAttributionTrackingEnabled = (autocapture: AutocaptureOptions | boolean | undefined) =>\n  isTrackingEnabled(autocapture, 'attribution');\n\nexport const isFileDownloadTrackingEnabled = (autocapture: AutocaptureOptions | boolean | undefined) =>\n  isTrackingEnabled(autocapture, 'fileDownloads');\n\nexport const isFormInteractionTrackingEnabled = (autocapture: AutocaptureOptions | boolean | undefined) =>\n  isTrackingEnabled(autocapture, 'formInteractions');\n\nexport const isPageViewTrackingEnabled = (autocapture: AutocaptureOptions | boolean | undefined) =>\n  isTrackingEnabled(autocapture, 'pageViews');\n\nexport const isSessionTrackingEnabled = (autocapture: AutocaptureOptions | boolean | undefined) =>\n  isTrackingEnabled(autocapture, 'sessions');\n\nexport const isPageUrlEnrichmentEnabled = (autocapture: AutocaptureOptions | boolean | undefined) =>\n  isTrackingEnabled(autocapture, 'pageUrlEnrichment');\n\n/**\n * Returns true if\n * 1. if autocapture.networkTracking === true\n * 2. if autocapture.networkTracking === object\n * otherwise returns false\n */\nexport const isNetworkTrackingEnabled = (autocapture: AutocaptureOptions | boolean | undefined) => {\n  if (typeof autocapture === 'boolean') {\n    return autocapture;\n  }\n\n  if (\n    typeof autocapture === 'object' &&\n    (autocapture.networkTracking === true || typeof autocapture.networkTracking === 'object')\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if\n * 1. autocapture === true\n * 2. if autocapture.elementInteractions === true\n * 3. if autocapture.elementInteractions === object\n * otherwise returns false\n */\nexport const isElementInteractionsEnabled = (autocapture: AutocaptureOptions | boolean | undefined): boolean => {\n  if (typeof autocapture === 'boolean') {\n    return autocapture;\n  }\n\n  if (\n    typeof autocapture === 'object' &&\n    (autocapture.elementInteractions === true || typeof autocapture.elementInteractions === 'object')\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if\n * 1. autocapture === true\n * 2. if autocapture.webVitals === true\n * otherwise returns false\n */\nexport const isWebVitalsEnabled = (autocapture: AutocaptureOptions | boolean | undefined): boolean => {\n  if (typeof autocapture === 'boolean') {\n    return autocapture;\n  }\n\n  if (typeof autocapture === 'object' && autocapture.webVitals === true) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const isFrustrationInteractionsEnabled = (autocapture: AutocaptureOptions | boolean | undefined): boolean => {\n  if (typeof autocapture === 'boolean') {\n    return autocapture;\n  }\n\n  if (\n    typeof autocapture === 'object' &&\n    (autocapture.frustrationInteractions === true || typeof autocapture.frustrationInteractions === 'object')\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const getElementInteractionsConfig = (config: BrowserOptions): ElementInteractionsOptions | undefined => {\n  if (\n    isElementInteractionsEnabled(config.autocapture) &&\n    typeof config.autocapture === 'object' &&\n    typeof config.autocapture.elementInteractions === 'object'\n  ) {\n    return config.autocapture.elementInteractions;\n  }\n  return undefined;\n};\n\nexport const getFrustrationInteractionsConfig = (\n  config: BrowserOptions,\n): FrustrationInteractionsOptions | undefined => {\n  if (\n    isFrustrationInteractionsEnabled(config.autocapture) &&\n    typeof config.autocapture === 'object' &&\n    typeof config.autocapture.frustrationInteractions === 'object'\n  ) {\n    return config.autocapture.frustrationInteractions;\n  }\n  return undefined;\n};\n\nexport const getNetworkTrackingConfig = (config: BrowserOptions): NetworkTrackingOptions | undefined => {\n  if (isNetworkTrackingEnabled(config.autocapture)) {\n    let networkTrackingConfig;\n    if (typeof config.autocapture === 'object' && typeof config.autocapture.networkTracking === 'object') {\n      networkTrackingConfig = config.autocapture.networkTracking;\n    } else if (config.networkTrackingOptions) {\n      networkTrackingConfig = config.networkTrackingOptions;\n    }\n    return {\n      ...networkTrackingConfig,\n      captureRules: networkTrackingConfig?.captureRules?.map((rule) => {\n        // if URLs and hosts are both set, URLs take precedence over hosts\n        if (rule.urls?.length && rule.hosts?.length) {\n          const hostsString = JSON.stringify(rule.hosts);\n          const urlsString = JSON.stringify(rule.urls);\n          /* istanbul ignore next */\n          config.loggerProvider?.warn(\n            `Found network capture rule with both urls='${urlsString}' and hosts='${hostsString}' set. ` +\n              `Definition of urls takes precedence over hosts, so ignoring hosts.`,\n          );\n          return { ...rule, hosts: undefined };\n        }\n        return rule;\n      }),\n    };\n  }\n  return;\n};\n\nexport const getPageViewTrackingConfig = (config: BrowserOptions): PageTrackingOptions => {\n  let trackOn: PageTrackingTrackOn | undefined = () => false;\n  let trackHistoryChanges: PageTrackingHistoryChanges | undefined = undefined;\n  let eventType: string | undefined;\n  const pageCounter = config.pageCounter;\n\n  const isDefaultPageViewTrackingEnabled = isPageViewTrackingEnabled(config.defaultTracking);\n  if (isDefaultPageViewTrackingEnabled) {\n    trackOn = undefined;\n    eventType = undefined;\n\n    if (\n      config.defaultTracking &&\n      typeof config.defaultTracking === 'object' &&\n      config.defaultTracking.pageViews &&\n      typeof config.defaultTracking.pageViews === 'object'\n    ) {\n      if ('trackOn' in config.defaultTracking.pageViews) {\n        trackOn = config.defaultTracking.pageViews.trackOn;\n      }\n\n      if ('trackHistoryChanges' in config.defaultTracking.pageViews) {\n        trackHistoryChanges = config.defaultTracking.pageViews.trackHistoryChanges;\n      }\n\n      if ('eventType' in config.defaultTracking.pageViews && config.defaultTracking.pageViews.eventType) {\n        eventType = config.defaultTracking.pageViews.eventType;\n      }\n    }\n  }\n\n  return {\n    trackOn,\n    trackHistoryChanges,\n    eventType,\n    pageCounter,\n  };\n};\n\nexport const getAttributionTrackingConfig = (config: BrowserOptions): AttributionOptions => {\n  if (\n    isAttributionTrackingEnabled(config.defaultTracking) &&\n    config.defaultTracking &&\n    typeof config.defaultTracking === 'object' &&\n    config.defaultTracking.attribution &&\n    typeof config.defaultTracking.attribution === 'object'\n  ) {\n    return {\n      ...config.defaultTracking.attribution,\n    };\n  }\n\n  return {};\n};\n\nexport const getFormInteractionsConfig = (config: BrowserOptions): FormInteractionsOptions | undefined => {\n  if (\n    isFormInteractionTrackingEnabled(config.defaultTracking) &&\n    config.defaultTracking &&\n    typeof config.defaultTracking === 'object' &&\n    typeof config.defaultTracking.formInteractions === 'object'\n  ) {\n    return config.defaultTracking.formInteractions;\n  }\n  return undefined;\n};\n", "import { Result, AmplitudeReturn } from '@amplitude/analytics-core';\n\ninterface ProxyItem {\n  name: string;\n  args: any[];\n  resolve?: (promise: Promise<Result>) => void;\n}\n\ntype QueueProxy = Array<ProxyItem>;\n\ninterface InstanceProxy {\n  _q: QueueProxy;\n  _iq: Record<string, InstanceProxy>;\n}\n\n/**\n * Applies the proxied functions on the proxied amplitude snippet to an instance of the real object.\n * @ignore\n */\nexport const runQueuedFunctions = (instance: object, queue: QueueProxy) => {\n  convertProxyObjectToRealObject(instance, queue);\n};\n\n/**\n * Applies the proxied functions on the proxied object to an instance of the real object.\n * Used to convert proxied Identify and Revenue objects.\n */\nexport const convertProxyObjectToRealObject = <T>(instance: T, queue: QueueProxy): T => {\n  for (let i = 0; i < queue.length; i++) {\n    const { name, args, resolve } = queue[i];\n    const fn = instance && instance[name as keyof T];\n    if (typeof fn === 'function') {\n      const result = fn.apply(instance, args) as AmplitudeReturn<Result>;\n      if (typeof resolve === 'function') {\n        resolve(result?.promise);\n      }\n    }\n  }\n  return instance;\n};\n\n/**\n * Check if the param is snippet proxy\n */\nexport const isInstanceProxy = (instance: unknown): instance is InstanceProxy => {\n  const instanceProxy = instance as InstanceProxy;\n  return instanceProxy && instanceProxy._q !== undefined;\n};\n", "export const VERSION = '2.34.0';\n", "export const LIBPREFIX = 'amplitude-ts';\n", "import { UUID, getLanguage, Event, BeforePlugin, BrowserConfig } from '@amplitude/analytics-core';\nimport { VERSION } from '../version';\nimport { LIBPREFIX } from '../lib-prefix';\n\nconst BROWSER_PLATFORM = 'Web';\nconst IP_ADDRESS = '$remote';\nexport class Context implements BeforePlugin {\n  name = '@amplitude/plugin-context-browser';\n  type = 'before' as const;\n\n  // this.config is defined in setup() which will always be called first\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  config: BrowserConfig;\n  userAgent: string | undefined;\n  library = `${LIBPREFIX}/${VERSION}`;\n\n  constructor() {\n    /* istanbul ignore else */\n    if (typeof navigator !== 'undefined') {\n      this.userAgent = navigator.userAgent;\n    }\n  }\n\n  setup(config: BrowserConfig): Promise<undefined> {\n    this.config = config;\n\n    return Promise.resolve(undefined);\n  }\n\n  async execute(context: Event): Promise<Event> {\n    const time = new Date().getTime();\n    const lastEventId = this.config.lastEventId ?? -1;\n    const nextEventId = context.event_id ?? lastEventId + 1;\n    this.config.lastEventId = nextEventId;\n    if (!context.time) {\n      this.config.lastEventTime = time;\n    }\n\n    const event: Event = {\n      user_id: this.config.userId,\n      device_id: this.config.deviceId,\n      session_id: this.config.sessionId,\n      time,\n      ...(this.config.appVersion && { app_version: this.config.appVersion }),\n      ...(this.config.trackingOptions.platform && { platform: BROWSER_PLATFORM }),\n      ...(this.config.trackingOptions.language && { language: getLanguage() }),\n      ...(this.config.trackingOptions.ipAddress && { ip: IP_ADDRESS }),\n      insert_id: UUID(),\n      partner_id: this.config.partnerId,\n      plan: this.config.plan,\n      ...(this.config.ingestionMetadata && {\n        ingestion_metadata: {\n          source_name: this.config.ingestionMetadata.sourceName,\n          source_version: this.config.ingestionMetadata.sourceVersion,\n        },\n      }),\n      ...context,\n      event_id: nextEventId,\n      library: this.library,\n      user_agent: this.userAgent,\n    };\n    return event;\n  }\n}\n", "import { getGlobalScope, ILogger, BrowserStorage } from '@amplitude/analytics-core';\n\nconst MAX_ARRAY_LENGTH = 1000;\n\ninterface LocalStorageOptions {\n  loggerProvider?: ILogger;\n}\nexport class LocalStorage<T> extends BrowserStorage<T> {\n  loggerProvider?: ILogger;\n\n  constructor(config?: LocalStorageOptions) {\n    let localStorage;\n\n    try {\n      localStorage = getGlobalScope()?.localStorage;\n    } catch (e) {\n      config?.loggerProvider?.debug(`Failed to access localStorage. error=${JSON.stringify(e)}`);\n      localStorage = undefined;\n    }\n    super(localStorage);\n    this.loggerProvider = config?.loggerProvider;\n  }\n\n  async set(key: string, value: T): Promise<void> {\n    if (Array.isArray(value) && value.length > MAX_ARRAY_LENGTH) {\n      const droppedEventsCount = value.length - MAX_ARRAY_LENGTH;\n      await super.set(key, value.slice(0, MAX_ARRAY_LENGTH) as T);\n      this.loggerProvider?.error(\n        `Failed to save ${droppedEventsCount} events because the queue length exceeded ${MAX_ARRAY_LENGTH}.`,\n      );\n    } else {\n      await super.set(key, value);\n    }\n  }\n}\n", "import { getGlobalScope, BrowserStorage } from '@amplitude/analytics-core';\n\nexport class SessionStorage<T> extends BrowserStorage<T> {\n  constructor() {\n    super(getGlobalScope()?.sessionStorage);\n  }\n}\n", "import { BaseTransport, Payload, Response, Transport } from '@amplitude/analytics-core';\n\nexport class XHRTransport extends BaseTransport implements Transport {\n  private state = {\n    done: 4,\n  };\n  private customHeaders: Record<string, string>;\n\n  constructor(customHeaders: Record<string, string> = {}) {\n    super();\n    this.customHeaders = customHeaders;\n  }\n\n  async send(serverUrl: string, payload: Payload): Promise<Response | null> {\n    return new Promise((resolve, reject) => {\n      /* istanbul ignore if */\n      if (typeof XMLHttpRequest === 'undefined') {\n        reject(new Error('XHRTransport is not supported.'));\n      }\n\n      const xhr = new XMLHttpRequest();\n      xhr.open('POST', serverUrl, true);\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === this.state.done) {\n          const responseText = xhr.responseText;\n          try {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            resolve(this.buildResponse(JSON.parse(responseText)));\n          } catch {\n            resolve(this.buildResponse({ code: xhr.status }));\n          }\n        }\n      };\n      // Merge headers: custom headers override defaults (consistent with FetchTransport)\n      const headers: Record<string, string> = {\n        'Content-Type': 'application/json',\n        Accept: '*/*',\n        ...this.customHeaders,\n      };\n      for (const [key, value] of Object.entries(headers)) {\n        xhr.setRequestHeader(key, value);\n      }\n      xhr.send(JSON.stringify(payload));\n    });\n  }\n}\n", "import { BaseTransport, getGlobalScope, Payload, Response, Transport } from '@amplitude/analytics-core';\n\nexport class SendBeaconTransport extends BaseTransport implements Transport {\n  async send(serverUrl: string, payload: Payload): Promise<Response | null> {\n    return new Promise((resolve, reject) => {\n      const globalScope = getGlobalScope();\n      /* istanbul ignore if */\n      if (!globalScope?.navigator.sendBeacon) {\n        throw new Error('SendBeaconTransport is not supported');\n      }\n      try {\n        const data = JSON.stringify(payload);\n        const success = globalScope.navigator.sendBeacon(serverUrl, JSON.stringify(payload));\n        if (success) {\n          return resolve(\n            this.buildResponse({\n              code: 200,\n              events_ingested: payload.events.length,\n              payload_size_bytes: data.length,\n              server_upload_time: Date.now(),\n            }),\n          );\n        }\n        return resolve(this.buildResponse({ code: 500 }));\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n}\n", "import { getOldCookieName, Storage, UserSession } from '@amplitude/analytics-core';\n\nexport const parseLegacyCookies = async (\n  apiKey: string,\n  cookieStorage: Storage<UserSession>,\n  deleteLegacyCookies = true,\n): Promise<UserSession> => {\n  const cookieName = getOldCookieName(apiKey);\n  const cookies = await cookieStorage.getRaw(cookieName);\n  if (!cookies) {\n    return {\n      optOut: false,\n    };\n  }\n  if (deleteLegacyCookies) {\n    await cookieStorage.remove(cookieName);\n  }\n  const [deviceId, userId, optOut, sessionId, lastEventTime, lastEventId] = cookies.split('.');\n  return {\n    deviceId,\n    userId: decode(userId),\n    sessionId: parseTime(sessionId),\n    lastEventId: parseTime(lastEventId),\n    lastEventTime: parseTime(lastEventTime),\n    optOut: Boolean(optOut),\n  };\n};\n\nexport const parseTime = (num: string) => {\n  const integer = parseInt(num, 32);\n  if (isNaN(integer)) {\n    return undefined;\n  }\n  return integer;\n};\n\nexport const decode = (value?: string): string | undefined => {\n  if (!atob || !escape || !value) {\n    return undefined;\n  }\n  try {\n    return decodeURIComponent(escape(atob(value)));\n  } catch {\n    return undefined;\n  }\n};\n", "import { IdentityStorageType, ServerZoneType } from '@amplitude/analytics-core';\n\nexport const DEFAULT_EVENT_PREFIX = '[Amplitude]';\n\nexport const DEFAULT_PAGE_VIEW_EVENT = `${DEFAULT_EVENT_PREFIX} Page Viewed`;\nexport const DEFAULT_FORM_START_EVENT = `${DEFAULT_EVENT_PREFIX} Form Started`;\nexport const DEFAULT_FORM_SUBMIT_EVENT = `${DEFAULT_EVENT_PREFIX} Form Submitted`;\nexport const DEFAULT_FILE_DOWNLOAD_EVENT = `${DEFAULT_EVENT_PREFIX} File Downloaded`;\nexport const DEFAULT_SESSION_START_EVENT = 'session_start';\nexport const DEFAULT_SESSION_END_EVENT = 'session_end';\n\nexport const FILE_EXTENSION = `${DEFAULT_EVENT_PREFIX} File Extension`;\nexport const FILE_NAME = `${DEFAULT_EVENT_PREFIX} File Name`;\nexport const LINK_ID = `${DEFAULT_EVENT_PREFIX} Link ID`;\nexport const LINK_TEXT = `${DEFAULT_EVENT_PREFIX} Link Text`;\nexport const LINK_URL = `${DEFAULT_EVENT_PREFIX} Link URL`;\n\nexport const FORM_ID = `${DEFAULT_EVENT_PREFIX} Form ID`;\nexport const FORM_NAME = `${DEFAULT_EVENT_PREFIX} Form Name`;\nexport const FORM_DESTINATION = `${DEFAULT_EVENT_PREFIX} Form Destination`;\n\nexport const DEFAULT_IDENTITY_STORAGE: IdentityStorageType = 'cookie';\nexport const DEFAULT_SERVER_ZONE: ServerZoneType = 'US';\n", "import {\n  Config,\n  Logger,\n  ILogger,\n  LogLevel,\n  Event,\n  Storage,\n  IngestionMetadata,\n  ServerZoneType,\n  OfflineDisabled,\n  Plan,\n  IdentityStorageType,\n  TransportTypeOrOptions,\n  MemoryStorage,\n  UUID,\n  CookieStorage,\n  getCookieName,\n  FetchTransport,\n  getQueryParams,\n  UserSession,\n  BrowserOptions,\n  BrowserConfig as IBrowserConfig,\n  DefaultTrackingOptions,\n  TrackingOptions,\n  AutocaptureOptions,\n  CookieOptions,\n  RemoteConfigOptions,\n  NetworkTrackingOptions,\n  IIdentify,\n  IDiagnosticsClient,\n  isDomainEqual,\n  CookieStorageConfig,\n  decodeCookieValue,\n} from '@amplitude/analytics-core';\n\nimport { LocalStorage } from './storage/local-storage';\nimport { SessionStorage } from './storage/session-storage';\nimport { XHRTransport } from './transports/xhr';\nimport { SendBeaconTransport } from './transports/send-beacon';\nimport { parseLegacyCookies } from './cookie-migration';\nimport { DEFAULT_IDENTITY_STORAGE, DEFAULT_SERVER_ZONE } from './constants';\nimport { AmplitudeBrowser } from './browser-client';\nimport { VERSION } from './version';\n\n// Exported for testing purposes only. Do not expose to public interface.\nexport class BrowserConfig extends Config implements IBrowserConfig {\n  public readonly version = VERSION;\n  protected _cookieStorage: Storage<UserSession>;\n  protected _deviceId?: string;\n  protected _lastEventId?: number;\n  protected _lastEventTime?: number;\n  protected _optOut = false;\n  protected _sessionId?: number;\n  protected _userId?: string;\n  protected _pageCounter?: number;\n  protected _debugLogsEnabled?: boolean;\n  constructor(\n    public apiKey: string,\n    public appVersion?: string,\n    cookieStorage: Storage<UserSession> = new MemoryStorage(),\n    public cookieOptions: CookieOptions = {\n      domain: '',\n      expiration: 365,\n      sameSite: 'Lax' as const,\n      secure: false,\n      upgrade: true,\n    },\n    public defaultTracking?: boolean | DefaultTrackingOptions,\n    public autocapture?: boolean | AutocaptureOptions,\n    deviceId?: string,\n    public flushIntervalMillis: number = 1000,\n    public flushMaxRetries: number = 5,\n    public flushQueueSize: number = 30,\n    public identityStorage: IdentityStorageType = DEFAULT_IDENTITY_STORAGE,\n    public ingestionMetadata?: IngestionMetadata,\n    public instanceName?: string,\n    lastEventId?: number,\n    lastEventTime?: number,\n    public loggerProvider: ILogger = new Logger(),\n    public logLevel: LogLevel = LogLevel.Warn,\n    public minIdLength?: number,\n    public offline: boolean | typeof OfflineDisabled = false,\n    optOut = false,\n    public partnerId?: string,\n    public plan?: Plan,\n    public serverUrl: string = '',\n    public serverZone: ServerZoneType = DEFAULT_SERVER_ZONE,\n    sessionId?: number,\n    public sessionTimeout: number = 30 * 60 * 1000,\n    public storageProvider: Storage<Event[]> = new LocalStorage({ loggerProvider }),\n    public trackingOptions: Required<TrackingOptions> = {\n      ipAddress: true,\n      language: true,\n      platform: true,\n    },\n    public transport: TransportTypeOrOptions = 'fetch',\n    public useBatch: boolean = false,\n    public fetchRemoteConfig: boolean = true,\n    userId?: string,\n    pageCounter?: number,\n    debugLogsEnabled?: boolean,\n    public networkTrackingOptions?: NetworkTrackingOptions,\n    public identify?: IIdentify,\n    public enableDiagnostics: boolean = true,\n    public diagnosticsSampleRate: number = 0,\n    public diagnosticsClient?: IDiagnosticsClient,\n    public remoteConfig?: RemoteConfigOptions,\n  ) {\n    super({ apiKey, storageProvider, transportProvider: createTransport(transport) });\n    this._cookieStorage = cookieStorage;\n    this.deviceId = deviceId;\n    this.lastEventId = lastEventId;\n    this.lastEventTime = lastEventTime;\n    this.optOut = optOut;\n    this.sessionId = sessionId;\n    this.pageCounter = pageCounter;\n    this.userId = userId;\n    this.debugLogsEnabled = debugLogsEnabled;\n    this.loggerProvider.enable(debugLogsEnabled ? LogLevel.Debug : this.logLevel);\n    this.networkTrackingOptions = networkTrackingOptions;\n    this.identify = identify;\n    this.enableDiagnostics = enableDiagnostics;\n    this.diagnosticsSampleRate = diagnosticsSampleRate;\n    this.diagnosticsClient = diagnosticsClient;\n\n    // Note: The canonical logic for determining fetchRemoteConfig is in shouldFetchRemoteConfig().\n    // This logic is duplicated here to maintain the BrowserConfig constructor contract and ensure\n    // the config object has the correct fetchRemoteConfig value set on its properties.\n    // The value passed to this constructor should already be computed via shouldFetchRemoteConfig().\n    const _fetchRemoteConfig = remoteConfig?.fetchRemoteConfig ?? fetchRemoteConfig;\n    this.remoteConfig = this.remoteConfig || {};\n    this.remoteConfig.fetchRemoteConfig = _fetchRemoteConfig;\n    this.fetchRemoteConfig = _fetchRemoteConfig;\n  }\n\n  get cookieStorage() {\n    return this._cookieStorage;\n  }\n\n  set cookieStorage(cookieStorage: Storage<UserSession>) {\n    if (this._cookieStorage !== cookieStorage) {\n      this._cookieStorage = cookieStorage;\n      this.updateStorage();\n    }\n  }\n\n  get deviceId() {\n    return this._deviceId;\n  }\n\n  set deviceId(deviceId: string | undefined) {\n    if (this._deviceId !== deviceId) {\n      this._deviceId = deviceId;\n      this.updateStorage();\n    }\n  }\n\n  get userId() {\n    return this._userId;\n  }\n\n  set userId(userId: string | undefined) {\n    if (this._userId !== userId) {\n      this._userId = userId;\n      this.updateStorage();\n    }\n  }\n\n  get sessionId() {\n    return this._sessionId;\n  }\n\n  set sessionId(sessionId: number | undefined) {\n    if (this._sessionId !== sessionId) {\n      this._sessionId = sessionId;\n      this.updateStorage();\n    }\n  }\n\n  get optOut() {\n    return this._optOut;\n  }\n\n  set optOut(optOut: boolean) {\n    if (this._optOut !== optOut) {\n      this._optOut = optOut;\n      this.updateStorage();\n    }\n  }\n\n  get lastEventTime() {\n    return this._lastEventTime;\n  }\n\n  set lastEventTime(lastEventTime: number | undefined) {\n    if (this._lastEventTime !== lastEventTime) {\n      this._lastEventTime = lastEventTime;\n      this.updateStorage();\n    }\n  }\n\n  get lastEventId() {\n    return this._lastEventId;\n  }\n\n  set lastEventId(lastEventId: number | undefined) {\n    if (this._lastEventId !== lastEventId) {\n      this._lastEventId = lastEventId;\n      this.updateStorage();\n    }\n  }\n\n  get pageCounter() {\n    return this._pageCounter;\n  }\n\n  set pageCounter(pageCounter: number | undefined) {\n    if (this._pageCounter !== pageCounter) {\n      this._pageCounter = pageCounter;\n      this.updateStorage();\n    }\n  }\n\n  set debugLogsEnabled(debugLogsEnabled: boolean | undefined) {\n    if (this._debugLogsEnabled !== debugLogsEnabled) {\n      this._debugLogsEnabled = debugLogsEnabled;\n      this.updateStorage();\n    }\n  }\n\n  private updateStorage() {\n    const cache = {\n      deviceId: this._deviceId,\n      userId: this._userId,\n      sessionId: this._sessionId,\n      optOut: this._optOut,\n      lastEventTime: this._lastEventTime,\n      lastEventId: this._lastEventId,\n      pageCounter: this._pageCounter,\n      debugLogsEnabled: this._debugLogsEnabled,\n      cookieDomain: undefined as string | undefined,\n    };\n\n    if (this.cookieStorage instanceof CookieStorage) {\n      cache.cookieDomain = this.cookieStorage.options.domain;\n    }\n\n    void this.cookieStorage.set(getCookieName(this.apiKey), cache);\n  }\n}\n\n/**\n * Early-initialized configuration values that are determined before useBrowserConfig is called.\n * These are created early to support DiagnosticsClient and RemoteConfigClient initialization.\n */\nexport interface EarlyConfig {\n  /** Logger instance - shared across DiagnosticsClient, RemoteConfigClient, and BrowserConfig */\n  loggerProvider: ILogger;\n  /** Server zone for API endpoints */\n  serverZone: ServerZoneType;\n  /** Whether diagnostics is enabled (may come from remote config) */\n  enableDiagnostics: boolean;\n  /** Diagnostics sample rate (may come from remote config) */\n  diagnosticsSampleRate: number;\n}\n\nexport const useBrowserConfig = async (\n  apiKey: string,\n  options: BrowserOptions = {},\n  amplitudeInstance: AmplitudeBrowser,\n  diagnosticsClient?: IDiagnosticsClient,\n  earlyConfig?: EarlyConfig,\n): Promise<IBrowserConfig> => {\n  // Step 1: Create identity storage instance\n  const identityStorage = options.identityStorage || DEFAULT_IDENTITY_STORAGE;\n  const cookieOptions = {\n    domain:\n      identityStorage !== DEFAULT_IDENTITY_STORAGE ? '' : options.cookieOptions?.domain ?? (await getTopLevelDomain()),\n    expiration: 365,\n    sameSite: 'Lax' as const,\n    secure: false,\n    upgrade: true,\n    ...options.cookieOptions,\n  };\n\n  const cookieConfig: CookieStorageConfig = {\n    // if more than one cookie with the same key exists,\n    // look for the cookie that has the domain attribute set to cookieOptions.domain\n    duplicateResolverFn: (value: string): boolean => {\n      const decodedValue = decodeCookieValue(value);\n      if (!decodedValue) {\n        return false;\n      }\n      const parsed = JSON.parse(decodedValue) as UserSession;\n      return isDomainEqual(parsed.cookieDomain, cookieOptions.domain);\n    },\n    diagnosticsClient: diagnosticsClient,\n  };\n  const cookieStorage = createCookieStorage<UserSession>(options.identityStorage, cookieOptions, cookieConfig);\n\n  // Step 1: Parse cookies using identity storage instance\n  const legacyCookies = await parseLegacyCookies(apiKey, cookieStorage, options.cookieOptions?.upgrade ?? true);\n  const previousCookies = await cookieStorage.get(getCookieName(apiKey));\n  const queryParams = getQueryParams();\n\n  // Check if ampTimestamp is present and valid\n  const ampTimestamp = queryParams.ampTimestamp ? Number(queryParams.ampTimestamp) : undefined;\n  const isWithinTimeLimit = ampTimestamp ? Date.now() < ampTimestamp : true;\n\n  // Step 3: Reconcile user identity\n  const deviceId =\n    options.deviceId ??\n    (isWithinTimeLimit ? queryParams.ampDeviceId ?? queryParams.deviceId : undefined) ??\n    previousCookies?.deviceId ??\n    legacyCookies.deviceId ??\n    UUID();\n  const lastEventId = previousCookies?.lastEventId ?? legacyCookies.lastEventId;\n  const lastEventTime = previousCookies?.lastEventTime ?? legacyCookies.lastEventTime;\n  const optOut = options.optOut ?? previousCookies?.optOut ?? legacyCookies.optOut;\n  const sessionId = previousCookies?.sessionId ?? legacyCookies.sessionId;\n  const userId = options.userId ?? previousCookies?.userId ?? legacyCookies.userId;\n  amplitudeInstance.previousSessionDeviceId = previousCookies?.deviceId ?? legacyCookies.deviceId;\n  amplitudeInstance.previousSessionUserId = previousCookies?.userId ?? legacyCookies.userId;\n\n  const trackingOptions = {\n    ipAddress: options.trackingOptions?.ipAddress ?? true,\n    language: options.trackingOptions?.language ?? true,\n    platform: options.trackingOptions?.platform ?? true,\n  };\n  const pageCounter = previousCookies?.pageCounter;\n  const debugLogsEnabled = previousCookies?.debugLogsEnabled;\n\n  // Override default tracking options if autocapture is set\n  if (options.autocapture !== undefined) {\n    options.defaultTracking = options.autocapture;\n  }\n\n  const browserConfig = new BrowserConfig(\n    apiKey,\n    options.appVersion,\n    cookieStorage,\n    cookieOptions,\n    options.defaultTracking,\n    options.autocapture,\n    deviceId,\n    options.flushIntervalMillis,\n    options.flushMaxRetries,\n    options.flushQueueSize,\n    identityStorage,\n    options.ingestionMetadata,\n    options.instanceName,\n    lastEventId,\n    lastEventTime,\n    // Use earlyConfig.loggerProvider to ensure consistent logger across DiagnosticsClient/RemoteConfigClient/BrowserConfig\n    earlyConfig?.loggerProvider ?? options.loggerProvider,\n    options.logLevel,\n    options.minIdLength,\n    options.offline,\n    optOut,\n    options.partnerId,\n    options.plan,\n    options.serverUrl,\n    // Use earlyConfig.serverZone to ensure consistent serverZone\n    earlyConfig?.serverZone ?? options.serverZone,\n    sessionId,\n    options.sessionTimeout,\n    options.storageProvider,\n    trackingOptions,\n    options.transport,\n    options.useBatch,\n    options.fetchRemoteConfig,\n    userId,\n    pageCounter,\n    debugLogsEnabled,\n    options.networkTrackingOptions,\n    options.identify,\n    // Use earlyConfig values (already has remote config applied), otherwise fall back to options\n    earlyConfig?.enableDiagnostics ?? options.enableDiagnostics,\n    earlyConfig?.diagnosticsSampleRate ?? amplitudeInstance._diagnosticsSampleRate,\n    diagnosticsClient,\n    options.remoteConfig,\n  );\n\n  if (!(await browserConfig.storageProvider.isEnabled())) {\n    browserConfig.loggerProvider.warn(\n      `Storage provider ${browserConfig.storageProvider.constructor.name} is not enabled. Falling back to MemoryStorage.`,\n    );\n    browserConfig.storageProvider = new MemoryStorage();\n  }\n\n  return browserConfig;\n};\n\nexport const createCookieStorage = <T>(\n  identityStorage: IdentityStorageType = DEFAULT_IDENTITY_STORAGE,\n  cookieOptions: CookieOptions = {},\n  cookieConfig?: CookieStorageConfig,\n) => {\n  switch (identityStorage) {\n    case 'localStorage':\n      return new LocalStorage<T>();\n    case 'sessionStorage':\n      return new SessionStorage<T>();\n    case 'none':\n      return new MemoryStorage<T>();\n    case 'cookie':\n    default:\n      return new CookieStorage<T>(\n        {\n          ...cookieOptions,\n          expirationDays: cookieOptions.expiration,\n        },\n        cookieConfig,\n      );\n  }\n};\n\n/**\n * Determines whether to fetch remote config based on options.\n * Extracted to allow early determination before useBrowserConfig is called.\n */\nexport const shouldFetchRemoteConfig = (options: BrowserOptions = {}): boolean => {\n  if (options.remoteConfig?.fetchRemoteConfig === true) {\n    // set to true if remoteConfig explicitly set to true\n    return true;\n  } else if (options.remoteConfig?.fetchRemoteConfig === false || options.fetchRemoteConfig === false) {\n    // set to false if either are set to false explicitly\n    return false;\n  } else {\n    // default to true if both undefined\n    return true;\n  }\n};\n\nexport const createTransport = (transport?: TransportTypeOrOptions) => {\n  const type = typeof transport === 'object' ? transport.type : transport;\n  const headers = typeof transport === 'object' ? transport.headers : undefined;\n\n  if (type === 'xhr') {\n    return new XHRTransport(headers);\n  }\n  if (type === 'beacon') {\n    // SendBeacon does not support custom headers\n    return new SendBeaconTransport();\n  }\n  return new FetchTransport(headers);\n};\n\nexport const getTopLevelDomain = async (url?: string) => {\n  if (\n    !(await new CookieStorage<number>().isEnabled()) ||\n    (!url && (typeof location === 'undefined' || !location.hostname))\n  ) {\n    return '';\n  }\n\n  const host = url ?? location.hostname;\n  const parts = host.split('.');\n  const levels = [];\n  const cookieKeyUniqueId = UUID();\n  const storageKey = `AMP_TLDTEST_${cookieKeyUniqueId.substring(0, 8)}`;\n\n  for (let i = parts.length - 2; i >= 0; --i) {\n    levels.push(parts.slice(i).join('.'));\n  }\n  for (let i = 0; i < levels.length; i++) {\n    const domain = levels[i];\n    const options = {\n      domain: '.' + domain,\n      expirationDays: 0.003, // expire in ~5 minutes\n    };\n    const storage = new CookieStorage<number>(options);\n    await storage.set(storageKey, 1);\n    const value = await storage.get(storageKey);\n    if (value) {\n      await storage.remove(storageKey);\n      return '.' + domain;\n    }\n  }\n\n  return '';\n};\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "export const omitUndefined = (input: Record<string, string | undefined>) => {\n  const obj: Record<string, string> = {};\n  for (const key in input) {\n    const val = input[key];\n    if (val) {\n      obj[key] = val;\n    }\n  }\n  return obj;\n};\n", "import {\n  getPageTitle,\n  replaceSensitiveString,\n  BrowserConfig,\n  BrowserClient,\n  EnrichmentPlugin,\n  Event,\n  IdentifyOperation,\n  IdentifyUserProperties,\n  ILogger,\n  CampaignParser,\n  getGlobalScope,\n  BASE_CAMPAIGN,\n} from '@amplitude/analytics-core';\nimport { CreatePageViewTrackingPlugin, Options } from './typings/page-view-tracking';\nimport { omitUndefined } from './utils';\n\nexport const defaultPageViewEvent = '[Amplitude] Page Viewed';\n\nexport const pageViewTrackingPlugin: CreatePageViewTrackingPlugin = (options: Options = {}) => {\n  let amplitude: BrowserClient | undefined;\n  const globalScope = getGlobalScope();\n  let loggerProvider: ILogger | undefined = undefined;\n  let isTracking = false;\n  let localConfig: BrowserConfig;\n  const { trackOn, trackHistoryChanges, eventType = defaultPageViewEvent } = options;\n\n  const getDecodeURI = (locationStr: string): string => {\n    let decodedLocationStr = locationStr;\n    try {\n      decodedLocationStr = decodeURI(locationStr);\n    } catch (e) {\n      /* istanbul ignore next */\n      loggerProvider?.error('Malformed URI sequence: ', e);\n    }\n\n    return decodedLocationStr;\n  };\n\n  const createPageViewEvent = async (): Promise<Event> => {\n    /* istanbul ignore next */\n    const locationHREF = getDecodeURI((typeof location !== 'undefined' && location.href) || '');\n    return {\n      event_type: eventType,\n      event_properties: {\n        ...(await getCampaignParams()),\n        '[Amplitude] Page Domain':\n          /* istanbul ignore next */ (typeof location !== 'undefined' && location.hostname) || '',\n        '[Amplitude] Page Location': locationHREF,\n        '[Amplitude] Page Path':\n          /* istanbul ignore next */ (typeof location !== 'undefined' && getDecodeURI(location.pathname)) || '',\n        '[Amplitude] Page Title': /* istanbul ignore next */ getPageTitle(replaceSensitiveString),\n        '[Amplitude] Page URL': locationHREF.split('?')[0],\n      },\n    };\n  };\n\n  const shouldTrackOnPageLoad = () => typeof trackOn === 'undefined' || (typeof trackOn === 'function' && trackOn());\n\n  /* istanbul ignore next */\n  let previousURL: string | null = typeof location !== 'undefined' ? location.href : null;\n\n  const trackHistoryPageView = async (): Promise<void> => {\n    const newURL = location.href;\n    const shouldTrackPageView =\n      shouldTrackHistoryPageView(trackHistoryChanges, newURL, previousURL || '') && shouldTrackOnPageLoad();\n    // Note: Update `previousURL` in the same clock tick as `shouldTrackHistoryPageView()`\n    // This was previously done after `amplitude?.track(await createPageViewEvent());` and\n    // causes a concurrency issue where app triggers `pushState` twice with the same URL target\n    // but `previousURL` is only updated after the second `pushState` producing two page viewed events\n    previousURL = newURL;\n\n    if (shouldTrackPageView) {\n      /* istanbul ignore next */\n      loggerProvider?.log('Tracking page view event');\n      amplitude?.track(await createPageViewEvent());\n    }\n  };\n\n  /* istanbul ignore next */\n  const trackHistoryPageViewWrapper = () => {\n    void trackHistoryPageView();\n  };\n\n  const plugin: EnrichmentPlugin = {\n    name: '@amplitude/plugin-page-view-tracking-browser',\n    type: 'enrichment',\n\n    setup: async (config: BrowserConfig, client: BrowserClient) => {\n      amplitude = client;\n      localConfig = config;\n\n      loggerProvider = config.loggerProvider;\n      loggerProvider.log('Installing @amplitude/plugin-page-view-tracking-browser');\n\n      isTracking = true;\n\n      if (globalScope) {\n        globalScope.addEventListener('popstate', trackHistoryPageViewWrapper);\n\n        /* istanbul ignore next */\n        // There is no global browser listener for changes to history, so we have\n        // to modify pushState directly.\n        // https://stackoverflow.com/a/64927639\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        globalScope.history.pushState = new Proxy(globalScope.history.pushState, {\n          apply: (target, thisArg, [state, unused, url]) => {\n            target.apply(thisArg, [state, unused, url]);\n            if (isTracking) {\n              void trackHistoryPageView();\n            }\n          },\n        });\n      }\n\n      if (shouldTrackOnPageLoad()) {\n        loggerProvider.log('Tracking page view event');\n\n        amplitude.track(await createPageViewEvent());\n      }\n    },\n\n    execute: async (event: Event) => {\n      if (trackOn === 'attribution' && isCampaignEvent(event)) {\n        /* istanbul ignore next */ // loggerProvider should be defined by the time execute is invoked\n        loggerProvider?.log('Enriching campaign event to page view event with campaign parameters');\n        const pageViewEvent = await createPageViewEvent();\n        event.event_type = pageViewEvent.event_type;\n        event.event_properties = {\n          ...event.event_properties,\n          ...pageViewEvent.event_properties,\n        };\n      }\n\n      // Update the pageCounter for the page view event\n      if (localConfig && event.event_type === eventType) {\n        localConfig.pageCounter = !localConfig.pageCounter ? 1 : localConfig.pageCounter + 1;\n        event.event_properties = {\n          ...event.event_properties,\n          '[Amplitude] Page Counter': localConfig.pageCounter,\n        };\n      }\n      return event;\n    },\n\n    teardown: async () => {\n      if (globalScope) {\n        globalScope.removeEventListener('popstate', trackHistoryPageViewWrapper);\n        isTracking = false;\n      }\n    },\n  };\n  return plugin;\n};\n\nconst getCampaignParams = async () => omitUndefined(await new CampaignParser().parse());\n\nconst isCampaignEvent = (event: Event) => {\n  if (event.event_type === '$identify' && event.user_properties) {\n    const properties = event.user_properties as IdentifyUserProperties;\n    const $set = properties[IdentifyOperation.SET] || {};\n    const $unset = properties[IdentifyOperation.UNSET] || {};\n    const userProperties = [...Object.keys($set), ...Object.keys($unset)];\n    return Object.keys(BASE_CAMPAIGN).every((value) => userProperties.includes(value));\n  }\n  return false;\n};\n\nexport const shouldTrackHistoryPageView = (\n  trackingOption: Options['trackHistoryChanges'],\n  newURLStr: string,\n  oldURLStr: string,\n): boolean => {\n  switch (trackingOption) {\n    case 'pathOnly': {\n      if (oldURLStr == '') return true;\n      const newURL = new URL(newURLStr);\n      const oldURL = new URL(oldURLStr);\n      const newBaseStr = newURL.origin + newURL.pathname;\n      const oldBaseStr = oldURL.origin + oldURL.pathname;\n      return newBaseStr !== oldBaseStr;\n    }\n    default:\n      return newURLStr !== oldURLStr;\n  }\n};\n", "import {\n  DEFAULT_FORM_START_EVENT,\n  DEFAULT_FORM_SUBMIT_EVENT,\n  FORM_ID,\n  FORM_NAME,\n  FORM_DESTINATION,\n} from '../constants';\nimport { BrowserConfig } from '../config';\nimport {\n  getGlobalScope,\n  Event as AmplitudeEvent,\n  EnrichmentPlugin,\n  BrowserClient,\n  FormInteractionsOptions,\n} from '@amplitude/analytics-core';\nimport { getFormInteractionsConfig } from '../default-tracking';\n\ninterface EventListener {\n  element: Element;\n  type: 'change' | 'submit';\n  handler: (event: Event) => void;\n}\n\nexport const formInteractionTracking = (): EnrichmentPlugin => {\n  let observer: MutationObserver | undefined;\n  let eventListeners: EventListener[] = [];\n\n  const addEventListener = (element: Element, type: 'change' | 'submit', handler: (event: Event) => void) => {\n    element.addEventListener(type, handler);\n    eventListeners.push({\n      element,\n      type,\n      handler,\n    });\n  };\n\n  const removeClickListeners = () => {\n    eventListeners.forEach(({ element, type, handler }) => {\n      /* istanbul ignore next */\n      element?.removeEventListener(type, handler);\n    });\n    eventListeners = [];\n  };\n\n  let formInteractionsConfig: FormInteractionsOptions | undefined;\n\n  const name = '@amplitude/plugin-form-interaction-tracking-browser';\n  const type = 'enrichment';\n  const setup = async (config: BrowserConfig, amplitude: BrowserClient) => {\n    formInteractionsConfig = getFormInteractionsConfig(config);\n\n    const initializeFormTracking = () => {\n      /* istanbul ignore if */\n      if (!amplitude) {\n        // TODO: Add required minimum version of @amplitude/analytics-browser\n        config.loggerProvider.warn(\n          'Form interaction tracking requires a later version of @amplitude/analytics-browser. Form interaction events are not tracked.',\n        );\n        return;\n      }\n\n      /* istanbul ignore if */\n      if (typeof document === 'undefined') {\n        return;\n      }\n\n      const addFormInteractionListener = (form: HTMLFormElement) => {\n        let hasFormChanged = false;\n\n        addEventListener(form, 'change', () => {\n          const formDestination = extractFormAction(form);\n          if (!hasFormChanged) {\n            amplitude.track(DEFAULT_FORM_START_EVENT, {\n              [FORM_ID]: stringOrUndefined(form.id),\n              [FORM_NAME]: stringOrUndefined(form.name),\n              [FORM_DESTINATION]: formDestination,\n            });\n          }\n          hasFormChanged = true;\n        });\n\n        addEventListener(form, 'submit', (event: Event) => {\n          const formDestination = extractFormAction(form);\n          if (!hasFormChanged) {\n            amplitude.track(DEFAULT_FORM_START_EVENT, {\n              [FORM_ID]: stringOrUndefined(form.id),\n              [FORM_NAME]: stringOrUndefined(form.name),\n              [FORM_DESTINATION]: formDestination,\n            });\n          }\n          hasFormChanged = true;\n\n          // Check if shouldTrackSubmit callback is provided and use it to determine whether to track form_submit\n          if (formInteractionsConfig?.shouldTrackSubmit !== undefined) {\n            if (\n              typeof formInteractionsConfig.shouldTrackSubmit === 'function' &&\n              typeof SubmitEvent !== 'undefined' &&\n              event instanceof SubmitEvent\n            ) {\n              try {\n                const shouldTrack = formInteractionsConfig.shouldTrackSubmit(event);\n                if (!shouldTrack) {\n                  return;\n                }\n              } catch (e) {\n                config.loggerProvider.warn('shouldTrackSubmit callback threw an error, proceeding with tracking.');\n              }\n            } else {\n              config.loggerProvider.warn(\n                'shouldTrackSubmit is ignored because it is not a function or event is not a SubmitEvent.',\n              );\n            }\n          }\n\n          amplitude.track(DEFAULT_FORM_SUBMIT_EVENT, {\n            [FORM_ID]: stringOrUndefined(form.id),\n            [FORM_NAME]: stringOrUndefined(form.name),\n            [FORM_DESTINATION]: formDestination,\n          });\n          hasFormChanged = false;\n        });\n      };\n\n      // Adds listener to existing anchor tags\n      const forms = Array.from(document.getElementsByTagName('form'));\n      forms.forEach(addFormInteractionListener);\n\n      // Adds listener to anchor tags added after initial load\n      /* istanbul ignore else */\n      if (typeof MutationObserver !== 'undefined') {\n        observer = new MutationObserver((mutations) => {\n          mutations.forEach((mutation) => {\n            mutation.addedNodes.forEach((node) => {\n              if (node.nodeName === 'FORM') {\n                addFormInteractionListener(node as HTMLFormElement);\n              }\n              if ('querySelectorAll' in node && typeof node.querySelectorAll === 'function') {\n                Array.from(node.querySelectorAll('form') as HTMLFormElement[]).map(addFormInteractionListener);\n              }\n            });\n          });\n        });\n\n        observer.observe(document.body, {\n          subtree: true,\n          childList: true,\n        });\n      }\n    };\n\n    // If the document is already loaded, initialize immediately.\n    if (document.readyState === 'complete') {\n      initializeFormTracking();\n    } else {\n      // Otherwise, wait for the load event.\n      // The form interaction plugin observes changes in the dom. For this to work correctly, the observer can only be setup\n      // after the body is built. When Amplitude gets initialized in a script tag, the body tag is still unavailable. So register this\n      // only after the window is loaded\n      const window = getGlobalScope();\n      /* istanbul ignore else*/\n      if (window) {\n        window.addEventListener('load', initializeFormTracking);\n      } else {\n        config.loggerProvider.debug('Form interaction tracking is not installed because global is undefined.');\n      }\n    }\n  };\n  const execute = async (event: AmplitudeEvent) => event;\n  const teardown = async () => {\n    observer?.disconnect();\n    removeClickListeners();\n  };\n\n  return {\n    name,\n    type,\n    setup,\n    execute,\n    teardown,\n  };\n};\n\nexport const stringOrUndefined = <T>(name: T): T extends string ? string : undefined => {\n  /* istanbul ignore if */\n  if (typeof name !== 'string') {\n    // We found instances where the value of `name` is an Element and not a string.\n    // Elements may have circular references and would throw an error when passed to `JSON.stringify(...)`.\n    // If a non-string value is seen, assume there is no value.\n    return undefined as T extends string ? string : undefined;\n  }\n\n  return name as T extends string ? string : undefined;\n};\n\n// Extracts the form action attribute, and normalizes it to a valid URL to preserve the previous behavior of accessing the action property directly.\nexport const extractFormAction = (form: HTMLFormElement): string | null => {\n  let formDestination = form.getAttribute('action');\n  try {\n    // eslint-disable-next-line no-restricted-globals\n    formDestination = new URL(encodeURI(formDestination ?? ''), window.location.href).href;\n  } catch {\n    //\n  }\n  return formDestination;\n};\n", "import { DEFAULT_FILE_DOWNLOAD_EVENT, FILE_EXTENSION, FILE_NAME, LINK_ID, LINK_TEXT, LINK_URL } from '../constants';\nimport { BrowserConfig } from '../config';\nimport { getGlobalScope, Event, EnrichmentPlugin, BrowserClient } from '@amplitude/analytics-core';\n\ninterface EventListener {\n  element: Element;\n  type: 'click';\n  handler: () => void;\n}\n\nexport const fileDownloadTracking = (): EnrichmentPlugin => {\n  let observer: MutationObserver | undefined;\n  let eventListeners: EventListener[] = [];\n  const addEventListener = (element: Element, type: 'click', handler: () => void) => {\n    element.addEventListener(type, handler);\n    eventListeners.push({\n      element,\n      type,\n      handler,\n    });\n  };\n  const removeClickListeners = () => {\n    eventListeners.forEach(({ element, type, handler }) => {\n      /* istanbul ignore next */\n      element?.removeEventListener(type, handler);\n    });\n    eventListeners = [];\n  };\n\n  const name = '@amplitude/plugin-file-download-tracking-browser';\n  const type = 'enrichment';\n\n  const setup = async (config: BrowserConfig, amplitude: BrowserClient) => {\n    const initializeFileDownloadTracking = () => {\n      /* istanbul ignore if */\n      if (!amplitude) {\n        // TODO: Add required minimum version of @amplitude/analytics-browser\n        config.loggerProvider.warn(\n          'File download tracking requires a later version of @amplitude/analytics-browser. File download events are not tracked.',\n        );\n        return;\n      }\n\n      /* istanbul ignore if */\n      if (typeof document === 'undefined') {\n        return;\n      }\n\n      const addFileDownloadListener = (a: HTMLAnchorElement) => {\n        let url: URL;\n        try {\n          // eslint-disable-next-line no-restricted-globals\n          url = new URL(a.href, window.location.href);\n        } catch {\n          /* istanbul ignore next */\n          return;\n        }\n        const result = ext.exec(url.href);\n        const fileExtension = result?.[1];\n\n        if (fileExtension) {\n          addEventListener(a, 'click', () => {\n            if (fileExtension) {\n              amplitude.track(DEFAULT_FILE_DOWNLOAD_EVENT, {\n                [FILE_EXTENSION]: fileExtension,\n                [FILE_NAME]: url.pathname,\n                [LINK_ID]: a.id,\n                [LINK_TEXT]: a.text,\n                [LINK_URL]: a.href,\n              });\n            }\n          });\n        }\n      };\n\n      const ext =\n        /\\.(pdf|xlsx?|docx?|txt|rtf|csv|exe|key|pp(s|t|tx)|7z|pkg|rar|gz|zip|avi|mov|mp4|mpe?g|wmv|midi?|mp3|wav|wma)(\\?.+)?$/;\n\n      // Adds listener to existing anchor tags\n      const links = Array.from(document.getElementsByTagName('a'));\n      links.forEach(addFileDownloadListener);\n\n      // Adds listener to anchor tags added after initial load\n      /* istanbul ignore else */\n      if (typeof MutationObserver !== 'undefined') {\n        observer = new MutationObserver((mutations) => {\n          mutations.forEach((mutation) => {\n            mutation.addedNodes.forEach((node) => {\n              if (node.nodeName === 'A') {\n                addFileDownloadListener(node as HTMLAnchorElement);\n              }\n              if ('querySelectorAll' in node && typeof node.querySelectorAll === 'function') {\n                Array.from(node.querySelectorAll('a') as HTMLAnchorElement[]).map(addFileDownloadListener);\n              }\n            });\n          });\n        });\n\n        observer.observe(document.body, {\n          subtree: true,\n          childList: true,\n        });\n      }\n    };\n\n    // If the document is already loaded, initialize immediately.\n    /* istanbul ignore else*/\n    if (document.readyState === 'complete') {\n      initializeFileDownloadTracking();\n    } else {\n      // Otherwise, wait for the load event.\n      const window = getGlobalScope();\n      /* istanbul ignore else*/\n      if (window) {\n        window.addEventListener('load', initializeFileDownloadTracking);\n      } else {\n        config.loggerProvider.debug('File download tracking is not installed because global is undefined.');\n      }\n    }\n  };\n\n  const execute = async (event: Event) => event;\n  const teardown = async () => {\n    observer?.disconnect();\n    removeClickListeners();\n  };\n\n  return {\n    name,\n    type,\n    setup,\n    execute,\n    teardown,\n  };\n};\n", "import { BrowserConfig } from '@amplitude/analytics-core';\n\nlet notified = false;\n\nexport const detNotify = (config: BrowserConfig): void => {\n  if (notified || config.defaultTracking !== undefined) {\n    return;\n  }\n\n  const message = `\\`options.defaultTracking\\` is set to undefined. This implicitly configures your Amplitude instance to track Page Views, Sessions, File Downloads, and Form Interactions. You can suppress this warning by explicitly setting a value to \\`options.defaultTracking\\`. The value must either be a boolean, to enable and disable all default events, or an object, for advanced configuration. For example:\n\namplitude.init(<YOUR_API_KEY>, {\n  defaultTracking: true,\n});\n\nVisit https://www.docs.developers.amplitude.com/data/sdks/browser-2/#tracking-default-events for more details.`;\n  config.loggerProvider.warn(message);\n  notified = true;\n};\n\n/**\n * @private\n * This function is meant for testing purposes only\n */\nexport const resetNotify = () => {\n  notified = false;\n};\n", "import { getGlobalScope, BeforePlugin, BrowserClient, BrowserConfig } from '@amplitude/analytics-core';\n\ninterface EventListener {\n  type: 'online' | 'offline';\n  handler: () => void;\n}\n\nexport const networkConnectivityCheckerPlugin = (): BeforePlugin => {\n  const name = '@amplitude/plugin-network-checker-browser';\n  const type = 'before' as const;\n  const globalScope = getGlobalScope();\n  let eventListeners: EventListener[] = [];\n\n  const addNetworkListener = (type: 'online' | 'offline', handler: () => void) => {\n    /* istanbul ignore next */\n    if (globalScope?.addEventListener) {\n      globalScope?.addEventListener(type, handler);\n      eventListeners.push({\n        type,\n        handler,\n      });\n    }\n  };\n\n  const removeNetworkListeners = () => {\n    eventListeners.forEach(({ type, handler }) => {\n      /* istanbul ignore next */\n      globalScope?.removeEventListener(type, handler);\n    });\n    eventListeners = [];\n  };\n\n  const setup = async (config: BrowserConfig, amplitude: BrowserClient) => {\n    if (typeof navigator === 'undefined') {\n      config.loggerProvider.debug(\n        'Network connectivity checker plugin is disabled because navigator is not available.',\n      );\n      config.offline = false;\n      return;\n    }\n\n    config.offline = !navigator.onLine;\n\n    addNetworkListener('online', () => {\n      config.loggerProvider.debug('Network connectivity changed to online.');\n      config.offline = false;\n      // Flush immediately will cause ERR_NETWORK_CHANGED\n      setTimeout(() => {\n        amplitude.flush();\n      }, config.flushIntervalMillis);\n    });\n\n    addNetworkListener('offline', () => {\n      config.loggerProvider.debug('Network connectivity changed to offline.');\n      config.offline = true;\n    });\n  };\n\n  const teardown = async () => {\n    removeNetworkListeners();\n  };\n\n  return {\n    name,\n    type,\n    setup,\n    teardown,\n  };\n};\n", "import {\n  AutocaptureOptions,\n  type ElementInteractionsOptions,\n  BrowserConfig,\n  RemoteConfig,\n  NetworkTrackingOptions,\n  NetworkCaptureRule,\n  SAFE_HEADERS,\n} from '@amplitude/analytics-core';\n\nexport interface AutocaptureOptionsRemoteConfig extends AutocaptureOptions {\n  elementInteractions?: boolean | ElementInteractionsOptionsRemoteConfig;\n  networkTracking?: boolean | NetworkTrackingOptionsRemoteConfig;\n}\nexport interface ElementInteractionsOptionsRemoteConfig extends ElementInteractionsOptions {\n  /**\n   * Related to pageUrlAllowlist but holds regex strings which will be initialized and appended to pageUrlAllowlist\n   */\n  pageUrlAllowlistRegex?: string[];\n}\n\nexport interface NetworkCaptureRuleRemoteConfig extends NetworkCaptureRule {\n  /**\n   * Related to urls but holds regex strings which will be initialized and appended to urls\n   */\n  urlsRegex?: string[];\n}\n\nexport interface NetworkTrackingOptionsRemoteConfig extends NetworkTrackingOptions {\n  /**\n   * Related to pageUrlAllowlist but holds regex strings which will be initialized and appended to pageUrlAllowlist\n   */\n  captureRules?: NetworkCaptureRuleRemoteConfig[];\n}\n\n// Type alias for the remote config structure we expect (this is what comes from the filtered browserSDK config)\ntype RemoteConfigBrowserSDK = {\n  autocapture?: AutocaptureOptionsRemoteConfig | boolean;\n};\n\n/**\n * Performs a deep transformation of a remote config object so that\n * it matches the expected schema of the local config.\n *\n * Specifically, it normalizes nested `enabled` flags into concise union types.\n *\n * ### Transformation Rules:\n * - If an object has `enabled: true`, it is replaced by the same object without the `enabled` field.\n * - If it has only `enabled: true`, it is replaced with `true`.\n * - If it has `enabled: false`, it is replaced with `false` regardless of other fields.\n *\n * ### Examples:\n * Input:  { prop: { enabled: true, hello: 'world' }}\n * Output: { prop: { hello: 'world' } }\n *\n * Input:  { prop: { enabled: true }}\n * Output: { prop: true }\n *\n * Input:  { prop: { enabled: false, hello: 'world' }}\n * Output: { prop: false }\n *\n * Input:  { prop: { hello: 'world' }}\n * Output: { prop: { hello: 'world' } } // No change\n *\n * @param config Remote config object to be transformed\n * @returns Transformed config object compatible with local schema\n */\nexport function translateRemoteConfigToLocal(config?: Record<string, any>) {\n  // Disabling type checking rules because remote config comes from a remote source\n  // and this function needs to handle any unexpected values\n  /* eslint-disable @typescript-eslint/no-unsafe-member-access,\n     @typescript-eslint/no-unsafe-assignment,\n     @typescript-eslint/no-unsafe-argument\n */\n  if (typeof config !== 'object' || config === null) {\n    return;\n  }\n\n  // translations are not applied on array properties\n  if (Array.isArray(config)) {\n    return;\n  }\n\n  const propertyNames = Object.keys(config);\n  for (const propertyName of propertyNames) {\n    try {\n      const value = config[propertyName];\n      // transform objects with { enabled } property to boolean | object\n      if (typeof value?.enabled === 'boolean') {\n        if (value.enabled) {\n          // if enabled is true, set the value to the rest of the object\n          // or true if the object has no other properties\n          delete value.enabled;\n          if (Object.keys(value).length === 0) {\n            (config as any)[propertyName] = true;\n          }\n        } else {\n          // If enabled is false, set the value to false\n          (config as any)[propertyName] = false;\n        }\n      }\n\n      // recursively translate properties of the value\n      translateRemoteConfigToLocal(value as Record<string, any>);\n    } catch (e) {\n      // a failure here means that an accessor threw an error\n      // so don't translate it\n      // TODO(diagnostics): add a diagnostic event for this\n    }\n  }\n\n  // translate remote responseHeaders and requestHeaders to local responseHeaders and requestHeaders\n  try {\n    if (config.autocapture?.networkTracking?.captureRules?.length) {\n      for (const rule of config.autocapture.networkTracking.captureRules) {\n        for (const header of ['responseHeaders', 'requestHeaders']) {\n          const { captureSafeHeaders, allowlist } = rule[header] ?? {};\n          if (!captureSafeHeaders && !allowlist) {\n            continue;\n          }\n          // if allowlist is not an array, remote config contract is violated, remove it\n          if (allowlist !== undefined && !Array.isArray(allowlist)) {\n            delete rule[header];\n            continue;\n          }\n          rule[header] = [...(captureSafeHeaders ? SAFE_HEADERS : []), ...(allowlist ?? [])];\n        }\n      }\n    }\n  } catch (e) {\n    /* istanbul ignore next */\n    // surprise exception, so don't translate it\n  }\n\n  // translate frustrationInteractions pluralization\n  const frustrationInteractions = config.autocapture?.frustrationInteractions;\n  if (frustrationInteractions) {\n    if (frustrationInteractions.rageClick) {\n      frustrationInteractions.rageClicks = frustrationInteractions.rageClick;\n      delete frustrationInteractions.rageClick;\n    }\n    if (frustrationInteractions.deadClick) {\n      frustrationInteractions.deadClicks = frustrationInteractions.deadClick;\n      delete frustrationInteractions.deadClick;\n    }\n  }\n}\n\nfunction mergeUrls(urlsExact: (string | RegExp)[], urlsRegex: string[] | undefined, browserConfig: BrowserConfig) {\n  // Convert string patterns to RegExp objects, warn on invalid patterns and skip them\n  const regexList = [];\n  for (const pattern of urlsRegex ?? []) {\n    try {\n      regexList.push(new RegExp(pattern));\n    } catch (regexError) {\n      browserConfig.loggerProvider.warn(`Invalid regex pattern: ${pattern}`, regexError);\n    }\n  }\n\n  return urlsExact.concat(regexList);\n}\n\n/**\n * Updates the browser config in place by applying remote configuration settings.\n * Primarily merges autocapture settings from the remote config into the browser config.\n *\n * @param remoteConfig - The remote configuration to apply, or null if none available\n * @param browserConfig - The browser config object to update (modified in place)\n */\nexport function updateBrowserConfigWithRemoteConfig(\n  remoteConfig: RemoteConfig | null,\n  browserConfig: BrowserConfig,\n): void {\n  if (!remoteConfig) {\n    return;\n  }\n\n  // translate remote config to local compatible format\n  translateRemoteConfigToLocal(remoteConfig);\n\n  try {\n    browserConfig.loggerProvider.debug(\n      'Update browser config with remote configuration:',\n      JSON.stringify(remoteConfig),\n    );\n\n    // type cast error will be thrown if remoteConfig is not a valid RemoteConfigBrowserSDK\n    // and it will be caught by the try-catch block\n    const typedRemoteConfig = remoteConfig as RemoteConfigBrowserSDK;\n\n    // merge remoteConfig.autocapture and browserConfig.autocapture\n    // if a field is in remoteConfig.autocapture, use that value\n    // if a field is not in remoteConfig.autocapture, use the value from browserConfig.autocapture\n    if (typedRemoteConfig && 'autocapture' in typedRemoteConfig) {\n      if (typeof typedRemoteConfig.autocapture === 'boolean') {\n        browserConfig.autocapture = typedRemoteConfig.autocapture;\n      }\n\n      if (typeof typedRemoteConfig.autocapture === 'object' && typedRemoteConfig.autocapture !== null) {\n        const transformedAutocaptureRemoteConfig = { ...typedRemoteConfig.autocapture };\n\n        if (browserConfig.autocapture === undefined) {\n          browserConfig.autocapture = typedRemoteConfig.autocapture;\n        }\n\n        // Handle Element Interactions config initialization\n        if (\n          typeof typedRemoteConfig.autocapture.elementInteractions === 'object' &&\n          typedRemoteConfig.autocapture.elementInteractions !== null &&\n          typedRemoteConfig.autocapture.elementInteractions.pageUrlAllowlistRegex?.length\n        ) {\n          transformedAutocaptureRemoteConfig.elementInteractions = {\n            ...typedRemoteConfig.autocapture.elementInteractions,\n          };\n          const transformedRcElementInteractions = transformedAutocaptureRemoteConfig.elementInteractions;\n\n          // combine exact allow list and regex allow list into just 'pageUrlAllowlist'\n          const exactAllowList = transformedRcElementInteractions.pageUrlAllowlist ?? [];\n          const urlsRegex = typedRemoteConfig.autocapture.elementInteractions.pageUrlAllowlistRegex;\n          transformedRcElementInteractions.pageUrlAllowlist = mergeUrls(exactAllowList, urlsRegex, browserConfig);\n\n          // clean up the regex allow list\n          delete transformedRcElementInteractions.pageUrlAllowlistRegex;\n        }\n\n        // Handle Network Tracking config initialization\n        if (\n          typeof typedRemoteConfig.autocapture.networkTracking === 'object' &&\n          typedRemoteConfig.autocapture.networkTracking !== null &&\n          typedRemoteConfig.autocapture.networkTracking.captureRules?.length\n        ) {\n          transformedAutocaptureRemoteConfig.networkTracking = {\n            ...typedRemoteConfig.autocapture.networkTracking,\n          };\n          const transformedRcNetworkTracking = transformedAutocaptureRemoteConfig.networkTracking;\n          /* istanbul ignore next */\n          const captureRules = transformedRcNetworkTracking.captureRules ?? [];\n          for (const rule of captureRules) {\n            rule.urls = mergeUrls(rule.urls ?? [], rule.urlsRegex, browserConfig);\n            delete rule.urlsRegex;\n          }\n        }\n\n        if (typeof browserConfig.autocapture === 'boolean') {\n          browserConfig.autocapture = {\n            attribution: browserConfig.autocapture,\n            fileDownloads: browserConfig.autocapture,\n            formInteractions: browserConfig.autocapture,\n            pageViews: browserConfig.autocapture,\n            sessions: browserConfig.autocapture,\n            elementInteractions: browserConfig.autocapture,\n            webVitals: browserConfig.autocapture,\n            frustrationInteractions: browserConfig.autocapture,\n            ...transformedAutocaptureRemoteConfig,\n          };\n        }\n\n        if (typeof browserConfig.autocapture === 'object') {\n          browserConfig.autocapture = {\n            ...browserConfig.autocapture,\n            ...transformedAutocaptureRemoteConfig,\n          };\n        }\n      }\n\n      // Override default tracking options if autocapture is updated by remote config\n      browserConfig.defaultTracking = browserConfig.autocapture;\n    }\n\n    browserConfig.loggerProvider.debug('Browser config after remote config update:', JSON.stringify(browserConfig));\n  } catch (e) {\n    browserConfig.loggerProvider.error('Failed to apply remote configuration because of error: ', e);\n  }\n}\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "export const VERSION = '1.19.0';\n", "export const PLUGIN_NAME = '@amplitude/plugin-autocapture-browser';\nexport const FRUSTRATION_PLUGIN_NAME = '@amplitude/plugin-frustration-browser';\n\nexport const AMPLITUDE_ELEMENT_CLICKED_EVENT = '[Amplitude] Element Clicked';\nexport const AMPLITUDE_ELEMENT_DEAD_CLICKED_EVENT = '[Amplitude] Dead Click';\nexport const AMPLITUDE_ELEMENT_RAGE_CLICKED_EVENT = '[Amplitude] Rage Click';\nexport const AMPLITUDE_ELEMENT_ERROR_CLICKED_EVENT = '[Amplitude] Error Click';\nexport const AMPLITUDE_ELEMENT_CHANGED_EVENT = '[Amplitude] Element Changed';\n\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_ID = '[Amplitude] Element ID';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_CLASS = '[Amplitude] Element Class';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_TAG = '[Amplitude] Element Tag';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_TEXT = '[Amplitude] Element Text';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_HIERARCHY = '[Amplitude] Element Hierarchy';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_HREF = '[Amplitude] Element Href';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_LEFT = '[Amplitude] Element Position Left';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_TOP = '[Amplitude] Element Position Top';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_ARIA_LABEL = '[Amplitude] Element Aria Label';\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_ATTRIBUTES = '[Amplitude] Element Attributes';\n\nexport const AMPLITUDE_EVENT_PROP_ELEMENT_PARENT_LABEL = '[Amplitude] Element Parent Label';\nexport const AMPLITUDE_EVENT_PROP_PAGE_URL = '[Amplitude] Page URL';\nexport const AMPLITUDE_EVENT_PROP_PAGE_TITLE = '[Amplitude] Page Title';\nexport const AMPLITUDE_EVENT_PROP_VIEWPORT_HEIGHT = '[Amplitude] Viewport Height';\nexport const AMPLITUDE_EVENT_PROP_VIEWPORT_WIDTH = '[Amplitude] Viewport Width';\n\n// Visual Tagging related constants\nexport const AMPLITUDE_ORIGIN = 'https://app.amplitude.com';\nexport const AMPLITUDE_ORIGIN_EU = 'https://app.eu.amplitude.com';\nexport const AMPLITUDE_ORIGIN_STAGING = 'https://apps.stag2.amplitude.com';\nexport const AMPLITUDE_ORIGINS_MAP = {\n  US: AMPLITUDE_ORIGIN,\n  EU: AMPLITUDE_ORIGIN_EU,\n  STAGING: AMPLITUDE_ORIGIN_STAGING,\n};\n\nexport const AMPLITUDE_VISUAL_TAGGING_SELECTOR_SCRIPT_URL =\n  'https://cdn.amplitude.com/libs/visual-tagging-selector-1.0.0-alpha.js.gz';\n// This is the class name used by the visual tagging selector to highlight the selected element.\n// Should not use this class in the selector.\nexport const AMPLITUDE_VISUAL_TAGGING_HIGHLIGHT_CLASS = 'amp-visual-tagging-selector-highlight';\n\n// Data attribute for specifying which attributes should be redacted from autocapture\nexport const DATA_AMP_MASK_ATTRIBUTES = 'data-amp-mask-attributes';\n\nexport const MAX_MASK_TEXT_PATTERNS = 25;\nexport const MAX_ATTRIBUTE_LENGTH = 128;\n", "/* eslint-disable no-restricted-globals */\nimport { ElementInteractionsOptions, ActionType, isUrlMatchAllowlist } from '@amplitude/analytics-core';\n\nexport type JSONValue = string | number | boolean | null | { [x: string]: JSONValue } | Array<JSONValue>;\n\nconst SENSITIVE_TAGS = ['input', 'select', 'textarea'];\n\nexport type shouldTrackEvent = (actionType: ActionType, element: Element) => boolean;\n\nexport const isElementPointerCursor = (element: Element, actionType: ActionType): boolean => {\n  /* istanbul ignore next */\n  const computedStyle = window?.getComputedStyle?.(element);\n  /* istanbul ignore next */\n  return computedStyle?.getPropertyValue('cursor') === 'pointer' && actionType === 'click';\n};\n\nexport const createShouldTrackEvent = (\n  autocaptureOptions: ElementInteractionsOptions,\n  allowlist: string[], // this can be any type of css selector allow list\n  isAlwaysCaptureCursorPointer = false,\n): shouldTrackEvent => {\n  return (actionType: ActionType, element: Element) => {\n    const { pageUrlAllowlist, pageUrlExcludelist, shouldTrackEventResolver } = autocaptureOptions;\n\n    /* istanbul ignore next */\n    const tag = element?.tagName?.toLowerCase?.();\n    // window, document, and Text nodes have no tag\n    if (!tag) {\n      return false;\n    }\n\n    if (shouldTrackEventResolver) {\n      return shouldTrackEventResolver(actionType, element);\n    }\n\n    // check if the URL is in the allow list\n    if (!isUrlMatchAllowlist(window.location.href, pageUrlAllowlist)) {\n      return false;\n    }\n\n    // check if the URL is in the excludelist\n    if (\n      pageUrlExcludelist &&\n      pageUrlExcludelist.length > 0 &&\n      isUrlMatchAllowlist(window.location.href, pageUrlExcludelist as (string | RegExp)[])\n    ) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    const elementType = String(element?.getAttribute('type')) || '';\n    if (typeof elementType === 'string') {\n      switch (elementType.toLowerCase()) {\n        case 'hidden':\n          return false;\n        case 'password':\n          return false;\n      }\n    }\n\n    const isCursorPointer = isElementPointerCursor(element, actionType);\n\n    if (isAlwaysCaptureCursorPointer && isCursorPointer) {\n      return true;\n    }\n\n    /* istanbul ignore if */\n    if (allowlist) {\n      const hasMatchAnyAllowedSelector = allowlist.some((selector) => !!element?.matches?.(selector));\n      if (!hasMatchAnyAllowedSelector) {\n        return false;\n      }\n    }\n\n    switch (tag) {\n      case 'input':\n      case 'select':\n      case 'textarea':\n        return actionType === 'change' || actionType === 'click';\n      default: {\n        /* istanbul ignore next */\n        /* istanbul ignore next */\n        if (isCursorPointer) {\n          return true;\n        }\n        return actionType === 'click';\n      }\n    }\n  };\n};\n\nexport const isTextNode = (node: Node) => {\n  return !!node && node.nodeType === 3;\n};\n\nexport const isNonSensitiveElement = (element: Element) => {\n  /* istanbul ignore next */\n  const tag = element?.tagName?.toLowerCase?.();\n  const isContentEditable =\n    element instanceof HTMLElement ? element.getAttribute('contenteditable')?.toLowerCase() === 'true' : false;\n\n  return !SENSITIVE_TAGS.includes(tag) && !isContentEditable;\n};\n\n/**\n * Collects redacted attribute names from element and ancestor elements with data-amp-mask-attributes\n * The 'id' and 'class' attributes cannot be redacted as they're critical for element identification\n * @param element - The target element to check for redaction attributes\n * @returns Set of attribute names that should be redacted\n */\n/**\n * Parses a comma-separated string of attribute names and filters out protected attributes\n * @param attributeString - Comma-separated string of attribute names\n * @returns Array of valid attribute names, excluding 'id' and 'class'\n */\nexport const parseAttributesToMask = (attributeString: string | null): string[] => {\n  return attributeString\n    ? attributeString\n        .split(',')\n        .map((attr) => attr.trim())\n        .filter((attr) => attr.length > 0 && attr !== 'id' && attr !== 'class') // Prevent 'id' and 'class' from being redacted as they're critical for element identification\n    : [];\n};\n\nexport const extractPrefixedAttributes = (\n  attrs: { [key: string]: string },\n  prefix: string,\n): { [key: string]: string } => {\n  return Object.entries(attrs).reduce((attributes: { [key: string]: string }, [attributeName, attributeValue]) => {\n    if (attributeName.startsWith(prefix)) {\n      const attributeKey = attributeName.replace(prefix, '');\n\n      if (attributeKey) {\n        attributes[attributeKey] = attributeValue || '';\n      }\n    }\n    return attributes;\n  }, {});\n};\n\nexport const isEmpty = (value: unknown) => {\n  return (\n    value === undefined ||\n    value === null ||\n    (typeof value === 'object' && Object.keys(value).length === 0) ||\n    (typeof value === 'string' && value.trim().length === 0)\n  );\n};\n\nexport const removeEmptyProperties = (properties: { [key: string]: unknown }): { [key: string]: unknown } => {\n  return Object.keys(properties).reduce((filteredProperties: { [key: string]: unknown }, key) => {\n    const value = properties[key];\n    if (!isEmpty(value)) {\n      filteredProperties[key] = value;\n    }\n    return filteredProperties;\n  }, {});\n};\n\nexport const querySelectUniqueElements = (root: Element | Document, selectors: string[]): Element[] => {\n  if (root && 'querySelectorAll' in root && typeof root.querySelectorAll === 'function') {\n    const elementSet = selectors.reduce((elements: Set<Element>, selector) => {\n      if (selector) {\n        const selectedElements = Array.from(root.querySelectorAll(selector));\n        selectedElements.forEach((element) => {\n          elements.add(element);\n        });\n      }\n      return elements;\n    }, new Set<Element>());\n    return Array.from(elementSet);\n  }\n  return [];\n};\n\n// Similar as element.closest, but works with multiple selectors\nexport const getClosestElement = (element: Element | null, selectors: string[]): Element | null => {\n  if (!element) {\n    return null;\n  }\n  /* istanbul ignore next */\n  if (selectors.some((selector) => element?.matches?.(selector))) {\n    return element;\n  }\n  /* istanbul ignore next */\n  return getClosestElement(element?.parentElement, selectors);\n};\n\nexport const asyncLoadScript = (url: string) => {\n  return new Promise((resolve, reject) => {\n    try {\n      const scriptElement = document.createElement('script');\n      scriptElement.type = 'text/javascript';\n      scriptElement.async = true;\n      scriptElement.src = url;\n      scriptElement.addEventListener(\n        'load',\n        () => {\n          resolve({ status: true });\n        },\n        { once: true },\n      );\n      scriptElement.addEventListener('error', () => {\n        reject({\n          status: false,\n          message: `Failed to load the script ${url}`,\n        });\n      });\n      /* istanbul ignore next */\n      document.head?.appendChild(scriptElement);\n    } catch (error) {\n      /* istanbul ignore next */\n      reject(error);\n    }\n  });\n};\n\nexport function generateUniqueId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport const filterOutNonTrackableEvents = (event: ElementBasedTimestampedEvent<ElementBasedEvent>): boolean => {\n  // Filter out changeEvent events with no target\n  // This could happen when change events are triggered programmatically\n  if (event.event.target === null || !event.closestTrackedAncestor) {\n    return false;\n  }\n\n  return true;\n};\n\nexport type AutoCaptureOptionsWithDefaults = Required<\n  Pick<ElementInteractionsOptions, 'debounceTime' | 'cssSelectorAllowlist' | 'actionClickAllowlist'>\n> &\n  ElementInteractionsOptions;\n\n// Base TimestampedEvent type\nexport type BaseTimestampedEvent<T> = {\n  event: T;\n  timestamp: number;\n  type: 'rage' | 'click' | 'change' | 'error' | 'navigate' | 'mutation';\n};\n\n// Specific types for events with targetElementProperties\nexport type ElementBasedEvent = MouseEvent | Event;\nexport type ElementBasedTimestampedEvent<T> = BaseTimestampedEvent<T> & {\n  event: MouseEvent | Event;\n  type: 'click' | 'change';\n  closestTrackedAncestor: Element;\n  targetElementProperties: Record<string, any>;\n};\n\nexport type evaluateTriggersFn = (\n  event: ElementBasedTimestampedEvent<ElementBasedEvent>,\n) => ElementBasedTimestampedEvent<ElementBasedEvent>;\n\n// Union type for all possible TimestampedEvents\nexport type TimestampedEvent<T> = BaseTimestampedEvent<T> | ElementBasedTimestampedEvent<T>;\n\n// Type predicate\nexport function isElementBasedEvent<T>(event: BaseTimestampedEvent<T>): event is ElementBasedTimestampedEvent<T> {\n  return event.type === 'click' || event.type === 'change';\n}\n\nexport interface NavigateEvent extends Event {\n  readonly navigationType: 'reload' | 'push' | 'replace' | 'traverse';\n  readonly destination: {\n    readonly url: string;\n    readonly key: string | null;\n    readonly id: string | null;\n    readonly index: number;\n    readonly sameDocument: boolean;\n\n    getState(): any;\n  };\n  readonly canIntercept: boolean;\n  readonly userInitiated: boolean;\n  readonly hashChange: boolean;\n  readonly signal: AbortSignal;\n  readonly formData: FormData | null;\n  readonly downloadRequest: string | null;\n  readonly info: any;\n  readonly hasUAVisualTransition: boolean;\n  /** @see https://github.com/WICG/navigation-api/pull/264 */\n  readonly sourceElement: Element | null;\n\n  scroll(): void;\n}\n\nexport enum MouseButton {\n  LEFT_OR_TOUCH_CONTACT = 0,\n  MIDDLE = 1,\n  RIGHT = 2,\n}\n", "import { isNonSensitiveElement } from './helpers';\nimport { DATA_AMP_MASK_ATTRIBUTES } from './constants';\nimport type { HierarchyNode } from './typings/autocapture';\nimport * as constants from './constants';\nimport { MASKED_TEXT_VALUE, TEXT_MASK_ATTRIBUTE } from '@amplitude/analytics-core';\n\nconst BLOCKED_ATTRIBUTES = new Set([\n  // Already captured elsewhere in the hierarchy object\n  'id',\n  'class',\n\n  // non-useful and potentially large attribute\n  'style',\n\n  // sensitive as prefilled form data may populate this attribute\n  'value',\n\n  // DOM events\n  'onclick',\n  'onchange',\n  'oninput',\n  'onblur',\n  'onsubmit',\n  'onfocus',\n  'onkeydown',\n  'onkeyup',\n  'onkeypress',\n\n  // React specific\n  'data-reactid',\n  'data-react-checksum',\n  'data-reactroot',\n\n  // Amplitude specific - used for redaction but should not be included in getElementProperties\n  DATA_AMP_MASK_ATTRIBUTES,\n  TEXT_MASK_ATTRIBUTE,\n]);\nconst SENSITIVE_ELEMENT_ATTRIBUTE_ALLOWLIST = ['type'];\n\nconst SVG_TAGS = ['svg', 'path', 'g'];\nconst HIGHLY_SENSITIVE_INPUT_TYPES = ['password', 'hidden'];\nexport const MAX_HIERARCHY_LENGTH = 1024;\n\nexport function getElementProperties(\n  element: Element | null,\n  userMaskedAttributeNames: Set<string>,\n): HierarchyNode | null {\n  if (element === null) {\n    return null;\n  }\n\n  const tagName = String(element.tagName).toLowerCase();\n  const properties: HierarchyNode = {\n    tag: tagName,\n  };\n\n  const siblings = Array.from(element.parentElement?.children ?? []);\n  if (siblings.length) {\n    properties.index = siblings.indexOf(element);\n    properties.indexOfType = siblings.filter((el) => el.tagName === element.tagName).indexOf(element);\n  }\n\n  const prevSiblingTag = element.previousElementSibling?.tagName?.toLowerCase();\n  if (prevSiblingTag) {\n    properties.prevSib = String(prevSiblingTag);\n  }\n\n  const id = element.getAttribute('id');\n  if (id) {\n    properties.id = String(id);\n  }\n\n  const classes = Array.from(element.classList);\n  if (classes.length) {\n    properties.classes = classes;\n  }\n\n  const attributes: Record<string, string> = {};\n  const attributesArray = Array.from(element.attributes);\n  const filteredAttributes = attributesArray.filter((attr) => !BLOCKED_ATTRIBUTES.has(attr.name));\n  const isSensitiveElement = !isNonSensitiveElement(element);\n\n  // if input is hidden or password or for SVGs, skip attribute collection entirely\n  if (!HIGHLY_SENSITIVE_INPUT_TYPES.includes(String(element.getAttribute('type'))) && !SVG_TAGS.includes(tagName)) {\n    for (const attr of filteredAttributes) {\n      // If sensitive element, only allow certain attributes\n      if (isSensitiveElement && !SENSITIVE_ELEMENT_ATTRIBUTE_ALLOWLIST.includes(attr.name)) {\n        continue;\n      }\n\n      if (userMaskedAttributeNames.has(attr.name)) {\n        attributes[attr.name] = MASKED_TEXT_VALUE;\n        continue;\n      }\n\n      // Finally cast attribute value to string and limit attribute value length\n      attributes[attr.name] = String(attr.value).substring(0, constants.MAX_ATTRIBUTE_LENGTH);\n    }\n  }\n\n  if (Object.keys(attributes).length) {\n    properties.attrs = attributes;\n  }\n\n  return properties;\n}\n\nexport function getAncestors(targetEl: Element | null): Element[] {\n  const ancestors: Element[] = [];\n\n  if (!targetEl) {\n    return ancestors;\n  }\n\n  // Add self to the list of ancestors\n  ancestors.push(targetEl);\n  let current = targetEl.parentElement;\n  while (current && current.tagName !== 'HTML') {\n    ancestors.push(current);\n    current = current.parentElement;\n  }\n  return ancestors;\n}\n", "import type { DataSource, PageAction } from '@amplitude/analytics-core/lib/esm/types/element-interactions';\nimport type { DataExtractor } from '../data-extractor';\nimport type { ElementBasedTimestampedEvent, ElementBasedEvent } from '../helpers';\n\n// Get DataSource\n/**\n * Gets the DOM element specified by the data source configuration\n * @param dataSource - Configuration for finding the target element\n * @param contextElement - The element to start searching from\n * @returns The matching DOM element or undefined if not found\n */\nexport const getDataSource = (dataSource: DataSource, contextElement: HTMLElement) => {\n  // Only process DOM_ELEMENT type data sources\n  try {\n    if (dataSource.sourceType === 'DOM_ELEMENT') {\n      // If scope is specified, find the closest ancestor matching the scope rather than using documentElement (html) as the scope\n      let scopingElement: HTMLElement | null = document.documentElement;\n      if (dataSource.scope && contextElement) {\n        scopingElement = contextElement.closest(dataSource.scope);\n      }\n\n      // If we have both a scope and selector, find the matching element\n      if (scopingElement && dataSource.selector) {\n        return scopingElement.querySelector(dataSource.selector);\n      }\n\n      // Return scopingElement if no selector was specified\n      return scopingElement;\n    }\n  } catch (error) {\n    return undefined;\n  }\n\n  // Return undefined for non-DOM_ELEMENT data sources\n  return undefined;\n};\n\n// Execute actions for a condition and attach event properties to the event if needed\nexport const executeActions = (\n  actions: (string | PageAction)[],\n  ev: ElementBasedTimestampedEvent<ElementBasedEvent>,\n  dataExtractor: DataExtractor,\n) => {\n  actions.forEach((action) => {\n    // Skip if actions is string until action set is implemented\n    if (typeof action === 'string') {\n      return;\n    }\n\n    if (action.actionType === 'ATTACH_EVENT_PROPERTY') {\n      const data = dataExtractor.extractDataFromDataSource(action.dataSource, ev.closestTrackedAncestor as HTMLElement);\n\n      // Attach data to event\n      ev.targetElementProperties[action.destinationKey] = data;\n    }\n  });\n};\n", "/* eslint-disable no-restricted-globals */\nimport {\n  ElementInteractionsOptions,\n  ActionType,\n  getDecodeURI,\n  IDiagnosticsClient,\n  MASKED_TEXT_VALUE,\n  TEXT_MASK_ATTRIBUTE,\n  getPageTitle,\n  replaceSensitiveString,\n} from '@amplitude/analytics-core';\nimport type { DataSource } from '@amplitude/analytics-core/lib/esm/types/element-interactions';\nimport * as constants from './constants';\nimport {\n  removeEmptyProperties,\n  extractPrefixedAttributes,\n  isElementPointerCursor,\n  getClosestElement,\n  isElementBasedEvent,\n  parseAttributesToMask,\n} from './helpers';\nimport type { BaseTimestampedEvent, ElementBasedTimestampedEvent, TimestampedEvent, JSONValue } from './helpers';\nimport { getAncestors, getElementProperties } from './hierarchy';\nimport { getDataSource } from './pageActions/actions';\nimport { Hierarchy } from './typings/autocapture';\n\nexport class DataExtractor {\n  private readonly additionalMaskTextPatterns: RegExp[];\n  diagnosticsClient?: IDiagnosticsClient;\n\n  constructor(options: ElementInteractionsOptions, context?: { diagnosticsClient: IDiagnosticsClient }) {\n    this.diagnosticsClient = context?.diagnosticsClient;\n\n    const rawPatterns = options.maskTextRegex ?? [];\n\n    const compiled: RegExp[] = [];\n    for (const entry of rawPatterns) {\n      if (compiled.length >= constants.MAX_MASK_TEXT_PATTERNS) {\n        break;\n      }\n      if (entry instanceof RegExp) {\n        compiled.push(entry);\n      } else if ('pattern' in entry && typeof entry.pattern === 'string') {\n        try {\n          compiled.push(new RegExp(entry.pattern, 'i'));\n        } catch {\n          // ignore invalid pattern strings\n        }\n      }\n    }\n    this.additionalMaskTextPatterns = compiled;\n  }\n\n  /**\n   * Wrapper method to replace sensitive strings using the helper function\n   * @param text - The text to search for sensitive data\n   * @returns The text with sensitive data replaced by masked text\n   */\n  replaceSensitiveString = (text: string | null): string => {\n    return replaceSensitiveString(text, this.additionalMaskTextPatterns);\n  };\n\n  // Get the DOM hierarchy of the element, starting from the target element to the root element.\n  getHierarchy = (element: Element | null): Hierarchy => {\n    const startTime = performance.now();\n\n    let hierarchy: Hierarchy = [];\n    if (!element) {\n      return [];\n    }\n\n    // Get list of ancestors including itself and get properties at each level in the hierarchy\n    const ancestors = getAncestors(element);\n\n    // Build attributes to mask map\n    const elementToAttributesToMaskMap = new Map<Element, Set<string>>();\n\n    for (let i = ancestors.length - 1; i >= 0; i--) {\n      const node = ancestors[i];\n      if (node) {\n        const attributesToMask = parseAttributesToMask(node.getAttribute(constants.DATA_AMP_MASK_ATTRIBUTES));\n        const ancestorAttributesToMask =\n          i === ancestors.length - 1 ? [] : elementToAttributesToMaskMap.get(ancestors[i + 1]) ?? new Set<string>();\n        const combinedAttributesToMask = new Set([...ancestorAttributesToMask, ...attributesToMask]);\n        elementToAttributesToMaskMap.set(node, combinedAttributesToMask);\n      }\n    }\n\n    hierarchy = ancestors.map((el) =>\n      getElementProperties(el, elementToAttributesToMaskMap.get(el) ?? new Set<string>()),\n    );\n\n    // Search for and mask any sensitive attribute values\n    for (const hierarchyNode of hierarchy) {\n      if (hierarchyNode?.attrs) {\n        Object.entries(hierarchyNode.attrs).forEach(([key, value]) => {\n          if (hierarchyNode.attrs) {\n            hierarchyNode.attrs[key] = this.replaceSensitiveString(value);\n          }\n        });\n      }\n    }\n\n    const endTime = performance.now();\n    this.diagnosticsClient?.recordHistogram('autocapturePlugin.getHierarchy', endTime - startTime);\n\n    return hierarchy;\n  };\n\n  getNearestLabel = (element: Element): string => {\n    const parent = element.parentElement;\n    if (!parent) {\n      return '';\n    }\n    let labelElement: Element | null;\n    try {\n      labelElement = parent.querySelector(':scope>span,h1,h2,h3,h4,h5,h6');\n    } catch {\n      /* istanbul ignore next */\n      labelElement = null;\n    }\n    if (labelElement) {\n      /* istanbul ignore next */\n      return this.getText(labelElement);\n    }\n    return this.getNearestLabel(parent);\n  };\n\n  // Returns the Amplitude event properties for the given element.\n  getEventProperties = (actionType: ActionType, element: Element, dataAttributePrefix: string) => {\n    /* istanbul ignore next */\n    const tag = element?.tagName?.toLowerCase?.();\n    /* istanbul ignore next */\n    const rect =\n      typeof element.getBoundingClientRect === 'function' ? element.getBoundingClientRect() : { left: null, top: null };\n\n    const hierarchy = this.getHierarchy(element);\n    const currentElementAttributes = hierarchy[0]?.attrs;\n    const nearestLabel = this.getNearestLabel(element);\n    const attributes = extractPrefixedAttributes(currentElementAttributes ?? {}, dataAttributePrefix);\n\n    /* istanbul ignore next */\n    const properties: Record<string, any> = {\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_HIERARCHY]: hierarchy,\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_TAG]: tag,\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_TEXT]: this.getText(element),\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_LEFT]: rect.left == null ? null : Math.round(rect.left),\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_POSITION_TOP]: rect.top == null ? null : Math.round(rect.top),\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_ATTRIBUTES]: attributes,\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_PARENT_LABEL]: nearestLabel,\n      [constants.AMPLITUDE_EVENT_PROP_PAGE_URL]: getDecodeURI(window.location.href.split('?')[0]),\n      [constants.AMPLITUDE_EVENT_PROP_PAGE_TITLE]: (\n        getPageTitle as (parseTitleFunction: (title: string) => string) => string\n      )(this.replaceSensitiveString),\n      [constants.AMPLITUDE_EVENT_PROP_VIEWPORT_HEIGHT]: window.innerHeight,\n      [constants.AMPLITUDE_EVENT_PROP_VIEWPORT_WIDTH]: window.innerWidth,\n    };\n\n    // id is never masked, so always include it\n    properties[constants.AMPLITUDE_EVENT_PROP_ELEMENT_ID] = element.getAttribute('id') || '';\n\n    // class is never masked, so always include it\n    properties[constants.AMPLITUDE_EVENT_PROP_ELEMENT_CLASS] = element.getAttribute('class');\n\n    properties[constants.AMPLITUDE_EVENT_PROP_ELEMENT_ARIA_LABEL] = currentElementAttributes?.['aria-label'];\n\n    if (tag === 'a' && actionType === 'click' && element instanceof HTMLAnchorElement) {\n      const href = element.href.substring(0, constants.MAX_ATTRIBUTE_LENGTH);\n      properties[constants.AMPLITUDE_EVENT_PROP_ELEMENT_HREF] = this.replaceSensitiveString(href); // we don't use hierarchy here because we don't want href value to be changed\n    }\n\n    return removeEmptyProperties(properties);\n  };\n\n  addTypeAndTimestamp = <T>(\n    event: T,\n    type: BaseTimestampedEvent<T>['type'] | ElementBasedTimestampedEvent<T>['type'],\n  ): BaseTimestampedEvent<T> | ElementBasedTimestampedEvent<T> => {\n    return {\n      event,\n      timestamp: Date.now(),\n      type,\n    };\n  };\n\n  addAdditionalEventProperties = <T>(\n    event: T,\n    type: TimestampedEvent<T>['type'],\n    selectorAllowlist: string[],\n    dataAttributePrefix: string,\n    // capture the event if the cursor is a \"pointer\" when this element is clicked on\n    // reason: a \"pointer\" cursor indicates that an element should be interactable\n    //         regardless of the element's tag name\n    isCapturingCursorPointer = false,\n  ): TimestampedEvent<T> | ElementBasedTimestampedEvent<T> => {\n    const baseEvent = this.addTypeAndTimestamp(event, type);\n\n    if (isElementBasedEvent(baseEvent) && baseEvent.event.target !== null) {\n      if (isCapturingCursorPointer) {\n        const isCursorPointer = isElementPointerCursor(baseEvent.event.target as Element, baseEvent.type);\n        if (isCursorPointer) {\n          baseEvent.closestTrackedAncestor = baseEvent.event.target as HTMLElement;\n          baseEvent.targetElementProperties = this.getEventProperties(\n            baseEvent.type,\n            baseEvent.closestTrackedAncestor,\n            dataAttributePrefix,\n          );\n          return baseEvent;\n        }\n      }\n      // Retrieve additional event properties from the target element\n      const closestTrackedAncestor = getClosestElement(baseEvent.event.target as HTMLElement, selectorAllowlist);\n      if (closestTrackedAncestor) {\n        baseEvent.closestTrackedAncestor = closestTrackedAncestor;\n        baseEvent.targetElementProperties = this.getEventProperties(\n          baseEvent.type,\n          closestTrackedAncestor,\n          dataAttributePrefix,\n        );\n      }\n      return baseEvent;\n    }\n\n    return baseEvent;\n  };\n\n  extractDataFromDataSource = (dataSource: DataSource, contextElement: HTMLElement) => {\n    // Extract from DOM Element\n    if (dataSource.sourceType === 'DOM_ELEMENT') {\n      const sourceElement = getDataSource(dataSource, contextElement);\n      if (!sourceElement) {\n        return undefined;\n      }\n\n      if (dataSource.elementExtractType === 'TEXT') {\n        return this.getText(sourceElement);\n      } else if (dataSource.elementExtractType === 'ATTRIBUTE' && dataSource.attribute) {\n        return sourceElement.getAttribute(dataSource.attribute);\n      }\n      return undefined;\n    }\n\n    // TODO: Extract from other source types\n    return undefined;\n  };\n\n  getText = (element: Element): string => {\n    // Check if element or any parent has data-amp-mask attribute\n    const hasMaskAttribute = element.closest(`[${TEXT_MASK_ATTRIBUTE}]`) !== null;\n    if (hasMaskAttribute) {\n      return MASKED_TEXT_VALUE;\n    }\n    let output = '';\n    if (!element.querySelector(`[${TEXT_MASK_ATTRIBUTE}], [contenteditable]`)) {\n      output = (element as HTMLElement).innerText || '';\n    } else {\n      const clonedTree = element.cloneNode(true) as HTMLElement;\n      // replace all elements with TEXT_MASK_ATTRIBUTE attribute and contenteditable with the text MASKED_TEXT_VALUE\n      clonedTree.querySelectorAll(`[${TEXT_MASK_ATTRIBUTE}], [contenteditable]`).forEach((node) => {\n        (node as HTMLElement).innerText = MASKED_TEXT_VALUE;\n      });\n      output = clonedTree.innerText || '';\n    }\n    return this.replaceSensitiveString(output.substring(0, 255)).replace(/\\s+/g, ' ').trim();\n  };\n\n  // Returns the element properties for the given element in Visual Labeling.\n  getEventTagProps = (element: Element): Record<string, JSONValue> => {\n    if (!element) {\n      return {};\n    }\n    /* istanbul ignore next */\n    const tag = element?.tagName?.toLowerCase?.();\n\n    const properties = {\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_TAG]: tag,\n      [constants.AMPLITUDE_EVENT_PROP_ELEMENT_TEXT]: this.getText(element),\n      [constants.AMPLITUDE_EVENT_PROP_PAGE_URL]: window.location.href.split('?')[0],\n    };\n    return removeEmptyProperties(properties) as Record<string, JSONValue>;\n  };\n}\n", "/* istanbul ignore file */\n/* eslint-disable no-restricted-globals */\nimport {\n  AMPLITUDE_ORIGIN,\n  AMPLITUDE_VISUAL_TAGGING_SELECTOR_SCRIPT_URL,\n  AMPLITUDE_VISUAL_TAGGING_HIGHLIGHT_CLASS,\n} from '../constants';\nimport { asyncLoadScript, generateUniqueId } from '../helpers';\nimport { ILogger, Messenger, ActionType } from '@amplitude/analytics-core';\nimport { VERSION } from '../version';\nimport { DataExtractor } from '../data-extractor';\n\nexport type Action =\n  | 'ping'\n  | 'pong'\n  | 'page-loaded'\n  | 'selector-loaded'\n  | 'initialize-visual-tagging-selector'\n  | 'close-visual-tagging-selector'\n  | 'element-selected'\n  | 'track-selector-mode-changed'\n  | 'track-selector-moved';\n\ninterface InitializeVisualTaggingSelectorData {\n  actionType: ActionType;\n}\n\ninterface ElementSelectedData {\n  '[Amplitude] Element Hierarchy'?: string;\n  '[Amplitude] Element Tag'?: string;\n  '[Amplitude] Element Text'?: string;\n  '[Amplitude] Page URL'?: string;\n  elementScreenshot?: Blob;\n}\n\ninterface TrackSelectorModeChangedData {\n  newMode: string;\n  pageUrl?: string;\n}\n\ninterface TrackSelectorMovedData {\n  newEditorLocation: string;\n  pageUrl?: string;\n}\n\nexport type ActionData = {\n  ping: null | undefined;\n  pong: null | undefined;\n  'page-loaded': null | undefined;\n  'selector-loaded': null | undefined;\n  'initialize-visual-tagging-selector': InitializeVisualTaggingSelectorData | null | undefined;\n  'close-visual-tagging-selector': null | undefined;\n  'element-selected': ElementSelectedData;\n  'track-selector-mode-changed': TrackSelectorModeChangedData;\n  'track-selector-moved': TrackSelectorMovedData;\n};\n\nexport interface Message<A extends Action> {\n  action: A;\n  data?: ActionData[A];\n}\n\ntype MessageRequest = {\n  id: string;\n  action: string;\n  args: Record<string, any>;\n};\n\ntype MessageResponse = {\n  id: string;\n  action: string;\n  responseData: any;\n};\n\n// TODO: use MessageChannel instead of window.postMessage\nexport class WindowMessenger implements Messenger {\n  endpoint = AMPLITUDE_ORIGIN;\n  logger?: ILogger;\n  requestCallbacks: {\n    [id: string]: {\n      resolve: (data: any) => void;\n      reject: (data: any) => void;\n    };\n  } = {};\n\n  constructor({ origin = AMPLITUDE_ORIGIN }: { origin?: string } = {}) {\n    this.endpoint = origin;\n  }\n\n  private notify(message: Message<Action> | MessageRequest) {\n    this.logger?.debug?.('Message sent: ', JSON.stringify(message));\n    (window.opener as WindowProxy)?.postMessage?.(message, this.endpoint);\n  }\n\n  // Send an async request to the parent window\n  public sendRequest(action: string, args: Record<string, any>, options = { timeout: 15_000 }): Promise<any> {\n    // Create Request ID\n    const id = generateUniqueId();\n    const request = {\n      id,\n      action,\n      args,\n    };\n\n    // Create a Promise that will be resolved when the response is received\n    const promise = new Promise((resolve, reject) => {\n      this.requestCallbacks[id] = { resolve, reject };\n\n      // Send the request\n      this.notify(request);\n\n      // Handle request timeouts\n      if (options?.timeout > 0) {\n        setTimeout(() => {\n          reject(new Error(`${action} timed out (id: ${id})`));\n          delete this.requestCallbacks[id];\n        }, options.timeout);\n      }\n    });\n\n    return promise;\n  }\n\n  // Handle messages from the parent window\n  private handleResponse(response: MessageResponse) {\n    if (!this.requestCallbacks[response.id]) {\n      this.logger?.warn(`No callback found for request id: ${response.id}`);\n      return;\n    }\n\n    this.requestCallbacks[response.id].resolve(response.responseData);\n    delete this.requestCallbacks[response.id];\n  }\n\n  setup(\n    {\n      logger,\n      endpoint,\n      isElementSelectable,\n      cssSelectorAllowlist,\n      actionClickAllowlist,\n      dataExtractor,\n    }: {\n      logger?: ILogger;\n      endpoint?: string;\n      isElementSelectable?: (action: InitializeVisualTaggingSelectorData['actionType'], element: Element) => boolean;\n      cssSelectorAllowlist?: string[];\n      actionClickAllowlist?: string[];\n      dataExtractor: DataExtractor;\n    } = { dataExtractor: new DataExtractor({}) },\n  ) {\n    this.logger = logger;\n    // If endpoint is customized, don't override it.\n    if (endpoint && this.endpoint === AMPLITUDE_ORIGIN) {\n      this.endpoint = endpoint;\n    }\n    let amplitudeVisualTaggingSelectorInstance: any = null;\n\n    // Attach Event Listener to listen for messages from the parent window\n    window.addEventListener('message', (event) => {\n      this.logger?.debug?.('Message received: ', JSON.stringify(event));\n\n      // Only accept messages from the specified origin\n      if (this.endpoint !== event.origin) {\n        return;\n      }\n\n      const eventData = event?.data as Message<Action> | MessageResponse;\n      const action = eventData?.action;\n\n      // Ignore messages without action\n      if (!action) {\n        return;\n      }\n\n      // If id exists, handle responses to previous requests\n      if ('id' in eventData) {\n        this.logger?.debug?.('Received Response to previous request: ', JSON.stringify(event));\n        this.handleResponse(eventData);\n\n        // If action exists, handle the action using existing handlers\n      } else {\n        if (action === 'ping') {\n          this.notify({ action: 'pong' });\n        } else if (action === 'initialize-visual-tagging-selector') {\n          const actionData = eventData?.data as InitializeVisualTaggingSelectorData;\n          asyncLoadScript(AMPLITUDE_VISUAL_TAGGING_SELECTOR_SCRIPT_URL)\n            .then(() => {\n              // eslint-disable-next-line\n              amplitudeVisualTaggingSelectorInstance = (window as any)?.amplitudeVisualTaggingSelector?.({\n                getEventTagProps: dataExtractor.getEventTagProps,\n                isElementSelectable: (element: Element) => {\n                  if (isElementSelectable) {\n                    return isElementSelectable(actionData?.actionType || 'click', element);\n                  }\n                  return true;\n                },\n                onTrack: this.onTrack,\n                onSelect: this.onSelect,\n                visualHighlightClass: AMPLITUDE_VISUAL_TAGGING_HIGHLIGHT_CLASS,\n                messenger: this,\n                cssSelectorAllowlist,\n                actionClickAllowlist,\n                extractDataFromDataSource: dataExtractor.extractDataFromDataSource,\n                dataExtractor,\n                diagnostics: {\n                  autocapture: {\n                    version: VERSION,\n                  },\n                },\n              });\n              this.notify({ action: 'selector-loaded' });\n            })\n            .catch(() => {\n              this.logger?.warn('Failed to initialize visual tagging selector');\n            });\n        } else if (action === 'close-visual-tagging-selector') {\n          // eslint-disable-next-line\n          amplitudeVisualTaggingSelectorInstance?.close?.();\n        }\n      }\n    });\n\n    // Notify the parent window that the page has loaded\n    this.notify({ action: 'page-loaded' });\n  }\n\n  private onSelect = (data: ElementSelectedData) => {\n    this.notify({ action: 'element-selected', data });\n  };\n\n  private onTrack = (type: string, properties: { [key: string]: string | null }) => {\n    if (type === 'selector-mode-changed') {\n      this.notify({ action: 'track-selector-mode-changed', data: properties });\n    } else if (type === 'selector-moved') {\n      this.notify({ action: 'track-selector-moved', data: properties });\n    }\n  };\n}\n", "import { AllWindowObservables } from '../autocapture-plugin';\nimport { ElementBasedEvent, ElementBasedTimestampedEvent, type evaluateTriggersFn } from '../helpers';\nimport { Observable, BrowserClient } from '@amplitude/analytics-core';\nimport { filterOutNonTrackableEvents, shouldTrackEvent } from '../helpers';\nimport { AMPLITUDE_ELEMENT_CLICKED_EVENT } from '../constants';\n\nexport function trackClicks({\n  amplitude,\n  allObservables,\n  shouldTrackEvent,\n  evaluateTriggers,\n}: {\n  amplitude: BrowserClient;\n  allObservables: AllWindowObservables;\n  shouldTrackEvent: shouldTrackEvent;\n  evaluateTriggers: evaluateTriggersFn;\n}) {\n  const { clickObservable } = allObservables;\n\n  const clickObservableFiltered = clickObservable\n    .filter(filterOutNonTrackableEvents)\n    .filter((click) => {\n      // Only track clicks on elements that should be tracked,\n      return shouldTrackEvent('click', click.closestTrackedAncestor);\n    })\n    .map((click) => evaluateTriggers(click));\n\n  const clicks: Observable<typeof clickObservableFiltered extends Observable<infer U> ? U : never> =\n    clickObservableFiltered;\n\n  return clicks.subscribe((click: ElementBasedTimestampedEvent<ElementBasedEvent>) => {\n    /* istanbul ignore next */\n    amplitude?.track(AMPLITUDE_ELEMENT_CLICKED_EVENT, click.targetElementProperties);\n  });\n}\n", "import { AllWindowObservables } from '../autocapture-plugin';\nimport {\n  filterOutNonTrackableEvents,\n  shouldTrackEvent,\n  ElementBasedTimestampedEvent,\n  type evaluateTriggersFn,\n} from '../helpers';\nimport { BrowserClient, ActionType } from '@amplitude/analytics-core';\nimport { AMPLITUDE_ELEMENT_CHANGED_EVENT } from '../constants';\n\nexport function trackChange({\n  amplitude,\n  allObservables,\n  getEventProperties,\n  shouldTrackEvent,\n  evaluateTriggers,\n}: {\n  amplitude: BrowserClient;\n  allObservables: AllWindowObservables;\n  getEventProperties: (actionType: ActionType, element: Element) => Record<string, any>;\n  shouldTrackEvent: shouldTrackEvent;\n  evaluateTriggers: evaluateTriggersFn;\n}) {\n  const { changeObservable } = allObservables;\n\n  const filteredChangeObservable = changeObservable\n    .filter(filterOutNonTrackableEvents)\n    .filter((changeEvent: ElementBasedTimestampedEvent<Event>) => {\n      // Only track change on elements that should be tracked,\n      return shouldTrackEvent('change', changeEvent.closestTrackedAncestor);\n    })\n    .map((changeEvent) => evaluateTriggers(changeEvent));\n\n  return filteredChangeObservable.subscribe((changeEvent) => {\n    /* istanbul ignore next */\n    amplitude?.track(AMPLITUDE_ELEMENT_CHANGED_EVENT, getEventProperties('change', changeEvent.closestTrackedAncestor));\n  });\n}\n", "import { AllWindowObservables, AutoCaptureOptionsWithDefaults } from '../autocapture-plugin';\nimport { BrowserClient, ActionType, merge, asyncMap } from '@amplitude/analytics-core';\nimport {\n  ElementBasedTimestampedEvent,\n  filterOutNonTrackableEvents,\n  getClosestElement,\n  shouldTrackEvent,\n  TimestampedEvent,\n} from '../helpers';\nimport { AMPLITUDE_ELEMENT_CLICKED_EVENT } from '../constants';\n\nexport function trackActionClick({\n  amplitude,\n  allObservables,\n  options,\n  getEventProperties,\n  shouldTrackEvent,\n  shouldTrackActionClick,\n}: {\n  amplitude: BrowserClient;\n  allObservables: AllWindowObservables;\n  options: AutoCaptureOptionsWithDefaults;\n  getEventProperties: (actionType: ActionType, element: Element) => Record<string, any>;\n  shouldTrackActionClick: shouldTrackEvent;\n  shouldTrackEvent: shouldTrackEvent;\n}) {\n  const { clickObservable, mutationObservable, navigateObservable } = allObservables;\n\n  const filteredClickObservable = clickObservable\n    .filter((click) => {\n      return !shouldTrackEvent('click', click.closestTrackedAncestor);\n    })\n    .map((click) => {\n      // overwrite the closestTrackedAncestor with the closest element that is on the actionClickAllowlist\n      const closestActionClickEl = getClosestElement(click.event.target as Element, options.actionClickAllowlist);\n      click.closestTrackedAncestor = closestActionClickEl as Element;\n\n      // overwrite the targetElementProperties with the properties of the closestActionClickEl\n      if (click.closestTrackedAncestor !== null) {\n        click.targetElementProperties = getEventProperties(click.type, click.closestTrackedAncestor);\n      }\n      return click;\n    })\n    .filter(filterOutNonTrackableEvents)\n    .filter((clickEvent) => {\n      // Only track change on elements that should be tracked\n      return shouldTrackActionClick('click', clickEvent.closestTrackedAncestor);\n    });\n\n  const mutationOrNavigate = navigateObservable ? merge(mutationObservable, navigateObservable) : mutationObservable;\n\n  const clickMutationNavigateObservable = merge(filteredClickObservable, mutationOrNavigate);\n\n  let actionClickTimer: ReturnType<typeof setTimeout> | null = null;\n  let lastClickEvent: TimestampedEvent<any> | null = null;\n\n  const actionClickObservable = asyncMap(clickMutationNavigateObservable, (event) => {\n    // clear any previous timer\n    if (actionClickTimer) {\n      clearTimeout(actionClickTimer);\n      actionClickTimer = null;\n    }\n    if (event.type === 'click') {\n      // mark the 'last click event'\n      lastClickEvent = event;\n\n      // set a timer to clear last click event if no mutation event between now and 500ms\n      actionClickTimer = setTimeout(() => {\n        actionClickTimer = null;\n        lastClickEvent = null;\n      }, 500);\n      return Promise.resolve(null);\n    } else {\n      // if mutation/navigation + last click event, then it's an action click\n      if (lastClickEvent) {\n        const event = lastClickEvent;\n        lastClickEvent = null;\n        return Promise.resolve(event);\n      }\n    }\n    return Promise.resolve(null);\n  });\n\n  return actionClickObservable.subscribe((actionClick) => {\n    if (!actionClick) return;\n    /* istanbul ignore next */\n    amplitude?.track(\n      AMPLITUDE_ELEMENT_CLICKED_EVENT,\n      getEventProperties('click', (actionClick as ElementBasedTimestampedEvent<MouseEvent>).closestTrackedAncestor),\n    );\n  });\n}\n", "import { Observable, consoleObserver, getGlobalScope, merge } from '@amplitude/analytics-core';\n\n/* eslint-disable-next-line no-restricted-globals */\nconst globalScope = getGlobalScope() as typeof window;\n\nexport const createMutationObservable = (): Observable<MutationRecord[]> => {\n  return new Observable<MutationRecord[]>((observer) => {\n    const mutationObserver = new MutationObserver((mutations) => {\n      observer.next(mutations);\n    });\n    if (document.body) {\n      mutationObserver.observe(document.body, {\n        childList: true,\n        attributes: true,\n        characterData: true,\n        subtree: true,\n      });\n    }\n    return () => mutationObserver.disconnect();\n  });\n};\n\n/**\n * Creates an observable that tracks click events on the document.\n * @param clickType - The type of click event to track (click or pointerdown)\n */\nexport const createClickObservable = (\n  clickType: 'click' | 'pointerdown' = 'click',\n): Observable<MouseEvent | PointerEvent> => {\n  return new Observable<MouseEvent | PointerEvent>((observer) => {\n    const handler = (event: MouseEvent | PointerEvent) => {\n      observer.next(event);\n    };\n    globalScope.document.addEventListener(clickType, handler, { capture: true });\n    return () => {\n      globalScope.document.removeEventListener(clickType, handler, { capture: true });\n    };\n  });\n};\n\nconst createConsoleErrorObservable = (): Observable<BrowserErrorEvent> => {\n  return new Observable<BrowserErrorEvent>((observer) => {\n    const handler = (_: string, ...args: any[]) => {\n      /* istanbul ignore next */\n      let message: string | undefined = undefined;\n      if (Array.isArray(args[0]) && typeof args[0][0] === 'string') {\n        message = args[0][0];\n      }\n      observer.next({ kind: 'console', message });\n    };\n    consoleObserver.addListener('error', handler);\n    return () => {\n      consoleObserver.removeListener(handler);\n    };\n  });\n};\n\nconst createUnhandledErrorObservable = (): Observable<BrowserErrorEvent> => {\n  return new Observable<BrowserErrorEvent>((observer) => {\n    const handler = (event: ErrorEvent) => {\n      let output: BrowserErrorEvent = {\n        kind: 'error',\n      };\n\n      if (event.error instanceof Error) {\n        output = {\n          ...output,\n          message: event.error.message,\n          stack: event.error.stack,\n          filename: event.filename,\n          lineNumber: event.lineno,\n          columnNumber: event.colno,\n        };\n      } else if (typeof event.error === 'string') {\n        output.message = event.error;\n      }\n      observer.next(output);\n    };\n\n    globalScope.addEventListener('error', handler);\n    return () => {\n      globalScope.removeEventListener('error', handler);\n    };\n  });\n};\n\nconst createUnhandledRejectionObservable = (): Observable<BrowserErrorEvent> => {\n  return new Observable<BrowserErrorEvent>((observer) => {\n    const handler = (event: PromiseRejectionEvent) => {\n      const output: BrowserErrorEvent = {\n        kind: 'unhandledrejection',\n      };\n      if (event.reason instanceof Error) {\n        output.message = event.reason.message;\n        output.stack = event.reason.stack;\n      } else if (typeof event.reason === 'string') {\n        output.message = event.reason;\n      }\n      observer.next(output);\n    };\n    globalScope.addEventListener('unhandledrejection', handler);\n    return () => {\n      globalScope.removeEventListener('unhandledrejection', handler);\n    };\n  });\n};\n\nexport type BrowserErrorEvent = {\n  kind: 'error' | 'unhandledrejection' | 'console';\n  message?: string;\n  filename?: string;\n  lineNumber?: number;\n  columnNumber?: number;\n  stack?: string;\n};\n\nexport const createErrorObservable = (): Observable<BrowserErrorEvent> => {\n  const unhandledErrorObservable = merge(createUnhandledErrorObservable(), createUnhandledRejectionObservable());\n  return merge(unhandledErrorObservable, createConsoleErrorObservable());\n};\n", "import type { Filter } from '@amplitude/analytics-core/lib/esm/types/element-interactions';\nimport { ElementBasedTimestampedEvent, ElementBasedEvent } from '../helpers';\n\n/**\n * Matches an event to a single filter\n * @param event - The event to match\n * @param filter - The filter to match against\n * @returns boolean indicating if the event matches the filter\n */\nexport const matchEventToFilter = (event: ElementBasedTimestampedEvent<ElementBasedEvent>, filter: Filter) => {\n  try {\n    if (filter.subprop_key === '[Amplitude] Element Text') {\n      // TODO: add support for the other operators\n      return (\n        filter.subprop_op === 'is' &&\n        filter.subprop_value.includes(event.targetElementProperties['[Amplitude] Element Text'] as string)\n      );\n    } else if (filter.subprop_key === '[Amplitude] Element Hierarchy') {\n      // Check if the element ancestory matches the CSS selector, always check this last since it is the most expensive\n      return (\n        filter.subprop_op === 'autotrack css match' &&\n        !!event.closestTrackedAncestor.closest(filter.subprop_value.toString())\n      );\n    }\n  } catch (error) {\n    console.error('Error matching event to filter', error);\n    return false;\n  }\n  return false;\n};\n", "import type { ElementInteractionsOptions, LabeledEvent, Trigger } from '@amplitude/analytics-core';\nimport type { ElementBasedTimestampedEvent, ElementBasedEvent } from '../helpers';\nimport { matchEventToFilter } from './matchEventToFilter';\nimport { executeActions } from './actions';\nimport type { DataExtractor } from '../data-extractor';\n\nconst eventTypeToBrowserEventMap = {\n  '[Amplitude] Element Clicked': 'click',\n  '[Amplitude] Element Changed': 'change',\n} as const;\n// groups labeled events by event type\n// skips any labeled events with malformed definitions or unexpected event_type\nexport const groupLabeledEventIdsByEventType = (labeledEvents: LabeledEvent[] | null | undefined) => {\n  // Initialize all event types with empty sets\n  const groupedLabeledEvents = Object.values(eventTypeToBrowserEventMap).reduce((acc, browserEvent) => {\n    acc[browserEvent] = new Set<string>();\n    return acc;\n  }, {} as Record<string, Set<string>>);\n\n  // If there are no labeled events, return the initialized groupedLabeledEvents\n  if (!labeledEvents) {\n    return groupedLabeledEvents;\n  }\n\n  // Group labeled events by event type\n  for (const le of labeledEvents) {\n    try {\n      for (const def of le.definition) {\n        const browserEvent = eventTypeToBrowserEventMap[def.event_type];\n        if (browserEvent) {\n          groupedLabeledEvents[browserEvent].add(le.id);\n        }\n      }\n    } catch (e) {\n      // Skip this labeled event if there is an error\n      console.warn('Skipping Labeled Event due to malformed definition', le?.id, e);\n    }\n  }\n  return groupedLabeledEvents;\n};\n\n// TODO: add tests\nexport const createLabeledEventToTriggerMap = (triggers: Trigger[]) => {\n  const labeledEventToTriggerMap = new Map<string, Trigger[]>();\n  for (const trigger of triggers) {\n    for (const condition of trigger.conditions) {\n      if (condition.type === 'LABELED_EVENT') {\n        const eventId = condition.match.eventId;\n        // Get existing triggers for this event ID or initialize empty array\n        let existingTriggers = labeledEventToTriggerMap.get(eventId);\n        if (!existingTriggers) {\n          existingTriggers = [];\n          labeledEventToTriggerMap.set(eventId, existingTriggers);\n        }\n        // Add current trigger to the list of triggers for this event ID\n        existingTriggers.push(trigger);\n      }\n    }\n  }\n  return labeledEventToTriggerMap;\n};\n\n/**\n * Matches an event to labeled events based on the event's properties.\n * The logic matches exactly what is supported by the query backend.\n * TODO: later pre-filter the labeled events based on URL first\n *\n * @param event - The event to match against labeled events\n * @param labeledEvents - Array of labeled events to match against\n * @returns Array of matching labeled events\n */\nexport const matchEventToLabeledEvents = (\n  event: ElementBasedTimestampedEvent<ElementBasedEvent>,\n  labeledEvents: LabeledEvent[],\n) => {\n  return labeledEvents.filter((le) => {\n    return le.definition.some((def) => {\n      return (\n        eventTypeToBrowserEventMap[def.event_type] === event.type &&\n        def.filters.every((filter) => matchEventToFilter(event, filter))\n      );\n    });\n  });\n};\n\nexport const matchLabeledEventsToTriggers = (labeledEvents: LabeledEvent[], leToTriggerMap: Map<string, Trigger[]>) => {\n  const matchingTriggers = new Set<Trigger>();\n  for (const le of labeledEvents) {\n    const triggers = leToTriggerMap.get(le.id);\n    if (triggers) {\n      for (const trigger of triggers) {\n        matchingTriggers.add(trigger);\n      }\n    }\n  }\n  return Array.from(matchingTriggers);\n};\n\nexport class TriggerEvaluator {\n  constructor(\n    private groupedLabeledEvents: ReturnType<typeof groupLabeledEventIdsByEventType>,\n    private labeledEventToTriggerMap: ReturnType<typeof createLabeledEventToTriggerMap>,\n    private dataExtractor: DataExtractor,\n    private options: ElementInteractionsOptions,\n  ) {}\n\n  evaluate(event: ElementBasedTimestampedEvent<ElementBasedEvent>) {\n    // If there is no pageActions, return the event as is\n    const { pageActions } = this.options;\n    if (!pageActions) {\n      return event;\n    }\n\n    // Find matching labeled events\n    const matchingLabeledEvents = matchEventToLabeledEvents(\n      event,\n      Array.from(this.groupedLabeledEvents[event.type]).map((id) => pageActions.labeledEvents[id]),\n    );\n    // Find matching conditions\n    const matchingTriggers = matchLabeledEventsToTriggers(matchingLabeledEvents, this.labeledEventToTriggerMap);\n    for (const trigger of matchingTriggers) {\n      executeActions(trigger.actions, event, this.dataExtractor);\n    }\n\n    return event;\n  }\n\n  update(\n    groupedLabeledEvents: ReturnType<typeof groupLabeledEventIdsByEventType>,\n    labeledEventToTriggerMap: ReturnType<typeof createLabeledEventToTriggerMap>,\n    options: ElementInteractionsOptions,\n  ) {\n    this.groupedLabeledEvents = groupedLabeledEvents;\n    this.labeledEventToTriggerMap = labeledEventToTriggerMap;\n    this.options = options;\n  }\n}\n\nexport const createTriggerEvaluator = (\n  groupedLabeledEvents: ReturnType<typeof groupLabeledEventIdsByEventType>,\n  labeledEventToTriggerMap: ReturnType<typeof createLabeledEventToTriggerMap>,\n  dataExtractor: DataExtractor,\n  options: ElementInteractionsOptions,\n) => {\n  return new TriggerEvaluator(groupedLabeledEvents, labeledEventToTriggerMap, dataExtractor, options);\n};\n", "/* eslint-disable no-restricted-globals */\nimport {\n  type BrowserClient,\n  type BrowserConfig,\n  type EnrichmentPlugin,\n  type ElementInteractionsOptions,\n  DEFAULT_CSS_SELECTOR_ALLOWLIST,\n  DEFAULT_ACTION_CLICK_ALLOWLIST,\n  DEFAULT_DATA_ATTRIBUTE_PREFIX,\n  IDiagnosticsClient,\n  getGlobalScope,\n  multicast,\n} from '@amplitude/analytics-core';\nimport { VERSION } from './version';\nimport * as constants from './constants';\nimport {\n  createShouldTrackEvent,\n  type ElementBasedTimestampedEvent,\n  type TimestampedEvent,\n  type NavigateEvent,\n} from './helpers';\nimport { WindowMessenger } from './libs/messenger';\nimport { trackClicks } from './autocapture/track-click';\nimport { trackChange } from './autocapture/track-change';\nimport { trackActionClick } from './autocapture/track-action-click';\nimport { createClickObservable, createMutationObservable } from './observables';\n\nimport {\n  createLabeledEventToTriggerMap,\n  createTriggerEvaluator,\n  groupLabeledEventIdsByEventType,\n} from './pageActions/triggers';\nimport { DataExtractor } from './data-extractor';\nimport { Observable, Unsubscribable } from '@amplitude/analytics-core';\n\ntype NavigationType = {\n  addEventListener: (type: string, listener: EventListenerOrEventListenerObject) => void;\n  removeEventListener: (type: string, listener: EventListenerOrEventListenerObject) => void;\n};\n\ndeclare global {\n  interface Window {\n    navigation: NavigationType;\n  }\n}\n\ntype BrowserEnrichmentPlugin = EnrichmentPlugin<BrowserClient, BrowserConfig>;\n\nexport type AutoCaptureOptionsWithDefaults = Required<\n  Pick<ElementInteractionsOptions, 'debounceTime' | 'cssSelectorAllowlist' | 'actionClickAllowlist'>\n> &\n  ElementInteractionsOptions;\n\nexport enum ObservablesEnum {\n  ClickObservable = 'clickObservable',\n  ChangeObservable = 'changeObservable',\n  // ErrorObservable = 'errorObservable',\n  NavigateObservable = 'navigateObservable',\n  MutationObservable = 'mutationObservable',\n  BrowserErrorObservable = 'browserErrorObservable',\n  SelectionObservable = 'selectionObservable',\n}\n\nexport interface AllWindowObservables {\n  [ObservablesEnum.ChangeObservable]: Observable<ElementBasedTimestampedEvent<Event>>;\n  // [ObservablesEnum.ErrorObservable]: Observable<TimestampedEvent<ErrorEvent>>;\n  [ObservablesEnum.ClickObservable]: Observable<ElementBasedTimestampedEvent<MouseEvent>>;\n  [ObservablesEnum.MutationObservable]: Observable<TimestampedEvent<MutationRecord[]>>;\n  [ObservablesEnum.NavigateObservable]?: Observable<TimestampedEvent<NavigateEvent>>;\n  [ObservablesEnum.SelectionObservable]?: Observable<void>;\n}\n\nexport const autocapturePlugin = (\n  options: ElementInteractionsOptions = {},\n  context?: { diagnosticsClient: IDiagnosticsClient },\n): BrowserEnrichmentPlugin => {\n  // Set the plugin version tag\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n  context?.diagnosticsClient.setTag('plugin.autocapture.version', VERSION);\n\n  const {\n    dataAttributePrefix = DEFAULT_DATA_ATTRIBUTE_PREFIX,\n    visualTaggingOptions = {\n      enabled: true,\n      messenger: new WindowMessenger(),\n    },\n  } = options;\n\n  options.cssSelectorAllowlist = options.cssSelectorAllowlist ?? DEFAULT_CSS_SELECTOR_ALLOWLIST;\n  options.actionClickAllowlist = options.actionClickAllowlist ?? DEFAULT_ACTION_CLICK_ALLOWLIST;\n  options.debounceTime = options.debounceTime ?? 0;\n\n  options.pageUrlExcludelist = options.pageUrlExcludelist?.reduce(\n    (acc: (string | RegExp | { pattern: string })[], excludePattern) => {\n      if (typeof excludePattern === 'string') {\n        acc.push(excludePattern);\n      }\n      if (excludePattern instanceof RegExp) {\n        acc.push(excludePattern);\n      }\n      if (typeof excludePattern === 'object' && excludePattern !== null && 'pattern' in excludePattern) {\n        try {\n          acc.push(new RegExp(excludePattern.pattern));\n        } catch (regexError) {\n          console.warn(`Invalid regex pattern: ${excludePattern.pattern}`, regexError);\n          return acc;\n        }\n      }\n      return acc;\n    },\n    [],\n  );\n\n  const name = constants.PLUGIN_NAME;\n  const type = 'enrichment';\n\n  const subscriptions: Unsubscribable[] = [];\n\n  // Create data extractor based on options\n  const dataExtractor = new DataExtractor(options, context);\n\n  // Create observables on events on the window\n  const createObservables = (): AllWindowObservables => {\n    const clickObservable = multicast(\n      createClickObservable().map(\n        (click) =>\n          dataExtractor.addAdditionalEventProperties(\n            click,\n            'click',\n            (options as AutoCaptureOptionsWithDefaults).cssSelectorAllowlist,\n            dataAttributePrefix,\n          ) as ElementBasedTimestampedEvent<MouseEvent>,\n      ),\n    );\n\n    const changeObservable = multicast(\n      new Observable<ElementBasedTimestampedEvent<Event>>((observer) => {\n        const handler = (changeEvent: Event) => {\n          const enrichedChangeEvent = dataExtractor.addAdditionalEventProperties(\n            changeEvent,\n            'change',\n            (options as AutoCaptureOptionsWithDefaults).cssSelectorAllowlist,\n            dataAttributePrefix,\n          ) as ElementBasedTimestampedEvent<Event>;\n          observer.next(enrichedChangeEvent);\n        };\n        /* istanbul ignore next */\n        getGlobalScope()?.document.addEventListener('change', handler, { capture: true });\n        /* istanbul ignore next */\n        return () => getGlobalScope()?.document.removeEventListener('change', handler);\n      }),\n    );\n\n    // Create Observable from unhandled errors\n    // const errorObservable = fromEvent<ErrorEvent>(window, 'error').pipe(\n    //   map((error) => addAdditionalEventProperties(error, 'error')),\n    // );\n\n    // Create observable for URL changes\n    let navigateObservable: Observable<TimestampedEvent<NavigateEvent>> | undefined;\n\n    /* istanbul ignore next */\n    if (window.navigation) {\n      navigateObservable = multicast(\n        new Observable<TimestampedEvent<NavigateEvent>>((observer) => {\n          const handler = (navigateEvent: NavigateEvent) => {\n            const enrichedNavigateEvent = dataExtractor.addAdditionalEventProperties(\n              navigateEvent,\n              'navigate',\n              (options as AutoCaptureOptionsWithDefaults).cssSelectorAllowlist,\n              dataAttributePrefix,\n            );\n            observer.next(enrichedNavigateEvent);\n          };\n          window.navigation.addEventListener('navigate', handler as EventListener);\n          return () => {\n            window.navigation.removeEventListener('navigate', handler as EventListener);\n          };\n        }),\n      );\n    }\n\n    const mutationObservable = multicast(\n      createMutationObservable().map((mutation) =>\n        dataExtractor.addAdditionalEventProperties(\n          mutation,\n          'mutation',\n          (options as AutoCaptureOptionsWithDefaults).cssSelectorAllowlist,\n          dataAttributePrefix,\n        ),\n      ),\n    );\n\n    return {\n      [ObservablesEnum.ChangeObservable]: changeObservable,\n      // [ObservablesEnum.ErrorObservable]: errorObservable,\n      [ObservablesEnum.ClickObservable]: clickObservable,\n      [ObservablesEnum.MutationObservable]: mutationObservable,\n      [ObservablesEnum.NavigateObservable]: navigateObservable,\n    };\n  };\n\n  // Group labeled events by event type (eg. click, change)\n  let groupedLabeledEvents = groupLabeledEventIdsByEventType(Object.values(options.pageActions?.labeledEvents ?? {}));\n\n  let labeledEventToTriggerMap = createLabeledEventToTriggerMap(options.pageActions?.triggers ?? []);\n\n  // Evaluate triggers for the given event by running the actions associated with the matching triggers\n  const evaluateTriggers = createTriggerEvaluator(\n    groupedLabeledEvents,\n    labeledEventToTriggerMap,\n    dataExtractor,\n    options,\n  );\n\n  // Function to recalculate internal variables when remote config is updated\n  const recomputePageActionsData = (remotePageActions: ElementInteractionsOptions['pageActions']) => {\n    if (remotePageActions) {\n      // Merge remote config with local options\n      options.pageActions = {\n        ...options.pageActions,\n        ...remotePageActions,\n      };\n\n      // Recalculate internal variables\n      groupedLabeledEvents = groupLabeledEventIdsByEventType(Object.values(options.pageActions.labeledEvents ?? {}));\n      labeledEventToTriggerMap = createLabeledEventToTriggerMap(options.pageActions.triggers ?? []);\n\n      // Update evaluateTriggers function\n      evaluateTriggers.update(groupedLabeledEvents, labeledEventToTriggerMap, options);\n    }\n  };\n\n  const setup: BrowserEnrichmentPlugin['setup'] = async (config, amplitude) => {\n    /* istanbul ignore if */\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // Fetch remote config for pageActions in a non-blocking manner\n    if (config.fetchRemoteConfig) {\n      if (!config.remoteConfigClient) {\n        // TODO(xinyi): Diagnostics.recordEvent\n        config.loggerProvider.debug('Remote config client is not provided, skipping remote config fetch');\n      } else {\n        config.remoteConfigClient.subscribe('configs.analyticsSDK.pageActions', 'all', (remoteConfig) => {\n          recomputePageActionsData(remoteConfig as ElementInteractionsOptions['pageActions']);\n        });\n      }\n    }\n\n    // Create should track event functions the different allowlists\n    const shouldTrackEvent = createShouldTrackEvent(\n      options,\n      (options as AutoCaptureOptionsWithDefaults).cssSelectorAllowlist,\n    );\n    const shouldTrackActionClick = createShouldTrackEvent(\n      options,\n      (options as AutoCaptureOptionsWithDefaults).actionClickAllowlist,\n    );\n\n    // Create observables for events on the window\n    const allObservables = createObservables();\n\n    // Create subscriptions\n    const clickTrackingSubscription = trackClicks({\n      allObservables,\n      amplitude,\n      shouldTrackEvent: shouldTrackEvent,\n      evaluateTriggers: evaluateTriggers.evaluate.bind(evaluateTriggers),\n    });\n\n    subscriptions.push(clickTrackingSubscription);\n\n    const changeSubscription = trackChange({\n      allObservables,\n      getEventProperties: (...args) => dataExtractor.getEventProperties(...args, dataAttributePrefix),\n      amplitude,\n      shouldTrackEvent: shouldTrackEvent,\n      evaluateTriggers: evaluateTriggers.evaluate.bind(evaluateTriggers),\n    });\n    subscriptions.push(changeSubscription);\n\n    const actionClickSubscription = trackActionClick({\n      allObservables,\n      options: options as AutoCaptureOptionsWithDefaults,\n      getEventProperties: (...args) => dataExtractor.getEventProperties(...args, dataAttributePrefix),\n      amplitude,\n      shouldTrackEvent,\n      shouldTrackActionClick: shouldTrackActionClick,\n    });\n    if (actionClickSubscription) {\n      subscriptions.push(actionClickSubscription);\n    }\n\n    /* istanbul ignore next */\n    config?.loggerProvider?.log(`${name} has been successfully added.`);\n\n    // Setup visual tagging selector\n    if (window.opener && visualTaggingOptions.enabled) {\n      const allowlist = (options as AutoCaptureOptionsWithDefaults).cssSelectorAllowlist;\n      const actionClickAllowlist = (options as AutoCaptureOptionsWithDefaults).actionClickAllowlist;\n\n      /* istanbul ignore next */\n      visualTaggingOptions.messenger?.setup({\n        dataExtractor: dataExtractor,\n        logger: config?.loggerProvider,\n        ...(config?.serverZone && { endpoint: constants.AMPLITUDE_ORIGINS_MAP[config.serverZone] }),\n        isElementSelectable: createShouldTrackEvent(options, [...allowlist, ...actionClickAllowlist]),\n        cssSelectorAllowlist: allowlist,\n        actionClickAllowlist: actionClickAllowlist,\n      });\n    }\n  };\n\n  const execute: BrowserEnrichmentPlugin['execute'] = async (event) => {\n    return event;\n  };\n\n  const teardown = async () => {\n    for (const subscription of subscriptions) {\n      subscription.unsubscribe();\n    }\n  };\n\n  return {\n    name,\n    type,\n    setup,\n    execute,\n    teardown,\n  };\n};\n", "import { AllWindowObservables } from '../frustration-plugin';\nimport { BrowserClient, ActionType, merge, asyncMap } from '@amplitude/analytics-core';\nimport { ElementBasedTimestampedEvent, filterOutNonTrackableEvents, MouseButton, shouldTrackEvent } from '../helpers';\nimport { AMPLITUDE_ELEMENT_DEAD_CLICKED_EVENT } from '../constants';\nconst DEAD_CLICK_TIMEOUT = 3000; // 3 seconds to wait for an activity to happen\n\ntype EventDeadClick = {\n  '[Amplitude] X': number;\n  '[Amplitude] Y': number;\n};\n\nconst CHANGE_EVENTS = ['mutation', 'navigate'];\n\nexport function trackDeadClick({\n  amplitude,\n  allObservables,\n  getEventProperties,\n  shouldTrackDeadClick,\n}: {\n  amplitude: BrowserClient;\n  allObservables: AllWindowObservables;\n  getEventProperties: (actionType: ActionType, element: Element) => Record<string, any>;\n  shouldTrackDeadClick: shouldTrackEvent;\n}) {\n  const { clickObservable, mutationObservable, navigateObservable }: AllWindowObservables = allObservables;\n\n  const filteredClickObservable = clickObservable.filter((click) => {\n    return (\n      filterOutNonTrackableEvents(click) &&\n      shouldTrackDeadClick('click', click.closestTrackedAncestor) &&\n      click.event.target instanceof Element &&\n      click.event.target.closest('a[target=\"_blank\"]') === null &&\n      click.event.button === MouseButton.LEFT_OR_TOUCH_CONTACT\n    );\n  });\n\n  /* istanbul ignore next */\n  const changeObservables = navigateObservable ? merge(mutationObservable, navigateObservable) : mutationObservable;\n\n  const clicksAndChangeObservable = merge(filteredClickObservable, changeObservables);\n\n  let deadClickTimer: ReturnType<typeof setTimeout> | null = null;\n\n  const deadClickObservable = asyncMap(\n    clicksAndChangeObservable,\n    (event): Promise<ElementBasedTimestampedEvent<MouseEvent> | null> => {\n      if (deadClickTimer && CHANGE_EVENTS.includes(event.type)) {\n        // a mutation or navigation means it's not a dead click, so clear the timer\n        clearTimeout(deadClickTimer);\n        deadClickTimer = null;\n        return Promise.resolve(null);\n      } else if (event.type === 'click') {\n        // if a dead click is already on-deck, return null.\n        // this throttles dead clicks events so no more than one dead click event\n        // is tracked per every DEAD_CLICK_TIMEOUT ms.\n        if (deadClickTimer) {\n          return Promise.resolve(null);\n        }\n        return new Promise((resolve) => {\n          deadClickTimer = setTimeout(() => {\n            resolve(event as ElementBasedTimestampedEvent<MouseEvent>);\n            deadClickTimer = null;\n          }, DEAD_CLICK_TIMEOUT);\n        });\n      }\n      // unreachable code, but needed to satisfy the type checker\n      return Promise.resolve(null);\n    },\n  );\n\n  return deadClickObservable.subscribe((actionClick) => {\n    if (!actionClick) return;\n    const deadClickEvent: EventDeadClick = {\n      '[Amplitude] X': (actionClick.event as MouseEvent).clientX,\n      '[Amplitude] Y': (actionClick.event as MouseEvent).clientY,\n    };\n    amplitude.track(\n      AMPLITUDE_ELEMENT_DEAD_CLICKED_EVENT,\n      {\n        ...getEventProperties('click', actionClick.closestTrackedAncestor),\n        ...deadClickEvent,\n      },\n      { time: actionClick.timestamp },\n    );\n  });\n}\n", "import { AllWindowObservables } from '../frustration-plugin';\nimport {\n  BrowserClient,\n  asyncMap,\n  DEFAULT_RAGE_CLICK_THRESHOLD,\n  DEFAULT_RAGE_CLICK_WINDOW_MS,\n  DEFAULT_RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD,\n} from '@amplitude/analytics-core';\nimport { shouldTrackEvent } from '../helpers';\nimport { AMPLITUDE_ELEMENT_RAGE_CLICKED_EVENT } from '../constants';\n\nconst RAGE_CLICK_THRESHOLD = DEFAULT_RAGE_CLICK_THRESHOLD;\nconst RAGE_CLICK_WINDOW_MS = DEFAULT_RAGE_CLICK_WINDOW_MS;\nconst RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD = DEFAULT_RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD;\n\ntype Click = {\n  X: number;\n  Y: number;\n  Time: number;\n};\n\ntype EventRageClick = {\n  '[Amplitude] Begin Time': string; // ISO-8601\n  '[Amplitude] End Time': string; // ISO-8601\n  '[Amplitude] Duration': number;\n  '[Amplitude] Clicks': Array<Click>;\n  '[Amplitude] Click Count': number;\n};\n\ntype ClickEvent = {\n  event: MouseEvent | Event;\n  timestamp: number;\n  targetElementProperties: Record<string, any>;\n  closestTrackedAncestor: Element | null;\n};\n\ntype ClickRegionBoundingBox = {\n  yMin?: number;\n  yMax?: number;\n  xMin?: number;\n  xMax?: number;\n  isOutOfBounds?: boolean;\n};\n\ntype RageClickEvent = {\n  rageClickEvent: EventRageClick;\n  time: number;\n};\n\nfunction addCoordinates(regionBox: ClickRegionBoundingBox, click: ClickEvent) {\n  const { pageX, pageY } = click.event as MouseEvent;\n  regionBox.yMin = Math.min(regionBox.yMin ?? pageY, pageY);\n  regionBox.yMax = Math.max(regionBox.yMax ?? pageY, pageY);\n  regionBox.xMin = Math.min(regionBox.xMin ?? pageX, pageX);\n  regionBox.xMax = Math.max(regionBox.xMax ?? pageX, pageX);\n  regionBox.isOutOfBounds =\n    regionBox.yMax - regionBox.yMin > RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD ||\n    regionBox.xMax - regionBox.xMin > RAGE_CLICK_OUT_OF_BOUNDS_THRESHOLD;\n}\n\nfunction getRageClickAnalyticsEvent(clickWindow: ClickEvent[]) {\n  /* istanbul ignore if */\n  if (clickWindow.length === 0) {\n    return null;\n  }\n  const firstClick = clickWindow[0];\n  const lastClick = clickWindow[clickWindow.length - 1];\n\n  const rageClickEvent: EventRageClick = {\n    '[Amplitude] Begin Time': new Date(firstClick.timestamp).toISOString(),\n    '[Amplitude] End Time': new Date(lastClick.timestamp).toISOString(),\n    '[Amplitude] Duration': lastClick.timestamp - firstClick.timestamp,\n    '[Amplitude] Clicks': clickWindow.map((click) => ({\n      X: (click.event as MouseEvent).pageX,\n      Y: (click.event as MouseEvent).pageY,\n      Time: click.timestamp,\n    })),\n    '[Amplitude] Click Count': clickWindow.length,\n    ...firstClick.targetElementProperties,\n  };\n\n  return { rageClickEvent, time: firstClick.timestamp };\n}\n\nfunction isClickOutsideRageClickWindow(clickWindow: ClickEvent[], click: ClickEvent) {\n  const firstIndex = Math.max(0, clickWindow.length - RAGE_CLICK_THRESHOLD + 1);\n  const firstClick = clickWindow[firstIndex];\n  return click.timestamp - firstClick.timestamp >= RAGE_CLICK_WINDOW_MS;\n}\n\nfunction isNewElement(clickWindow: ClickEvent[], click: ClickEvent) {\n  return (\n    clickWindow.length > 0 &&\n    clickWindow[clickWindow.length - 1].closestTrackedAncestor !== click.closestTrackedAncestor\n  );\n}\n\nexport function trackRageClicks({\n  amplitude,\n  allObservables,\n  shouldTrackRageClick,\n}: {\n  amplitude: BrowserClient;\n  allObservables: AllWindowObservables;\n  shouldTrackRageClick: shouldTrackEvent;\n}) {\n  const { clickObservable, selectionObservable }: AllWindowObservables = allObservables;\n\n  // Keep track of all clicks within the sliding window\n  let clickWindow: ClickEvent[] = [];\n\n  // Keep track of the region box for all clicks, to determine when a rage click is out of bounds\n  let clickBoundingBox: ClickRegionBoundingBox = {};\n\n  let pendingRageClick: {\n    resolve: (rageClickEvent: RageClickEvent | null) => void;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    timerId: any;\n  } | null = null;\n\n  // helper function to reset the click window and region box\n  function resetClickWindow(click?: ClickEvent) {\n    clickWindow = [];\n    clickBoundingBox = {};\n    if (click) {\n      addCoordinates(clickBoundingBox, click);\n      clickWindow.push(click);\n    }\n  }\n\n  const rageClickObservable = asyncMap(\n    clickObservable.filter((click) => shouldTrackRageClick('click', click.closestTrackedAncestor)),\n    async (click: ClickEvent): Promise<RageClickEvent | null> => {\n      // add this click's coordinates to the bounding box\n      addCoordinates(clickBoundingBox, click);\n\n      let resolutionValue: RageClickEvent | null = null;\n\n      // if current click is:\n      //  1. first click in the window\n      //  2. on a new element\n      //  3. outside the rage click time window\n      //  4. out of bounds\n      // then start a new click window\n      if (\n        clickWindow.length === 0 ||\n        isNewElement(clickWindow, click) ||\n        isClickOutsideRageClickWindow(clickWindow, click) ||\n        clickBoundingBox.isOutOfBounds\n      ) {\n        // if there was a previous Rage Click Event on deck, then send it\n        if (pendingRageClick) {\n          resolutionValue = getRageClickAnalyticsEvent(clickWindow);\n        }\n        resetClickWindow(click);\n      } else {\n        clickWindow.push(click);\n      }\n\n      // if there was a previous Rage Click Event on deck, then resolve it\n      if (pendingRageClick) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        clearTimeout(pendingRageClick.timerId);\n        pendingRageClick.resolve(resolutionValue);\n        pendingRageClick = null;\n      }\n\n      // if we have enough clicks to be a rage click, set a timout to trigger the rage\n      // click event after the time threshold is reached.\n      // This will be cancelled if a new click is tracked within the time threshold.\n      if (clickWindow.length >= RAGE_CLICK_THRESHOLD) {\n        return new Promise((resolve) => {\n          pendingRageClick = {\n            resolve,\n            timerId: setTimeout(() => {\n              resolve(getRageClickAnalyticsEvent(clickWindow));\n            }, RAGE_CLICK_WINDOW_MS),\n          };\n        });\n      }\n\n      return null;\n    },\n  );\n\n  // reset the click window when a selection change occurs\n  /* istanbul ignore next */\n  const selectionSubscription = selectionObservable?.subscribe(() => {\n    resetClickWindow();\n  });\n\n  const rageClickSubscription = rageClickObservable.subscribe((data: RageClickEvent | null) => {\n    /* istanbul ignore if */\n    if (data === null) {\n      return;\n    }\n    amplitude.track(AMPLITUDE_ELEMENT_RAGE_CLICKED_EVENT, data.rageClickEvent, { time: data.time });\n  });\n\n  return {\n    unsubscribe: () => {\n      rageClickSubscription.unsubscribe();\n      /* istanbul ignore next */\n      selectionSubscription?.unsubscribe();\n    },\n  };\n}\n", "import { BrowserErrorEvent } from '../observables';\nimport { AllWindowObservables } from '../frustration-plugin';\nimport {\n  ElementBasedTimestampedEvent,\n  filterOutNonTrackableEvents,\n  MouseButton,\n  shouldTrackEvent,\n  TimestampedEvent,\n} from '../helpers';\nimport { BrowserClient, merge } from '@amplitude/analytics-core';\nimport { AMPLITUDE_ELEMENT_ERROR_CLICKED_EVENT } from '../constants';\n\ntype ClickOrErrorEvent = ElementBasedTimestampedEvent<MouseEvent> | TimestampedEvent<BrowserErrorEvent>;\n\nconst ERROR_CLICK_TIMEOUT = 2_000; // 2 seconds to wait for an error to happen\n\nexport function trackErrorClicks({\n  amplitude,\n  allObservables,\n  shouldTrackErrorClick,\n}: {\n  amplitude: BrowserClient;\n  allObservables: AllWindowObservables;\n  shouldTrackErrorClick: shouldTrackEvent;\n}) {\n  const { clickObservable, browserErrorObservable } = allObservables;\n\n  const filteredClickObservable = clickObservable.filter((click) => {\n    return (\n      filterOutNonTrackableEvents(click) &&\n      shouldTrackErrorClick('click', click.closestTrackedAncestor) &&\n      click.event.target instanceof Element &&\n      click.event.target.closest('a[target=\"_blank\"]') === null &&\n      click.event.button === MouseButton.LEFT_OR_TOUCH_CONTACT\n    );\n  });\n\n  let errorClickTimer: ReturnType<typeof setTimeout> | null = null;\n  let latestClickEvent: ElementBasedTimestampedEvent<MouseEvent> | null = null;\n\n  const clearClickTimer = () => {\n    if (errorClickTimer !== null) {\n      clearTimeout(errorClickTimer);\n      errorClickTimer = null;\n    }\n    latestClickEvent = null;\n  };\n\n  return merge(filteredClickObservable, browserErrorObservable).subscribe((event: ClickOrErrorEvent) => {\n    if (event.type === 'click') {\n      clearClickTimer();\n      latestClickEvent = event as ElementBasedTimestampedEvent<MouseEvent>;\n      errorClickTimer = setTimeout(clearClickTimer, ERROR_CLICK_TIMEOUT);\n      return;\n    }\n\n    if (event.type === 'error' && latestClickEvent) {\n      amplitude.track(AMPLITUDE_ELEMENT_ERROR_CLICKED_EVENT, {\n        ['[Amplitude] Kind']: event.event.kind,\n        ['[Amplitude] Message']: event.event.message,\n        ['[Amplitude] Stack']: event.event.stack,\n        ['[Amplitude] Filename']: event.event.filename,\n        ['[Amplitude] Line Number']: event.event.lineNumber,\n        ['[Amplitude] Column Number']: event.event.columnNumber,\n        ...latestClickEvent.targetElementProperties,\n      });\n      clearClickTimer();\n    }\n  });\n}\n", "/* eslint-disable no-restricted-globals */\nimport {\n  BrowserClient,\n  BrowserConfig,\n  EnrichmentPlugin,\n  FrustrationInteractionsOptions,\n  DEFAULT_DATA_ATTRIBUTE_PREFIX,\n  multicast,\n  Observable,\n  Unsubscribable,\n  DEFAULT_RAGE_CLICK_ALLOWLIST,\n  DEFAULT_DEAD_CLICK_ALLOWLIST,\n  DEFAULT_ERROR_CLICK_ALLOWLIST,\n} from '@amplitude/analytics-core';\nimport * as constants from './constants';\nimport { createShouldTrackEvent, ElementBasedTimestampedEvent, NavigateEvent, TimestampedEvent } from './helpers';\nimport { trackDeadClick } from './autocapture/track-dead-click';\nimport { trackRageClicks } from './autocapture/track-rage-click';\nimport { ObservablesEnum } from './autocapture-plugin';\nimport {\n  BrowserErrorEvent,\n  createClickObservable,\n  createErrorObservable,\n  createMutationObservable,\n} from './observables';\nimport { DataExtractor } from './data-extractor';\nimport { trackErrorClicks } from './autocapture/track-error-click';\n\nexport interface AllWindowObservables {\n  [ObservablesEnum.ClickObservable]: Observable<ElementBasedTimestampedEvent<MouseEvent>>;\n  [ObservablesEnum.MutationObservable]: Observable<TimestampedEvent<MutationRecord[]>>;\n  [ObservablesEnum.BrowserErrorObservable]: Observable<TimestampedEvent<BrowserErrorEvent>>;\n  [ObservablesEnum.NavigateObservable]?: Observable<TimestampedEvent<NavigateEvent>>;\n  [ObservablesEnum.SelectionObservable]?: Observable<void>;\n}\n\ntype BrowserEnrichmentPlugin = EnrichmentPlugin<BrowserClient, BrowserConfig>;\n\n/**\n * Helper function to extract the css selector allowlist\n * from the frustration interactions options for a specific\n * autocapture feature.\n */\nfunction getCssSelectorAllowlist(\n  options: FrustrationInteractionsOptions,\n  attribute: keyof FrustrationInteractionsOptions,\n  defaultAllowlist: string[],\n  enabled: boolean,\n): string[] {\n  if (!enabled) {\n    return [];\n  }\n  const config = options[attribute];\n  if (\n    typeof config === 'object' &&\n    config !== null &&\n    'cssSelectorAllowlist' in config &&\n    Array.isArray(config.cssSelectorAllowlist)\n  ) {\n    return config.cssSelectorAllowlist;\n  }\n  return defaultAllowlist;\n}\n\nexport const frustrationPlugin = (options: FrustrationInteractionsOptions = {}): BrowserEnrichmentPlugin => {\n  const name = constants.FRUSTRATION_PLUGIN_NAME;\n  const type = 'enrichment';\n\n  const subscriptions: Unsubscribable[] = [];\n\n  let isErrorClicksEnabled = options.errorClicks !== false;\n\n  // if errorClicks is not defined, disable it\n  // change this once it moves out of @experimental\n  if (!options.errorClicks) {\n    isErrorClicksEnabled = false;\n  }\n\n  // Check if each feature is enabled\n  const deadClicksEnabled = options.deadClicks !== false && options.deadClicks !== null;\n  const rageClicksEnabled = options.rageClicks !== false && options.rageClicks !== null;\n\n  // Get CSS selectors for enabled features\n  const rageCssSelectors = getCssSelectorAllowlist(\n    options,\n    'rageClicks',\n    DEFAULT_RAGE_CLICK_ALLOWLIST,\n    rageClicksEnabled,\n  );\n  const deadCssSelectors = getCssSelectorAllowlist(\n    options,\n    'deadClicks',\n    DEFAULT_DEAD_CLICK_ALLOWLIST,\n    deadClicksEnabled,\n  );\n\n  const errorCssSelectors = getCssSelectorAllowlist(\n    options,\n    'errorClicks',\n    DEFAULT_ERROR_CLICK_ALLOWLIST,\n    isErrorClicksEnabled,\n  );\n\n  const dataAttributePrefix = options.dataAttributePrefix ?? DEFAULT_DATA_ATTRIBUTE_PREFIX;\n\n  const dataExtractor = new DataExtractor(options);\n\n  // combine the selector lists from enabled features to determine which clicked elements should be filtered\n  const combinedCssSelectors = [...new Set([...rageCssSelectors, ...deadCssSelectors, ...errorCssSelectors])];\n\n  // Create observables on events on the window\n  const createObservables = (): AllWindowObservables => {\n    const clickObservable = multicast(\n      createClickObservable('pointerdown').map((click) => {\n        return dataExtractor.addAdditionalEventProperties(\n          click,\n          'click',\n          combinedCssSelectors,\n          dataAttributePrefix,\n          true, // capture when cursor is pointer\n        );\n      }),\n    );\n\n    const browserErrorObservables = multicast(\n      createErrorObservable().map((error) => {\n        return dataExtractor.addTypeAndTimestamp(error, 'error');\n      }),\n    );\n\n    const enrichedMutationObservable = multicast<TimestampedEvent<MutationRecord[]>>(\n      createMutationObservable().map((mutation) =>\n        dataExtractor.addAdditionalEventProperties(mutation, 'mutation', combinedCssSelectors, dataAttributePrefix),\n      ),\n    );\n\n    let enrichedNavigateObservable: Observable<TimestampedEvent<NavigateEvent>> | undefined;\n\n    if (window.navigation) {\n      const navigateObservable = new Observable<Event>((observer) => {\n        const handler = (event: Event): void => {\n          observer.next({\n            ...event,\n            type: 'navigate',\n          });\n        };\n        window.navigation.addEventListener('navigate', handler);\n        return () => {\n          window.navigation.removeEventListener('navigate', handler);\n        };\n      });\n      enrichedNavigateObservable = multicast<TimestampedEvent<NavigateEvent>>(\n        navigateObservable.map<TimestampedEvent<NavigateEvent>>(\n          (navigate) =>\n            dataExtractor.addAdditionalEventProperties(\n              navigate,\n              'navigate',\n              combinedCssSelectors,\n              dataAttributePrefix,\n            ) as TimestampedEvent<NavigateEvent>,\n        ),\n      );\n    }\n\n    const selectionObservable = multicast(\n      new Observable<void>((observer) => {\n        const handler = () => {\n          const el: HTMLElement | null = document.activeElement as HTMLElement;\n\n          // handle input and textarea\n\n          // if the selectionStart and selectionEnd are the same, it means\n          // nothing is selected (collapsed) and the cursor position is one point\n          if (el && (el.tagName === 'TEXTAREA' || el.tagName === 'INPUT')) {\n            let start: number | null | undefined;\n            let end: number | null | undefined;\n            try {\n              start = (el as HTMLInputElement | HTMLTextAreaElement).selectionStart;\n              end = (el as HTMLInputElement | HTMLTextAreaElement).selectionEnd;\n              if (start === end) return; // collapsed\n            } catch (error) {\n              // input that doesn't support selectionStart/selectionEnd (like checkbox)\n              // do nothing here\n              return;\n            }\n            return observer.next();\n          }\n\n          // handle non-input elements\n\n          // non-input elements have an attribute called \"isCollapsed\" which\n          // if true, indicates there \"is currently not any text selected\"\n          // (see https://developer.mozilla.org/en-US/docs/Web/API/Selection/isCollapsed)\n          const selection = window.getSelection();\n          if (!selection || selection.isCollapsed) return;\n          return observer.next();\n        };\n        window.document.addEventListener('selectionchange', handler);\n        return () => {\n          window.document.removeEventListener('selectionchange', handler);\n        };\n      }),\n    );\n\n    return {\n      [ObservablesEnum.ClickObservable]: clickObservable as Observable<ElementBasedTimestampedEvent<MouseEvent>>,\n      [ObservablesEnum.MutationObservable]: enrichedMutationObservable,\n      [ObservablesEnum.NavigateObservable]: enrichedNavigateObservable,\n      [ObservablesEnum.BrowserErrorObservable]: browserErrorObservables,\n      [ObservablesEnum.SelectionObservable]: selectionObservable,\n    };\n  };\n\n  const setup: BrowserEnrichmentPlugin['setup'] = async (config, amplitude) => {\n    /* istanbul ignore if */\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // Create observables for events on the window\n    const allObservables = createObservables();\n\n    // Create subscriptions only for enabled features\n    if (rageClicksEnabled) {\n      const shouldTrackRageClick = createShouldTrackEvent(options, rageCssSelectors);\n      const rageClickSubscription = trackRageClicks({\n        allObservables,\n        amplitude,\n        shouldTrackRageClick,\n      });\n      subscriptions.push(rageClickSubscription);\n    }\n\n    if (deadClicksEnabled) {\n      const shouldTrackDeadClick = createShouldTrackEvent(options, deadCssSelectors);\n      const deadClickSubscription = trackDeadClick({\n        amplitude,\n        allObservables,\n        getEventProperties: (actionType, element) =>\n          dataExtractor.getEventProperties(actionType, element, dataAttributePrefix),\n        shouldTrackDeadClick,\n      });\n      subscriptions.push(deadClickSubscription);\n    }\n\n    if (isErrorClicksEnabled) {\n      const shouldTrackErrorClick = createShouldTrackEvent(options, errorCssSelectors);\n      const errorClickSubscription = trackErrorClicks({\n        amplitude,\n        allObservables,\n        shouldTrackErrorClick,\n      });\n      subscriptions.push(errorClickSubscription);\n    }\n\n    /* istanbul ignore next */\n    config?.loggerProvider?.log(`${name} has been successfully added.`);\n  };\n\n  const execute: BrowserEnrichmentPlugin['execute'] = async (event) => {\n    return event;\n  };\n\n  const teardown = async () => {\n    for (const subscription of subscriptions) {\n      subscription.unsubscribe();\n    }\n  };\n\n  return {\n    name,\n    type,\n    setup,\n    execute,\n    teardown,\n  };\n};\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "export const PLUGIN_NAME = '@amplitude/plugin-network-capture-browser';\n\nexport const AMPLITUDE_NETWORK_REQUEST_EVENT = '[Amplitude] Network Request';\n\n// TODO: when @experimental is removed from responseHeaders and requestHeaders,\n// remove this constant or set it to false\nexport const IS_HEADER_CAPTURE_EXPERIMENTAL = true;\n", "import {\n  BrowserClient,\n  NetworkRequestEvent,\n  NetworkCaptureRule,\n  NetworkTrackingOptions,\n  getGlobalScope,\n  isUrlMatchAllowlist,\n  SAFE_HEADERS,\n  ILogger,\n  IRequestWrapper,\n  Unsubscribable,\n} from '@amplitude/analytics-core';\nimport { AllWindowObservables, TimestampedEvent } from './network-capture-plugin';\nimport { AMPLITUDE_NETWORK_REQUEST_EVENT, IS_HEADER_CAPTURE_EXPERIMENTAL } from './constants';\nimport { BodyCaptureRule } from '@amplitude/analytics-core/lib/esm/types/network-tracking';\n\nconst DEFAULT_STATUS_CODE_RANGE = '500-599';\n\nfunction wildcardMatch(str: string, pattern: string) {\n  // Escape all regex special characters except for *\n  const escapedPattern = pattern.replace(/[-[\\]{}()+?.,\\\\^$|#\\s]/g, '\\\\$&');\n  // Replace * with .*\n  const regexPattern = '^' + escapedPattern.replace(/\\*/g, '.*') + '$';\n  const regex = new RegExp(regexPattern);\n  return regex.test(str);\n}\n\nfunction isStatusCodeInRange(statusCode: number, range: string) {\n  const ranges = range.split(',');\n  for (const r of ranges) {\n    const [start, end] = r.split('-').map(Number);\n    if (statusCode === start && end === undefined) {\n      return true;\n    }\n    if (statusCode >= start && statusCode <= end) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isCaptureRuleMatch(\n  rule: NetworkCaptureRule,\n  hostname: string,\n  status?: number,\n  url?: string,\n  method?: string,\n) {\n  // check if the host is in the allowed hosts\n  if (rule.hosts && !rule.hosts.find((host: string) => wildcardMatch(hostname, host))) {\n    return;\n  }\n\n  // check if the URL is in the allowed URL patterns\n  if (url && rule.urls && !isUrlMatchAllowlist(url, rule.urls)) {\n    return;\n  }\n\n  // check if the method is in the allowed methods\n  if (\n    method &&\n    rule.methods &&\n    !rule.methods.find(\n      (allowedMethod: string) => method.toLowerCase() === allowedMethod.toLowerCase() || allowedMethod === '*',\n    )\n  ) {\n    return;\n  }\n\n  // check if the status code is in the allowed range\n  if (status || status === 0) {\n    const statusCodeRange = rule.statusCodeRange || DEFAULT_STATUS_CODE_RANGE;\n    if (!isStatusCodeInRange(status, statusCodeRange)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction parseUrl(url: string | undefined) {\n  if (!url) {\n    return;\n  }\n  try {\n    /* istanbul ignore next */\n    const currentHref = getGlobalScope()?.location.href;\n    const urlObj = new URL(url, currentHref);\n    const query = urlObj.searchParams.toString();\n    const fragment = urlObj.hash.replace('#', '');\n    const href = urlObj.href;\n    const host = urlObj.host;\n    urlObj.hash = '';\n    urlObj.search = '';\n    const hrefWithoutQueryOrHash = urlObj.href;\n    return { query, fragment, href, hrefWithoutQueryOrHash, host };\n  } catch (e) {\n    /* istanbul ignore next */\n    return;\n  }\n}\n\nfunction isAmplitudeNetworkRequestEvent(host: string, requestWrapper: IRequestWrapper): boolean {\n  if (host.includes('amplitude.com')) {\n    try {\n      const body = requestWrapper.body;\n      if (typeof body !== 'string') {\n        return false;\n      }\n      const bodyObj = JSON.parse(body) as { events: any[] };\n      const { events } = bodyObj;\n      /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access */\n      if (events.find((event: any) => event.event_type === AMPLITUDE_NETWORK_REQUEST_EVENT)) {\n        return true;\n      }\n    } catch (e) {\n      // do nothing\n    }\n  }\n  return false;\n}\n\n/**\n * Takes a user provided header capture rule and returns a\n * HeaderCaptureRule object that sets proper default values.\n *\n * @param rule - The header capture rule to parse.\n * @returns A HeaderCaptureRule object.\n */\nexport function parseHeaderCaptureRule(rule: string[] | boolean | undefined | null): string[] | undefined {\n  if (typeof rule !== 'object' || rule === null) {\n    // if rule is truthy or undefined, return SAFE_HEADERS\n    if (rule) {\n      return [...SAFE_HEADERS];\n    } else if (rule === undefined) {\n      /* istanbul ignore next */\n      const res = IS_HEADER_CAPTURE_EXPERIMENTAL ? undefined : [...SAFE_HEADERS];\n      return res;\n    }\n    return;\n  }\n\n  // if the rule is defined but empty, return undefined\n  if (rule.length === 0) {\n    return;\n  }\n\n  return rule;\n}\n\nfunction isBodyCaptureRuleEmpty(rule: BodyCaptureRule) {\n  /* istanbul ignore next */\n  return !rule?.allowlist?.length && !rule?.blocklist?.length;\n}\n\nexport function shouldTrackNetworkEvent(networkEvent: NetworkRequestEvent, options: NetworkTrackingOptions = {}) {\n  const urlObj = parseUrl(networkEvent.url);\n  /* istanbul ignore if */\n  if (!urlObj) {\n    // if the URL failed to parse, do not track the event\n    // this is a probably impossible case that would only happen if the URL is malformed\n    /* istanbul ignore next */\n    return false;\n  }\n  const { host } = urlObj;\n\n  // false if is amplitude request and not configured to track amplitude requests\n  if (\n    options.ignoreAmplitudeRequests !== false &&\n    (wildcardMatch(host, '*.amplitude.com') || wildcardMatch(host, 'amplitude.com'))\n  ) {\n    return false;\n  }\n\n  // false if the host is in the ignore list\n  if (options.ignoreHosts?.find((ignoreHost: string) => wildcardMatch(host, ignoreHost))) {\n    return false;\n  }\n\n  // false if the status code is not 500-599 and there are no captureRules\n  if (\n    !options.captureRules &&\n    networkEvent.status !== undefined &&\n    !isStatusCodeInRange(networkEvent.status, DEFAULT_STATUS_CODE_RANGE)\n  ) {\n    return false;\n  }\n\n  if (options.captureRules) {\n    // find the first capture rule, in reverse-order,\n    // that is a match (true) or a miss (false)\n    let isMatch: boolean | undefined;\n    [...options.captureRules].reverse().find((rule) => {\n      isMatch = isCaptureRuleMatch(rule, host, networkEvent.status, networkEvent.url, networkEvent.method);\n\n      if (isMatch) {\n        const responseHeadersRule = parseHeaderCaptureRule(rule.responseHeaders);\n        if (networkEvent.responseWrapper && responseHeadersRule) {\n          const responseHeaders = networkEvent.responseWrapper.headers(responseHeadersRule);\n          if (responseHeaders) {\n            networkEvent.responseHeaders = responseHeaders;\n          }\n        }\n\n        // if requestHeaders rule is specified, enrich the event with the request headers\n        const requestHeadersRule = parseHeaderCaptureRule(rule.requestHeaders);\n        if (networkEvent.requestWrapper && requestHeadersRule) {\n          const requestHeaders = networkEvent.requestWrapper.headers(requestHeadersRule);\n          if (requestHeaders) {\n            networkEvent.requestHeaders = requestHeaders;\n          }\n        }\n\n        // if responseBody rule is specified, enrich the event with the response body\n        if (networkEvent.responseWrapper && rule.responseBody && !isBodyCaptureRuleEmpty(rule.responseBody)) {\n          networkEvent.responseBodyJson = networkEvent.responseWrapper.json(\n            rule.responseBody.allowlist,\n            rule.responseBody.blocklist,\n          );\n        }\n\n        // if requestBody rule is specified, enrich the event with the request body\n        if (networkEvent.requestWrapper && rule.requestBody && !isBodyCaptureRuleEmpty(rule.requestBody)) {\n          networkEvent.requestBodyJson = networkEvent.requestWrapper.json(\n            rule.requestBody.allowlist,\n            rule.requestBody.blocklist,\n          );\n        }\n      }\n\n      return isMatch !== undefined;\n    });\n\n    // if we found a miss (false) or no match (undefined),\n    // then do not track the event\n    if (!isMatch) {\n      return false;\n    }\n  }\n\n  // skip Amplitude network requests to \"[Amplitude] Network Request\" to avoid infinite loop\n  if (networkEvent.requestWrapper && isAmplitudeNetworkRequestEvent(host, networkEvent.requestWrapper)) {\n    return false;\n  }\n\n  return true;\n}\n\nexport type NetworkAnalyticsEvent = {\n  ['[Amplitude] URL']: string;\n  ['[Amplitude] URL Query']?: string;\n  ['[Amplitude] URL Fragment']?: string;\n  ['[Amplitude] Request Method']: string;\n  ['[Amplitude] Status Code']?: number;\n  ['[Amplitude] Start Time']?: number; // unix timestamp\n  ['[Amplitude] Completion Time']?: number; // unix timestamp\n  ['[Amplitude] Duration']?: number; // completionTime - startTime (millis)\n  ['[Amplitude] Request Body Size']?: number;\n  ['[Amplitude] Request Headers']?: Record<string, string>;\n  ['[Amplitude] Request Body']?: string;\n  ['[Amplitude] Response Body Size']?: number;\n  ['[Amplitude] Response Headers']?: Record<string, string>;\n  ['[Amplitude] Response Body']?: string;\n  ['[Amplitude] Request Type']?: 'xhr' | 'fetch';\n};\n\nexport async function logNetworkAnalyticsEvent(\n  networkAnalyticsEvent: NetworkAnalyticsEvent,\n  request: NetworkRequestEvent,\n  amplitude: BrowserClient,\n  loggerProvider?: ILogger,\n) {\n  if (request.requestBodyJson || request.responseBodyJson) {\n    const [requestBody, responseBody] = await Promise.all([request.requestBodyJson, request.responseBodyJson]);\n    if (requestBody) {\n      try {\n        networkAnalyticsEvent['[Amplitude] Request Body'] = JSON.stringify(requestBody);\n      } catch (e) {\n        /* istanbul ignore next */\n        loggerProvider?.debug('Failed to stringify request body', e);\n      }\n    }\n    if (responseBody) {\n      try {\n        networkAnalyticsEvent['[Amplitude] Response Body'] = JSON.stringify(responseBody);\n      } catch (e) {\n        /* istanbul ignore next */\n        loggerProvider?.debug('Failed to stringify response body');\n      }\n    }\n  }\n  /* istanbul ignore next */\n  amplitude?.track(AMPLITUDE_NETWORK_REQUEST_EVENT, networkAnalyticsEvent);\n}\n\nexport function trackNetworkEvents({\n  allObservables,\n  networkTrackingOptions,\n  amplitude,\n  loggerProvider,\n}: {\n  allObservables: AllWindowObservables;\n  networkTrackingOptions: NetworkTrackingOptions;\n  amplitude: BrowserClient;\n  loggerProvider?: ILogger;\n}): Unsubscribable {\n  const { networkObservable } = allObservables;\n\n  const filteredNetworkObservable = networkObservable.filter((event: TimestampedEvent<NetworkRequestEvent>) => {\n    // Only track network events that should be tracked\n    return shouldTrackNetworkEvent(event.event as NetworkRequestEvent, networkTrackingOptions);\n  });\n\n  return filteredNetworkObservable.subscribe((networkEvent) => {\n    const request = networkEvent.event;\n\n    // convert to NetworkAnalyticsEvent\n    const urlObj = parseUrl(request.url);\n    /* istanbul ignore if */\n    if (!urlObj) {\n      // if the URL failed to parse, do not track the event\n      // this is a very unlikely case, because URL() shouldn't throw an exception\n      // when the URL is a valid URL\n      /* istanbul ignore next */\n      return;\n    }\n\n    const responseBodySize = request.responseWrapper?.bodySize;\n    /* istanbul ignore next */\n    const requestBodySize = request.requestWrapper?.bodySize;\n\n    const networkAnalyticsEvent: NetworkAnalyticsEvent = {\n      ['[Amplitude] URL']: urlObj.hrefWithoutQueryOrHash,\n      ['[Amplitude] URL Query']: urlObj.query,\n      ['[Amplitude] URL Fragment']: urlObj.fragment,\n      ['[Amplitude] Request Method']: request.method,\n      ['[Amplitude] Status Code']: request.status,\n      ['[Amplitude] Start Time']: request.startTime,\n      ['[Amplitude] Completion Time']: request.endTime,\n      ['[Amplitude] Duration']: request.duration,\n      ['[Amplitude] Request Body Size']: requestBodySize,\n      ['[Amplitude] Response Body Size']: responseBodySize,\n      ['[Amplitude] Request Type']: request.type,\n      ['[Amplitude] Request Headers']: request.requestHeaders,\n      ['[Amplitude] Response Headers']: request.responseHeaders,\n    };\n\n    // fire-and-forget promise that tracks the event\n    void logNetworkAnalyticsEvent(networkAnalyticsEvent, request, amplitude, loggerProvider);\n  });\n}\n", "/* eslint-disable no-restricted-globals */\nimport {\n  BrowserClient,\n  BrowserConfig,\n  EnrichmentPlugin,\n  NetworkRequestEvent,\n  networkObserver,\n  NetworkEventCallback,\n  NetworkTrackingOptions,\n  ILogger,\n} from '@amplitude/analytics-core';\nimport * as constants from './constants';\nimport { Observable, Unsubscribable } from '@amplitude/analytics-core';\nimport { trackNetworkEvents } from './track-network-event';\n\nexport type BrowserEnrichmentPlugin = EnrichmentPlugin<BrowserClient, BrowserConfig>;\n\nexport enum ObservablesEnum {\n  NetworkObservable = 'networkObservable',\n}\n\n// Base TimestampedEvent type\ntype BaseTimestampedEvent<T> = {\n  event: T;\n  timestamp: number;\n  type: 'rage' | 'click' | 'change' | 'error' | 'navigate' | 'mutation' | 'network';\n};\n\n// Specific types for events with targetElementProperties\nexport type ElementBasedEvent = MouseEvent | Event;\nexport type ElementBasedTimestampedEvent<T> = BaseTimestampedEvent<T> & {\n  event: MouseEvent | Event;\n  type: 'click' | 'change';\n  closestTrackedAncestor: Element;\n  targetElementProperties: Record<string, any>;\n};\n\n// Union type for all possible TimestampedEvents\nexport type TimestampedEvent<T> = BaseTimestampedEvent<T> | ElementBasedTimestampedEvent<T>;\n\nexport interface AllWindowObservables {\n  [ObservablesEnum.NetworkObservable]: Observable<TimestampedEvent<NetworkRequestEvent>>;\n}\n\nlet subscription: Unsubscribable;\n\nexport const networkCapturePlugin = (options: NetworkTrackingOptions = {}): BrowserEnrichmentPlugin => {\n  const name = constants.PLUGIN_NAME;\n  const type = 'enrichment';\n  let logger: ILogger;\n\n  const addAdditionalEventProperties = <T>(\n    event: T,\n    type: TimestampedEvent<T>['type'],\n  ): TimestampedEvent<T> | ElementBasedTimestampedEvent<T> => {\n    const baseEvent: BaseTimestampedEvent<T> | ElementBasedTimestampedEvent<T> = {\n      event,\n      timestamp: Date.now(),\n      type,\n    };\n\n    return baseEvent;\n  };\n\n  // Create observables on events on the window\n  const createObservables = (): AllWindowObservables => {\n    const networkObservable = new Observable<TimestampedEvent<NetworkRequestEvent>>((observer) => {\n      const callback = new NetworkEventCallback((event) => {\n        const eventWithProperties = addAdditionalEventProperties(event, 'network');\n        observer.next(eventWithProperties);\n      });\n      networkObserver.subscribe(callback, logger);\n      return () => {\n        networkObserver.unsubscribe(callback);\n      };\n    });\n\n    return {\n      [ObservablesEnum.NetworkObservable]: networkObservable,\n    };\n  };\n\n  const setup: BrowserEnrichmentPlugin['setup'] = async (config, amplitude) => {\n    /* istanbul ignore if */\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // Create observables for events on the window\n    const allObservables = createObservables();\n\n    /* istanbul ignore next */\n    logger = config?.loggerProvider;\n\n    subscription = trackNetworkEvents({\n      allObservables,\n      networkTrackingOptions: options,\n      amplitude,\n      loggerProvider: logger,\n    });\n\n    /* istanbul ignore next */\n    logger?.log(`${name} has been successfully added.`);\n  };\n\n  /* istanbul ignore next */\n  const execute: BrowserEnrichmentPlugin['execute'] = async (event) => {\n    return event;\n  };\n\n  const teardown = async () => {\n    subscription.unsubscribe();\n  };\n\n  return {\n    name,\n    type,\n    setup,\n    execute,\n    teardown,\n  };\n};\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "export const PLUGIN_NAME = 'web-vitals-browser';\nexport const WEB_VITALS_EVENT_NAME = '[Amplitude] Web Vitals';\n", "let e=-1;const t=t=>{addEventListener(\"pageshow\",(n=>{n.persisted&&(e=n.timeStamp,t(n))}),!0)},n=(e,t,n,i)=>{let s,o;return r=>{t.value>=0&&(r||i)&&(o=t.value-(s??0),(o||void 0===s)&&(s=t.value,t.delta=o,t.rating=((e,t)=>e>t[1]?\"poor\":e>t[0]?\"needs-improvement\":\"good\")(t.value,n),e(t)))}},i=e=>{requestAnimationFrame((()=>requestAnimationFrame((()=>e()))))},s=()=>{const e=performance.getEntriesByType(\"navigation\")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},o=()=>{const e=s();return e?.activationStart??0},r=(t,n=-1)=>{const i=s();let r=\"navigate\";e>=0?r=\"back-forward-cache\":i&&(document.prerendering||o()>0?r=\"prerender\":document.wasDiscarded?r=\"restore\":i.type&&(r=i.type.replace(/_/g,\"-\")));return{name:t,value:n,rating:\"good\",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},c=new WeakMap;function a(e,t){return c.get(e)||c.set(e,new t),c.get(e)}class d{t;i=0;o=[];h(e){if(e.hadRecentInput)return;const t=this.o[0],n=this.o.at(-1);this.i&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}}const h=(e,t,n={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const i=new PerformanceObserver((e=>{Promise.resolve().then((()=>{t(e.getEntries())}))}));return i.observe({type:e,buffered:!0,...n}),i}}catch{}},f=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let u=-1;const l=new Set,m=()=>\"hidden\"!==document.visibilityState||document.prerendering?1/0:0,p=e=>{if(\"hidden\"===document.visibilityState){if(\"visibilitychange\"===e.type)for(const e of l)e();isFinite(u)||(u=\"visibilitychange\"===e.type?e.timeStamp:0,removeEventListener(\"prerenderingchange\",p,!0))}},v=()=>{if(u<0){const e=o(),n=document.prerendering?void 0:globalThis.performance.getEntriesByType(\"visibility-state\").filter((t=>\"hidden\"===t.name&&t.startTime>e))[0]?.startTime;u=n??m(),addEventListener(\"visibilitychange\",p,!0),addEventListener(\"prerenderingchange\",p,!0),t((()=>{setTimeout((()=>{u=m()}))}))}return{get firstHiddenTime(){return u},onHidden(e){l.add(e)}}},g=e=>{document.prerendering?addEventListener(\"prerenderingchange\",(()=>e()),!0):e()},y=[1800,3e3],E=(e,s={})=>{g((()=>{const c=v();let a,d=r(\"FCP\");const f=h(\"paint\",(e=>{for(const t of e)\"first-contentful-paint\"===t.name&&(f.disconnect(),t.startTime<c.firstHiddenTime&&(d.value=Math.max(t.startTime-o(),0),d.entries.push(t),a(!0)))}));f&&(a=n(e,d,y,s.reportAllChanges),t((t=>{d=r(\"FCP\"),a=n(e,d,y,s.reportAllChanges),i((()=>{d.value=performance.now()-t.timeStamp,a(!0)}))})))}))},b=[.1,.25],L=(e,s={})=>{const o=v();E(f((()=>{let c,f=r(\"CLS\",0);const u=a(s,d),l=e=>{for(const t of e)u.h(t);u.i>f.value&&(f.value=u.i,f.entries=u.o,c())},m=h(\"layout-shift\",l);m&&(c=n(e,f,b,s.reportAllChanges),o.onHidden((()=>{l(m.takeRecords()),c(!0)})),t((()=>{u.i=0,f=r(\"CLS\",0),c=n(e,f,b,s.reportAllChanges),i((()=>c()))})),setTimeout(c))})))};let P=0,T=1/0,_=0;const M=e=>{for(const t of e)t.interactionId&&(T=Math.min(T,t.interactionId),_=Math.max(_,t.interactionId),P=_?(_-T)/7+1:0)};let w;const C=()=>w?P:performance.interactionCount??0,I=()=>{\"interactionCount\"in performance||w||(w=h(\"event\",M,{type:\"event\",buffered:!0,durationThreshold:0}))};let F=0;class k{u=[];l=new Map;m;p;v(){F=C(),this.u.length=0,this.l.clear()}L(){const e=Math.min(this.u.length-1,Math.floor((C()-F)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&\"first-input\"!==e.entryType)return;const t=this.u.at(-1);let n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>t.P){if(n?e.duration>n.P?(n.entries=[e],n.P=e.duration):e.duration===n.P&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],P:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort(((e,t)=>t.P-e.P)),this.u.length>10){const e=this.u.splice(10);for(const t of e)this.l.delete(t.id)}this.p?.(n)}}}const A=e=>{const t=globalThis.requestIdleCallback||setTimeout;\"hidden\"===document.visibilityState?e():(e=f(e),addEventListener(\"visibilitychange\",e,{once:!0,capture:!0}),t((()=>{e(),removeEventListener(\"visibilitychange\",e,{capture:!0})})))},B=[200,500],S=(e,i={})=>{if(!globalThis.PerformanceEventTiming||!(\"interactionId\"in PerformanceEventTiming.prototype))return;const s=v();g((()=>{I();let o,c=r(\"INP\");const d=a(i,k),f=e=>{A((()=>{for(const t of e)d.h(t);const t=d.L();t&&t.P!==c.value&&(c.value=t.P,c.entries=t.entries,o())}))},u=h(\"event\",f,{durationThreshold:i.durationThreshold??40});o=n(e,c,B,i.reportAllChanges),u&&(u.observe({type:\"first-input\",buffered:!0}),s.onHidden((()=>{f(u.takeRecords()),o(!0)})),t((()=>{d.v(),c=r(\"INP\"),o=n(e,c,B,i.reportAllChanges)})))}))};class N{m;h(e){this.m?.(e)}}const q=[2500,4e3],x=(e,s={})=>{g((()=>{const c=v();let d,u=r(\"LCP\");const l=a(s,N),m=e=>{s.reportAllChanges||(e=e.slice(-1));for(const t of e)l.h(t),t.startTime<c.firstHiddenTime&&(u.value=Math.max(t.startTime-o(),0),u.entries=[t],d())},p=h(\"largest-contentful-paint\",m);if(p){d=n(e,u,q,s.reportAllChanges);const o=f((()=>{m(p.takeRecords()),p.disconnect(),d(!0)})),c=e=>{e.isTrusted&&(A(o),removeEventListener(e.type,c,{capture:!0}))};for(const e of[\"keydown\",\"click\",\"visibilitychange\"])addEventListener(e,c,{capture:!0});t((t=>{u=r(\"LCP\"),d=n(e,u,q,s.reportAllChanges),i((()=>{u.value=performance.now()-t.timeStamp,d(!0)}))}))}}))},H=[800,1800],O=e=>{document.prerendering?g((()=>O(e))):\"complete\"!==document.readyState?addEventListener(\"load\",(()=>O(e)),!0):setTimeout(e)},$=(e,i={})=>{let c=r(\"TTFB\"),a=n(e,c,H,i.reportAllChanges);O((()=>{const d=s();d&&(c.value=Math.max(d.responseStart-o(),0),c.entries=[d],a(!0),t((()=>{c=r(\"TTFB\",0),a=n(e,c,H,i.reportAllChanges),a(!0)})))}))};export{b as CLSThresholds,y as FCPThresholds,B as INPThresholds,q as LCPThresholds,H as TTFBThresholds,L as onCLS,E as onFCP,S as onINP,x as onLCP,$ as onTTFB};\n", "/* eslint-disable no-restricted-globals */\nimport {\n  BrowserClient,\n  BrowserConfig,\n  EnrichmentPlugin,\n  getGlobalScope,\n  getDecodeURI,\n} from '@amplitude/analytics-core';\nimport { PLUGIN_NAME, WEB_VITALS_EVENT_NAME } from './constants';\nimport { onLCP, onINP, onCLS, onFCP, onTTFB, Metric } from 'web-vitals';\n\nexport type BrowserEnrichmentPlugin = EnrichmentPlugin<BrowserClient, BrowserConfig>;\n\ntype WebVitalsMetricPayload = {\n  value: number;\n  rating: Metric['rating'];\n  delta: number;\n  navigationType: Metric['navigationType'];\n  id: string;\n  timestamp: number;\n  navigationStart: number;\n};\n\ntype WebVitalsEventPayload = {\n  '[Amplitude] LCP'?: WebVitalsMetricPayload;\n  '[Amplitude] FCP'?: WebVitalsMetricPayload;\n  '[Amplitude] INP'?: WebVitalsMetricPayload;\n  '[Amplitude] CLS'?: WebVitalsMetricPayload;\n  '[Amplitude] TTFB'?: WebVitalsMetricPayload;\n  '[Amplitude] Page Domain'?: string;\n  '[Amplitude] Page Location'?: string;\n  '[Amplitude] Page Path'?: string;\n  '[Amplitude] Page Title'?: string;\n  '[Amplitude] Page URL'?: string;\n};\n\nfunction getMetricStartTime(metric: Metric) {\n  /* istanbul ignore next */\n  const startTime = metric.entries[0]?.startTime || 0;\n  return performance.timeOrigin + startTime;\n}\n\nfunction processMetric(metric: Metric) {\n  return {\n    value: metric.value,\n    rating: metric.rating,\n    delta: metric.delta,\n    navigationType: metric.navigationType,\n    id: metric.id,\n    timestamp: Math.floor(getMetricStartTime(metric)),\n    navigationStart: Math.floor(performance.timeOrigin),\n  };\n}\n\nexport const webVitalsPlugin = (): BrowserEnrichmentPlugin => {\n  let visibilityListener: ((this: Document, ev: Event) => void) | null = null;\n  const globalScope = getGlobalScope();\n  const doc = globalScope?.document;\n  const location = globalScope?.location;\n  const setup: BrowserEnrichmentPlugin['setup'] = async (config, amplitude) => {\n    if (doc === undefined) {\n      return;\n    }\n    const locationHref = getDecodeURI(/* istanbul ignore next */ location?.href || '', config.loggerProvider);\n    const webVitalsPayload: WebVitalsEventPayload = {\n      '[Amplitude] Page Domain': /* istanbul ignore next */ location?.hostname || '',\n      '[Amplitude] Page Location': locationHref,\n      '[Amplitude] Page Path': getDecodeURI(/* istanbul ignore next */ location?.pathname || '', config.loggerProvider),\n      '[Amplitude] Page Title': /* istanbul ignore next */ (typeof document !== 'undefined' && document.title) || '',\n      '[Amplitude] Page URL': getDecodeURI(locationHref.split('?')[0], config.loggerProvider),\n    };\n\n    onLCP((metric) => {\n      webVitalsPayload['[Amplitude] LCP'] = processMetric(metric);\n    });\n\n    onFCP((metric) => {\n      webVitalsPayload['[Amplitude] FCP'] = processMetric(metric);\n    });\n\n    onINP((metric) => {\n      webVitalsPayload['[Amplitude] INP'] = processMetric(metric);\n    });\n\n    onCLS((metric) => {\n      webVitalsPayload['[Amplitude] CLS'] = processMetric(metric);\n    });\n\n    onTTFB((metric) => {\n      webVitalsPayload['[Amplitude] TTFB'] = processMetric(metric);\n    });\n\n    visibilityListener = () => {\n      if (doc.visibilityState === 'hidden' && visibilityListener) {\n        amplitude.track(WEB_VITALS_EVENT_NAME, webVitalsPayload);\n        doc.removeEventListener('visibilitychange', visibilityListener);\n        visibilityListener = null;\n      }\n    };\n    doc.addEventListener('visibilitychange', visibilityListener);\n  };\n\n  const execute: BrowserEnrichmentPlugin['execute'] = async (event) => {\n    return event;\n  };\n\n  const teardown = async () => {\n    if (visibilityListener) {\n      /* istanbul ignore next */\n      doc?.removeEventListener('visibilitychange', visibilityListener);\n    }\n  };\n\n  return {\n    name: PLUGIN_NAME,\n    type: 'enrichment',\n    setup,\n    execute,\n    teardown,\n  };\n};\n", "import { createIdentifyEvent, Identify, ILogger, Campaign, BASE_CAMPAIGN } from '@amplitude/analytics-core';\n\nexport interface Options {\n  excludeReferrers?: (string | RegExp)[];\n  initialEmptyValue?: string;\n  resetSessionOnNewCampaign?: boolean;\n}\n\nconst domainWithoutSubdomain = (domain: string) => {\n  const parts = domain.split('.');\n\n  if (parts.length <= 2) {\n    return domain;\n  }\n\n  return parts.slice(parts.length - 2, parts.length).join('.');\n};\n\n//Direct traffic mean no external referral, no UTMs, no click-ids, and no other customer identified marketing campaign url params.\nconst isDirectTraffic = (current: Campaign) => {\n  return Object.values(current).every((value) => !value);\n};\n\nexport const isNewCampaign = (\n  current: Campaign,\n  previous: Campaign | undefined,\n  options: Options,\n  logger: ILogger,\n  isNewSession = true,\n) => {\n  const { referrer, referring_domain, ...currentCampaign } = current;\n  const { referrer: _previous_referrer, referring_domain: prevReferringDomain, ...previousCampaign } = previous || {};\n\n  if (isExcludedReferrer(options.excludeReferrers, current.referring_domain)) {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    logger.debug(`This is not a new campaign because ${current.referring_domain} is in the exclude referrer list.`);\n    return false;\n  }\n\n  //In the same session, direct traffic should not override or unset any persisting query params\n  if (!isNewSession && isDirectTraffic(current) && previous) {\n    logger.debug('This is not a new campaign because this is a direct traffic in the same session.');\n    return false;\n  }\n\n  const hasNewCampaign = JSON.stringify(currentCampaign) !== JSON.stringify(previousCampaign);\n  const hasNewDomain =\n    domainWithoutSubdomain(referring_domain || '') !== domainWithoutSubdomain(prevReferringDomain || '');\n\n  const result = !previous || hasNewCampaign || hasNewDomain;\n\n  if (!result) {\n    logger.debug(\"This is not a new campaign because it's the same as the previous one.\");\n  } else {\n    logger.debug(`This is a new campaign. An $identify event will be sent.`);\n  }\n\n  return result;\n};\n\nexport const isExcludedReferrer = (excludeReferrers: (string | RegExp)[] = [], referringDomain = '') => {\n  return excludeReferrers.some((value) =>\n    value instanceof RegExp ? value.test(referringDomain) : value === referringDomain,\n  );\n};\n\nexport const createCampaignEvent = (campaign: Campaign, options: Options) => {\n  const campaignParameters: Campaign = {\n    // This object definition allows undefined keys to be iterated on\n    // in .reduce() to build indentify object\n    ...BASE_CAMPAIGN,\n    ...campaign,\n  };\n  const identifyEvent = Object.entries(campaignParameters).reduce((identify, [key, value]) => {\n    identify.setOnce(`initial_${key}`, value ?? options.initialEmptyValue ?? 'EMPTY');\n    if (value) {\n      return identify.set(key, value);\n    }\n    return identify.unset(key);\n  }, new Identify());\n\n  return createIdentifyEvent(identifyEvent);\n};\n\nexport const getDefaultExcludedReferrers = (cookieDomain: string | undefined) => {\n  let domain = cookieDomain;\n  if (domain) {\n    if (domain.startsWith('.')) {\n      domain = domain.substring(1);\n    }\n    return [new RegExp(`${domain.replace('.', '\\\\.')}$`)];\n  }\n  return [];\n};\n", "import {\n  BrowserConfig,\n  ILogger,\n  Storage,\n  getStorageKey,\n  isNewSession,\n  Campaign,\n  BASE_CAMPAIGN,\n  CampaignParser,\n} from '@amplitude/analytics-core';\nimport { Options, getDefaultExcludedReferrers, createCampaignEvent, isNewCampaign } from './helpers';\n\nexport class WebAttribution {\n  options: Options;\n  storage: Storage<Campaign>;\n  storageKey: string;\n  webExpStorageKey: string;\n  previousCampaign?: Campaign;\n  currentCampaign: Campaign;\n  shouldTrackNewCampaign = false;\n  sessionTimeout: number;\n  lastEventTime?: number;\n  logger: ILogger;\n\n  constructor(options: Options, config: BrowserConfig) {\n    this.options = {\n      initialEmptyValue: 'EMPTY',\n      resetSessionOnNewCampaign: false,\n      excludeReferrers: getDefaultExcludedReferrers(config.cookieOptions?.domain),\n      ...options,\n    };\n    this.storage = config.cookieStorage as unknown as Storage<Campaign>;\n    this.storageKey = getStorageKey(config.apiKey, 'MKTG');\n    this.webExpStorageKey = getStorageKey(config.apiKey, 'MKTG_ORIGINAL');\n    this.currentCampaign = BASE_CAMPAIGN;\n    this.sessionTimeout = config.sessionTimeout;\n    this.lastEventTime = config.lastEventTime;\n    this.logger = config.loggerProvider;\n    config.loggerProvider.log('Installing web attribution tracking.');\n  }\n\n  async init() {\n    [this.currentCampaign, this.previousCampaign] = await this.fetchCampaign();\n    const isEventInNewSession = !this.lastEventTime ? true : isNewSession(this.sessionTimeout, this.lastEventTime);\n\n    if (isNewCampaign(this.currentCampaign, this.previousCampaign, this.options, this.logger, isEventInNewSession)) {\n      this.shouldTrackNewCampaign = true;\n      await this.storage.set(this.storageKey, this.currentCampaign);\n    }\n  }\n\n  async fetchCampaign() {\n    const originalCampaign = await this.storage.get(this.webExpStorageKey);\n    if (originalCampaign) {\n      await this.storage.remove(this.webExpStorageKey);\n    }\n    return await Promise.all([originalCampaign || new CampaignParser().parse(), this.storage.get(this.storageKey)]);\n  }\n\n  /**\n   * This can be called when enable web attribution and either\n   * 1. set a new session\n   * 2. has new campaign and enable resetSessionOnNewCampaign\n   */\n  generateCampaignEvent(event_id?: number) {\n    // Mark this campaign has been tracked\n    this.shouldTrackNewCampaign = false;\n    const campaignEvent = createCampaignEvent(this.currentCampaign, this.options);\n    if (event_id) {\n      campaignEvent.event_id = event_id;\n    }\n    return campaignEvent;\n  }\n\n  shouldSetSessionIdOnNewCampaign() {\n    return this.shouldTrackNewCampaign && !!this.options.resetSessionOnNewCampaign;\n  }\n}\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "import {\n  type BrowserClient,\n  type BrowserConfig,\n  BrowserStorage,\n  type EnrichmentPlugin,\n  type Event,\n  getDecodeURI,\n  getGlobalScope,\n  getPageTitle,\n  type ILogger,\n  PageUrlEnrichmentOptions,\n  replaceSensitiveString,\n  SpecialEventType,\n} from '@amplitude/analytics-core';\n\nexport const CURRENT_PAGE_STORAGE_KEY = 'AMP_CURRENT_PAGE';\nexport const PREVIOUS_PAGE_STORAGE_KEY = 'AMP_PREVIOUS_PAGE';\nexport const URL_INFO_STORAGE_KEY = 'AMP_URL_INFO';\n\nexport type URLInfo = {\n  [CURRENT_PAGE_STORAGE_KEY]?: string;\n  [PREVIOUS_PAGE_STORAGE_KEY]?: string;\n};\n\nenum PreviousPageType {\n  Direct = 'direct', // for no prev page or referrer\n  Internal = 'internal', // for internal domains - exact domain matches or when current and previous page are both internal domains\n  External = 'external', // for different domains\n}\n\nexport const EXCLUDED_DEFAULT_EVENT_TYPES = new Set<string>([\n  SpecialEventType.IDENTIFY,\n  SpecialEventType.GROUP_IDENTIFY,\n  SpecialEventType.REVENUE,\n]);\n\nexport const isPageUrlEnrichmentEnabled = (option: unknown): boolean => {\n  if (typeof option === 'boolean') {\n    return option;\n  }\n  if (typeof option === 'object' && option !== null && 'pageUrlEnrichment' in option) {\n    return Boolean((option as { pageUrlEnrichment?: boolean }).pageUrlEnrichment);\n  }\n  return false;\n};\n\nexport const pageUrlEnrichmentPlugin = ({ internalDomains = [] }: PageUrlEnrichmentOptions = {}): EnrichmentPlugin => {\n  const globalScope = getGlobalScope();\n  let sessionStorage: BrowserStorage<URLInfo> | undefined = undefined;\n  let isStorageEnabled = false;\n  let loggerProvider: ILogger | undefined = undefined;\n\n  let isProxied = false;\n  let isTracking = false;\n\n  const getHostname = (url: string): string | undefined => {\n    let hostname: string | undefined;\n\n    try {\n      const decodedUrl = getDecodeURI(url, loggerProvider);\n      hostname = new URL(decodedUrl).hostname;\n    } catch (e) {\n      /* istanbul ignore next */\n      loggerProvider?.error('Could not parse URL: ', e);\n    }\n\n    return hostname;\n  };\n\n  const getPrevPageType = (previousPage: string) => {\n    const currentDomain = (typeof location !== 'undefined' && location.hostname) || '';\n    const previousPageDomain = previousPage ? getHostname(previousPage) : undefined;\n\n    if (!previousPageDomain) {\n      return PreviousPageType.Direct;\n    }\n\n    const isCurrentInternal = internalDomains.some((domain) => currentDomain.indexOf(domain) !== -1);\n    const isPrevInternal = internalDomains.some((domain) => previousPageDomain.indexOf(domain) !== -1);\n\n    if (currentDomain === previousPageDomain || (isPrevInternal && isCurrentInternal)) {\n      return PreviousPageType.Internal;\n    }\n\n    return PreviousPageType.External;\n  };\n\n  const saveURLInfo = async () => {\n    if (sessionStorage && isStorageEnabled) {\n      const URLInfo = await sessionStorage.get(URL_INFO_STORAGE_KEY);\n      const currentURL = getDecodeURI((typeof location !== 'undefined' && location.href) || '');\n      const storedCurrentURL = URLInfo?.[CURRENT_PAGE_STORAGE_KEY] || '';\n\n      let previousURL: string | undefined;\n      if (currentURL === storedCurrentURL) {\n        previousURL = URLInfo?.[PREVIOUS_PAGE_STORAGE_KEY] || '';\n      } else if (storedCurrentURL) {\n        previousURL = storedCurrentURL;\n      } else {\n        previousURL = document.referrer || '';\n      }\n\n      await sessionStorage.set(URL_INFO_STORAGE_KEY, {\n        [CURRENT_PAGE_STORAGE_KEY]: currentURL,\n        [PREVIOUS_PAGE_STORAGE_KEY]: previousURL,\n      });\n    }\n  };\n\n  const saveUrlInfoWrapper = () => {\n    void saveURLInfo();\n  };\n\n  const plugin: EnrichmentPlugin = {\n    name: '@amplitude/plugin-page-url-enrichment-browser',\n    type: 'enrichment',\n\n    setup: async (config: BrowserConfig, _: BrowserClient) => {\n      loggerProvider = config.loggerProvider;\n      loggerProvider.log('Installing @amplitude/plugin-page-url-enrichment-browser');\n\n      isTracking = true;\n\n      if (globalScope) {\n        sessionStorage = new BrowserStorage<URLInfo>(globalScope.sessionStorage);\n        isStorageEnabled = await sessionStorage.isEnabled();\n\n        globalScope.addEventListener('popstate', saveUrlInfoWrapper);\n\n        if (!isProxied) {\n          /* istanbul ignore next */\n          // There is no global browser listener for changes to history, so we have\n          // to modify pushState and replaceState directly.\n          // https://stackoverflow.com/a/64927639\n          // eslint-disable-next-line @typescript-eslint/unbound-method\n          globalScope.history.pushState = new Proxy(globalScope.history.pushState, {\n            apply: (target, thisArg, [state, unused, url]) => {\n              target.apply(thisArg, [state, unused, url]);\n              if (isTracking) {\n                saveUrlInfoWrapper();\n              }\n            },\n          });\n\n          // eslint-disable-next-line @typescript-eslint/unbound-method\n          globalScope.history.replaceState = new Proxy(globalScope.history.replaceState, {\n            apply: (target, thisArg, [state, unused, url]) => {\n              target.apply(thisArg, [state, unused, url]);\n              if (isTracking) {\n                saveUrlInfoWrapper();\n              }\n            },\n          });\n\n          isProxied = true;\n        }\n      }\n    },\n    execute: async (event: Event) => {\n      const locationHREF = getDecodeURI((typeof location !== 'undefined' && location.href) || '');\n\n      if (sessionStorage && isStorageEnabled) {\n        const URLInfo = await sessionStorage.get(URL_INFO_STORAGE_KEY);\n        if (!URLInfo?.[CURRENT_PAGE_STORAGE_KEY]) {\n          await sessionStorage.set(URL_INFO_STORAGE_KEY, {\n            [CURRENT_PAGE_STORAGE_KEY]: locationHREF,\n            [PREVIOUS_PAGE_STORAGE_KEY]: document.referrer || '',\n          });\n        }\n\n        const updatedURLInfo = await sessionStorage.get(URL_INFO_STORAGE_KEY);\n        let previousPage = '';\n        if (updatedURLInfo) {\n          previousPage = updatedURLInfo[PREVIOUS_PAGE_STORAGE_KEY] || '';\n        }\n\n        // no need to proceed to add additional properties if the event is one of the default event types to be excluded\n        if (EXCLUDED_DEFAULT_EVENT_TYPES.has(event.event_type)) {\n          return event;\n        }\n\n        event.event_properties = {\n          ...(event.event_properties || {}),\n          '[Amplitude] Page Domain': addIfNotExist(\n            event,\n            '[Amplitude] Page Domain',\n            (typeof location !== 'undefined' && location.hostname) || '',\n          ),\n          '[Amplitude] Page Location': addIfNotExist(event, '[Amplitude] Page Location', locationHREF),\n          '[Amplitude] Page Path': addIfNotExist(\n            event,\n            '[Amplitude] Page Path',\n            (typeof location !== 'undefined' && getDecodeURI(location.pathname)) || '',\n          ),\n          '[Amplitude] Page Title': addIfNotExist(\n            event,\n            '[Amplitude] Page Title',\n            getPageTitle(replaceSensitiveString),\n          ),\n          '[Amplitude] Page URL': addIfNotExist(event, '[Amplitude] Page URL', locationHREF.split('?')[0]),\n          '[Amplitude] Previous Page Location': previousPage,\n          '[Amplitude] Previous Page Type': getPrevPageType(previousPage),\n        };\n      }\n\n      return event;\n    },\n    teardown: async () => {\n      if (globalScope) {\n        globalScope.removeEventListener('popstate', saveUrlInfoWrapper);\n\n        isTracking = false;\n      }\n\n      if (sessionStorage && isStorageEnabled) {\n        await sessionStorage.set(URL_INFO_STORAGE_KEY, {});\n      }\n    },\n  };\n\n  return plugin;\n};\n\nfunction addIfNotExist(event: Event, key: string, value: string): string {\n  if (!event.event_properties) {\n    event.event_properties = {};\n  }\n\n  if ((event.event_properties as { [key: string]: any })[key] === undefined) {\n    return value;\n  }\n\n  return (event.event_properties as { [key: string]: any })[key] as string;\n}\n", "import {\n  AmplitudeCore,\n  Destination,\n  Identify,\n  returnWrapper,\n  Revenue,\n  UUID,\n  getAnalyticsConnector,\n  setConnectorDeviceId,\n  setConnectorUserId,\n  isNewSession,\n  IdentityEventSender,\n  getQueryParams,\n  Event,\n  EventOptions,\n  IIdentify,\n  IRevenue,\n  TransportTypeOrOptions,\n  OfflineDisabled,\n  Result,\n  BrowserOptions,\n  BrowserConfig,\n  BrowserClient,\n  SpecialEventType,\n  AnalyticsClient,\n  IRemoteConfigClient,\n  RemoteConfigClient,\n  RemoteConfig,\n  Source,\n  DiagnosticsClient,\n  createIdentifyEvent,\n  Logger,\n} from '@amplitude/analytics-core';\nimport {\n  getAttributionTrackingConfig,\n  getPageViewTrackingConfig,\n  getElementInteractionsConfig,\n  getNetworkTrackingConfig,\n  isAttributionTrackingEnabled,\n  isSessionTrackingEnabled,\n  isFileDownloadTrackingEnabled,\n  isFormInteractionTrackingEnabled,\n  isElementInteractionsEnabled,\n  isPageViewTrackingEnabled,\n  isNetworkTrackingEnabled,\n  isWebVitalsEnabled,\n  isFrustrationInteractionsEnabled,\n  getFrustrationInteractionsConfig,\n  isPageUrlEnrichmentEnabled,\n} from './default-tracking';\nimport { convertProxyObjectToRealObject, isInstanceProxy } from './utils/snippet-helper';\nimport { Context } from './plugins/context';\nimport { useBrowserConfig, createTransport, shouldFetchRemoteConfig } from './config';\nimport { pageViewTrackingPlugin } from '@amplitude/plugin-page-view-tracking-browser';\nimport { formInteractionTracking } from './plugins/form-interaction-tracking';\nimport { fileDownloadTracking } from './plugins/file-download-tracking';\nimport { DEFAULT_SESSION_END_EVENT, DEFAULT_SESSION_START_EVENT, DEFAULT_SERVER_ZONE } from './constants';\nimport { detNotify } from './det-notification';\nimport { networkConnectivityCheckerPlugin } from './plugins/network-connectivity-checker';\nimport { updateBrowserConfigWithRemoteConfig } from './config/joined-config';\nimport { autocapturePlugin, frustrationPlugin } from '@amplitude/plugin-autocapture-browser';\nimport { plugin as networkCapturePlugin } from '@amplitude/plugin-network-capture-browser';\nimport { webVitalsPlugin } from '@amplitude/plugin-web-vitals-browser';\nimport { WebAttribution } from './attribution/web-attribution';\nimport { LIBPREFIX } from './lib-prefix';\nimport { VERSION } from './version';\nimport { pageUrlEnrichmentPlugin } from '@amplitude/plugin-page-url-enrichment-browser';\n\n/**\n * Exported for `@amplitude/unified` or integration with blade plugins.\n * If you only use `@amplitude/analytics-browser`, use `amplitude.init()` or `amplitude.createInstance()` instead.\n */\nexport class AmplitudeBrowser extends AmplitudeCore implements BrowserClient, AnalyticsClient {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  config: BrowserConfig;\n  previousSessionDeviceId: string | undefined;\n  previousSessionUserId: string | undefined;\n  webAttribution: WebAttribution | undefined;\n  userProperties: { [key: string]: any } | undefined;\n\n  // Backdoor to set diagnostics sample rate\n  // by calling amplitude._setDiagnosticsSampleRate(1); before amplitude.init()\n  _diagnosticsSampleRate = 0;\n\n  init(apiKey = '', userIdOrOptions?: string | BrowserOptions, maybeOptions?: BrowserOptions) {\n    let userId: string | undefined;\n    let options: BrowserOptions | undefined;\n    if (arguments.length > 2) {\n      userId = userIdOrOptions as string | undefined;\n      options = maybeOptions;\n    } else {\n      if (typeof userIdOrOptions === 'string') {\n        userId = userIdOrOptions;\n        options = undefined;\n      } else {\n        userId = userIdOrOptions?.userId;\n        options = userIdOrOptions;\n      }\n    }\n    return returnWrapper(this._init({ ...options, userId, apiKey }));\n  }\n  protected async _init(options: BrowserOptions & { apiKey: string }) {\n    // Step 1: Block concurrent initialization\n    if (this.initializing) {\n      return;\n    }\n    this.initializing = true;\n\n    // Step 2: Create browser config\n    // Step 2.1: Determine if we should fetch remote config BEFORE creating browser config\n    // This allows us to get diagnostics settings before creating the DiagnosticsClient\n    const fetchRemoteConfig = shouldFetchRemoteConfig(options);\n\n    // Set up early dependencies needed for remote config client\n    // These use options directly or fall back to defaults\n    const loggerProvider = options.loggerProvider ?? new Logger();\n    const serverZone = options.serverZone ?? DEFAULT_SERVER_ZONE;\n\n    let remoteConfigClient: IRemoteConfigClient | undefined;\n    let diagnosticsSampleRate = this._diagnosticsSampleRate;\n    let enableDiagnostics = options.enableDiagnostics ?? true;\n\n    // Step 2.2: Fetch diagnostics config FIRST to get sample rate for DiagnosticsClient\n    // We want to create DiagnosticsClient as early as possible so it can track more data\n    /* istanbul ignore next */\n    if (fetchRemoteConfig) {\n      remoteConfigClient = new RemoteConfigClient(\n        options.apiKey,\n        loggerProvider,\n        serverZone,\n        /* istanbul ignore next */ options.remoteConfig?.serverUrl,\n      );\n\n      // Fetch diagnostics config first to get sample rate\n      await new Promise<void>((resolve) => {\n        // Disable coverage for this line because remote config client will always be defined in this case.\n        // istanbul ignore next\n        remoteConfigClient?.subscribe(\n          'configs.diagnostics.browserSDK',\n          'all',\n          (remoteConfig: RemoteConfig | null, source: Source, lastFetch: Date) => {\n            loggerProvider.debug(\n              'Diagnostics remote configuration received:',\n              JSON.stringify(\n                {\n                  remoteConfig,\n                  source,\n                  lastFetch,\n                },\n                null,\n                2,\n              ),\n            );\n            if (remoteConfig) {\n              // Validate and set sampleRate (must be a valid number)\n              const sampleRate = remoteConfig.sampleRate as number;\n              if (typeof sampleRate === 'number' && !isNaN(sampleRate)) {\n                diagnosticsSampleRate = sampleRate;\n              }\n\n              // Validate and set enabled (must be a boolean)\n              const enabled = remoteConfig.enabled as boolean;\n              if (typeof enabled === 'boolean') {\n                enableDiagnostics = enabled;\n              }\n            }\n            resolve();\n          },\n        );\n      });\n    }\n\n    // Step 2.3: Initialize diagnostics client as early as possible\n    // Now we have the sample rate from remote config (if fetched)\n    const diagnosticsClient = new DiagnosticsClient(options.apiKey, loggerProvider, serverZone, {\n      enabled: enableDiagnostics,\n      sampleRate: diagnosticsSampleRate,\n    });\n    diagnosticsClient.setTag('library', `${LIBPREFIX}/${VERSION}`);\n    if (typeof navigator !== 'undefined') {\n      diagnosticsClient.setTag('user_agent', navigator.userAgent);\n    }\n\n    // Step 2.4: Create browser config with diagnosticsClient and earlyConfig\n    // earlyConfig ensures consistent logger/serverZone/diagnostics settings across all components\n    const browserOptions = await useBrowserConfig(options.apiKey, options, this, diagnosticsClient, {\n      loggerProvider,\n      serverZone,\n      enableDiagnostics,\n      diagnosticsSampleRate,\n    });\n\n    // Step 2.5: Fetch analytics SDK remote config\n    // This is fetched after DiagnosticsClient is created so diagnostics can track any issues\n    /* istanbul ignore next */\n    if (fetchRemoteConfig && remoteConfigClient) {\n      await new Promise<void>((resolve) => {\n        // Disable coverage for this line because remote config client will always be defined in this case.\n        // istanbul ignore next\n        remoteConfigClient?.subscribe(\n          'configs.analyticsSDK.browserSDK',\n          'all',\n          (remoteConfig: RemoteConfig | null, source: Source, lastFetch: Date) => {\n            browserOptions.loggerProvider.debug(\n              'Remote configuration received:',\n              JSON.stringify(\n                {\n                  remoteConfig,\n                  source,\n                  lastFetch,\n                },\n                null,\n                2,\n              ),\n            );\n            if (remoteConfig) {\n              updateBrowserConfigWithRemoteConfig(remoteConfig, browserOptions);\n            }\n            // Resolve the promise on first callback (initial config)\n            resolve();\n          },\n        );\n      });\n    }\n\n    await super._init(browserOptions);\n    this.logBrowserOptions(browserOptions);\n\n    this.config.remoteConfigClient = remoteConfigClient;\n\n    // Add web attribution plugin\n    if (isAttributionTrackingEnabled(this.config.defaultTracking)) {\n      const attributionTrackingOptions = getAttributionTrackingConfig(this.config);\n      this.webAttribution = new WebAttribution(attributionTrackingOptions, this.config);\n      // Fetch the current campaign, check if need to track web attribution later\n      await this.webAttribution.init();\n    }\n\n    // Step 3: Set session ID\n    // Priority 1: `options.sessionId`\n    // Priority 2: sessionId from url if it's Number and ampTimestamp is valid\n    // Priority 3: last known sessionId from user identity storage\n    // Default: `Date.now()`\n    // Session ID is handled differently than device ID and user ID due to session events\n    const queryParams = getQueryParams();\n\n    // Check if ampTimestamp is present and valid\n    const ampTimestamp = queryParams.ampTimestamp ? Number(queryParams.ampTimestamp) : undefined;\n    const isWithinTimeLimit = ampTimestamp ? Date.now() < ampTimestamp : true;\n\n    // check if we need to set the sessionId\n    const querySessionId =\n      isWithinTimeLimit && !Number.isNaN(Number(queryParams.ampSessionId))\n        ? Number(queryParams.ampSessionId)\n        : undefined;\n    this.setSessionId(options.sessionId ?? querySessionId ?? this.config.sessionId ?? Date.now());\n\n    // Set up the analytics connector to integrate with the experiment SDK.\n    // Send events from the experiment SDK and forward identifies to the\n    // identity store.\n    const connector = getAnalyticsConnector(options.instanceName);\n    connector.identityStore.setIdentity({\n      userId: this.config.userId,\n      deviceId: this.config.deviceId,\n    });\n\n    // Step 4: Install plugins\n    // Do not track any events before this\n    if (this.config.offline !== OfflineDisabled) {\n      await this.add(networkConnectivityCheckerPlugin()).promise;\n    }\n    await this.add(new Destination({ diagnosticsClient })).promise;\n    await this.add(new Context()).promise;\n    await this.add(new IdentityEventSender()).promise;\n\n    // Notify if DET is enabled\n    detNotify(this.config);\n\n    if (isFileDownloadTrackingEnabled(this.config.defaultTracking)) {\n      this.config.loggerProvider.debug('Adding file download tracking plugin');\n      await this.add(fileDownloadTracking()).promise;\n    }\n\n    if (isFormInteractionTrackingEnabled(this.config.defaultTracking)) {\n      this.config.loggerProvider.debug('Adding form interaction plugin');\n      await this.add(formInteractionTracking()).promise;\n    }\n\n    // Add page view plugin\n    if (isPageViewTrackingEnabled(this.config.defaultTracking)) {\n      this.config.loggerProvider.debug('Adding page view tracking plugin');\n      await this.add(pageViewTrackingPlugin(getPageViewTrackingConfig(this.config))).promise;\n    }\n\n    if (isElementInteractionsEnabled(this.config.autocapture)) {\n      this.config.loggerProvider.debug('Adding user interactions plugin (autocapture plugin)');\n      await this.add(autocapturePlugin(getElementInteractionsConfig(this.config), { diagnosticsClient })).promise;\n    }\n\n    if (isFrustrationInteractionsEnabled(this.config.autocapture)) {\n      this.config.loggerProvider.debug('Adding frustration interactions plugin');\n      await this.add(frustrationPlugin(getFrustrationInteractionsConfig(this.config))).promise;\n    }\n\n    if (isNetworkTrackingEnabled(this.config.autocapture)) {\n      this.config.loggerProvider.debug('Adding network tracking plugin');\n      await this.add(networkCapturePlugin(getNetworkTrackingConfig(this.config))).promise;\n    }\n\n    if (isWebVitalsEnabled(this.config.autocapture)) {\n      this.config.loggerProvider.debug('Adding web vitals plugin');\n      await this.add(webVitalsPlugin()).promise;\n    }\n\n    if (isPageUrlEnrichmentEnabled(this.config.autocapture)) {\n      this.config.loggerProvider.debug('Adding referrer page url plugin');\n      await this.add(pageUrlEnrichmentPlugin()).promise;\n    }\n\n    this.initializing = false;\n\n    // Step 6: Run queued dispatch functions\n    await this.runQueuedFunctions('dispatchQ');\n\n    // Step 7: Add the event receiver after running remaining queued functions.\n    connector.eventBridge.setEventReceiver((event) => {\n      const { time, ...cleanEventProperties } = event.eventProperties || {};\n      const eventOptions = typeof time === 'number' ? { time } : undefined;\n      void this.track(event.eventType, cleanEventProperties, eventOptions);\n    });\n  }\n\n  getUserId() {\n    return this.config?.userId;\n  }\n\n  setUserId(userId: string | undefined) {\n    if (!this.config) {\n      this.q.push(this.setUserId.bind(this, userId));\n      return;\n    }\n    this.config.loggerProvider.debug('function setUserId: ', userId);\n    if (userId !== this.config.userId || userId === undefined) {\n      this.config.userId = userId;\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      this.timeline.onIdentityChanged({ userId: userId });\n      setConnectorUserId(userId, this.config.instanceName);\n    }\n  }\n\n  getDeviceId() {\n    return this.config?.deviceId;\n  }\n\n  setDeviceId(deviceId: string) {\n    if (!this.config) {\n      this.q.push(this.setDeviceId.bind(this, deviceId));\n      return;\n    }\n    this.config.loggerProvider.debug('function setDeviceId: ', deviceId);\n    if (deviceId !== this.config.deviceId) {\n      this.config.deviceId = deviceId;\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      this.timeline.onIdentityChanged({ deviceId: deviceId });\n      setConnectorDeviceId(deviceId, this.config.instanceName);\n    }\n  }\n\n  reset() {\n    this.setDeviceId(UUID());\n    this.setUserId(undefined);\n    this.timeline.onReset();\n  }\n\n  getIdentity() {\n    return {\n      deviceId: this.config?.deviceId,\n      userId: this.config?.userId,\n      userProperties: this.userProperties,\n    };\n  }\n\n  getOptOut(): boolean | undefined {\n    return this.config?.optOut;\n  }\n\n  getSessionId() {\n    return this.config?.sessionId;\n  }\n\n  setSessionId(sessionId: number) {\n    const promises: Promise<Result>[] = [];\n    if (!this.config) {\n      this.q.push(this.setSessionId.bind(this, sessionId));\n      return returnWrapper(Promise.resolve());\n    }\n    // Prevents starting a new session with the same session ID\n    if (sessionId === this.config.sessionId) {\n      return returnWrapper(Promise.resolve());\n    }\n\n    this.config.loggerProvider.debug('function setSessionId: ', sessionId);\n\n    const previousSessionId = this.getSessionId();\n    if (previousSessionId !== sessionId) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      this.timeline.onSessionIdChanged(sessionId);\n    }\n\n    const lastEventTime = this.config.lastEventTime;\n    let lastEventId = this.config.lastEventId ?? -1;\n\n    this.config.sessionId = sessionId;\n    this.config.lastEventTime = undefined;\n    this.config.pageCounter = 0;\n\n    if (isSessionTrackingEnabled(this.config.defaultTracking)) {\n      if (previousSessionId && lastEventTime) {\n        promises.push(\n          this.track(DEFAULT_SESSION_END_EVENT, undefined, {\n            device_id: this.previousSessionDeviceId,\n            event_id: ++lastEventId,\n            session_id: previousSessionId,\n            time: lastEventTime + 1,\n            user_id: this.previousSessionUserId,\n          }).promise,\n        );\n      }\n      this.config.lastEventTime = this.config.sessionId;\n    }\n\n    // Fire web attribution event when enable webAttribution tracking\n    // 1. has new campaign (call setSessionId from init function)\n    // 2. or shouldTrackNewCampaign (call setSessionId from async process(event) when there has new campaign and resetSessionOnNewCampaign = true )\n    const isCampaignEventTracked = this.trackCampaignEventIfNeeded(++lastEventId, promises);\n\n    // track the identify event if an Identify object is provided in the config\n    if (this.config.identify) {\n      promises.push(this.track(createIdentifyEvent(this.config.identify)).promise);\n    }\n\n    if (isSessionTrackingEnabled(this.config.defaultTracking)) {\n      promises.push(\n        this.track(DEFAULT_SESSION_START_EVENT, undefined, {\n          event_id: isCampaignEventTracked ? ++lastEventId : lastEventId,\n          session_id: this.config.sessionId,\n          time: this.config.lastEventTime,\n        }).promise,\n      );\n    }\n\n    this.previousSessionDeviceId = this.config.deviceId;\n    this.previousSessionUserId = this.config.userId;\n    return returnWrapper(Promise.all(promises));\n  }\n\n  extendSession() {\n    if (!this.config) {\n      this.q.push(this.extendSession.bind(this));\n      return;\n    }\n    this.config.lastEventTime = Date.now();\n  }\n\n  setTransport(transport: TransportTypeOrOptions) {\n    if (!this.config) {\n      this.q.push(this.setTransport.bind(this, transport));\n      return;\n    }\n    this.config.transportProvider = createTransport(transport);\n  }\n\n  identify(identify: IIdentify, eventOptions?: EventOptions) {\n    if (isInstanceProxy(identify)) {\n      const queue = identify._q;\n      identify._q = [];\n      identify = convertProxyObjectToRealObject(new Identify(), queue);\n    }\n    if (eventOptions?.user_id) {\n      this.setUserId(eventOptions.user_id);\n    }\n    if (eventOptions?.device_id) {\n      this.setDeviceId(eventOptions.device_id);\n    }\n    return super.identify(identify, eventOptions);\n  }\n\n  groupIdentify(groupType: string, groupName: string | string[], identify: IIdentify, eventOptions?: EventOptions) {\n    if (isInstanceProxy(identify)) {\n      const queue = identify._q;\n      identify._q = [];\n      identify = convertProxyObjectToRealObject(new Identify(), queue);\n    }\n    return super.groupIdentify(groupType, groupName, identify, eventOptions);\n  }\n\n  revenue(revenue: IRevenue, eventOptions?: EventOptions) {\n    if (isInstanceProxy(revenue)) {\n      const queue = revenue._q;\n      revenue._q = [];\n      revenue = convertProxyObjectToRealObject(new Revenue(), queue);\n    }\n    return super.revenue(revenue, eventOptions);\n  }\n\n  private trackCampaignEventIfNeeded(lastEventId?: number, promises?: Promise<Result>[]) {\n    if (!this.webAttribution || !this.webAttribution.shouldTrackNewCampaign) {\n      return false;\n    }\n\n    const campaignEvent = this.webAttribution.generateCampaignEvent(lastEventId);\n    if (promises) {\n      promises.push(this.track(campaignEvent).promise);\n    } else {\n      this.track(campaignEvent);\n    }\n    this.config.loggerProvider.log('Tracking attribution.');\n    return true;\n  }\n\n  async process(event: Event) {\n    const currentTime = Date.now();\n    const isEventInNewSession = isNewSession(this.config.sessionTimeout, this.config.lastEventTime);\n    const shouldSetSessionIdOnNewCampaign =\n      this.webAttribution && this.webAttribution.shouldSetSessionIdOnNewCampaign();\n\n    if (\n      event.event_type !== DEFAULT_SESSION_START_EVENT &&\n      event.event_type !== DEFAULT_SESSION_END_EVENT &&\n      (!event.session_id || event.session_id === this.getSessionId())\n    ) {\n      if (isEventInNewSession || shouldSetSessionIdOnNewCampaign) {\n        this.setSessionId(currentTime);\n        if (shouldSetSessionIdOnNewCampaign) {\n          this.config.loggerProvider.log('Created a new session for new campaign.');\n        }\n      } else if (!isEventInNewSession) {\n        // Web attribution should be tracked during the middle of a session\n        // if there has been a chance in the campaign information.\n        this.trackCampaignEventIfNeeded();\n      }\n    }\n\n    // Set user properties\n    if (event.event_type === SpecialEventType.IDENTIFY && event.user_properties) {\n      this.userProperties = this.getOperationAppliedUserProperties(event.user_properties);\n    }\n\n    return super.process(event);\n  }\n\n  private logBrowserOptions(browserConfig: BrowserOptions & { apiKey: string }) {\n    try {\n      const browserConfigCopy = {\n        ...browserConfig,\n        apiKey: browserConfig.apiKey.substring(0, 10) + '********',\n      };\n      this.config.loggerProvider.debug('Initialized Amplitude with BrowserConfig:', JSON.stringify(browserConfigCopy));\n    } catch (e) {\n      /* istanbul ignore next */\n      this.config.loggerProvider.error('Error logging browser config', e);\n    }\n  }\n\n  /**\n   * @experimental\n   * WARNING: This method is for internal testing only and is not part of the public API.\n   * It may be changed or removed at any time without notice.\n   *\n   * Sets the diagnostics sample rate before amplitude.init()\n   * @param sampleRate - The sample rate to set\n   */\n  _setDiagnosticsSampleRate(sampleRate: number): void {\n    if (sampleRate > 1 || sampleRate < 0) {\n      return;\n    }\n    // Set diagnostics sample rate before initializing the config\n    if (!this.config) {\n      this._diagnosticsSampleRate = sampleRate;\n      return;\n    }\n  }\n}\n", "import { debugWrapper, getClientLogConfig, getClientStates, BrowserClient } from '@amplitude/analytics-core';\nimport { AmplitudeBrowser } from './browser-client';\n\nexport const createInstance = (): BrowserClient => {\n  const client = new AmplitudeBrowser();\n  return {\n    init: debugWrapper(\n      client.init.bind(client),\n      'init',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    add: debugWrapper(\n      client.add.bind(client),\n      'add',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.plugins']),\n    ),\n    remove: debugWrapper(\n      client.remove.bind(client),\n      'remove',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.plugins']),\n    ),\n    track: debugWrapper(\n      client.track.bind(client),\n      'track',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.queue.length']),\n    ),\n    logEvent: debugWrapper(\n      client.logEvent.bind(client),\n      'logEvent',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.queue.length']),\n    ),\n    identify: debugWrapper(\n      client.identify.bind(client),\n      'identify',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.queue.length']),\n    ),\n    groupIdentify: debugWrapper(\n      client.groupIdentify.bind(client),\n      'groupIdentify',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.queue.length']),\n    ),\n    setGroup: debugWrapper(\n      client.setGroup.bind(client),\n      'setGroup',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.queue.length']),\n    ),\n    revenue: debugWrapper(\n      client.revenue.bind(client),\n      'revenue',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.queue.length']),\n    ),\n    flush: debugWrapper(\n      client.flush.bind(client),\n      'flush',\n      getClientLogConfig(client),\n      getClientStates(client, ['config.apiKey', 'timeline.queue.length']),\n    ),\n    getUserId: debugWrapper(\n      client.getUserId.bind(client),\n      'getUserId',\n      getClientLogConfig(client),\n      getClientStates(client, ['config', 'config.userId']),\n    ),\n    setUserId: debugWrapper(\n      client.setUserId.bind(client),\n      'setUserId',\n      getClientLogConfig(client),\n      getClientStates(client, ['config', 'config.userId']),\n    ),\n    getDeviceId: debugWrapper(\n      client.getDeviceId.bind(client),\n      'getDeviceId',\n      getClientLogConfig(client),\n      getClientStates(client, ['config', 'config.deviceId']),\n    ),\n    setDeviceId: debugWrapper(\n      client.setDeviceId.bind(client),\n      'setDeviceId',\n      getClientLogConfig(client),\n      getClientStates(client, ['config', 'config.deviceId']),\n    ),\n    reset: debugWrapper(\n      client.reset.bind(client),\n      'reset',\n      getClientLogConfig(client),\n      getClientStates(client, ['config', 'config.userId', 'config.deviceId']),\n    ),\n    getSessionId: debugWrapper(\n      client.getSessionId.bind(client),\n      'getSessionId',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    setSessionId: debugWrapper(\n      client.setSessionId.bind(client),\n      'setSessionId',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    extendSession: debugWrapper(\n      client.extendSession.bind(client),\n      'extendSession',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    setOptOut: debugWrapper(\n      client.setOptOut.bind(client),\n      'setOptOut',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    setTransport: debugWrapper(\n      client.setTransport.bind(client),\n      'setTransport',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    getIdentity: debugWrapper(\n      client.getIdentity.bind(client),\n      'getIdentity',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    getOptOut: debugWrapper(\n      client.getOptOut.bind(client),\n      'getOptOut',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n    _setDiagnosticsSampleRate: debugWrapper(\n      client._setDiagnosticsSampleRate.bind(client),\n      '_setDiagnosticsSampleRate',\n      getClientLogConfig(client),\n      getClientStates(client, ['config']),\n    ),\n  };\n};\n\nexport default createInstance();\n", "/* eslint-disable @typescript-eslint/unbound-method */\nexport {\n  AmplitudeReturn,\n  BaseEvent,\n  EventOptions,\n  BrowserClient,\n  AttributionOptions,\n  AutocaptureOptions,\n  BrowserOptions,\n  BrowserConfig,\n  IConfig,\n  Event,\n  IdentifyEvent,\n  GroupIdentifyEvent,\n  IdentifyOperation,\n  SpecialEventType,\n  IIdentify,\n  IRevenue,\n  RevenueProperty,\n  ILogger,\n  LogLevel,\n  Plugin,\n  BeforePlugin,\n  EnrichmentPlugin,\n  DestinationPlugin,\n  Result,\n  ServerZoneType,\n  ServerZone,\n  IdentityStorageType,\n  Storage,\n  TransportType,\n  OfflineDisabled,\n  Messenger,\n  ElementInteractionsOptions,\n  ActionType,\n  DEFAULT_CSS_SELECTOR_ALLOWLIST,\n  DEFAULT_DATA_ATTRIBUTE_PREFIX,\n  DEFAULT_ACTION_CLICK_ALLOWLIST,\n  Campaign,\n  ClickIdParameters,\n  ReferrerParameters,\n  UTMParameters,\n} from '@amplitude/analytics-core';\n", "/* eslint-disable @typescript-eslint/unbound-method */\nimport client from './browser-client-factory';\nexport { createInstance } from './browser-client-factory';\nexport const {\n  add,\n  extendSession,\n  flush,\n  getDeviceId,\n  getIdentity,\n  getOptOut,\n  getSessionId,\n  getUserId,\n  groupIdentify,\n  identify,\n  init,\n  logEvent,\n  remove,\n  reset,\n  revenue,\n  setDeviceId,\n  setGroup,\n  setOptOut,\n  setSessionId,\n  setTransport,\n  setUserId,\n  track,\n  _setDiagnosticsSampleRate,\n} = client;\nexport { AmplitudeBrowser } from './browser-client';\nexport { runQueuedFunctions } from './utils/snippet-helper';\nexport { Revenue, Identify } from '@amplitude/analytics-core';\n\n// Export types to maintain backward compatibility with `analytics-types`.\n// In the next major version, only export customer-facing types to reduce the public API surface.\nexport * as Types from './types';\n"],
  "mappings": "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",
  "names": ["d", "b", "p", "__assign", "t", "s", "i", "n", "e", "P", "e", "_", "t", "f", "y", "g", "n", "v", "o", "s", "m", "i", "n", "r", "e", "i", "l", "IdentifyOperation", "SpecialEventType", "Identify", "IdentifyOperation", "IdentifyOperation", "Status", "a", "globalScope", "r", "_a", "Timeline", "plugin", "e", "_a", "_b", "identify", "groupIdentify", "revenue", "AmplitudeCore", "identify", "revenue", "plugin", "Revenue", "revenue", "RevenueProperty", "LogLevel", "Logger", "Config", "RequestMetadata", "Destination", "_a", "ApplicationContextProviderImpl", "EventBridgeImpl", "__assign", "t", "s", "i", "n", "p", "__values", "o", "m", "__read", "r", "e", "__values", "p", "i", "IdentityStoreImpl", "self", "__assign", "__read", "AnalyticsConnector", "IdentityEventSender", "getLanguage", "globalScope", "e", "i", "MemoryStorage", "CookieStorage", "globalScope", "cookie", "c", "_a", "BrowserStorage", "DiagnosticsStorage", "_a", "event", "DiagnosticsClient", "BaseTransport", "FetchTransport", "RemoteConfigLocalStorage", "RemoteConfigClient", "result", "_", "attempt", "i", "ServerZone", "i", "k", "l", "RequestWrapperFetch", "_a", "_b", "value", "key", "global", "RequestWrapperXhr", "global", "ResponseWrapperFetch", "ResponseWrapperXhr", "PRUNE_STRATEGY", "key", "e", "i", "NetworkRequestEvent", "_a", "_b", "_", "v", "NetworkEventCallback", "NetworkObserver", "globalScope", "CampaignParser", "o", "i", "n", "x", "e", "subscription", "m", "Subscription", "SubscriptionObserver", "Observable", "C", "v", "value", "s", "subscription", "extendStatics", "d", "b", "p", "__extends", "__assign", "t", "s", "i", "n", "__rest", "e", "__awaiter", "P", "e", "__generator", "_", "t", "f", "y", "g", "n", "v", "__values", "o", "s", "m", "i", "__read", "n", "r", "e", "__spreadArray", "i", "l", "__assign", "_a", "i", "Context", "__assign", "getLanguage", "__extends", "LocalStorage", "localStorage", "e", "__extends", "SessionStorage", "__extends", "XHRTransport", "_a", "__assign", "__values", "__read", "__extends", "SendBeaconTransport", "globalScope", "e", "__read", "__extends", "BrowserConfig", "identify", "__assign", "__awaiter", "i", "__assign", "t", "s", "i", "n", "p", "__awaiter", "P", "e", "__generator", "_", "t", "f", "y", "g", "n", "v", "__read", "o", "n", "m", "i", "r", "e", "__spreadArray", "i", "l", "globalScope", "getDecodeURI", "e", "__awaiter", "__assign", "_a", "_b", "__read", "__generator", "__spreadArray", "addEventListener", "type", "__awaiter", "_a", "e", "__generator", "addEventListener", "type", "__awaiter", "a", "_a", "__generator", "globalScope", "type", "__awaiter", "__values", "e", "__spreadArray", "__read", "__assign", "__assign", "t", "s", "i", "n", "p", "__awaiter", "P", "e", "__generator", "_", "t", "f", "y", "g", "n", "v", "__values", "o", "s", "m", "i", "__read", "n", "r", "e", "__spreadArray", "i", "l", "VERSION", "_a", "__read", "MouseButton", "attr", "__values", "DataExtractor", "i", "_b", "__spreadArray", "__read", "_a", "hierarchyNode", "__values", "WindowMessenger", "_b", "_a", "VERSION", "globalScope", "_", "__assign", "browserEvent", "__values", "e", "TriggerEvaluator", "ObservablesEnum", "VERSION", "_a", "__assign", "_b", "__awaiter", "__spreadArray", "__read", "__values", "subscription", "__assign", "__assign", "__awaiter", "__assign", "_a", "__spreadArray", "__read", "__assign", "_a", "__awaiter", "__values", "subscription", "__awaiter", "P", "e", "__generator", "_", "t", "f", "y", "g", "n", "v", "__values", "o", "s", "m", "i", "__read", "n", "r", "e", "__spreadArray", "i", "l", "PLUGIN_NAME", "__values", "r", "__read", "e", "__spreadArray", "_a", "ObservablesEnum", "PLUGIN_NAME", "type", "__awaiter", "__awaiter", "P", "e", "__generator", "_", "t", "f", "y", "g", "n", "v", "PLUGIN_NAME", "t", "n", "e", "i", "s", "o", "r", "c", "a", "d", "f", "u", "l", "m", "p", "globalScope", "location", "__awaiter", "PLUGIN_NAME", "isNewSession", "__rest", "__assign", "identify", "__read", "WebAttribution", "__assign", "__read", "__assign", "t", "s", "i", "n", "p", "__awaiter", "P", "e", "__generator", "_", "t", "f", "y", "g", "n", "v", "__read", "o", "n", "m", "i", "r", "e", "PreviousPageType", "globalScope", "e", "__awaiter", "_b", "_a", "_", "__read", "__assign", "__extends", "AmplitudeBrowser", "__assign", "_a", "__rest", "identify", "revenue", "e"]
}
